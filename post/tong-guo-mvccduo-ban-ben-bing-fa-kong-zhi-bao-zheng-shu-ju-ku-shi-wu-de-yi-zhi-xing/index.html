<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="è…°ç›é†‹é™æ€ä¸ªäººåšå®¢">
<meta name="description" content="æ¸©æ•…è€ŒçŸ¥æ–°">
<meta name="theme-color" content="#000">
<title>é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ä¿è¯æ•°æ®åº“äº‹åŠ¡çš„ä¸€è‡´æ€§ | è…°ç›é†‹</title>
<link rel="shortcut icon" href="/favicon.ico?v=1637045473816">
<link rel="stylesheet" href="/media/css/pisces.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/default.css"
  rel="stylesheet">

<link rel="stylesheet" href="/styles/main.css">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>





  <meta name="description" content="é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ä¿è¯æ•°æ®åº“äº‹åŠ¡çš„ä¸€è‡´æ€§" />
  <meta name="keywords" content="" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="pisces">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>è…°ç›é†‹</span>
            </a>  
          
        </div>
        
          <p class="subtitle">å³ä½¿åšå’¸é±¼,ä¹Ÿè¦åšæœ€å’¸çš„é‚£ä¸€æ¡</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> å½’æ¡£
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> æ ‡ç­¾
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> å‹æƒ…é“¾æ¥
                  
                </a>
              </li>
            
          
          
            <li id="fa_search" class="nav-item">
              <a href="javascript:void(0);">
                <i class="fa fa-search"></i> <span class="language" data-lan="search">æœç´¢</span>
              </a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout pisces ">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper bg-color right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">æ–‡ç« ç›®å½•</span>
            <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">ç«™ç‚¹æ¦‚è§ˆ</span>
          </div>
        </div>
      
      <div class="sidebar-body pisces" id="sidebar_body">
        
          
            <div class="post-side-meta" id="post_side_meta">
              
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">è…°ç›é†‹</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">48</span>
        <span class="site-item-stat-name language" data-lan="article">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">27</span>
        <span class="site-item-stat-name language" data-lan="category">åˆ†ç±»</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">27</span>
        <span class="site-item-stat-name language" data-lan="tag">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
    
  
  



</div>
            </div>
            <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
              <div class="toc-box right-motion">
  <div class="toc-wrapper auto-number auto"
    id="toc_wrapper">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#undo-%E6%97%A5%E5%BF%97%E9%93%BE%E8%A1%A8">undo æ—¥å¿—é“¾è¡¨</a></li>
<li><a href="#readview-%E5%8F%AF%E8%AF%BB%E8%A7%86%E5%9B%BE">ReadView ï¼ˆå¯è¯»è§†å›¾ï¼‰</a></li>
</ul>
</li>
</ul>

  </div>
</div>

<script>

  let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
  let active = 'active-show', activeClass = 'active-current';
  let tocWrapper = document.querySelector('#toc_wrapper');
  let tocContent = tocWrapper.children[0];
  let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

  function addTocNumber(elem, deep) {
    if (!elem) {
      return;
    }
    let prop = elem.__proto__;

    if (prop === HTMLUListElement.prototype) {
      for (let i = 0; i < elem.children.length; i++) {
        addTocNumber(elem.children[i], deep + (i + 1) + '.');
      }
    } else if (prop === HTMLLIElement.prototype) {
      // ä¿å­˜liå…ƒç´ 
      if (elem.children[0] && elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
        lList.push(elem);
      }
      for (let i = 0; i < elem.children.length; i++) {
        let cur = elem.children[i];
        if (cur.__proto__ === HTMLAnchorElement.prototype) {
          if (autoNumber) {
            cur.text = deep + ' ' + cur.text;
          }
        } else if (cur.__proto__ === HTMLUListElement.prototype) {
          addTocNumber(cur, deep);
        }
      }
    }
  }

  function removeParentActiveClass() {
    let parents = tocContent.querySelectorAll('.' + active)
    parents.forEach(function (elem) {
      elem.classList.remove(active);
    });
  }

  function addActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.add(activeClass);
    }
  }

  function removeActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.remove(activeClass);
    }
  }

  function addActiveLiElemment(elem, parent) {
    if (!elem || elem === parent) {
      return;
    } else {
      if (elem.__proto__ === HTMLLIElement.prototype) {
        elem.classList.add(active);
      }
      addActiveLiElemment(elem.parentElement, parent);
    }
  }

  function showToc() {
    if (tocWrapper) {
      postBody = document.querySelector('#post_body');
      for (let i = 0; i < postBody.children.length; i++) {
        if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
          hList.push(postBody.children[i]);
        }
      }
      if (tocWrapper.classList.contains('compress')) {
        tocContent.classList.add('closed');
      } else if (tocWrapper.classList.contains('no_compress')) {
        tocContent.classList.add('expanded');
      } else {
        if (hList.length > 10) {
          active = 'active-hidden'
          tocContent.classList.add('closed');
        } else {
          tocContent.classList.add('expanded');
        }
      }
    }
  }

  (function () {
    // å¤„ç†ä¸æ˜¯ä»#ä¸€çº§æ ‡é¢˜å¼€å§‹ç›®å½•
    if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
      let con = tocContent.children[0].children[0];
      tocContent.innerHTML = con.innerHTML;
    }
    let markdownItTOC = document.querySelector('.markdownIt-TOC');
    let innerHeight = window.innerHeight;
    markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
    addTocNumber(tocContent, '');
  })();

  document.addEventListener('scroll', function (e) {
    if (lList.length <= 0) {
      return;
    }
    let scrollTop = document.scrollingElement.scrollTop + 10;
    let dir;

    if (lastTop - scrollTop > 0) {
      dir = 'up';
    } else {
      dir = 'down';
    }

    lastTop = scrollTop;
    if (scrollTop <= 0) {
      if (lastIndex >= 0 && lastIndex < hList.length) {
        lList[lastIndex].classList.remove(activeClass);
      }
      return;
    }

    let current = 0, hasFind = false;
    for (let i = 0; i < hList.length; i++) {
      if (hList[i].offsetTop > scrollTop) {
        current = i;
        hasFind = true;
        break;
      }
    }
    if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
      current = hList.length - 1;
    } else {
      current--;
    }
    if (dir === 'down') {
      if (current > lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex)
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    } else {
      if (current < lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex);
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    }
  });


  window.addEventListener('load', function () {
    showToc();
    document.querySelector('#sidebar').style = 'display: block;';
    tocWrapper.classList.add('toc-active');
    setTimeout(function () {
      if ("createEvent" in document) {
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("scroll", false, true);
        document.dispatchEvent(evt);
      }
      else {
        document.fireEvent("scroll");
      }
    }, 500)
  })

</script>
            </div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    window.Velocity(hideElement, 'stop');
    window.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        window.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <section class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="http://weakcc.github.io/post/tong-guo-mvccduo-ban-ben-bing-fa-kong-zhi-bao-zheng-shu-ju-ku-shi-wu-de-yi-zhi-xing/">
      é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ä¿è¯æ•°æ®åº“äº‹åŠ¡çš„ä¸€è‡´æ€§
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">å‘å¸ƒäº</span>
      <span class="publish-time" data-t="2021-11-12 08:18:09">2021-11-12</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>8<span class="language" data-lan="minute">åˆ†é’Ÿ</span></span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>2191<span class="pc-show language" data-lan="words">å­—æ•°</span></span>
    </span>
    
    
    
    <span id="/post/tong-guo-mvccduo-ban-ben-bing-fa-kong-zhi-bao-zheng-shu-ju-ku-shi-wu-de-yi-zhi-xing/" data-flag-title="é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ä¿è¯æ•°æ®åº“äº‹åŠ¡çš„ä¸€è‡´æ€§" class="meta-item pc-show leancloud_visitors">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-eye"></i>
      <span><span class="language" data-lan="view">æµè§ˆé‡</span>ï¼š<span class="leancloud-visitors-count"></span></span>
    </span>
    
  </div>
</section>
            <div class="post-body next-md-body" id="post_body">
              <p><code>MVCC</code> çš„è‹±æ–‡å…¨ç§°æ˜¯ <strong>Multiversion Concurrency Control</strong>ï¼Œä¸­æ–‡æ„æ€æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æŠ€æœ¯ã€‚åŸç†æ˜¯ï¼Œé€šè¿‡æ•°æ®è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç®¡ç†æ¥å®ç°æ•°æ®åº“çš„å¹¶å‘æ§åˆ¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¿å­˜æ•°æ®çš„å†å²ç‰ˆæœ¬ã€‚å¯ä»¥é€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·å†³å®šæ•°æ®æ˜¯å¦æ˜¾ç¤ºå‡ºæ¥ã€‚è¯»å–æ•°æ®çš„æ—¶å€™ä¸éœ€è¦åŠ é”å¯ä»¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ•ˆæœã€‚</p>
<!-- more -->
<h2 id="undo-æ—¥å¿—é“¾è¡¨">undo æ—¥å¿—é“¾è¡¨</h2>
<p>å½“ InnoDB å¼•æ“åº•å±‚å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡çš„æ—¶å€™ï¼Œä¼šåˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„äº‹åŠ¡ IDï¼Œè¯¥äº‹åŠ¡ ID å†™å…¥ undo æ—¥å¿—çš„åŒæ—¶ä¹Ÿä¼šå­˜å‚¨åˆ°æ•°æ®è¡¨è®°å½•ç°‡æ‹¥ç´¢å¼•çš„ <code>trx_id</code> éšè—åˆ—ä¸­ã€‚<br>
<img src="http://weakcc.github.io/post-images/1636676416765.png" alt="" loading="lazy"><br>
å¦ä¸€ä¸ªéšè—åˆ— <code>roll_pointer</code> æŒ‡é’ˆä¼šæŒ‡å‘è¯¥è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ undo æ—¥å¿—ï¼Œå‘ç”Ÿäº‹åŠ¡å›æ»šæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥æŒ‡é’ˆæ‰¾åˆ°è¿™æ¡è®°å½•è¦å›æ»šåˆ°çš„ç‰ˆæœ¬ã€‚<br>
è¿™æ ·ï¼Œæ¯æ¬¡è®°å½•æ›´æ–°åï¼Œä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å€¼å°±ä¼šè¢«å­˜æ”¾åˆ° undo æ—¥å¿—ä¸­ï¼Œå¹¶ä¸”å°†å½“å‰æœ€æ–°è®°å½•çš„ <code>roll_pointer</code> æŒ‡é’ˆæŒ‡å‘è¯¥ undo æ—¥å¿—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„ <code>roll_pointer</code> æŒ‡é’ˆä¸²æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¯¥é“¾è¡¨è¢«ç§°ä½œç‰ˆæœ¬é“¾ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•æœ€æ–°ç‰ˆæœ¬çš„å€¼ã€‚<br>
ğŸŒ°<br>
ç°åœ¨å‡è®¾æœ‰ä¸€ä¸ª<code>äº‹åŠ¡ Aï¼ˆid=50ï¼‰</code>ï¼Œæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™æ¡æ•°æ®çš„éšè—å­—æ®µä»¥åŠæŒ‡å‘çš„ <code>undo log</code> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ’å…¥çš„è¿™æ¡æ•°æ®çš„å€¼æ˜¯ Aï¼Œå› æ­¤æ­¤æ—¶<code>äº‹åŠ¡ A</code> çš„ id æ˜¯ 50ï¼Œæ‰€ä»¥è¿™æ¡æ•°æ®çš„ <code>txr_id</code> å°±æ˜¯ 50ï¼Œ<code>roll_pointer</code> æŒ‡å‘ä¸€ä¸ªç©ºçš„ <code>undo log</code>ï¼Œå› ä¸ºä¹‹å‰è¿™æ¡æ•°æ®æ˜¯æ²¡æœ‰çš„ã€‚<br>
<img src="http://weakcc.github.io/post-images/1636681437542.png" alt="" loading="lazy"><br>
æ¥ç€æœ‰ä¸€ä¸ª<code>äº‹åŠ¡ B</code> è·‘æ¥ä¿®æ”¹äº†ä¸€ä¸‹è¿™æ¡æ•°æ®ï¼ŒæŠŠå€¼æ”¹æˆäº†å€¼ Bï¼Œ<code>äº‹åŠ¡ B</code> çš„ id æ˜¯ 58ï¼Œé‚£ä¹ˆæ­¤æ—¶æ›´æ–°ä¹‹å‰ä¼šç”Ÿæˆä¸€ä¸ª <code>undo log</code> è®°å½•ä¹‹å‰çš„å€¼ï¼Œç„¶åä¼šæŠŠ <code>roll pointer</code> æŒ‡å‘è¿™ä¸ªå®é™…çš„ <code>undo log</code> å›æ»šæ—¥å¿—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br>
<img src="http://weakcc.github.io/post-images/1636681605467.png" alt="" loading="lazy"><br>
æ¥ç€<code>äº‹åŠ¡ C</code> åŒç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br>
<img src="http://weakcc.github.io/post-images/1636681701729.png" alt="" loading="lazy"><br>
å¤šä¸ªäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼Œæ¯ä¸ªäººä¿®æ”¹äº†ä¸€è¡Œæ•°æ®ï¼Œéƒ½ä¼šæ›´æ–°éšè—å­—æ®µ <code>txr_id</code> å’Œ <code>roll_pointer</code>ï¼ŒåŒæ—¶ä¹‹å‰å¤šä¸ªæ•°æ®å¿«ç…§å¯¹åº”çš„ <code>undo log</code>ï¼Œä¼šé€šè¿‡ <code>roll_pointer</code> æŒ‡é’ˆä¸²è”èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªé‡è¦çš„ç‰ˆæœ¬é“¾ã€‚</p>
<h2 id="readview-å¯è¯»è§†å›¾">ReadView ï¼ˆå¯è¯»è§†å›¾ï¼‰</h2>
<p>ReadView å®é™…ä¸Šæ˜¯å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰æ´»è·ƒäº‹åŠ¡çš„åˆ—è¡¨ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç»„æˆéƒ¨åˆ†ï¼š</p>
<ul>
<li><code>m_ids</code>ï¼šåœ¨ç”Ÿæˆ ReadView æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡ ID åˆ—è¡¨</li>
<li><code>min_trx_id</code>ï¼šåœ¨ç”Ÿæˆ ReadView æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ IDï¼Œä¹Ÿå°±æ˜¯ m_ids ä¸­çš„æœ€å°å€¼</li>
<li><code>max_trx_id</code>ï¼šåœ¨ç”Ÿæˆ ReadView æ—¶ç³»ç»Ÿä¸­åº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ ID å€¼</li>
<li><code>creator_trx_id</code>ï¼šç”Ÿæˆ ReadView çš„äº‹åŠ¡å¯¹åº”çš„äº‹åŠ¡ IDï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡ ID</li>
</ul>
<p>æœ‰äº†è¿™ä¸ª ReadView ä¹‹åï¼Œåœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤åˆ¤æ–­è¯¥è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ï¼š</p>
<ul>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ <code>trx_id</code> å±æ€§å€¼ä¸ ReadView ä¸­çš„ <code>tcreator_trx_id</code> å€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®</li>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ <code>trx_id</code> å±æ€§å€¼å°äº ReadView ä¸­çš„ <code>min_trx_id</code> å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”Ÿæˆ ReadView å‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®</li>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ <code>trx_id</code> å±æ€§å€¼å¤§äºæˆ–ç­‰äº ReadView ä¸­çš„ <code>max_trx_id</code> å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”Ÿæˆ ReadView åæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®</li>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ <code>trx_id</code> å±æ€§å€¼åœ¨ ReadView çš„ <code>min_trx_id</code> å’Œ <code>max_trx_id</code> ä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹ <code>trx_id</code> å±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨ <code>m_ids</code> åˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»º ReadView æ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ï¼›å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»º ReadView æ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬è®°å½•å¯ä»¥è¢«è®¿é—®</li>
<li>å¦‚æœæŸä¸ªç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§çš„è¯ï¼Œé‚£å°±é¡ºç€ç‰ˆæœ¬é“¾æ‰¾åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œç»§ç»­æŒ‰ç…§ä¸Šè¾¹çš„æ­¥éª¤åˆ¤æ–­å¯è§æ€§ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç‰ˆæœ¬é“¾ä¸­çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚æœæœ€åä¸€ä¸ªç‰ˆæœ¬ä¹Ÿä¸å¯è§çš„è¯ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¯¥æ¡è®°å½•å¯¹è¯¥äº‹åŠ¡å®Œå…¨ä¸å¯è§ï¼ŒæŸ¥è¯¢ç»“æœå°±ä¸åŒ…å«è¯¥è®°å½•</li>
</ul>
<p>ğŸŒ°<br>
å‡è®¾åŸæ¥æ•°æ®åº“é‡Œå°±æœ‰ä¸€è¡Œæ•°æ®ï¼Œå¾ˆæ—©ä»¥å‰å°±æœ‰äº‹åŠ¡æ’å…¥è¿‡äº†ï¼Œäº‹åŠ¡ id æ˜¯ 32ï¼Œä»–çš„åˆå§‹å€¼ï¼Œå¦‚ä¸‹å›¾<br>
<img src="http://weakcc.github.io/post-images/1636682975510.png" alt="" loading="lazy"><br>
æ¥ç€å‘¢ï¼Œæ­¤æ—¶ä¸¤ä¸ªäº‹åŠ¡å¹¶å‘æ¥æ‰§è¡Œäº†ï¼Œä¸€ä¸ª<code>äº‹åŠ¡ A</code>ï¼ˆid=45ï¼‰ï¼Œä¸€ä¸ª<code>äº‹åŠ¡ B</code>ï¼ˆid=59ï¼‰ï¼Œ<code>äº‹åŠ¡ B</code> æ˜¯è¦å»æ›´æ–°è¿™è¡Œæ•°æ®çš„ï¼Œ<code>äº‹åŠ¡ A</code> æ˜¯è¦å»è¯»å–è¿™è¡Œæ•°æ®çš„ï¼Œæ­¤æ—¶ä¸¤ä¸ªäº‹åŠ¡å¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636683099964.png" alt="" loading="lazy"><br>
ç°åœ¨<code>äº‹åŠ¡ A</code> ç›´æ¥å¼€å¯ä¸€ä¸ª <code>ReadView</code>ï¼Œè¿™åˆš <code>ReadView</code> é‡Œçš„ <code>m_ids</code> å°±åŒ…å«äº†<code>äº‹åŠ¡ A</code> å’Œ<code>äº‹åŠ¡ B</code> çš„ä¸¤ä¸ª idï¼Œ45 å’Œ 59ï¼Œç„¶å <code>min_trx_id</code> å°±æ˜¯ 45ï¼Œ<code>max_trx_id</code> å°±æ˜¯ 60ï¼Œ<code>creator_trx_id å°±æ˜¯ 45ï¼Œæ˜¯</code>äº‹åŠ¡ A` è‡ªå·±ã€‚</p>
<p>è¿™åˆšæ—¶å€™<code>äº‹åŠ¡ A</code> ç¬¬ä¸€æ¬¡æŸ¥è¯¢è¿™è¡Œæ•°æ®ï¼Œä¼šèµ°ä¸€ä¸ªåˆ¤æ–­ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™è¡Œæ•°æ®çš„ <code>trx_id</code> æ˜¯å¦å°äº <code>ReadView</code> ä¸­çš„ <code>min_trx_id</code>ï¼Œæ­¤æ—¶å‘ç° <code>trx_id=32</code> ï¼Œæ˜¯å°äº <code>ReadView</code> é‡Œçš„ <code>min_trx_id</code> å°±æ˜¯ 45 çš„ï¼Œè¯´æ˜ä½ äº‹åŠ¡å¼€å¯ä¹‹å‰ï¼Œä¿®æ”¹è¿™è¡Œæ•°æ®çš„äº‹åŠ¡æ—©å·²æäº¤ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥æŸ¥è¯¢è¿™è¡Œæ•°æ®ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636683428146.png" alt="" loading="lazy"><br>
æ¥ç€<code>äº‹åŠ¡ B</code> å¼€å§‹åŠ¨æ‰‹äº†ï¼Œä»–æŠŠè¿™è¡Œæ•°æ®çš„å€¼æ”¹ä¸ºäº†å€¼ Bï¼Œç„¶åè¿™è¡Œæ•°æ®çš„ <code>trx_id</code> è®¾ç½®ä¸ºè‡ªå·±çš„ idï¼Œä¹Ÿå°±æ˜¯ 59ï¼ŒåŒæ—¶ <code>roll_pointer</code> æŒ‡å‘äº†ä¿®æ”¹ä¹‹å‰ç”Ÿæˆçš„ä¸€ä¸ª <code>undo log</code>ï¼Œæ¥ç€è¿™ä¸ª<code>äº‹åŠ¡ B</code> å°±æäº¤äº†ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636683586822.png" alt="" loading="lazy"><br>
è¿™ä¸ªæ—¶å€™ <code>äº‹åŠ¡ A</code> å†æ¬¡æŸ¥è¯¢ï¼Œæ­¤æ—¶æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ­¤æ—¶æ•°æ®è¡Œé‡Œçš„ <code>trx_id=59</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª <code>trx_id</code> æ˜¯å¤§äº <code>ReadView</code> é‡Œçš„ <code>min_trx_idï¼ˆ45ï¼‰</code>ï¼ŒåŒæ—¶å°äº <code>ReadView</code> é‡Œçš„ <code>max_trx_idï¼ˆ60ï¼‰</code>ï¼Œè¯´æ˜æ›´æ–°è¿™æ¡æ•°æ®çš„äº‹åŠ¡ï¼Œå¾ˆå¯èƒ½å°±è·Ÿè‡ªå·±å·®ä¸å¤šæ˜¯åŒæ—¶å¼€å¯çš„ï¼Œäºæ˜¯ä¼šçœ‹ä¸€ä¸‹è¿™ä¸ª <code>trx_id=59</code>ï¼Œæ˜¯å¦åœ¨ <code>ReadView</code> çš„ <code>m_ids</code> åˆ—è¡¨é‡Œçš„ï¼Ÿæœç„¶ï¼Œåœ¨ <code>ReadView</code> çš„ <code>m_ids</code> åˆ—è¡¨é‡Œï¼Œæœ‰ 45 å’Œ 59 ä¸¤ä¸ªäº‹åŠ¡ idï¼Œç›´æ¥è¯å®äº†ï¼Œè¿™ä¸ªä¿®æ”¹æ•°æ®çš„äº‹åŠ¡æ˜¯è·Ÿè‡ªå·±åŒä¸€æ—¶æ®µå¹¶å‘æ‰§è¡Œç„¶åæäº¤çš„ï¼Œæ‰€ä»¥è¿™è¡Œæ•°æ®æ˜¯ä¸èƒ½æŸ¥è¯¢çš„ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636683916110.png" alt="" loading="lazy"><br>
æ—¢ç„¶è¿™è¡Œæ•°æ®ä¸èƒ½æŸ¥è¯¢ï¼Œé‚£ä¹ˆæŸ¥è¯¢ä»€ä¹ˆå‘¢ï¼Ÿ<br>
ç®€å•ï¼Œé¡ºç€è¿™æ¡æ•°æ®çš„ <code>roll_pointer</code> é¡ºç€ <code>undo log</code> æ—¥å¿—é“¾æ¡å¾€ä¸‹æ‰¾ï¼Œå°±ä¼šæ‰¾åˆ°æœ€è¿‘ä¸€æ¡ <code>undo log</code>ï¼Œ<code>trx_id</code> æ˜¯ 32ï¼Œæ­¤æ—¶å‘ç° <code>trx_id=32</code>ï¼Œæ˜¯å°äº <code>ReadView</code> é‡Œçš„ <code>min_trx_idï¼ˆ45ï¼‰</code>çš„ï¼Œè¯´æ˜è¿™ä¸ª <code>undo log</code> ç‰ˆæœ¬å¿…ç„¶æ˜¯åœ¨<code>äº‹åŠ¡ A</code> å¼€å¯ä¹‹å‰å°±æ‰§è¡Œä¸”æäº¤çš„ã€‚<br>
å¥½äº†ï¼Œé‚£ä¹ˆå°±æŸ¥è¯¢æœ€è¿‘çš„ <code>undo log</code> é‡Œçš„å€¼å°±å¥½äº†ï¼Œè¿™å°±æ˜¯ <code>undo log</code> å¯¹ç‰ˆæœ¬é“¾æ¡çš„ä½œç”¨ï¼Œä»–å¯ä»¥ä¿å­˜ä¸€ä¸ªå¿«ç…§é“¾æ¡ï¼Œè®©ä½ å¯ä»¥è¯»åˆ°ä¹‹å‰çš„å¿«ç…§å€¼ã€‚å¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636684163556.png" alt="" loading="lazy"><br>
å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œ<code>äº‹åŠ¡ B</code> æ›´æ–°çš„å€¼ï¼Œé€šè¿‡è¿™å¥— <strong>ReadView + undo log</strong> æ—¥å¿—é“¾æ¡çš„æœºåˆ¶ï¼Œå°±å¯ä»¥ä¿è¯<code>äº‹åŠ¡ A</code> ä¸ä¼šè¯»åˆ°å¹¶å‘æ‰§è¡Œçš„<code>äº‹åŠ¡ B</code> æ›´æ–°çš„å€¼ï¼Œåªä¼šè¯»åˆ°ä¹‹å‰çš„å€¼ã€‚</p>
<p>æ¥ç€å‡è®¾<code>äº‹åŠ¡ A</code> è‡ªå·±æ›´æ–°äº†è¿™è¡Œæ•°æ®ï¼Œæ”¹ä¸ºå€¼ Aï¼Œ<code>trxt_id</code>ä¿®å¥½ä¸º 45ï¼ŒåŒæ—¶ä¿å­˜ä¹‹å‰<code>äº‹åŠ¡ B</code> ä¿®æ”¹å€¼çš„å¿«ç…§ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636684360943.png" alt="" loading="lazy"><br>
æ­¤æ—¶<code>äº‹åŠ¡ A</code> æ¥æŸ¥è¯¢è¿™æ¡æ•°æ®çš„å€¼ï¼Œä¼šå‘ç°è¿™ä¸ª <code>trx_id=45</code>ï¼Œå±…ç„¶è·Ÿè‡ªå·±çš„ <code>ReadView</code>é‡Œçš„ <code>creator_trx_idï¼ˆ45ï¼‰</code>æ˜¯ä¸€æ ·çš„ï¼Œè¯´æ˜ä»€ä¹ˆï¼Ÿ</p>
<p>è¯´æ˜è¿™è¡Œæ•°æ®çš„å°±æ˜¯è‡ªå·±ä¿®æ”¹çš„ï¼Œè‡ªå·±ä¿®æ”¹çš„å€¼å½“ç„¶æ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636684489534.png" alt="" loading="lazy"><br>
æ¥ç€åœ¨äº‹åŠ¡Aæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œçªç„¶å¼€å¯ä¸€ä¸ª<code>äº‹åŠ¡ C</code>ï¼Œè¿™ä¸ªäº‹åŠ¡çš„ id æ˜¯ 78ï¼Œç„¶åä»–æ›´æ–°äº†é‚£è¡Œæ•°æ®çš„å€¼ä¸ºå€¼ Cï¼Œè¿˜æäº¤äº†ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636684574035.png" alt="" loading="lazy"><br>
è¿™ä¸ªæ—¶å€™<code>äº‹åŠ¡ A</code> å†å»æŸ¥è¯¢ï¼Œä¼šå‘ç°å½“å‰æ•°æ®çš„ <code>trx_id=78</code>ï¼Œå¤§äºäº†è‡ªå·±çš„ <code>ReadView</code> ä¸­çš„ <code>max_trx_idï¼ˆ60ï¼‰</code>ï¼Œæ­¤æ—¶è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ</p>
<p>è¯´æ˜æ˜¯è¿™ä¸ª <code>äº‹åŠ¡ A</code> å¼€å¯ä¹‹åï¼Œç„¶åæœ‰ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†æ•°æ®ï¼Œè‡ªå·±å½“ç„¶æ˜¯ä¸èƒ½çœ‹åˆ°çš„ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636684712358.png" alt="" loading="lazy"><br>
æ­¤æ—¶å°±ä¼šé¡ºç€ <code>undo log</code> å¤šç‰ˆæœ¬é“¾æ¡å¾€ä¸‹æ‰¾ï¼Œå…ˆæ‰¾åˆ°å€¼ A æ˜¯è‡ªå·±ä¹‹å‰ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ï¼Œå› ä¸ºé‚£ä¸ª <code>trx_id=45</code> è·Ÿè‡ªå·±çš„ <code>ReadVie</code> é‡Œçš„ <code>creator_trx_id</code> æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ­¤æ—¶ç›´æ¥è¯»å–è‡ªå·±ä¹‹å‰ä¿®æ”¹çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œå¦‚ä¸‹<br>
<img src="http://weakcc.github.io/post-images/1636684860422.png" alt="" loading="lazy"></p>
<blockquote>
<p>æ³¨ï¼šåœ¨ MySQL InnoDB å¼•æ“ä¸­ï¼Œåªæœ‰ READ COMMITTD å’Œ REPEATABLE READ è¿™ä¸¤ç§éš”ç¦»çº§åˆ«æ‰å¯ä»¥ä½¿ç”¨ MVCCï¼Œåº”å¯¹é«˜å¹¶å‘äº‹åŠ¡ï¼ŒMVCC æ¯”å•çº¯çš„åŠ è¡Œé”æ›´æœ‰æ•ˆï¼Œå¼€é”€æ›´å°ã€‚</p>
</blockquote>

            </div>
            
              <div class="reward-btn">
                <div class="reward-btn-text">èµèµ</div>
              </div>
            
            
              <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong class="language" data-lan="author">æœ¬æ–‡ä½œè€…ï¼š</strong>
      è…°ç›é†‹
    </li>
    <li class="post-copyright-link">
      <strong class="language" data-lan="link">æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="http://weakcc.github.io/post/tong-guo-mvccduo-ban-ben-bing-fa-kong-zhi-bao-zheng-shu-ju-ku-shi-wu-de-yi-zhi-xing/" title="é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ä¿è¯æ•°æ®åº“äº‹åŠ¡çš„ä¸€è‡´æ€§">http://weakcc.github.io/post/tong-guo-mvccduo-ban-ben-bing-fa-kong-zhi-bao-zheng-shu-ju-ku-shi-wu-de-yi-zhi-xing/</a>
    </li>
    <li class="post-copyright-license">
      <strong class="language" data-lan="copyright">ç‰ˆæƒå£°æ˜ï¼š </strong>
      æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
  <div class="tags">
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="RabbitMQ ä»å…¥é—¨åˆ°æ”¾å¼ƒ" href="http://weakcc.github.io/post/rabbitmq-cong-ru-men-dao-fang-qi/">RabbitMQ ä»å…¥é—¨åˆ°æ”¾å¼ƒ</a>
        <a class="nav-mobile-next" title="RabbitMQ ä»å…¥é—¨åˆ°æ”¾å¼ƒ" href="http://weakcc.github.io/post/rabbitmq-cong-ru-men-dao-fang-qi/">ä¸‹ä¸€ç¯‡</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
            
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Â© 2019-2020 Theme By <a
        href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      Powered by <a href="https://weakcc.github.io/" target="_blank">è…°ç›é†‹</a>
    </div>
  </footer>
  
  
  <div class="pisces back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
  
  
<link rel="stylesheet" href="/media/live2d/css/live2d.css" />
<div class="box-scale">
  <div id="landlord" style="left: 10px;px;bottom: 10px;px;"
    data-key="">
    <canvas id="live2d" width="500" height="560" class="live2d"></canvas>
    

      <div class="message" style="opacity:0"></div>
      <div class="live_talk_input_body">
        <div class="live_talk_input_name_body">
          <input name="name" type="text" class="live_talk_name white_input" id="AIuserName" autocomplete="off"
            placeholder="ä½ çš„åå­—" />
        </div>
        <div class="live_talk_input_text_body">
          <input name="talk" type="text" class="live_talk_talk white_input" id="AIuserText" autocomplete="off"
            placeholder="è¦å’Œæˆ‘èŠä»€ä¹ˆå‘€ï¼Ÿ" />
          <button type="button" class="live_talk_send_btn" id="talk_send">å‘é€</button>
        </div>
      </div>
      <input name="live_talk" id="live_talk" value="1" type="hidden" />
      <div class="live_ico_box">
        <div class="live_ico_item type_info" id="showInfoBtn"></div>
        <div class="live_ico_item type_talk" id="showTalkBtn"></div>
        
        <div class="live_ico_item type_youdu" id="youduButton"></div>
        <div class="live_ico_item type_quit" id="hideButton"></div>
        <input name="live_statu_val" id="live_statu_val" value="0" type="hidden" />
        <audio src="" style="display:none;" id="live2d_bgm" data-bgm="0" preload="none"></audio>
        <input id="duType" value="douqilai" type="hidden">
        
      </div>
    
  </div>
</div>
<div id="open_live2d">å¬å”¤çœ‹æ¿å¨˜</div>
<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
  var message_Path = 'https://cdn.jsdelivr.net/gh/hsxyhao/live2d.github.io@master/';
  let landlord = document.querySelector('#landlord');
  var apiKey = landlord.dataset.key;
</script>
<script type="text/javascript" src="/media/live2d/js/live2d.js"></script>
<script>
	var home_Path = document.location.protocol + '//' + window.document.location.hostname + ":" + window.document.location.port + '/';
	var userAgent = window.navigator.userAgent.toLowerCase();
	var norunAI = ["android", "iphone", "ipod", "ipad", "windows phone", "mqqbrowser", "msie", "trident/7.0"];
	var norunFlag = false;

	for (var i = 0; i < norunAI.length; i++) {
		if (userAgent.indexOf(norunAI[i]) > -1) {
			norunFlag = true;
			break;
		}
	}

	if (!window.WebGLRenderingContext) {
		norunFlag = true;
	}

	if (!norunFlag) {
		var hitFlag = false;
		var AIFadeFlag = false;
		var liveTlakTimer = null;
		var sleepTimer_ = null;
		var AITalkFlag = false;
		var talkNum = 0;
		(function () {
			function renderTip(template, context) {
				var tokenReg = /(\\)?\{([^\{\}\\]+)(\\)?\}/g;
				return template.replace(tokenReg, function (word, slash1, token, slash2) {
					if (slash1 || slash2) {
						return word.replace('\\', '');
					}
					var variables = token.replace(/\s/g, '').split('.');
					var currentObject = context;
					var i, length, variable;
					for (i = 0, length = variables.length; i < length; ++i) {
						variable = variables[i];
						currentObject = currentObject[variable];
						if (currentObject === undefined || currentObject === null) return '';
					}
					return currentObject;
				});
			}

			String.prototype.renderTip = function (context) {
				return renderTip(this, context);
			};

			var re = /x/;
			re.toString = function () {
				showMessage('å“ˆå“ˆï¼Œä½ æ‰“å¼€äº†æ§åˆ¶å°ï¼Œæ˜¯æƒ³è¦çœ‹çœ‹æˆ‘çš„ç§˜å¯†å—ï¼Ÿ', 5000);
				return '';
			};

			$(document).on('copy', function () {
				showMessage('ä½ éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆå‘€ï¼Œè½¬è½½è¦è®°å¾—åŠ ä¸Šå‡ºå¤„å“¦~~', 5000);
			});

			function initTips() {
				$.ajax({
					cache: true,
					url: message_Path + 'message.json',
					dataType: "json",
					success: function (result) {
						$.each(result.mouseover, function (index, tips) {
							$(tips.selector).mouseover(function () {
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
								talkValTimer();
								clearInterval(liveTlakTimer);
								liveTlakTimer = null;
							});
							$(tips.selector).mouseout(function () {
								showHitokoto();
								if (liveTlakTimer == null) {
									liveTlakTimer = window.setInterval(function () {
										showHitokoto();
									}, 15000);
								};
							});
						});
						$.each(result.click, function (index, tips) {
							$(tips.selector).click(function () {
								if (hitFlag) {
									return false
								}
								hitFlag = true;
								setTimeout(function () {
									hitFlag = false;
								}, 8000);
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
							});
							clearInterval(liveTlakTimer);
							liveTlakTimer = null;
							if (liveTlakTimer == null) {
								liveTlakTimer = window.setInterval(function () {
									showHitokoto();
								}, 15000);
							};
						});
					}
				});
			}
			initTips();

			var text;
			if (document.referrer !== '') {
				var referrer = document.createElement('a');
				referrer.href = document.referrer;
				text = 'å—¨ï¼æ¥è‡ª <span style="color:#0099cc;">' + referrer.hostname + '</span> çš„æœ‹å‹ï¼';
				var domain = referrer.hostname.split('.')[1];
				if (domain == 'baidu') {
					text = 'å—¨ï¼ æ¥è‡ª ç™¾åº¦æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				} else if (domain == 'so') {
					text = 'å—¨ï¼ æ¥è‡ª 360æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				} else if (domain == 'google') {
					text = 'å—¨ï¼ æ¥è‡ª è°·æ­Œæœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				}
			} else {
				if (window.location.href == home_Path) { //ä¸»é¡µURLåˆ¤æ–­ï¼Œéœ€è¦æ–œæ ç»“å°¾
					var now = (new Date()).getHours();
					if (now > 23 || now <= 5) {
						text = 'ä½ æ˜¯å¤œçŒ«å­å‘€ï¼Ÿè¿™ä¹ˆæ™šè¿˜ä¸ç¡è§‰ï¼Œæ˜å¤©èµ·çš„æ¥å˜›ï¼Ÿ';
					} else if (now > 5 && now <= 7) {
						text = 'æ—©ä¸Šå¥½ï¼ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼Œç¾å¥½çš„ä¸€å¤©å°±è¦å¼€å§‹äº†ï¼';
					} else if (now > 7 && now <= 11) {
						text = 'ä¸Šåˆå¥½ï¼å·¥ä½œé¡ºåˆ©å˜›ï¼Œä¸è¦ä¹…åï¼Œå¤šèµ·æ¥èµ°åŠ¨èµ°åŠ¨å“¦ï¼';
					} else if (now > 11 && now <= 14) {
						text = 'ä¸­åˆäº†ï¼Œå·¥ä½œäº†ä¸€ä¸ªä¸Šåˆï¼Œç°åœ¨æ˜¯åˆé¤æ—¶é—´ï¼';
					} else if (now > 14 && now <= 17) {
						text = 'åˆåå¾ˆå®¹æ˜“çŠ¯å›°å‘¢ï¼Œä»Šå¤©çš„è¿åŠ¨ç›®æ ‡å®Œæˆäº†å—ï¼Ÿ';
					} else if (now > 17 && now <= 19) {
						text = 'å‚æ™šäº†ï¼çª—å¤–å¤•é˜³çš„æ™¯è‰²å¾ˆç¾ä¸½å‘¢ï¼Œæœ€ç¾ä¸è¿‡å¤•é˜³çº¢~~';
					} else if (now > 19 && now <= 21) {
						text = 'æ™šä¸Šå¥½ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ';
					} else if (now > 21 && now <= 23) {
						text = 'å·²ç»è¿™ä¹ˆæ™šäº†å‘€ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼Œæ™šå®‰~~';
					} else {
						text = 'å—¨~ å¿«æ¥é€—æˆ‘ç©å§ï¼';
					}
				} else {
					text = 'æ¬¢è¿é˜…è¯»<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				}
			}
			showMessage(text, 12000);
		})();

		liveTlakTimer = setInterval(function () {
			showHitokoto();
		}, 15000);

		function showHitokoto() {
			if (sessionStorage.getItem("Sleepy") !== "1") {
				if (!AITalkFlag) {
					$.getJSON('https://v1.hitokoto.cn/', function (result) {
						talkValTimer();
						showMessage(result.hitokoto, 0);
					});
				}
			} else {
				hideMessage(0);
				if (sleepTimer_ == null) {
					sleepTimer_ = setInterval(function () {
						checkSleep();
					}, 200);
				}
			}
		}

		function checkSleep() {
			var sleepStatu = sessionStorage.getItem("Sleepy");
			if (sleepStatu !== '1') {
				talkValTimer();
				showMessage('ä½ å›æ¥å•¦~', 0);
				clearInterval(sleepTimer_);
				sleepTimer_ = null;
			}
		}

		function showMessage(text, timeout) {
			if (Array.isArray(text)) text = text[Math.floor(Math.random() * text.length + 1) - 1];
			$('.message').stop();
			$('.message').html(text);
			$('.message').fadeTo(200, 1);
			//if (timeout === null) timeout = 5000;
			//hideMessage(timeout);
		}
		function talkValTimer() {
			$('#live_talk').val('1');
		}

		function hideMessage(timeout) {
			//$('.message').stop().css('opacity',1);
			if (timeout === null) timeout = 5000;
			$('.message').delay(timeout).fadeTo(200, 0);
		}

		function initLive2d() {
			$('#hideButton').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "0");
					$('#landlord').fadeOut(200);
					$('#open_live2d').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#open_live2d').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "1");
					$('#open_live2d').fadeOut(200);
					$('#landlord').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#youduButton').on('click', function () {
				if ($('#youduButton').hasClass('doudong')) {
					var typeIs = $('#youduButton').attr('data-type');
					$('#youduButton').removeClass('doudong');
					$('body').removeClass(typeIs);
					$('#youduButton').attr('data-type', '');
				} else {
					var duType = $('#duType').val();
					var duArr = duType.split(",");
					var dataType = duArr[Math.floor(Math.random() * duArr.length)];

					$('#youduButton').addClass('doudong');
					$('#youduButton').attr('data-type', dataType);
					$('body').addClass(dataType);
				}
			});
			if (apiKey) {
				$('#showInfoBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "0") {
						return
					} else {
						$('#live_statu_val').val("0");
						$('.live_talk_input_body').fadeOut(500);
						AITalkFlag = false;
						showHitokoto();
						$('#showTalkBtn').show();
						$('#showInfoBtn').hide();
					}
				});
				$('#showTalkBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "1") {
						return
					} else {
						$('#live_statu_val').val("1");
						$('.live_talk_input_body').fadeIn(500);
						AITalkFlag = true;
						$('#showTalkBtn').hide();
						$('#showInfoBtn').show();

					}
				});
				$('#talk_send').on('click', function () {
					var info_ = $('#AIuserText').val();
					var userid_ = $('#AIuserName').val();
					if (info_ == "") {
						showMessage('å†™ç‚¹ä»€ä¹ˆå§ï¼', 0);
						return;
					}
					if (userid_ == "") {
						showMessage('èŠä¹‹å‰è¯·å‘Šè¯‰æˆ‘ä½ çš„åå­—å§ï¼', 0);
						return;
					}
					showMessage('æ€è€ƒä¸­~', 0);
					let protocol = window.location.protocol.indexOf("s") > 0 ? "https" : "http";
					$.ajax({
						type: "get",
						url: `${protocol}://www.tuling123.com/openapi/api?key=${apiKey}&info=${info_}`,
						dataType: "json",
						success: function (res) {
							talkValTimer();
							showMessage(res.text, 0);
							$('#AIuserText').val("");
							sessionStorage.setItem("live2duser", userid_);
						},
						error: function (e) {
							talkValTimer();
							showMessage('ä¼¼ä¹æœ‰ä»€ä¹ˆé”™è¯¯ï¼Œè¯·å’Œç«™é•¿è”ç³»ï¼', 0);
						}
					});
				});
			} else {
				$('#showInfoBtn').hide();
				$('#showTalkBtn').hide();
			}
			//è·å–éŸ³ä¹ä¿¡æ¯åˆå§‹åŒ–
			var bgmListInfo = $('input[name=live2dBGM]');
			if (bgmListInfo.length == 0) {
				$('#musicButton').hide();
			} else {
				var bgmPlayNow = parseInt($('#live2d_bgm').attr('data-bgm'));
				var bgmPlayTime = 0;
				var live2dBGM_Num = sessionStorage.getItem("live2dBGM_Num");
				var live2dBGM_PlayTime = sessionStorage.getItem("live2dBGM_PlayTime");
				if (live2dBGM_Num) {
					if (live2dBGM_Num <= $('input[name=live2dBGM]').length - 1) {
						bgmPlayNow = parseInt(live2dBGM_Num);
					}
				}
				if (live2dBGM_PlayTime) {
					bgmPlayTime = parseInt(live2dBGM_PlayTime);
				}
				var live2dBGMSrc = bgmListInfo.eq(bgmPlayNow).val();
				$('#live2d_bgm').attr('data-bgm', bgmPlayNow);
				$('#live2d_bgm').attr('src', live2dBGMSrc);
				$('#live2d_bgm')[0].currentTime = bgmPlayTime;
				$('#live2d_bgm')[0].volume = 0.5;
				var live2dBGM_IsPlay = sessionStorage.getItem("live2dBGM_IsPlay");
				var live2dBGM_WindowClose = sessionStorage.getItem("live2dBGM_WindowClose");
				if (live2dBGM_IsPlay == '0' && live2dBGM_WindowClose == '0') {
					$('#live2d_bgm')[0].play();
					$('#musicButton').addClass('play');
				}
				sessionStorage.setItem("live2dBGM_WindowClose", '1');
				$('#musicButton').on('click', function () {
					if ($('#musicButton').hasClass('play')) {
						$('#live2d_bgm')[0].pause();
						$('#musicButton').removeClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '1');
					} else {
						$('#live2d_bgm')[0].play();
						$('#musicButton').addClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				});
				window.onbeforeunload = function () {
					sessionStorage.setItem("live2dBGM_WindowClose", '0');
					if ($('#musicButton').hasClass('play')) {
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				}
				document.getElementById('live2d_bgm').addEventListener("timeupdate", function () {
					var live2dBgmPlayTimeNow = document.getElementById('live2d_bgm').currentTime;
					sessionStorage.setItem("live2dBGM_PlayTime", live2dBgmPlayTimeNow);
				});
				document.getElementById('live2d_bgm').addEventListener("ended", function () {
					var listNow = parseInt($('#live2d_bgm').attr('data-bgm'));
					listNow++;
					if (listNow > $('input[name=live2dBGM]').length - 1) {
						listNow = 0;
					}
					var listNewSrc = $('input[name=live2dBGM]').eq(listNow).val();
					sessionStorage.setItem("live2dBGM_Num", listNow);
					$('#live2d_bgm').attr('src', listNewSrc);
					$('#live2d_bgm')[0].play();
					$('#live2d_bgm').attr('data-bgm', listNow);
				});
				document.getElementById('live2d_bgm').addEventListener("error", function () {
					$('#live2d_bgm')[0].pause();
					$('#musicButton').removeClass('play');
					showMessage('éŸ³ä¹ä¼¼ä¹åŠ è½½ä¸å‡ºæ¥äº†å‘¢ï¼', 0);
				});
			}
			//è·å–ç”¨æˆ·å
			var live2dUser = sessionStorage.getItem("live2duser");
			if (live2dUser !== null) {
				$('#AIuserName').val(live2dUser);
			}
			//è·å–ä½ç½®
			var landL = sessionStorage.getItem("historywidth");
			var landB = sessionStorage.getItem("historyheight");
			if (landL == null || landB == null) {
				landL = '5px'
				landB = '0px'
			}
			$('#landlord').css('left', landL + 'px');
			$('#landlord').css('bottom', landB + 'px');
			//ç§»åŠ¨
			function getEvent() {
				return window.event || arguments.callee.caller.arguments[0];
			}
			var smcc = document.getElementById("landlord");
			var moveX = 0;
			var moveY = 0;
			var moveBottom = 0;
			var moveLeft = 0;
			var moveable = false;
			var docMouseMoveEvent = document.onmousemove;
			var docMouseUpEvent = document.onmouseup;
			smcc.onmousedown = function () {
				var ent = getEvent();
				moveable = true;
				moveX = ent.clientX;
				moveY = ent.clientY;
				var obj = smcc;
				moveBottom = parseInt(obj.style.bottom);
				moveLeft = parseInt(obj.style.left);
				if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0) {
					window.getSelection().removeAllRanges();
				}
				document.onmousemove = function () {
					if (moveable) {
						var ent = getEvent();
						var x = moveLeft + ent.clientX - moveX;
						var y = moveBottom + (moveY - ent.clientY);
						obj.style.left = x + "px";
						obj.style.bottom = y + "px";
					}
				};
				document.onmouseup = function () {
					if (moveable) {
						var historywidth = obj.style.left;
						var historyheight = obj.style.bottom;
						historywidth = historywidth.replace('px', '');
						historyheight = historyheight.replace('px', '');
						sessionStorage.setItem("historywidth", historywidth);
						sessionStorage.setItem("historyheight", historyheight);
						document.onmousemove = docMouseMoveEvent;
						document.onmouseup = docMouseUpEvent;
						moveable = false;
						moveX = 0;
						moveY = 0;
						moveBottom = 0;
						moveLeft = 0;
					}
				};
			};
		}
		$(document).ready(function () {
			var AIimgSrc = [];
			let chooseLive2d = 'rem'
			if (chooseLive2d === 'histoire') {
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_00.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_01.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_02.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_03.png");
			} else if (chooseLive2d === 'rem') {
				AIimgSrc.push(message_Path + "model/rem/remu2048/texture_00.png");
			} else if (chooseLive2d === 'aoba') {
				AIimgSrc.push(message_Path + "model/aoba/textures/texture_00.png");
			} else if (chooseLive2d === 'hijiki') {
				AIimgSrc.push(message_Path + "model/hijiki/moc/hijiki.2048/texture_00.png");
			} else if (chooseLive2d === 'tororo') {
				AIimgSrc.push(message_Path + "model/tororo/moc/tororo.2048/texture_00.png");
			}
			var images = [];
			var imgLength = AIimgSrc.length;
			var loadingNum = 0;
			for (var i = 0; i < imgLength; i++) {
				images[i] = new Image();
				images[i].src = AIimgSrc[i];
				images[i].onload = function () {
					loadingNum++;
					if (loadingNum === imgLength) {
						var live2dhidden = localStorage.getItem("live2dhidden");
						if (live2dhidden === "0") {
							setTimeout(function () {
								$('#open_live2d').fadeIn(200);
							}, 1300);
						} else {
							setTimeout(function () {
								$('#landlord').fadeIn(200);
							}, 1300);
						}
						let model = '';
						if (chooseLive2d === 'histoire') {
							model = message_Path + "model/histoire/model.json";
						} else if (chooseLive2d === 'rem') {
							model = message_Path + "model/rem/model.json";
						} else if (chooseLive2d === 'aoba') {
							model = message_Path + "model/aoba/model.json";
						} else if (chooseLive2d === 'hijiki') {
							model = message_Path + "model/hijiki/hijiki.model.json";
						} else if (chooseLive2d === 'tororo') {
							model = message_Path + "model/tororo/tororo.model.json";
						}
						setTimeout(function () {
							loadlive2d("live2d", model);
						}, 1000);
						initLive2d();
						images = null;
					}
				}
			}
		});
	}
</script>
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
    back2TopText = document.querySelector('#back_to_top_text'),
    drawerBox = document.querySelector('#drawer_box'),
    rightSideBar = document.querySelector('.sidebar'),
    viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {

    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function (e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });

  window.addEventListener('scroll', function (e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });


  let hasCacu = false;
  window.onresize = function () {
    calcuHeight();
  }

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();

  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function () {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, transitionDir, {});
          }
        })
        window.Velocity(viewport, openProp, {
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp, {
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // é“¾æ¥è·³è½¬
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target", "_blank");
      }
    })
  }

  let faSearch = document.querySelector('#fa_search');
  faSearch.addEventListener('click', function () {
    document.querySelector('#search_mask').style = ''
  })

  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();
  
  // ç¦»å¼€å½“å‰é¡µtitleå˜åŒ–
  var leaveTitle = "";
  if (leaveTitle) {
    document.addEventListener('visibilitychange', function () {
      if (document.visibilityState == 'hidden') {
        normal_title = document.title;
        document.title = leaveTitle;
      } else {
        document.title = normal_title;
      }
    });
  }

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px;border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
    <div class="reward-mask" style="display: none;">
  <div class="reward-relative">
    <span class="close" aria-hidden="true">x</span>
    <div class="reward-body">
      <h2>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</h2>
      <div class="reward-img-box">
        <div style="position: relative; width: 140px; height: 140px;">
          
          
            <img id="zfb" class="reward-img" src="/media/images/custom-zfbImg.png" alt="èµèµç ">
          
          
            <img id="wx" class="reward-img" src="/media/images/custom-wxImg.png" alt="èµèµç ">
          
        </div>
      </div>
      <p class="reward-word">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p>
      <p class="reward-tip">æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œå³å¯è¿›è¡Œæ‰«ç æ‰“èµå“¦</p>
    </div>
    <div class="bottom">
      
      <div id="zfbBtn" class="pay-text">
        æ”¯ä»˜å®
      </div>
      
      
      <div id="wxBtn" class="pay-text">
        å¾®ä¿¡æ”¯ä»˜
      </div>
      
    </div>
  </div>
</div>
<style>
  .reward-mask {
    position: fixed;
    z-index: 99999;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #00000054;
  }

  .reward-relative {
    position: relative;
    width: 480px;
    text-align: center;
    margin: 0 auto;
    border-radius: 5px;
    background-color: #fff;
    top: 50%;
    margin-top: -205px;
  }

  .reward-relative .close {
    position: absolute;
    right: 10px;
    font-weight: normal;
    font-size: 16px;
    color: #929292;
  }

  .reward-body {
    padding: 40px 20px 20px;
  }

  .bottom {
    display: flex;
  }

  .reward-btn {
    text-align: center;
  }

  .reward-btn-text {
    display: inline-block;
    cursor: pointer;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    background-color: #ff9734;
    color: #FFF;
    margin-top: 20px;
  }

  .pay-text {
    margin-top: 10px;
    padding: 10px;
    flex: 1;
    transition: all .2s linear;
  }

  .pay-text:hover {
    background-color: #a5a5a536;
  }

  .reward-body h2 {
    padding-top: 10px;
    text-align: center;
    color: #a3a3a3;
    font-size: 16px;
    font-weight: normal;
    margin: 0 0 20px;
  }

  .reward-body h2:after,
  .reward-body h2:before {
    font-family: Arial, Helvetica, sans-serif;
    background: 0 0;
    width: 0;
    height: 0;
    font-style: normal;
    color: #eee;
    font-size: 80px;
    position: absolute;
    top: 20px;
  }

  .reward-body h2:before {
    content: '\201c';
    left: 50px;
  }

  .reward-body h2:after {
    content: '\201d';
    right: 80px;
  }

  .reward-img-box {
    display: inline-block;
    padding: 10px;
    border: 6px solid #ea5f00;
    margin: 0 auto;
    border-radius: 3px;
    position: relative;
  }

  .reward-img {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 767px) {
    .reward-relative {
      height: 100%;
      top: 0px;
      margin-top: 0;
      width: auto;
    }

    .reward-relative .bottom {
      flex-direction: column;
    }

    .reward-relative .pay-text {
      width: 80%;
      margin: 5px auto;
      border: 1px solid silver;
      padding: 6px;
      border-radius: 4px;
    }

    .reward-body h2:after {
      right: 40px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
      font-size: 60px;
    }

    .reward-body h2:before {
      left: 20px;
    }
  }
</style>
<script>
  !function () {
    var mask = document.querySelector('.reward-mask');
    let close = document.querySelector('.reward-relative .close');
    let rewardBtn = document.querySelector('.reward-btn');

    let zfb = document.querySelector('#zfb'),
      wx = document.querySelector('#wx'),
      zfbBtn = document.querySelector('#zfbBtn'),
      wxBtn = document.querySelector('#wxBtn');

    if (zfbBtn && wxBtn) {
      zfbBtn.addEventListener('click', () => {
        window.Velocity(zfb, 'transition.slideLeftIn', {
          duration: 400
        });
        window.Velocity(wx, 'transition.slideRightOut', {
          display: 'none',
          duration: 400
        });
      });

      wxBtn.addEventListener('click', () => {
        window.Velocity(wx, 'transition.slideRightIn', {
          duration: 400
        });
        window.Velocity(zfb, 'transition.slideLeftOut', {
          display: 'none',
          duration: 400
        });
      });
    }

    rewardBtn.addEventListener('click', (e) => {
      window.Velocity(mask, 'transition.slideDownIn', {
        duration: 400
      })
    });

    close.addEventListener('click', (e) => {
      e.preventDefault();
      window.Velocity(mask, 'transition.slideUpOut', {
        duration: 400
      })
    })
  }()
</script>

  </div>
</body>

<div class="search-mask" id="search_mask" style="display: none;">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input id="search" type="text" class="language" data-lan="search" placeholder="æœç´¢">
      </div>
      <i id="close" class="fa fa-times-circle"></i>
    </div>
    <div class="stat-box">
      <span id="stat_count">0</span><span class="language" data-lan="stat">æ¡ç›¸å…³æ¡ç›®ï¼Œä½¿ç”¨äº†</span><span id="stat_times">0</span><span class="language" data-lan="stat-time">æ¯«ç§’</span>
      <hr>
    </div>
    <div class="result" id="result">
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/tong-guo-mvccduo-ban-ben-bing-fa-kong-zhi-bao-zheng-shu-ju-ku-shi-wu-de-yi-zhi-xing/"" data-c="
          &lt;p&gt;&lt;code&gt;MVCC&lt;/code&gt; çš„è‹±æ–‡å…¨ç§°æ˜¯ &lt;strong&gt;Multiversion Concurrency Control&lt;/strong&gt;ï¼Œä¸­æ–‡æ„æ€æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æŠ€æœ¯ã€‚åŸç†æ˜¯ï¼Œé€šè¿‡æ•°æ®è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç®¡ç†æ¥å®ç°æ•°æ®åº“çš„å¹¶å‘æ§åˆ¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¿å­˜æ•°æ®çš„å†å²ç‰ˆæœ¬ã€‚å¯ä»¥é€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·å†³å®šæ•°æ®æ˜¯å¦æ˜¾ç¤ºå‡ºæ¥ã€‚è¯»å–æ•°æ®çš„æ—¶å€™ä¸éœ€è¦åŠ é”å¯ä»¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ•ˆæœã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;undo-æ—¥å¿—é“¾è¡¨&#34;&gt;undo æ—¥å¿—é“¾è¡¨&lt;/h2&gt;
&lt;p&gt;å½“ InnoDB å¼•æ“åº•å±‚å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡çš„æ—¶å€™ï¼Œä¼šåˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„äº‹åŠ¡ IDï¼Œè¯¥äº‹åŠ¡ ID å†™å…¥ undo æ—¥å¿—çš„åŒæ—¶ä¹Ÿä¼šå­˜å‚¨åˆ°æ•°æ®è¡¨è®°å½•ç°‡æ‹¥ç´¢å¼•çš„ &lt;code&gt;trx_id&lt;/code&gt; éšè—åˆ—ä¸­ã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636676416765.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¦ä¸€ä¸ªéšè—åˆ— &lt;code&gt;roll_pointer&lt;/code&gt; æŒ‡é’ˆä¼šæŒ‡å‘è¯¥è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ undo æ—¥å¿—ï¼Œå‘ç”Ÿäº‹åŠ¡å›æ»šæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥æŒ‡é’ˆæ‰¾åˆ°è¿™æ¡è®°å½•è¦å›æ»šåˆ°çš„ç‰ˆæœ¬ã€‚&lt;br&gt;
è¿™æ ·ï¼Œæ¯æ¬¡è®°å½•æ›´æ–°åï¼Œä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å€¼å°±ä¼šè¢«å­˜æ”¾åˆ° undo æ—¥å¿—ä¸­ï¼Œå¹¶ä¸”å°†å½“å‰æœ€æ–°è®°å½•çš„ &lt;code&gt;roll_pointer&lt;/code&gt; æŒ‡é’ˆæŒ‡å‘è¯¥ undo æ—¥å¿—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„ &lt;code&gt;roll_pointer&lt;/code&gt; æŒ‡é’ˆä¸²æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¯¥é“¾è¡¨è¢«ç§°ä½œç‰ˆæœ¬é“¾ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•æœ€æ–°ç‰ˆæœ¬çš„å€¼ã€‚&lt;br&gt;
ğŸŒ°&lt;br&gt;
ç°åœ¨å‡è®¾æœ‰ä¸€ä¸ª&lt;code&gt;äº‹åŠ¡ Aï¼ˆid=50ï¼‰&lt;/code&gt;ï¼Œæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™æ¡æ•°æ®çš„éšè—å­—æ®µä»¥åŠæŒ‡å‘çš„ &lt;code&gt;undo log&lt;/code&gt; å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ’å…¥çš„è¿™æ¡æ•°æ®çš„å€¼æ˜¯ Aï¼Œå› æ­¤æ­¤æ—¶&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; çš„ id æ˜¯ 50ï¼Œæ‰€ä»¥è¿™æ¡æ•°æ®çš„ &lt;code&gt;txr_id&lt;/code&gt; å°±æ˜¯ 50ï¼Œ&lt;code&gt;roll_pointer&lt;/code&gt; æŒ‡å‘ä¸€ä¸ªç©ºçš„ &lt;code&gt;undo log&lt;/code&gt;ï¼Œå› ä¸ºä¹‹å‰è¿™æ¡æ•°æ®æ˜¯æ²¡æœ‰çš„ã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636681437542.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ¥ç€æœ‰ä¸€ä¸ª&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; è·‘æ¥ä¿®æ”¹äº†ä¸€ä¸‹è¿™æ¡æ•°æ®ï¼ŒæŠŠå€¼æ”¹æˆäº†å€¼ Bï¼Œ&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; çš„ id æ˜¯ 58ï¼Œé‚£ä¹ˆæ­¤æ—¶æ›´æ–°ä¹‹å‰ä¼šç”Ÿæˆä¸€ä¸ª &lt;code&gt;undo log&lt;/code&gt; è®°å½•ä¹‹å‰çš„å€¼ï¼Œç„¶åä¼šæŠŠ &lt;code&gt;roll pointer&lt;/code&gt; æŒ‡å‘è¿™ä¸ªå®é™…çš„ &lt;code&gt;undo log&lt;/code&gt; å›æ»šæ—¥å¿—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636681605467.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ¥ç€&lt;code&gt;äº‹åŠ¡ C&lt;/code&gt; åŒç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636681701729.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¤šä¸ªäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼Œæ¯ä¸ªäººä¿®æ”¹äº†ä¸€è¡Œæ•°æ®ï¼Œéƒ½ä¼šæ›´æ–°éšè—å­—æ®µ &lt;code&gt;txr_id&lt;/code&gt; å’Œ &lt;code&gt;roll_pointer&lt;/code&gt;ï¼ŒåŒæ—¶ä¹‹å‰å¤šä¸ªæ•°æ®å¿«ç…§å¯¹åº”çš„ &lt;code&gt;undo log&lt;/code&gt;ï¼Œä¼šé€šè¿‡ &lt;code&gt;roll_pointer&lt;/code&gt; æŒ‡é’ˆä¸²è”èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªé‡è¦çš„ç‰ˆæœ¬é“¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;readview-å¯è¯»è§†å›¾&#34;&gt;ReadView ï¼ˆå¯è¯»è§†å›¾ï¼‰&lt;/h2&gt;
&lt;p&gt;ReadView å®é™…ä¸Šæ˜¯å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰æ´»è·ƒäº‹åŠ¡çš„åˆ—è¡¨ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç»„æˆéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;m_ids&lt;/code&gt;ï¼šåœ¨ç”Ÿæˆ ReadView æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡ ID åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;min_trx_id&lt;/code&gt;ï¼šåœ¨ç”Ÿæˆ ReadView æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ IDï¼Œä¹Ÿå°±æ˜¯ m_ids ä¸­çš„æœ€å°å€¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;max_trx_id&lt;/code&gt;ï¼šåœ¨ç”Ÿæˆ ReadView æ—¶ç³»ç»Ÿä¸­åº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ ID å€¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;creator_trx_id&lt;/code&gt;ï¼šç”Ÿæˆ ReadView çš„äº‹åŠ¡å¯¹åº”çš„äº‹åŠ¡ IDï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡ ID&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸ª ReadView ä¹‹åï¼Œåœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤åˆ¤æ–­è¯¥è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ &lt;code&gt;trx_id&lt;/code&gt; å±æ€§å€¼ä¸ ReadView ä¸­çš„ &lt;code&gt;tcreator_trx_id&lt;/code&gt; å€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®å®ƒè‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®&lt;/li&gt;
&lt;li&gt;å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ &lt;code&gt;trx_id&lt;/code&gt; å±æ€§å€¼å°äº ReadView ä¸­çš„ &lt;code&gt;min_trx_id&lt;/code&gt; å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”Ÿæˆ ReadView å‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®&lt;/li&gt;
&lt;li&gt;å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ &lt;code&gt;trx_id&lt;/code&gt; å±æ€§å€¼å¤§äºæˆ–ç­‰äº ReadView ä¸­çš„ &lt;code&gt;max_trx_id&lt;/code&gt; å€¼ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”Ÿæˆ ReadView åæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬è®°å½•ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®&lt;/li&gt;
&lt;li&gt;å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ &lt;code&gt;trx_id&lt;/code&gt; å±æ€§å€¼åœ¨ ReadView çš„ &lt;code&gt;min_trx_id&lt;/code&gt; å’Œ &lt;code&gt;max_trx_id&lt;/code&gt; ä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹ &lt;code&gt;trx_id&lt;/code&gt; å±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨ &lt;code&gt;m_ids&lt;/code&gt; åˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»º ReadView æ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ï¼›å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»º ReadView æ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬è®°å½•å¯ä»¥è¢«è®¿é—®&lt;/li&gt;
&lt;li&gt;å¦‚æœæŸä¸ªç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§çš„è¯ï¼Œé‚£å°±é¡ºç€ç‰ˆæœ¬é“¾æ‰¾åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œç»§ç»­æŒ‰ç…§ä¸Šè¾¹çš„æ­¥éª¤åˆ¤æ–­å¯è§æ€§ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç‰ˆæœ¬é“¾ä¸­çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚æœæœ€åä¸€ä¸ªç‰ˆæœ¬ä¹Ÿä¸å¯è§çš„è¯ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¯¥æ¡è®°å½•å¯¹è¯¥äº‹åŠ¡å®Œå…¨ä¸å¯è§ï¼ŒæŸ¥è¯¢ç»“æœå°±ä¸åŒ…å«è¯¥è®°å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸŒ°&lt;br&gt;
å‡è®¾åŸæ¥æ•°æ®åº“é‡Œå°±æœ‰ä¸€è¡Œæ•°æ®ï¼Œå¾ˆæ—©ä»¥å‰å°±æœ‰äº‹åŠ¡æ’å…¥è¿‡äº†ï¼Œäº‹åŠ¡ id æ˜¯ 32ï¼Œä»–çš„åˆå§‹å€¼ï¼Œå¦‚ä¸‹å›¾&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636682975510.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ¥ç€å‘¢ï¼Œæ­¤æ—¶ä¸¤ä¸ªäº‹åŠ¡å¹¶å‘æ¥æ‰§è¡Œäº†ï¼Œä¸€ä¸ª&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt;ï¼ˆid=45ï¼‰ï¼Œä¸€ä¸ª&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt;ï¼ˆid=59ï¼‰ï¼Œ&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; æ˜¯è¦å»æ›´æ–°è¿™è¡Œæ•°æ®çš„ï¼Œ&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; æ˜¯è¦å»è¯»å–è¿™è¡Œæ•°æ®çš„ï¼Œæ­¤æ—¶ä¸¤ä¸ªäº‹åŠ¡å¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636683099964.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç°åœ¨&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; ç›´æ¥å¼€å¯ä¸€ä¸ª &lt;code&gt;ReadView&lt;/code&gt;ï¼Œè¿™åˆš &lt;code&gt;ReadView&lt;/code&gt; é‡Œçš„ &lt;code&gt;m_ids&lt;/code&gt; å°±åŒ…å«äº†&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; å’Œ&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; çš„ä¸¤ä¸ª idï¼Œ45 å’Œ 59ï¼Œç„¶å &lt;code&gt;min_trx_id&lt;/code&gt; å°±æ˜¯ 45ï¼Œ&lt;code&gt;max_trx_id&lt;/code&gt; å°±æ˜¯ 60ï¼Œ&lt;code&gt;creator_trx_id å°±æ˜¯ 45ï¼Œæ˜¯&lt;/code&gt;äº‹åŠ¡ A` è‡ªå·±ã€‚&lt;/p&gt;
&lt;p&gt;è¿™åˆšæ—¶å€™&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; ç¬¬ä¸€æ¬¡æŸ¥è¯¢è¿™è¡Œæ•°æ®ï¼Œä¼šèµ°ä¸€ä¸ªåˆ¤æ–­ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™è¡Œæ•°æ®çš„ &lt;code&gt;trx_id&lt;/code&gt; æ˜¯å¦å°äº &lt;code&gt;ReadView&lt;/code&gt; ä¸­çš„ &lt;code&gt;min_trx_id&lt;/code&gt;ï¼Œæ­¤æ—¶å‘ç° &lt;code&gt;trx_id=32&lt;/code&gt; ï¼Œæ˜¯å°äº &lt;code&gt;ReadView&lt;/code&gt; é‡Œçš„ &lt;code&gt;min_trx_id&lt;/code&gt; å°±æ˜¯ 45 çš„ï¼Œè¯´æ˜ä½ äº‹åŠ¡å¼€å¯ä¹‹å‰ï¼Œä¿®æ”¹è¿™è¡Œæ•°æ®çš„äº‹åŠ¡æ—©å·²æäº¤ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥æŸ¥è¯¢è¿™è¡Œæ•°æ®ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636683428146.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ¥ç€&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; å¼€å§‹åŠ¨æ‰‹äº†ï¼Œä»–æŠŠè¿™è¡Œæ•°æ®çš„å€¼æ”¹ä¸ºäº†å€¼ Bï¼Œç„¶åè¿™è¡Œæ•°æ®çš„ &lt;code&gt;trx_id&lt;/code&gt; è®¾ç½®ä¸ºè‡ªå·±çš„ idï¼Œä¹Ÿå°±æ˜¯ 59ï¼ŒåŒæ—¶ &lt;code&gt;roll_pointer&lt;/code&gt; æŒ‡å‘äº†ä¿®æ”¹ä¹‹å‰ç”Ÿæˆçš„ä¸€ä¸ª &lt;code&gt;undo log&lt;/code&gt;ï¼Œæ¥ç€è¿™ä¸ª&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; å°±æäº¤äº†ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636683586822.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™ä¸ªæ—¶å€™ &lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; å†æ¬¡æŸ¥è¯¢ï¼Œæ­¤æ—¶æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ­¤æ—¶æ•°æ®è¡Œé‡Œçš„ &lt;code&gt;trx_id=59&lt;/code&gt;ï¼Œé‚£ä¹ˆè¿™ä¸ª &lt;code&gt;trx_id&lt;/code&gt; æ˜¯å¤§äº &lt;code&gt;ReadView&lt;/code&gt; é‡Œçš„ &lt;code&gt;min_trx_idï¼ˆ45ï¼‰&lt;/code&gt;ï¼ŒåŒæ—¶å°äº &lt;code&gt;ReadView&lt;/code&gt; é‡Œçš„ &lt;code&gt;max_trx_idï¼ˆ60ï¼‰&lt;/code&gt;ï¼Œè¯´æ˜æ›´æ–°è¿™æ¡æ•°æ®çš„äº‹åŠ¡ï¼Œå¾ˆå¯èƒ½å°±è·Ÿè‡ªå·±å·®ä¸å¤šæ˜¯åŒæ—¶å¼€å¯çš„ï¼Œäºæ˜¯ä¼šçœ‹ä¸€ä¸‹è¿™ä¸ª &lt;code&gt;trx_id=59&lt;/code&gt;ï¼Œæ˜¯å¦åœ¨ &lt;code&gt;ReadView&lt;/code&gt; çš„ &lt;code&gt;m_ids&lt;/code&gt; åˆ—è¡¨é‡Œçš„ï¼Ÿæœç„¶ï¼Œåœ¨ &lt;code&gt;ReadView&lt;/code&gt; çš„ &lt;code&gt;m_ids&lt;/code&gt; åˆ—è¡¨é‡Œï¼Œæœ‰ 45 å’Œ 59 ä¸¤ä¸ªäº‹åŠ¡ idï¼Œç›´æ¥è¯å®äº†ï¼Œè¿™ä¸ªä¿®æ”¹æ•°æ®çš„äº‹åŠ¡æ˜¯è·Ÿè‡ªå·±åŒä¸€æ—¶æ®µå¹¶å‘æ‰§è¡Œç„¶åæäº¤çš„ï¼Œæ‰€ä»¥è¿™è¡Œæ•°æ®æ˜¯ä¸èƒ½æŸ¥è¯¢çš„ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636683916110.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ—¢ç„¶è¿™è¡Œæ•°æ®ä¸èƒ½æŸ¥è¯¢ï¼Œé‚£ä¹ˆæŸ¥è¯¢ä»€ä¹ˆå‘¢ï¼Ÿ&lt;br&gt;
ç®€å•ï¼Œé¡ºç€è¿™æ¡æ•°æ®çš„ &lt;code&gt;roll_pointer&lt;/code&gt; é¡ºç€ &lt;code&gt;undo log&lt;/code&gt; æ—¥å¿—é“¾æ¡å¾€ä¸‹æ‰¾ï¼Œå°±ä¼šæ‰¾åˆ°æœ€è¿‘ä¸€æ¡ &lt;code&gt;undo log&lt;/code&gt;ï¼Œ&lt;code&gt;trx_id&lt;/code&gt; æ˜¯ 32ï¼Œæ­¤æ—¶å‘ç° &lt;code&gt;trx_id=32&lt;/code&gt;ï¼Œæ˜¯å°äº &lt;code&gt;ReadView&lt;/code&gt; é‡Œçš„ &lt;code&gt;min_trx_idï¼ˆ45ï¼‰&lt;/code&gt;çš„ï¼Œè¯´æ˜è¿™ä¸ª &lt;code&gt;undo log&lt;/code&gt; ç‰ˆæœ¬å¿…ç„¶æ˜¯åœ¨&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; å¼€å¯ä¹‹å‰å°±æ‰§è¡Œä¸”æäº¤çš„ã€‚&lt;br&gt;
å¥½äº†ï¼Œé‚£ä¹ˆå°±æŸ¥è¯¢æœ€è¿‘çš„ &lt;code&gt;undo log&lt;/code&gt; é‡Œçš„å€¼å°±å¥½äº†ï¼Œè¿™å°±æ˜¯ &lt;code&gt;undo log&lt;/code&gt; å¯¹ç‰ˆæœ¬é“¾æ¡çš„ä½œç”¨ï¼Œä»–å¯ä»¥ä¿å­˜ä¸€ä¸ªå¿«ç…§é“¾æ¡ï¼Œè®©ä½ å¯ä»¥è¯»åˆ°ä¹‹å‰çš„å¿«ç…§å€¼ã€‚å¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636684163556.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œ&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; æ›´æ–°çš„å€¼ï¼Œé€šè¿‡è¿™å¥— &lt;strong&gt;ReadView + undo log&lt;/strong&gt; æ—¥å¿—é“¾æ¡çš„æœºåˆ¶ï¼Œå°±å¯ä»¥ä¿è¯&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; ä¸ä¼šè¯»åˆ°å¹¶å‘æ‰§è¡Œçš„&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; æ›´æ–°çš„å€¼ï¼Œåªä¼šè¯»åˆ°ä¹‹å‰çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€å‡è®¾&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; è‡ªå·±æ›´æ–°äº†è¿™è¡Œæ•°æ®ï¼Œæ”¹ä¸ºå€¼ Aï¼Œ&lt;code&gt;trxt_id&lt;/code&gt;ä¿®å¥½ä¸º 45ï¼ŒåŒæ—¶ä¿å­˜ä¹‹å‰&lt;code&gt;äº‹åŠ¡ B&lt;/code&gt; ä¿®æ”¹å€¼çš„å¿«ç…§ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636684360943.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ­¤æ—¶&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; æ¥æŸ¥è¯¢è¿™æ¡æ•°æ®çš„å€¼ï¼Œä¼šå‘ç°è¿™ä¸ª &lt;code&gt;trx_id=45&lt;/code&gt;ï¼Œå±…ç„¶è·Ÿè‡ªå·±çš„ &lt;code&gt;ReadView&lt;/code&gt;é‡Œçš„ &lt;code&gt;creator_trx_idï¼ˆ45ï¼‰&lt;/code&gt;æ˜¯ä¸€æ ·çš„ï¼Œè¯´æ˜ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¯´æ˜è¿™è¡Œæ•°æ®çš„å°±æ˜¯è‡ªå·±ä¿®æ”¹çš„ï¼Œè‡ªå·±ä¿®æ”¹çš„å€¼å½“ç„¶æ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636684489534.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ¥ç€åœ¨äº‹åŠ¡Aæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œçªç„¶å¼€å¯ä¸€ä¸ª&lt;code&gt;äº‹åŠ¡ C&lt;/code&gt;ï¼Œè¿™ä¸ªäº‹åŠ¡çš„ id æ˜¯ 78ï¼Œç„¶åä»–æ›´æ–°äº†é‚£è¡Œæ•°æ®çš„å€¼ä¸ºå€¼ Cï¼Œè¿˜æäº¤äº†ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636684574035.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™ä¸ªæ—¶å€™&lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; å†å»æŸ¥è¯¢ï¼Œä¼šå‘ç°å½“å‰æ•°æ®çš„ &lt;code&gt;trx_id=78&lt;/code&gt;ï¼Œå¤§äºäº†è‡ªå·±çš„ &lt;code&gt;ReadView&lt;/code&gt; ä¸­çš„ &lt;code&gt;max_trx_idï¼ˆ60ï¼‰&lt;/code&gt;ï¼Œæ­¤æ—¶è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¯´æ˜æ˜¯è¿™ä¸ª &lt;code&gt;äº‹åŠ¡ A&lt;/code&gt; å¼€å¯ä¹‹åï¼Œç„¶åæœ‰ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†æ•°æ®ï¼Œè‡ªå·±å½“ç„¶æ˜¯ä¸èƒ½çœ‹åˆ°çš„ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636684712358.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ­¤æ—¶å°±ä¼šé¡ºç€ &lt;code&gt;undo log&lt;/code&gt; å¤šç‰ˆæœ¬é“¾æ¡å¾€ä¸‹æ‰¾ï¼Œå…ˆæ‰¾åˆ°å€¼ A æ˜¯è‡ªå·±ä¹‹å‰ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ï¼Œå› ä¸ºé‚£ä¸ª &lt;code&gt;trx_id=45&lt;/code&gt; è·Ÿè‡ªå·±çš„ &lt;code&gt;ReadVie&lt;/code&gt; é‡Œçš„ &lt;code&gt;creator_trx_id&lt;/code&gt; æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ­¤æ—¶ç›´æ¥è¯»å–è‡ªå·±ä¹‹å‰ä¿®æ”¹çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1636684860422.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šåœ¨ MySQL InnoDB å¼•æ“ä¸­ï¼Œåªæœ‰ READ COMMITTD å’Œ REPEATABLE READ è¿™ä¸¤ç§éš”ç¦»çº§åˆ«æ‰å¯ä»¥ä½¿ç”¨ MVCCï¼Œåº”å¯¹é«˜å¹¶å‘äº‹åŠ¡ï¼ŒMVCC æ¯”å•çº¯çš„åŠ è¡Œé”æ›´æœ‰æ•ˆï¼Œå¼€é”€æ›´å°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
">é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ä¿è¯æ•°æ®åº“äº‹åŠ¡çš„ä¸€è‡´æ€§</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/rabbitmq-cong-ru-men-dao-fang-qi/"" data-c="
          &lt;h1 id=&#34;æ¦‚å¿µè¯´æ˜&#34;&gt;æ¦‚å¿µè¯´æ˜&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1636619280369.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;broker&#34;&gt;Broker&lt;/h2&gt;
&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®ä½“ã€‚&lt;/p&gt;
&lt;h2 id=&#34;exchange&#34;&gt;Exchange&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯äº¤æ¢æœºï¼Œå®ƒæŒ‡å®šæ¶ˆæ¯æŒ‰ä»€ä¹ˆè§„åˆ™ï¼Œè·¯ç”±åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;queue&#34;&gt;Queue&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—è½½ä½“ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æŠ•å…¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;binding&#34;&gt;Binding&lt;/h2&gt;
&lt;p&gt;ç»‘å®šï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æŠŠ &lt;code&gt;exchange&lt;/code&gt; å’Œ &lt;code&gt;queue&lt;/code&gt; æŒ‰ç…§è·¯ç”±è§„åˆ™ç»‘å®šèµ·æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;routing-key&#34;&gt;Routing Key&lt;/h2&gt;
&lt;p&gt;è·¯ç”±å…³é”®å­—ï¼Œ&lt;code&gt;exchange&lt;/code&gt; æ ¹æ®è¿™ä¸ªå…³é”®å­—è¿›è¡Œæ¶ˆæ¯æŠ•é€’ã€‚&lt;/p&gt;
&lt;h2 id=&#34;vhost&#34;&gt;vhost&lt;/h2&gt;
&lt;p&gt;è™šæ‹Ÿä¸»æœºï¼Œä¸€ä¸ª &lt;code&gt;broker&lt;/code&gt; é‡Œå¯ä»¥å¼€è®¾å¤šä¸ª &lt;code&gt;vhost&lt;/code&gt;ï¼Œç”¨ä½œä¸åŒç”¨æˆ·çš„æƒé™åˆ†ç¦»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;producer&#34;&gt;producer&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯æŠ•é€’æ¶ˆæ¯çš„ç¨‹åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;consumer&#34;&gt;consumer&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå°±æ˜¯æ¥å—æ¶ˆæ¯çš„ç¨‹åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;channel&#34;&gt;channel&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯é€šé“ï¼Œåœ¨å®¢æˆ·ç«¯çš„æ¯ä¸ªè¿æ¥é‡Œï¼Œå¯å»ºç«‹å¤šä¸ª &lt;code&gt;channel&lt;/code&gt;ï¼Œæ¯ä¸ª &lt;code&gt;channel&lt;/code&gt; ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨è¿‡ç¨‹&#34;&gt;ä½¿ç”¨è¿‡ç¨‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¿æ¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œæ‰“å¼€ä¸€ä¸ªchannel&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ª &lt;code&gt;exchange&lt;/code&gt;ï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ª &lt;code&gt;queue&lt;/code&gt;ï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä½¿ç”¨ &lt;code&gt;routing key&lt;/code&gt;ï¼Œåœ¨ &lt;code&gt;exchange&lt;/code&gt; å’Œ &lt;code&gt;queue&lt;/code&gt; ä¹‹é—´å»ºç«‹å¥½ç»‘å®šå…³ç³»&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;å®¢æˆ·ç«¯æŠ•é€’æ¶ˆæ¯åˆ° &lt;code&gt;exchange&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;exchange&lt;/code&gt; æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°±æ ¹æ®æ¶ˆæ¯çš„ &lt;code&gt;key&lt;/code&gt; å’Œå·²ç»è®¾ç½®çš„ &lt;code&gt;binding&lt;/code&gt;ï¼Œè¿›è¡Œæ¶ˆæ¯è·¯ç”±ï¼Œå°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—é‡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;exchange&lt;/code&gt; ä¹Ÿæœ‰å‡ ä¸ªç±»å‹ï¼Œå®Œå…¨æ ¹æ® &lt;code&gt;key&lt;/code&gt; è¿›è¡ŒæŠ•é€’çš„å«åš &lt;strong&gt;Direct&lt;/strong&gt; äº¤æ¢æœºï¼Œä¾‹å¦‚ï¼Œç»‘å®šæ—¶è®¾ç½®äº† &lt;code&gt;routing key&lt;/code&gt;ä¸º â€œabcâ€ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯æäº¤çš„æ¶ˆæ¯ï¼Œåªæœ‰è®¾ç½®äº† &lt;code&gt;key&lt;/code&gt; ä¸º â€œabcâ€ çš„æ‰ä¼šæŠ•é€’åˆ°é˜Ÿåˆ—ã€‚å¯¹ &lt;code&gt;key&lt;/code&gt; è¿›è¡Œæ¨¡å¼åŒ¹é…åè¿›è¡ŒæŠ•é€’çš„å«åš &lt;strong&gt;Topic&lt;/strong&gt; äº¤æ¢æœºï¼Œç¬¦å· &lt;b&gt;#&lt;/b&gt; åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å· &lt;b&gt;*&lt;/b&gt; åŒ¹é…æ­£å¥½ä¸€ä¸ªè¯ã€‚ä¾‹å¦‚ â€œabc.#â€ åŒ¹é… â€œabc.def.ghiâ€ï¼Œâ€œabc.*â€ åªåŒ¹é… â€œabc.defâ€ã€‚è¿˜æœ‰ä¸€ç§ä¸éœ€è¦ &lt;code&gt;key&lt;/code&gt; çš„ï¼Œå«åš &lt;strong&gt;Fanout&lt;/strong&gt; äº¤æ¢æœºï¼Œå®ƒé‡‡å–å¹¿æ’­æ¨¡å¼ï¼Œä¸€ä¸ªæ¶ˆæ¯è¿›æ¥æ—¶ï¼ŒæŠ•é€’åˆ°ä¸è¯¥äº¤æ¢æœºç»‘å®šçš„æ‰€æœ‰é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;direct&#34;&gt;Direct&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1636619505554.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;fanout&#34;&gt;Fanout&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1636619513185.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;topic&#34;&gt;Topic&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1636619518110.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;RabbitMQ&lt;/strong&gt; æ”¯æŒæ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯æ•°æ®å†™åœ¨ç£ç›˜ä¸Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;exchange&lt;/code&gt; æŒä¹…åŒ–ï¼Œåœ¨å£°æ˜æ—¶æŒ‡å®š &lt;code&gt;durable =&amp;gt; 1&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;code&gt;queue&lt;/code&gt; æŒä¹…åŒ–ï¼Œåœ¨å£°æ˜æ—¶æŒ‡å®š &lt;code&gt;durable =&amp;gt; 1&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ¶ˆæ¯æŒä¹…åŒ–ï¼Œåœ¨æŠ•é€’æ—¶æŒ‡å®š &lt;code&gt;delivery_mode =&amp;gt; 2&lt;/code&gt;ï¼ˆ1æ˜¯éæŒä¹…åŒ–ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœ exchange å’Œ queue éƒ½æ˜¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„ binding ä¹Ÿæ˜¯æŒä¹…åŒ–çš„ã€‚å¦‚æœ exchange å’Œ queue ä¸¤è€…ä¹‹é—´æœ‰ä¸€ä¸ªæŒä¹…åŒ–ï¼Œä¸€ä¸ªéæŒä¹…åŒ–ï¼Œå°±ä¸å…è®¸å»ºç«‹ç»‘å®šã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;mac-ä¸‹æ­å»º-php-å¼€å‘ç¯å¢ƒ&#34;&gt;Mac ä¸‹æ­å»º PHP å¼€å‘ç¯å¢ƒ&lt;/h1&gt;
&lt;h2 id=&#34;å®‰è£…-rabbitmq&#34;&gt;å®‰è£… RabbitMQ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;brew install rabbitmq

brew install rabbitmq-c

pecl install amqp
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;å®‰è£…è¿‡ç¨‹æç¤ºï¼šSet the path to librabbitmq install prefix [autodetect]&lt;br&gt;
è§£å†³åŠæ³•ï¼š/usr/local/Cellar/rabbitmq-c/0.11.0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;php-ä¸­å®ç°æ¶ˆæ¯å‘é€å’Œæ¥æ”¶&#34;&gt;PHP ä¸­å®ç°æ¶ˆæ¯å‘é€å’Œæ¥æ”¶&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;send.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * å‘é€æ¶ˆæ¯
 */

$exchangeName = &#39;demo&#39;;
$routeKey = &#39;hello&#39;;
$message = &#39;Hello World!&#39;;

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to the broker!\n&amp;quot;);

try {
    $channel = new AMQPChannel($connection);

    $exchange = new AMQPExchange($channel);
    $exchange-&amp;gt;setName($exchangeName);
    $exchange-&amp;gt;setType(AMQP_EX_TYPE_DIRECT);
    $exchange-&amp;gt;declareExchange();

    echo &#39;Send Message: &#39; . $exchange-&amp;gt;publish($message, $routeKey) . &amp;quot;\n&amp;quot;;
    echo &amp;quot;Message Is Sent: &amp;quot; . $message . &amp;quot;\n&amp;quot;;
} catch (AMQPConnectionException $e) {
    var_dump($e);
}

// æ–­å¼€è¿æ¥
$connection-&amp;gt;disconnect();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;receive.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * æ¥æ”¶æ¶ˆæ¯
 */

$exchangeName = &#39;demo&#39;;
$queueName = &#39;hello&#39;;
$routeKey = &#39;hello&#39;;

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to the broker!\n&amp;quot;);

$channel = new AMQPChannel($connection);

$exchange = new AMQPExchange($channel);
$exchange-&amp;gt;setName($exchangeName);
$exchange-&amp;gt;setType(AMQP_EX_TYPE_DIRECT);

echo &#39;Exchange Status: &#39; . $exchange-&amp;gt;declareExchange() . &amp;quot;\n&amp;quot;;

$queue = new AMQPQueue($channel);
$queue-&amp;gt;setName($queueName);

echo &#39;Message Total: &#39; . $queue-&amp;gt;declareQueue() . &amp;quot;\n&amp;quot;;

echo &#39;Queue Bind: &#39; . $queue-&amp;gt;bind($exchangeName, $routeKey) . &amp;quot;\n&amp;quot;;

var_dump(&amp;quot;Waiting for message...&amp;quot;);

// æ¶ˆè´¹é˜Ÿåˆ—æ¶ˆæ¯
while(TRUE) {
    $queue-&amp;gt;consume(&#39;processMessage&#39;);
}

// æ–­å¼€è¿æ¥
$connection-&amp;gt;disconnect();

function processMessage($envelope, $queue) {
    $msg = $envelope-&amp;gt;getBody();
    var_dump(&amp;quot;Received: &amp;quot; . $msg);
    $queue-&amp;gt;ack($envelope-&amp;gt;getDeliveryTag()); // æ‰‹åŠ¨å‘é€ACKåº”ç­”
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æµ‹è¯•ï¼š&lt;br&gt;
æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯&lt;br&gt;
å…ˆè¿è¡Œæ¥æ”¶è€…è„šæœ¬ç›‘å¬æ¶ˆæ¯å‘é€&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;php receive.php
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œæ¶ˆæ¯å‘é€è„šæœ¬&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;php send.php
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åä¼šåœ¨æ¶ˆè´¹è€…ç»ˆç«¯ä¸­çœ‹åˆ°æ¶ˆæ¯è¢«æ¥æ”¶å¹¶æ‰“å°å‡ºæ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶ˆæ¯åˆ†å‘æœºåˆ¶&#34;&gt;æ¶ˆæ¯åˆ†å‘æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;å¯¹äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œéœ€è¦å°†å…¶åˆ†å‘ç»™å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ã€‚&lt;br&gt;
&lt;code&gt;task.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * åˆ†å‘ä»»åŠ¡
 */

$exchangeName = &#39;task&#39;;
$queueName = &#39;worker&#39;;
$routeKey = &#39;worker&#39;;
$message = empty($argv[1]) ? &#39;Hello World!&#39; : $argv[1];

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to the broker!\n&amp;quot;);

try {
    $channel = new AMQPChannel($connection);

    $exchange = new AMQPExchange($channel);
    $exchange-&amp;gt;setName($exchangeName);
    $exchange-&amp;gt;setType(AMQP_EX_TYPE_DIRECT);
    $exchange-&amp;gt;declareExchange();

    echo &#39;Send Message: &#39; . $exchange-&amp;gt;publish($message, $routeKey) . &amp;quot;\n&amp;quot;;
    echo &amp;quot;Message Is Sent: &amp;quot; . $message . &amp;quot;\n&amp;quot;;
} catch (AMQPConnectionException $e) {
    var_dump($e);
}

// æ–­å¼€è¿æ¥
$connection-&amp;gt;disconnect();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;worker.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * å¤„ç†ä»»åŠ¡
 */

$exchangeName = &#39;task&#39;;
$queueName = &#39;worker&#39;;
$routeKey = &#39;worker&#39;;

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to the broker!\n&amp;quot;);

$channel = new AMQPChannel($connection);

$exchange = new AMQPExchange($channel);
$exchange-&amp;gt;setName($exchangeName);
$exchange-&amp;gt;setType(AMQP_EX_TYPE_DIRECT);

echo &#39;Exchange Status: &#39; . $exchange-&amp;gt;declareExchange() . &amp;quot;\n&amp;quot;;

$queue = new AMQPQueue($channel);
$queue-&amp;gt;setName($queueName);

echo &#39;Message Total: &#39; . $queue-&amp;gt;declareQueue() . &amp;quot;\n&amp;quot;;

echo &#39;Queue Bind: &#39; . $queue-&amp;gt;bind($exchangeName, $routeKey) . &amp;quot;\n&amp;quot;;

var_dump(&amp;quot;Waiting for message...&amp;quot;);

// æ¶ˆè´¹é˜Ÿåˆ—æ¶ˆæ¯
while(true) {
    $queue-&amp;gt;consume(&#39;processMessage&#39;);
}

// æ–­å¼€è¿æ¥
$connection-&amp;gt;disconnect();

function processMessage($envelope, $queue) {
    $msg = $envelope-&amp;gt;getBody();
    var_dump(&amp;quot;Received: &amp;quot; . $msg);
    sleep(substr_count($msg, &#39;.&#39;)); // ä¸ºæ¯ä¸€ä¸ªç‚¹å·æ¨¡æ‹Ÿ1ç§’é’Ÿæ“ä½œ
    $queue-&amp;gt;ack($envelope-&amp;gt;getDeliveryTag()); // æ‰‹åŠ¨å‘é€ACKåº”ç­”
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;è½®è¯¢åˆ†å‘&#34;&gt;è½®è¯¢åˆ†å‘&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;è½®è¯¢åˆ†å‘&lt;/strong&gt;ï¼Œæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œåˆ†åˆ«è¿è¡Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;php worker.php
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åå†å¼€ä¸€ä¸ªç»ˆç«¯è¿›è¡Œä»»åŠ¡åˆ†å‘&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;php task.php ç¬¬ä¸€æ¡æ¶ˆæ¯...
php task.php ç¬¬äºŒæ¡æ¶ˆæ¯...
php task.php ç¬¬ä¸‰æ¡æ¶ˆæ¯...
php task.php ç¬¬å››æ¡æ¶ˆæ¯...
php task.php ç¬¬äº”æ¡æ¶ˆæ¯...
php task.php ç¬¬å…­æ¡æ¶ˆæ¯...
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1636696898388.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;æ¶ˆæ¯ç¡®è®¤&#34;&gt;æ¶ˆæ¯ç¡®è®¤&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ª Consumer å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å¤„ç†å®Œæ”¶åˆ°çš„æ•°æ®ã€‚å¦‚æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒConsumer å‡ºé”™æˆ–å¼‚å¸¸é€€å‡ºï¼Œè€Œæ•°æ®è¿˜æ²¡æœ‰å¤„ç†å®Œæˆï¼Œé‚£ä¹ˆè¿™æ®µæ•°æ®å°±ä¸¢å¤±äº†ã€‚å› ä¸ºæˆ‘ä»¬é‡‡ç”¨ no-ack çš„æ–¹å¼è¿›è¡Œç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡ Consumer æ¥åˆ°æ•°æ®åï¼Œä¸ç®¡æ˜¯å¦å¤„ç†å®Œæˆï¼ŒRabbitMQ Server ä¼šç«‹å³æŠŠè¿™ä¸ª Message æ ‡è®°ä¸ºå®Œæˆï¼Œç„¶åä» Queue ä¸­åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯æ•°æ®ä¸è¢«ä¸¢å¤±ï¼ŒRabbitMQ æ”¯æŒæ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¸‹ä¸èƒ½é‡‡ç”¨ no-ackï¼Œè€Œåº”è¯¥æ˜¯åœ¨å¤„ç†å®Œæ•°æ®åå‘é€ ackã€‚å¦‚æœå¤„ç†ä¸­é€” Consumer é€€å‡ºäº†ï¼Œä½†æ˜¯æ²¡æœ‰å‘é€ ackï¼Œé‚£ä¹ˆ RabbitMQ å°±ä¼šæŠŠè¿™ä¸ª Message å‘é€åˆ°ä¸‹ä¸€ä¸ª Consumerï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨ Consumer å¼‚å¸¸é€€å‡ºçš„æƒ…å†µä¸‹æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå¹¶æ²¡æœ‰ç”¨åˆ°è¶…æ—¶æœºåˆ¶ï¼ŒRabbitMQ ä»…ä»…é€šè¿‡ Consumer çš„è¿æ¥ä¸­æ–­æ¥ç¡®è®¤è¯¥ Message å¹¶æ²¡æœ‰è¢«æ­£ç¡®å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒRabbitMQ ç»™ Consumer è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥åšæ•°æ®å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨äº† &lt;code&gt;$queue-&amp;gt;ack($envelope-&amp;gt;getDeliveryTag());&lt;/code&gt;ï¼Œè¿™å°±æ˜¯æ¶ˆæ¯ç¡®è®¤æœºåˆ¶çš„åº”ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿ä¸­æ–­ä»»åŠ¡æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šå½±å“ RabbitMQ ä¸­æ¶ˆæ¯çš„å¤„ç†ï¼ŒRabbitMQ ä¼šå°†å…¶å‘é€ç»™ä¸‹ä¸€ä¸ª Consumer è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå¿˜è®°äº† ackï¼Œé‚£ä¹ˆåæœå¾ˆä¸¥é‡ã€‚å½“ Consumer é€€å‡ºæ—¶ï¼ŒMessage ä¼šé‡æ–°åˆ†å‘ã€‚ç„¶å RabbitMQ ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„å†…å­˜ï¼Œç”±äº RabbitMQ ä¼šé•¿æ—¶é—´è¿è¡Œï¼Œå› æ­¤è¿™ä¸ªâ€œå†…å­˜æ³„æ¼â€æ˜¯è‡´å‘½çš„ã€‚é’ˆå¯¹è¿™è¡Œåœºæ™¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œ&lt;br&gt;
Debug&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sudo rabbitmqctl list_queues name messages_ready messages_unacknowledged
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ¶ˆæ¯æŒä¹…åŒ–&#34;&gt;æ¶ˆæ¯æŒä¹…åŒ–&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯åœ¨ RabbitMQ é€€å‡ºæˆ–è€… crash äº†æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦å°† Queue å’Œ Message æŒä¹…åŒ–ã€‚&lt;br&gt;
Exchange çš„æŒä¹…åŒ–&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$exchange-&amp;gt;setFlags(AMQP_DURABLE);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Queue çš„æŒä¹…åŒ–&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$queue-&amp;gt;setFlags(AMQP_DURABLE);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;fair-dispatch-å…¬å¹³åˆ†å‘&#34;&gt;Fair dispatch å…¬å¹³åˆ†å‘&lt;/h3&gt;
&lt;p&gt;è½®è¯¢çš„å¼Šç—…ï¼šä¾æ¬¡åˆ†å‘ï¼Œå‘¨è€Œå¤å§‹ï¼Œåœ¨æŸäº› Consumer è´Ÿè½½å¾ˆé‡çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¼šåˆ†å‘ç»™å®ƒã€‚&lt;br&gt;
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;$channel-&amp;gt;setPrefetchCount()&lt;/code&gt; æ–¹æ³•ï¼Œå¹¶è®¾ç½® prefetch_count = 1ã€‚è¿™æ ·æ˜¯å‘Šè¯‰ RabbitMQï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œä¸è¦å‘é€è¶…è¿‡ 1 æ¡æ¶ˆæ¯ç»™ä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰ï¼Œç›´åˆ°å®ƒå·²ç»å¤„ç†äº†ä¸Šä¸€æ¡æ¶ˆæ¯å¹¶ä¸”ä½œå‡ºäº†å“åº”ã€‚è¿™æ ·ï¼ŒRabbitMQ å°±ä¼šæŠŠæ¶ˆæ¯åˆ†å‘ç»™ä¸‹ä¸€ä¸ªç©ºé—²çš„å·¥ä½œè€…ï¼ˆworkerï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶ˆæ¯è®¢é˜…publishsubscribe&#34;&gt;æ¶ˆæ¯è®¢é˜…ï¼ˆPublish/Subscribeï¼‰&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œå®ƒåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šç¬¬ä¸€ä¸ªéƒ¨åˆ†è´Ÿè´£å‘å‡ºlogï¼ˆProducerï¼‰ï¼Œç¬¬äºŒä¸ªéƒ¨åˆ†è´Ÿè´£æ¥æ”¶å¹¶æ‰“å°ï¼ˆConsumerï¼‰ã€‚æˆ‘ä»¬å°†æ„å»ºä¸¤ä¸ª Consumerï¼Œç¬¬ä¸€ä¸ªå°† log å†™åˆ°ç‰©ç†ç£ç›˜ä¸Šï¼›ç¬¬äºŒä¸ªå°† log è¾“å‡ºåˆ°å±å¹•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;exchange-2&#34;&gt;Exchange&lt;/h3&gt;
&lt;p&gt;Exchange å†³å®šå°† Message å‘é€åˆ°å…·ä½“çš„ Queueï¼Œè‡³äºæ˜¯å‘é€ç»™ä¸€ä¸ª Queue è¿˜æ˜¯å¤šä¸ª Queueï¼Œåˆ™éœ€è¦é€šè¿‡ Exchange çš„ç±»å‹ç±»å†³å®šã€‚Exchange åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šdirectã€topic å’Œ fanoutã€‚fanout å°±æ˜¯å¹¿æ’­æ¨¡å¼ï¼Œä¼šå°† Message éƒ½æ”¾åˆ°å®ƒæ‰€çŸ¥é“çš„æ‰€æœ‰ Queue ä¸­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$exchange-&amp;gt;setType(AMQP_EX_TYPE_FANOUT);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ Exchangeï¼Œè€Œä¸éœ€è¦ routing_key æ¥å‘é€ Message äº†&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$exchange-&amp;gt;publish($message);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ä¸´æ—¶é˜Ÿåˆ—&#34;&gt;ä¸´æ—¶é˜Ÿåˆ—&lt;/h3&gt;
&lt;p&gt;æˆªè‡³ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨çš„ Queue éƒ½æ˜¯æœ‰åå­—çš„ã€‚ä½¿ç”¨æœ‰åå­—çš„ Queueï¼Œä½¿å¾—åœ¨ Producer å’Œ Consumer ä¹‹å‰å…±äº« Queue æˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿä¸­ï¼Œä¸éœ€è¦æœ‰åå­—çš„é˜Ÿåˆ—ï¼Œè¦å®ç°è¿™ä¸ªç›®æ ‡ï¼Œéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶ä¸æŒ‡å®šåç§°ï¼Œè€Œç”±ç³»ç»Ÿéšæœºåˆ†é…&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$queue = new AMQPQueue($channel);
//$queue-&amp;gt;setName($queueName);
$queue-&amp;gt;setFlags(AMQP_EXCLUSIVE);
$queue-&amp;gt;declareQueue();
//$queue-&amp;gt;bind($exchangeName, $routeKey);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ—¶ï¼Œé€šè¿‡ $queue-&amp;gt;getName() è·å–åˆ°çš„é˜Ÿåˆ—åç§°æ˜¯éšæœºç”Ÿæˆçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»‘å®š&#34;&gt;ç»‘å®š&lt;/h3&gt;
&lt;p&gt;å»ºç«‹ Exchange ä¸ Queue ä¹‹é—´çš„ç»‘å®š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$queue-&amp;gt;bind($exchangeName);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ¼”ç¤ºä»£ç &#34;&gt;æ¼”ç¤ºä»£ç &lt;/h3&gt;
&lt;p&gt;&lt;code&gt;emit_logs.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * å‘é€æ¶ˆæ¯
 */

$exchangeName = &#39;logs&#39;;
$message = &#39;Hello World!&#39;;

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to the broker!\n&amp;quot;);

try {
    $channel = new AMQPChannel($connection);

    $exchange = new AMQPExchange($channel);
    $exchange-&amp;gt;setName($exchangeName);
    $exchange-&amp;gt;setType(AMQP_EX_TYPE_FANOUT);
    $exchange-&amp;gt;declareExchange();

    echo &#39;Send Message: &#39; . $exchange-&amp;gt;publish($message) . &amp;quot;\n&amp;quot;;
    echo &amp;quot;Message Is Sent: &amp;quot; . $message . &amp;quot;\n&amp;quot;;
} catch (AMQPConnectionException $e) {
    var_dump($e);
}

// æ–­å¼€è¿æ¥
$connection-&amp;gt;disconnect();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;receive_logs.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * æ¥æ”¶æ¶ˆæ¯
 */

$exchangeName = &#39;logs&#39;;

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to the broker!\n&amp;quot;);

$channel = new AMQPChannel($connection);

$exchange = new AMQPExchange($channel);
$exchange-&amp;gt;setName($exchangeName);
$exchange-&amp;gt;setType(AMQP_EX_TYPE_FANOUT);
$exchange-&amp;gt;declareExchange();

$queue = new AMQPQueue($channel);
$queue-&amp;gt;setFlags(AMQP_EXCLUSIVE);
$queue-&amp;gt;declareQueue();
$queue-&amp;gt;bind($exchangeName);

var_dump(&amp;quot;Waiting for message...&amp;quot;);

// æ¶ˆè´¹é˜Ÿåˆ—æ¶ˆæ¯
while(true) {
    $queue-&amp;gt;consume(&#39;processMessage&#39;);
}

// æ–­å¼€è¿æ¥
$connection-&amp;gt;disconnect();

function processMessage($envelope, $queue) {
    $msg = $envelope-&amp;gt;getBody();
    var_dump(&amp;quot;Received: &amp;quot; . $msg);
    $queue-&amp;gt;ack($envelope-&amp;gt;getDeliveryTag()); // æ‰‹åŠ¨å‘é€ACKåº”ç­”
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ¼”ç¤ºæµç¨‹&lt;/strong&gt;&lt;br&gt;
æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…é˜Ÿåˆ—è´Ÿè´£å°†æ—¥å¿—å†™å…¥æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;php receive_logs.php &amp;gt; logs_from_rabbit.log
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸€ä¸ªè´Ÿè´£å°†æ—¥å¿—è¾“å‡ºåˆ°å±å¹•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;php receive_logs.php
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åå†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œå°†æ—¥å¿—ä¿¡æ¯å‘é€åˆ°æ‰€æœ‰é˜Ÿåˆ—&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;php emit_logs.php
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·ï¼Œä¼šå‘ç°æ‰€æœ‰é˜Ÿåˆ—ä¼šåŒæ—¶æ¥æ”¶åˆ°æ—¥å¿—å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é€šè¿‡ä¸»é¢˜è¿›è¡Œæ¶ˆæ¯åˆ†å‘&#34;&gt;é€šè¿‡ä¸»é¢˜è¿›è¡Œæ¶ˆæ¯åˆ†å‘&lt;/h2&gt;
&lt;p&gt;å¯¹äº Message çš„ &lt;code&gt;routing_key&lt;/code&gt; å­—ç¬¦ä¸²æ ¼å¼æ˜¯æœ‰é™åˆ¶çš„ï¼šä»¥ç‚¹å·&amp;quot;.&amp;quot;åˆ†å‰²çš„å­—ç¬¦è¡¨ï¼Œå¦‚php.laravelï¼Œå¹¶ä¸”é•¿åº¦ä¸èƒ½è¶…è¿‡ 255 ä¸ªå­—èŠ‚ã€‚&lt;br&gt;
å¯¹äº &lt;code&gt;routing_key&lt;/code&gt; è€Œè¨€ï¼Œæœ‰ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;*&lt;/code&gt;ï¼šä»£è¡¨ä»»æ„å•è¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#&lt;/code&gt;ï¼šä»£è¡¨0ä¸ªæˆ–å¤šä¸ªå•è¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Topic Exchange ä¸å…¶ä»– Exchange çš„è½¬åŒ–&lt;br&gt;
&lt;code&gt;routing_key&lt;/code&gt; æ˜¯ &lt;code&gt;#&lt;/code&gt;ï¼Œä¼šæ¥æ”¶æ‰€æœ‰ Messageï¼Œæ­¤æ—¶ç­‰åŒäº Fanout Exchangeï¼›&lt;br&gt;
&lt;code&gt;routing_key&lt;/code&gt; ä¸åŒ…å« &lt;code&gt;#&lt;/code&gt; æˆ– &lt;code&gt;*&lt;/code&gt;ï¼Œåˆ™ç­‰åŒäº Direct Exchange&lt;/p&gt;
&lt;h3 id=&#34;æ¼”ç¤ºä»£ç -2&#34;&gt;æ¼”ç¤ºä»£ç &lt;/h3&gt;
&lt;p&gt;&lt;code&gt;emit_logs_topic.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * å‘é€æ¶ˆæ¯
 */

$exchangeName = &#39;topic_logs&#39;;
$topic = empty($argv[1]) ? &#39;anonymous.info&#39; : $argv[1]; // ä¸»é¢˜
$message = empty($argv[2]) ? &#39;Hello World!&#39; : $argv[2];

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to broker!\n&amp;quot;);

$channel = new AMQPChannel($connection);
$exchange = new AMQPExchange($channel);
$exchange-&amp;gt;setName($exchangeName);
$exchange-&amp;gt;setType(AMQP_EX_TYPE_TOPIC);
$exchange-&amp;gt;declareExchange();

$exchange-&amp;gt;publish($message, $topic);
echo &amp;quot;Message is sent: &amp;quot; . $message . &amp;quot;\n&amp;quot;;
$connection-&amp;gt;disconnect();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;receive_logs_topic.php&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * æ¥æ”¶æ¶ˆæ¯
 */

$exchangeName = &#39;topic_logs&#39;;
$topic = $argv[1];

// å»ºç«‹TCPè¿æ¥
$connection = new AMQPConnection([
    &#39;host&#39; =&amp;gt; &#39;localhost&#39;,
    &#39;port&#39; =&amp;gt; &#39;5672&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
    &#39;login&#39; =&amp;gt; &#39;guest&#39;,
    &#39;password&#39; =&amp;gt; &#39;guest&#39;
]);
$connection-&amp;gt;connect() or die(&amp;quot;Cannot connect to broker!\n&amp;quot;);

$channel = new AMQPChannel($connection);

$exchange = new AMQPExchange($channel);
$exchange-&amp;gt;setName($exchangeName);
$exchange-&amp;gt;setType(AMQP_EX_TYPE_TOPIC);
$exchange-&amp;gt;declareExchange();

$queue = new AMQPQueue($channel);
$queue-&amp;gt;setFlags(AMQP_EXCLUSIVE);
$queue-&amp;gt;declareQueue();
$queue-&amp;gt;bind($exchangeName, $topic);

echo &amp;quot;Waiting for logs...\n&amp;quot;;
while (TRUE) {
    $queue-&amp;gt;consume(&#39;processLogs&#39;);
}

$connection-&amp;gt;disconnect();

function processLogs($envelope, $queue) {
    $logs = $envelope-&amp;gt;getBody();
    var_dump(&amp;quot;Received: &amp;quot; . $logs);
    $queue-&amp;gt;ack($envelope-&amp;gt;getDeliveryTag()); // æ‰‹åŠ¨å‘é€ACKåº”ç­”
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;php-php-amqplib-åº“æ“ä½œ-rabbitmq&#34;&gt;PHP php-amqplib åº“æ“ä½œ RabbitMQ&lt;/h1&gt;
&lt;h2 id=&#34;ä½¿ç”¨-composer-è¿›è¡Œ-rabbitmq-ä¾èµ–å®‰è£…&#34;&gt;ä½¿ç”¨ composer è¿›è¡Œ rabbitmq ä¾èµ–å®‰è£…&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;composer require php-amqplib/php-amqplib
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;php-æ“ä½œ-rabbitmq-çš„ç®€å•ç¤ºä¾‹&#34;&gt;PHP æ“ä½œ RabbitMQ çš„ç®€å•ç¤ºä¾‹&lt;/h2&gt;
&lt;h3 id=&#34;ç”Ÿäº§è€…&#34;&gt;ç”Ÿäº§è€…&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
require &#39;../vendor/autoload.php&#39;;

$conf = [
    &#39;host&#39; =&amp;gt; &#39;127.0.0.1&#39;,
    &#39;port&#39; =&amp;gt; 5672,
    &#39;user&#39; =&amp;gt; &#39;guest&#39;,
    &#39;pwd&#39;  =&amp;gt; &#39;guest&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
];

$exchangeName = &#39;kd_sms_send_ex&#39;; // äº¤æ¢æœºå
$queueName = &#39;kd_sms_send_q&#39;; // é˜Ÿåˆ—åç§°
$routingKey = &#39;sms_send&#39;; // è·¯ç”±å…³é”®å­—(ä¹Ÿå¯ä»¥çœç•¥) ä¸€èˆ¬éƒ½å¸¦ä¸Šæ–¹ä¾¿äº¤æ¢æœºå¯¹æ¶ˆæ¯è¿›è¡Œä¸åŒé˜Ÿåˆ—çš„æ¨é€ å¦‚æœç»‘å®šçš„æ—¶å€™ä½¿ç”¨äº† $routingKey,é‚£ä¹ˆåœ¨ bashic_publish çš„æ—¶å€™ä¹Ÿè¦æŒ‡å®š $routingKeyï¼Œä¸ç„¶äº¤æ¢æœºæ— æ³•è·¯ç”±åˆ°æŒ‡å®šé˜Ÿåˆ—ï¼Œé»˜è®¤å°±æ¨é€åˆ°ä¸ä½¿ç”¨å…³é”®å­—çš„é˜Ÿåˆ—äº†

// å»ºç«‹ç”Ÿäº§è€…ä¸ mq ä¹‹é—´çš„è¿æ¥
$conn = new \PhpAmqpLib\Connection\AMQPStreamConnection($conf[&#39;host&#39;], $conf[&#39;port&#39;], $conf[&#39;user&#39;], $conf[&#39;pwd&#39;], $conf[&#39;vhost&#39;]);
// åœ¨å·²è¿æ¥åŸºç¡€ä¸Šå»ºç«‹ç”Ÿäº§è€…ä¸ mq ä¹‹é—´çš„é€šé“
$channel = $conn-&amp;gt;channel();
/*
å£°æ˜åˆå§‹åŒ–äº¤æ¢æœº
å‚æ•°è¯´æ˜ï¼š
exchangeï¼šäº¤æ¢æœºåç§°
typeï¼šäº¤æ¢æœºç±»å‹ï¼Œå¸¸è§çš„å¦‚fanoutã€directã€topic =ã€‹directirect ç²¾å‡†æ¨é€ fanout å¹¿æ’­ æ¨é€åˆ°ç»‘å®šåˆ°æ­¤äº¤æ¢æœºä¸‹çš„æ‰€æœ‰é˜Ÿåˆ— topic ç»„æ’­ æ¯”å¦‚ä¸Šé¢æˆ‘ç»‘å®šçš„å…³é”®å­—æ˜¯sms_sendï¼Œé‚£ä¹ˆä»–å¯ä»¥æ¨é€åˆ°*.sms_sendçš„æ‰€æœ‰é˜Ÿåˆ—
passiveï¼šåªæŸ¥è¯¢ä¸åˆ›å»º.å¦‚æœä¸ºtrue,å¦‚æœå­˜åœ¨è¿™ä¸ªé˜Ÿåˆ—,åˆ™ä¼šè¿”å›é˜Ÿåˆ—çš„ä¿¡æ¯.å¦‚æœä¸å­˜åœ¨è¿™ä¸ªé˜Ÿåˆ—..åˆ™ä¼šæŠ›å¼‚å¸¸(ä¸äº¤æ¢æœºä¸åŒçš„æ˜¯,å¦‚æœäº¤æ¢æœºåˆ¤æ–­å­˜åœ¨,åˆ™è¿”å›NULL,å¦åˆ™å¼‚å¸¸)
durableï¼šè®¾ç½®æ˜¯å¦æŒä¹…åŒ–ã€‚durableè®¾ç½®trueè¡¨ç¤ºæŒä¹…åŒ–ï¼Œåä¹‹æ˜¯æŒä¹…åŒ–ã€‚æŒä¹…åŒ–å¯ä»¥å°†å°†æ¢æœºå­˜ç›˜ï¼Œåœ¨æœåŠ¡å™¨é‡å¯æ—¶ä¸ä¼šä¸¢å¤±ç›¸å…³ä¿¡æ¯
autoDeleteï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚autoDeleteè®¾ç½®ä¸ºtrueåˆ™è¡¨ç¤ºè‡ªåŠ¨åˆ é™¤ã€‚è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯è‡³å°‘æœ‰ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…äº¤æ¢æœºä¸è¿™ä¸ªäº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—æˆ–è€…äº¤æ¢å™¨éƒ½ä¸ä¹‹è§£ç»‘
internalï¼šè®¾ç½®æ˜¯å¦å†…ç½®çš„ã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºæ˜¯å†…ç½®çš„äº¤æ¢å™¨ï¼Œå®¢æˆ·ç«¯ç¨‹åºæ— æ³•ç›´æ¥å‘é€æ¶ˆæ¯åˆ°è¿™ä¸ªäº¤æ¢å™¨ä¸­ï¼Œåªèƒ½é€šè¿‡äº¤æ¢å™¨è·¯ç”±åˆ°äº¤æ¢å™¨è¿™ç§æ–¹å¼
argumentï¼šå…¶ä»–ä¸€äº›ç»“æ„åŒ–å‚æ•°ï¼Œæ¯”å¦‚alternate-exchange
*/
$channel-&amp;gt;exchange_declare($exchangeName, AMQP_EX_TYPE_DIRECT, false, false, false);
/*
å£°æ˜åˆå§‹åŒ–ä¸€æ¡é˜Ÿåˆ—
å‚æ•°è¯´æ˜ï¼š
queueï¼šé˜Ÿåˆ—çš„åç§°
durableï¼šè®¾ç½®æ˜¯å¦æŒä¹…åŒ–ã€‚ä¸ºtrueåˆ™è®¾ç½®é˜Ÿåˆ—ä¸ºæŒä¹…åŒ–ã€‚æŒä¹…åŒ–çš„é˜Ÿåˆ—ä¼šå­˜ç›˜ï¼Œåœ¨æœåŠ¡å™¨é‡å¯çš„æ—¶å€™å¯ä»¥ä¿è¯ä¸ä¸¢å¤±ç›¸å…³ä¿¡æ¯
exclusiveï¼šè®¾ç½®æ˜¯å¦æ’ä»–ã€‚ä¸ºtrueåˆ™è®¾ç½®å¯¹åˆ—ä¸ºæ’ä»–çš„ã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸‰ç‚¹ï¼šæ’ä»–é˜Ÿåˆ—æ˜¯åŸºäºè¿æ¥å¯è§ï¼ŒåŒä¸€ä¸ªè¿æ¥çš„ä¸åŒä¿¡é“æ˜¯å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€ä¸ªè¿æ¥åˆ›å»ºçš„æ’ä»–é˜Ÿåˆ—ï¼›â€é¦–æ¬¡â€œæ˜¯æŒ‡å¦‚æœä¸€ä¸ªè¿æ¥å·²ç»å£°æ˜äº†ä¸€ä¸ªæ’ä»–é˜Ÿåˆ—ï¼Œå…¶ä»–è¿æ¥æ˜¯ä¸å…è®¸å»ºç«‹åŒåçš„æ’ä»–é˜Ÿåˆ—çš„ï¼Œè¿™ä¸ªä¸æ™®é€šé˜Ÿåˆ—ä¸åŒï¼›å³ä½¿è¯¥é˜Ÿåˆ—æ˜¯æŒä¹…åä¸œï¼Œä¸€æ—¦è¿æ¥å…³é—­æˆ–è€…å®¢æˆ·ç«¯é€€å‡ºï¼Œè¯¥æ’ä»–é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨è¢«åˆ é™¤ï¼Œè¿™ç§é˜Ÿåˆ—é€‚ç”¨äºä¸€ä¸ªå®¢æˆ·ç«¯åŒäº‹å‘é€å’Œè¯»å–æ¶ˆæ¯çš„åº”ç”¨åœºæ™¯
autoDeleteï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚ä¸ºtrueåˆ™è®¾ç½®é˜Ÿåˆ—ä¸ºè‡ªåŠ¨åˆ é™¤ã€‚è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯ï¼šè‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¹‹åæ‰€æœ‰ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥çš„æ¶ˆè´¹è€…éƒ½æ–­å¼€æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ä¸èƒ½æŠŠè¿™ä¸ªå‚æ•°é”™è¯¯åœ°ç†è§£ä¸ºï¼šâ€å½“è¿æ¥åˆ°æ­¤é˜Ÿåˆ—çš„æ‰€æœ‰å®¢æˆ·ç«¯æ–­å¼€æ—¶ï¼Œè¿™ä¸ªé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤â€œï¼Œå› ä¸ºç”Ÿäº§è€…å®¢æˆ·ç«¯åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—ï¼Œæˆ–è€…æ²¡æœ‰æ¶ˆè´¹è€…å®¢æˆ·ç«¯ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥æ—¶ï¼Œéƒ½ä¸ä¼šè‡ªåŠ¨åˆ é™¤è¿™ä¸ªé˜Ÿåˆ—
argumentsï¼šè®¾ç½®é˜Ÿåˆ—çš„å…¶ä»–ä¸€äº›å‚æ•°ï¼Œå¦‚x-message-ttlç­‰
*/
$channel-&amp;gt;queue_declare($queueName, false, true, false, false);
// å°†é˜Ÿåˆ—ä¸æŸä¸ªäº¤æ¢æœºè¿›è¡Œç»‘å®šï¼Œå¹¶ä½¿ç”¨è·¯ç”±å…³é”®å­—
$channel-&amp;gt;queue_bind($queueName, $exchangeName, $routingKey);

//ç”Ÿæˆæ¶ˆæ¯
$msgBody = json_encode([&amp;quot;name&amp;quot; =&amp;gt; &amp;quot;xiaomi&amp;quot;, &amp;quot;age&amp;quot; =&amp;gt; 18]);
// DELIVERY_MODE_PERSISTENT 2 æ¶ˆæ¯æŒä¹…åŒ–
$msg = new \PhpAmqpLib\Message\AMQPMessage($msgBody, [&#39;content_type&#39; =&amp;gt; &#39;text/plain&#39;, &#39;delivery_mode&#39; =&amp;gt; \PhpAmqpLib\Message\AMQPMessage::DELIVERY_MODE_PERSISTENT]);
// æ¨é€æ¶ˆæ¯åˆ°æŸä¸ªäº¤æ¢æœº
$r = $channel-&amp;gt;basic_publish($msg, $exchangeName, $routingKey);

// å…³é—­é€šé“
$channel-&amp;gt;close();
// å…³é—­è¿æ¥
$conn-&amp;gt;close();
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ¶ˆè´¹è€…&#34;&gt;æ¶ˆè´¹è€…&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
require &#39;../vendor/autoload.php&#39;;

$conf = [
    &#39;host&#39; =&amp;gt; &#39;127.0.0.1&#39;,
    &#39;port&#39; =&amp;gt; 5672,
    &#39;user&#39; =&amp;gt; &#39;guest&#39;,
    &#39;pwd&#39; =&amp;gt; &#39;guest&#39;,
    &#39;vhost&#39; =&amp;gt; &#39;/&#39;,
];

$exchangeName = &#39;kd_sms_send_ex&#39;; // äº¤æ¢æœºå
$queueName = &#39;kd_sms_send_q&#39;; // é˜Ÿåˆ—åç§°
$routingKey = &#39;sms_send&#39;; // è·¯ç”±å…³é”®å­—(ä¹Ÿå¯ä»¥çœç•¥) ä¸€èˆ¬éƒ½å¸¦ä¸Šæ–¹ä¾¿äº¤æ¢æœºå¯¹æ¶ˆæ¯è¿›è¡Œä¸åŒé˜Ÿåˆ—çš„æ¨é€ å¦‚æœç»‘å®šçš„æ—¶å€™ä½¿ç”¨äº† $routingKey,é‚£ä¹ˆåœ¨ bashic_publish çš„æ—¶å€™ä¹Ÿè¦æŒ‡å®š $routingKeyï¼Œä¸ç„¶äº¤æ¢æœºæ— æ³•è·¯ç”±åˆ°æŒ‡å®šé˜Ÿåˆ—ï¼Œé»˜è®¤å°±æ¨é€åˆ°ä¸ä½¿ç”¨å…³é”®å­—çš„é˜Ÿåˆ—äº†

// å»ºç«‹ç”Ÿäº§è€…ä¸ mq ä¹‹é—´çš„è¿æ¥
$conn = new \PhpAmqpLib\Connection\AMQPStreamConnection($conf[&#39;host&#39;], $conf[&#39;port&#39;], $conf[&#39;user&#39;], $conf[&#39;pwd&#39;], $conf[&#39;vhost&#39;]);
// åœ¨å·²è¿æ¥åŸºç¡€ä¸Šå»ºç«‹ç”Ÿäº§è€…ä¸ mq ä¹‹é—´çš„é€šé“
$channel = $conn-&amp;gt;channel();
// å¯¹äºæ­£åœ¨ç¹å¿™çš„å®¢æˆ·ç«¯ï¼Œæ²¡æœ‰å¾—åˆ°å›åº”ä¹‹å‰ï¼Œä¸å‘å…¶å‘é€æ¶ˆæ¯
$channel-&amp;gt;basic_qos(null, 1, null);
/*
å£°æ˜åˆå§‹åŒ–äº¤æ¢æœº
å‚æ•°è¯´æ˜ï¼š
exchangeï¼šäº¤æ¢æœºåç§°
typeï¼šäº¤æ¢æœºç±»å‹ï¼Œå¸¸è§çš„å¦‚fanoutã€directã€topic =ã€‹directirect ç²¾å‡†æ¨é€ fanout å¹¿æ’­ æ¨é€åˆ°ç»‘å®šåˆ°æ­¤äº¤æ¢æœºä¸‹çš„æ‰€æœ‰é˜Ÿåˆ— topic ç»„æ’­ æ¯”å¦‚ä¸Šé¢æˆ‘ç»‘å®šçš„å…³é”®å­—æ˜¯sms_sendï¼Œé‚£ä¹ˆä»–å¯ä»¥æ¨é€åˆ°*.sms_sendçš„æ‰€æœ‰é˜Ÿåˆ—
passiveï¼šåªæŸ¥è¯¢ä¸åˆ›å»º.å¦‚æœä¸ºtrue,å¦‚æœå­˜åœ¨è¿™ä¸ªé˜Ÿåˆ—,åˆ™ä¼šè¿”å›é˜Ÿåˆ—çš„ä¿¡æ¯.å¦‚æœä¸å­˜åœ¨è¿™ä¸ªé˜Ÿåˆ—..åˆ™ä¼šæŠ›å¼‚å¸¸(ä¸äº¤æ¢æœºä¸åŒçš„æ˜¯,å¦‚æœäº¤æ¢æœºåˆ¤æ–­å­˜åœ¨,åˆ™è¿”å›NULL,å¦åˆ™å¼‚å¸¸)
durableï¼šè®¾ç½®æ˜¯å¦æŒä¹…åŒ–ã€‚durableè®¾ç½®trueè¡¨ç¤ºæŒä¹…åŒ–ï¼Œåä¹‹æ˜¯æŒä¹…åŒ–ã€‚æŒä¹…åŒ–å¯ä»¥å°†å°†æ¢æœºå­˜ç›˜ï¼Œåœ¨æœåŠ¡å™¨é‡å¯æ—¶ä¸ä¼šä¸¢å¤±ç›¸å…³ä¿¡æ¯
autoDeleteï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚autoDeleteè®¾ç½®ä¸ºtrueåˆ™è¡¨ç¤ºè‡ªåŠ¨åˆ é™¤ã€‚è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯è‡³å°‘æœ‰ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…äº¤æ¢æœºä¸è¿™ä¸ªäº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—æˆ–è€…äº¤æ¢å™¨éƒ½ä¸ä¹‹è§£ç»‘
internalï¼šè®¾ç½®æ˜¯å¦å†…ç½®çš„ã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºæ˜¯å†…ç½®çš„äº¤æ¢å™¨ï¼Œå®¢æˆ·ç«¯ç¨‹åºæ— æ³•ç›´æ¥å‘é€æ¶ˆæ¯åˆ°è¿™ä¸ªäº¤æ¢å™¨ä¸­ï¼Œåªèƒ½é€šè¿‡äº¤æ¢å™¨è·¯ç”±åˆ°äº¤æ¢å™¨è¿™ç§æ–¹å¼
argumentï¼šå…¶ä»–ä¸€äº›ç»“æ„åŒ–å‚æ•°ï¼Œæ¯”å¦‚alternate-exchange
*/
$channel-&amp;gt;exchange_declare($exchangeName, AMQP_EX_TYPE_DIRECT, false, false, false);
/*
å£°æ˜åˆå§‹åŒ–ä¸€æ¡é˜Ÿåˆ—
å‚æ•°è¯´æ˜ï¼š
queueï¼šé˜Ÿåˆ—çš„åç§°
durableï¼šè®¾ç½®æ˜¯å¦æŒä¹…åŒ–ã€‚ä¸ºtrueåˆ™è®¾ç½®é˜Ÿåˆ—ä¸ºæŒä¹…åŒ–ã€‚æŒä¹…åŒ–çš„é˜Ÿåˆ—ä¼šå­˜ç›˜ï¼Œåœ¨æœåŠ¡å™¨é‡å¯çš„æ—¶å€™å¯ä»¥ä¿è¯ä¸ä¸¢å¤±ç›¸å…³ä¿¡æ¯
exclusiveï¼šè®¾ç½®æ˜¯å¦æ’ä»–ã€‚ä¸ºtrueåˆ™è®¾ç½®å¯¹åˆ—ä¸ºæ’ä»–çš„ã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸‰ç‚¹ï¼šæ’ä»–é˜Ÿåˆ—æ˜¯åŸºäºè¿æ¥å¯è§ï¼ŒåŒä¸€ä¸ªè¿æ¥çš„ä¸åŒä¿¡é“æ˜¯å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€ä¸ªè¿æ¥åˆ›å»ºçš„æ’ä»–é˜Ÿåˆ—ï¼›â€é¦–æ¬¡â€œæ˜¯æŒ‡å¦‚æœä¸€ä¸ªè¿æ¥å·²ç»å£°æ˜äº†ä¸€ä¸ªæ’ä»–é˜Ÿåˆ—ï¼Œå…¶ä»–è¿æ¥æ˜¯ä¸å…è®¸å»ºç«‹åŒåçš„æ’ä»–é˜Ÿåˆ—çš„ï¼Œè¿™ä¸ªä¸æ™®é€šé˜Ÿåˆ—ä¸åŒï¼›å³ä½¿è¯¥é˜Ÿåˆ—æ˜¯æŒä¹…åä¸œï¼Œä¸€æ—¦è¿æ¥å…³é—­æˆ–è€…å®¢æˆ·ç«¯é€€å‡ºï¼Œè¯¥æ’ä»–é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨è¢«åˆ é™¤ï¼Œè¿™ç§é˜Ÿåˆ—é€‚ç”¨äºä¸€ä¸ªå®¢æˆ·ç«¯åŒäº‹å‘é€å’Œè¯»å–æ¶ˆæ¯çš„åº”ç”¨åœºæ™¯
autoDeleteï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚ä¸ºtrueåˆ™è®¾ç½®é˜Ÿåˆ—ä¸ºè‡ªåŠ¨åˆ é™¤ã€‚è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯ï¼šè‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¹‹åæ‰€æœ‰ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥çš„æ¶ˆè´¹è€…éƒ½æ–­å¼€æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ä¸èƒ½æŠŠè¿™ä¸ªå‚æ•°é”™è¯¯åœ°ç†è§£ä¸ºï¼šâ€å½“è¿æ¥åˆ°æ­¤é˜Ÿåˆ—çš„æ‰€æœ‰å®¢æˆ·ç«¯æ–­å¼€æ—¶ï¼Œè¿™ä¸ªé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤â€œï¼Œå› ä¸ºç”Ÿäº§è€…å®¢æˆ·ç«¯åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—ï¼Œæˆ–è€…æ²¡æœ‰æ¶ˆè´¹è€…å®¢æˆ·ç«¯ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥æ—¶ï¼Œéƒ½ä¸ä¼šè‡ªåŠ¨åˆ é™¤è¿™ä¸ªé˜Ÿåˆ—
argumentsï¼šè®¾ç½®é˜Ÿåˆ—çš„å…¶ä»–ä¸€äº›å‚æ•°ï¼Œå¦‚x-message-ttlç­‰
*/
$channel-&amp;gt;queue_declare($queueName, false, true, false, false);
// å°†é˜Ÿåˆ—ä¸æŸä¸ªäº¤æ¢æœºè¿›è¡Œç»‘å®šï¼Œå¹¶ä½¿ç”¨è·¯ç”±å…³é”®å­—
$channel-&amp;gt;queue_bind($queueName, $exchangeName, $routingKey);
echo &#39;[*] Waiting for messages. To exit prss CTRL+C, &#39; . &amp;quot;\n&amp;quot;;
$callback = function ($msg) {
    echo date(&#39;Y-m-d H:i:s&#39;) . &#39; body is &#39; . $msg-&amp;gt;body . &amp;quot;\n&amp;quot;;
    // æ‰‹åŠ¨ç¡®è®¤ackï¼Œç¡®ä¿æ¶ˆæ¯å·²ç»å¤„ç† no_ack ä¸º false éœ€æ±‚æ‰‹åŠ¨ç¡®è®¤
    $msg-&amp;gt;getChannel()-&amp;gt;basic_ack($msg-&amp;gt;getDeliveryTag());
};
//
/*
å¼€å§‹é˜Ÿåˆ—æ¶ˆè´¹ï¼Œç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºæœåŠ¡ç«¯æ¶ˆè´¹æƒ…å†µ
å‚æ•°è¯´æ˜ï¼š
queueï¼šé˜Ÿåˆ—çš„åç§°
consumer_tagï¼šæ¶ˆè´¹è€…æ ‡ç­¾ï¼Œç”¨æ¥åŒºåˆ†å¤šä¸ªæ¶ˆè´¹è€…
no_localï¼šè¿™ä¸ªåŠŸèƒ½å±äºAMQPçš„æ ‡å‡†,ä½†æ˜¯rabbitMQå¹¶æ²¡æœ‰åšå®ç°
no_ackï¼šfalse æ”¶åˆ°æ¶ˆæ¯å,æ˜¯å¦ä¸éœ€è¦å›å¤ç¡®è®¤å³è¢«è®¤ä¸ºè¢«æ¶ˆè´¹ï¼Œå¦‚æœæœª true è¿™ç§æƒ…å†µè¡¨ç¤ºç”Ÿäº§è€…ä¸å…³å¿ƒæ•°æ®æ˜¯å¦å¤„ç†å®Œæ¯•ã€‚å¦‚æœAæŒ‚äº†
   A å½“æ—¶çš„æ•°æ®å°±ä¸¢æ‰
exclusiveï¼šæ˜¯å¦æ’ä»–
nowaitï¼šfalse ä¸è¿”å›æ‰§è¡Œç»“æœ,ä½†æ˜¯å¦‚æœæ’ä»–å¼€å¯çš„è¯,åˆ™å¿…é¡»éœ€è¦ç­‰å¾…ç»“æœçš„,å¦‚æœä¸¤ä¸ªä¸€èµ·å¼€å°±ä¼šæŠ¥é”™
callback å›è°ƒå‡½æ•°
*/
$channel-&amp;gt;basic_consume($queueName, &#39;&#39;, false, false, false, false, $callback);

while (count($channel-&amp;gt;callbacks)) {
    $channel-&amp;gt;wait();
}

// å…³é—­é€šé“
$channel-&amp;gt;close();
// å…³é—­è¿æ¥
$conn-&amp;gt;close();
&lt;/code&gt;&lt;/pre&gt;
">RabbitMQ ä»å…¥é—¨åˆ°æ”¾å¼ƒ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/laravel-su-cha-biao/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://learnku.com/docs/laravel-cheatsheet/8.x&#34;&gt;Laravelé€ŸæŸ¥è¡¨&lt;/a&gt;&lt;/p&gt;
">Laravel é€ŸæŸ¥è¡¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/php-su-cha-biao/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://www.p2hp.com/phpfuncs.html&#34;&gt;PHP é€ŸæŸ¥è¡¨&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;æœ¬åœ°æœåŠ¡å™¨&#34;&gt;æœ¬åœ°æœåŠ¡å™¨&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;php -S localhost:3000
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ³¨é‡Š&#34;&gt;æ³¨é‡Š&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;// å•è¡Œæ³¨é‡Š

/*
è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šå—
è·¨è¶Šå¤šè¡Œ
*/
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;å‘½åçº¦å®š&#34;&gt;å‘½åçº¦å®š&lt;/h1&gt;
&lt;h2 id=&#34;å¼€å§‹ç»“æŸ-æ ‡è®°&#34;&gt;å¼€å§‹/ç»“æŸ æ ‡è®°&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
  echo &amp;quot;Hello World&amp;quot;;
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¦‚æœæ²¡æœ‰ç»“æŸæ ‡è®°æ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†å°†è¢«è§†ä¸º-php-ä»£ç &#34;&gt;å¦‚æœæ²¡æœ‰ç»“æŸæ ‡è®°ï¼Œæ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†å°†è¢«è§†ä¸º PHP ä»£ç &lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
  echo &amp;quot;Hello World&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç®€çŸ­çš„-php-è¯­æ³•è¾“å‡º&#34;&gt;ç®€çŸ­çš„ PHP è¯­æ³•è¾“å‡º&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?= &amp;quot;Hello World&amp;quot; ?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¯ç”¨ä¸¥æ ¼æ¨¡å¼-å®ƒå¿…é¡»åœ¨-php-æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ&#34;&gt;å¯ç”¨ä¸¥æ ¼æ¨¡å¼ (å®ƒå¿…é¡»åœ¨ PHP æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;? declare(strict_types=1);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åŒ…æ‹¬ä¸€ä¸ª-php-æ–‡ä»¶&#34;&gt;åŒ…æ‹¬ä¸€ä¸ª PHP æ–‡ä»¶&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;require &#39;app/Product.php&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ›å»ºå‘½åç©ºé—´&#34;&gt;åˆ›å»ºå‘½åç©ºé—´&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;namespace App;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ä½¿ç”¨å‘½åç©ºé—´&#34;&gt;ä½¿ç”¨å‘½åç©ºé—´&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;use App\Product;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å°é©¼å³°å‘½å&#34;&gt;å°é©¼å³°å‘½å&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$firstName = &#39;Mike&#39;

function updateProduct()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¤§é©¼å³°å‘½å&#34;&gt;å¤§é©¼å³°å‘½å&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class ProductItem
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ‰€æœ‰å¤§å†™å­—æ¯ç”¨ä¸‹åˆ’çº¿åˆ†éš”&#34;&gt;æ‰€æœ‰å¤§å†™å­—æ¯ç”¨ä¸‹åˆ’çº¿åˆ†éš”&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;const ACCESS_KEY = &#39;123abc&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;è¾“å‡º-è¾“å…¥&#34;&gt;è¾“å‡º &amp;amp; è¾“å…¥&lt;/h1&gt;
&lt;h2 id=&#34;è¾“å‡º&#34;&gt;è¾“å‡º&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo &#39;Hello World&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è°ƒå¼è¾“å‡º&#34;&gt;è°ƒå¼è¾“å‡º&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;var_dump($names);
print_r($products);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ä»æ§åˆ¶å°è¾“å…¥&#34;&gt;ä»æ§åˆ¶å°è¾“å…¥&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$name = readline(&#39;What is your name : &#39;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;å˜é‡å£°æ˜&#34;&gt;å˜é‡å£°æ˜&lt;/h1&gt;
&lt;h2 id=&#34;å­—ç¬¦ä¸²&#34;&gt;å­—ç¬¦ä¸²&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$name = &#39;Mike&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¸ƒå°”å‹&#34;&gt;å¸ƒå°”å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$isActive = true;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•´å‹&#34;&gt;æ•´å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$number = 25;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æµ®ç‚¹å‹&#34;&gt;æµ®ç‚¹å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$amount = 99.95;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°ç»„&#34;&gt;æ•°ç»„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$fruits = [&#39;orange&#39;, &#39;apple&#39;, &#39;banana&#39;];
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¸¸é‡&#34;&gt;å¸¸é‡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;const MAX_USERS = 50;

define(&#39;MAX_USERS&#39;, 50);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;èµ‹å€¼-å¼•ç”¨-æ˜¯é€šè¿‡-å…³é”®å­—&#34;&gt;èµ‹å€¼ &#39;å¼•ç”¨&#39; æ˜¯é€šè¿‡ &amp;amp; å…³é”®å­—&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$name_2 = &amp;amp;$name_1;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç±»å‹è½¬æ¢&#34;&gt;ç±»å‹è½¬æ¢&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$age = (int)readline(&#39;Your age: &#39;);

echo &#39;Your age is&#39; . (string)$age;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è·å–å˜é‡ç±»å‹&#34;&gt;è·å–å˜é‡ç±»å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo gettype($age); // int
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ¤æ–­æ˜¯å¦æ•´å½¢&#34;&gt;åˆ¤æ–­æ˜¯å¦æ•´å½¢&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo is_int($age)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ¤æ–­æ˜¯å¦æµ®ç‚¹å‹&#34;&gt;åˆ¤æ–­æ˜¯å¦æµ®ç‚¹å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo is_float($age)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ¤æ–­æ˜¯å¦å­—ç¬¦ä¸²&#34;&gt;åˆ¤æ–­æ˜¯å¦å­—ç¬¦ä¸²&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo is_string($age)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;å­—ç¬¦ä¸²-2&#34;&gt;å­—ç¬¦ä¸²&lt;/h1&gt;
&lt;h2 id=&#34;å•å¼•å·&#34;&gt;å•å¼•å·&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$name = &#39;Mike&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åŒå¼•å·&#34;&gt;åŒå¼•å·&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$name = &amp;quot;Mike&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åŒå¼•å·å­—ç¬¦ä¸²èƒ½å¤Ÿä½¿ç”¨è½¬ä¹‰å­—ç¬¦-n-new-line-t-tab-backslash&#34;&gt;åŒå¼•å·å­—ç¬¦ä¸²èƒ½å¤Ÿä½¿ç”¨è½¬ä¹‰å­—ç¬¦ \n = new line  \t = tab  \ = backslash&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo &amp;quot;Hello Mike\nHello David&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åŒå¼•å·å­—ç¬¦ä¸²èƒ½å¤Ÿæ’å…¥å˜é‡&#34;&gt;åŒå¼•å·å­—ç¬¦ä¸²èƒ½å¤Ÿæ’å…¥å˜é‡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo &amp;quot;Hello $name&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å­—ç¬¦ä¸²æ‹¼æ¥&#34;&gt;å­—ç¬¦ä¸²æ‹¼æ¥&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo &#39;Hello &#39; . $name;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å­—ç¬¦ä¸²é•¿åº¦&#34;&gt;å­—ç¬¦ä¸²é•¿åº¦&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo strlen($name);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ é™¤é¦–éƒ¨å’Œå°¾éƒ¨çš„ç©ºæ ¼&#34;&gt;åˆ é™¤é¦–éƒ¨å’Œå°¾éƒ¨çš„ç©ºæ ¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo trim($text);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è½¬æ¢ä¸ºå°å†™&#34;&gt;è½¬æ¢ä¸ºå°å†™&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo strtolower($email);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è½¬æ¢ä¸ºå¤§å†™&#34;&gt;è½¬æ¢ä¸ºå¤§å†™&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo strtoupper($email);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å°†é¦–å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™&#34;&gt;å°†é¦–å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo ucfirst($name);  // &#39;Mike&#39; 
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ›¿æ¢-å°†-text-ä¸­çš„æ–‡æœ¬-a-æ›¿æ¢æˆæ–‡æœ¬-b&#34;&gt;æ›¿æ¢ å°† $text ä¸­çš„æ–‡æœ¬ a æ›¿æ¢æˆæ–‡æœ¬ b&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo str_replace(&#39;a&#39;, &#39;b&#39;, $text);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å­—ç¬¦ä¸²åŒ…å«-php-8&#34;&gt;å­—ç¬¦ä¸²åŒ…å« (PHP 8)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo str_contains($name, &#39;ke&#39;)  # true
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æŸ¥æ‰¾-k-åœ¨å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®&#34;&gt;æŸ¥æ‰¾ &amp;quot;k&amp;quot; åœ¨å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$pos = strpos($name, &#39;k&#39;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†-åç§»é‡-é•¿åº¦&#34;&gt;è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ† (åç§»é‡ / é•¿åº¦)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo substr($name, 0, $pos); # Mi
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ•°å­—&#34;&gt;æ•°å­—&lt;/h1&gt;
&lt;h2 id=&#34;å¿«æ·å¢åŠ å¹¶èµ‹å€¼&#34;&gt;å¿«æ·å¢åŠ å¹¶èµ‹å€¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$value = 10;
$value++;
// or 
$value += 1;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¿«æ·å‡å°‘å¹¶èµ‹å€¼&#34;&gt;å¿«æ·å‡å°‘å¹¶èµ‹å€¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$value = 10;
$value--;
// or 
$value -= 1;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—&#34;&gt;æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo is_numeric(&#39;59.99&#39;); # true
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å››èˆäº”å…¥&#34;&gt;å››èˆäº”å…¥&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo round(0.80);  // returns 1
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç²¾ç¡®åœ°å¯¹æ•°å­—è¿›è¡Œå››èˆäº”å…¥&#34;&gt;ç²¾ç¡®åœ°å¯¹æ•°å­—è¿›è¡Œå››èˆäº”å…¥&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo round(1.49356, 2));  // returns 1.49
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;éšæœºæ•°&#34;&gt;éšæœºæ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo(rand(10, 100)); # 89
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ¡ä»¶è¯­å¥&#34;&gt;æ¡ä»¶è¯­å¥&lt;/h1&gt;
&lt;h2 id=&#34;if-elseif-else&#34;&gt;If / elseif / else&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;if ($condition == 10) {
    echo &#39;condition 10&#39;
} elseif  ($condition == 5) {
    echo &#39;condition 5&#39;
} else {
    echo &#39;all other conditions&#39;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;and-ç­‰äº&#34;&gt;And ç­‰äº &amp;amp;&amp;amp;&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;if ($condition === 10 &amp;amp;&amp;amp; $condition2 === 5) {
    echo &#39;10 and 5&#39;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;or-ç­‰äº&#34;&gt;Or ç­‰äº ||&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;if ($condition === 10 || $condition2 === 5) {
    echo &#39;10 or 5&#39;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å•è¡Œ&#34;&gt;å•è¡Œ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;if ($isActive) return true;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ£€æŸ¥-null-å€¼&#34;&gt;æ£€æŸ¥ null å€¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;if (is_null($name)) {
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ¯”è¾ƒæ“ä½œç¬¦&#34;&gt;æ¯”è¾ƒæ“ä½œç¬¦&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;== // æ¾æ•£æ¯”è¾ƒ
=== // ä¸¥æ ¼æ¯”è¾ƒ
!= // ä¸ç­‰äº
|| // æˆ–
&amp;amp;&amp;amp; // ä¸”
&amp;gt; // å¤§äº
&amp;lt; // å°äº
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ä¸‰å…ƒè¿ç®—-true-false&#34;&gt;ä¸‰å…ƒè¿ç®— (true : false)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo $isValid ? &#39;user valid&#39; : &#39;user not valid&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;null-åˆå¹¶è¿ç®—&#34;&gt;null åˆå¹¶è¿ç®—&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo $name ?? &#39;Mike&#39;;  //output &#39;Mike&#39; if $name is null
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;null-åˆå¹¶èµ‹å€¼&#34;&gt;null åˆå¹¶èµ‹å€¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$name ??= &#39;Mike&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;null-å®‰å…¨è¿ç®—ç¬¦php-8å¦‚æœæœ‰ä¸€ä¸ªä¸º-nullå°†è¿”å›-null&#34;&gt;null å®‰å…¨è¿ç®—ç¬¦ï¼ˆPHP 8ï¼‰å¦‚æœæœ‰ä¸€ä¸ªï¼Ÿä¸º nullï¼Œå°†è¿”å› null&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo $user?-&amp;gt;profile?-&amp;gt;activate();
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;null-å®‰å…¨-null-åˆå¹¶-å¦‚æœä¸º-null-å°†è¿”å›-no-user-profile&#34;&gt;null å®‰å…¨ + null åˆå¹¶ (å¦‚æœä¸º null å°†è¿”å› ã€No user profileã€)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo $user?-&amp;gt;profile?-&amp;gt;activate() ?? &#39;Not applicable&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é£èˆ¹ç¬¦å·-è¿”å›-1-0-1&#34;&gt;é£èˆ¹ç¬¦å· è¿”å› -1 0 1&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$names = [&#39;Mike&#39;, &#39;Paul&#39;, &#39;John&#39;]
usort($names, function($a, $b) {
    return $a &amp;lt;=&amp;gt; $b;
}
// [&#39;John&#39;, &#39;Mike&#39;, &#39;Paul&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è½¬æ¢ä¸ºå¸ƒå°”å€¼æ—¶è¿”å›-false&#34;&gt;è½¬æ¢ä¸ºå¸ƒå°”å€¼æ—¶è¿”å› false&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;false, 0, 0.0, null, unset, &#39;0&#39;, &#39;&#39;, []
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å°†åŒä¸€å˜é‡ä¸å¤šä¸ªå€¼è¿›è¡Œæ¯”è¾ƒ&#34;&gt;å°†åŒä¸€å˜é‡ä¸å¤šä¸ªå€¼è¿›è¡Œæ¯”è¾ƒ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;switch ($color) {
    case &#39;red&#39;:
        echo &#39;The color is red&#39;;
         break;
    case &#39;yellow&#39;:
        echo &#39;The color is yellow&#39;;
        break;
    case &#39;red&#39;:
        echo &#39;The color is red&#39;;
        break;
    default:
        echo &#39;The color is unknown&#39;;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;match-è¡¨è¾¾å¼php-8&#34;&gt;Match è¡¨è¾¾å¼ï¼ˆPHP 8ï¼‰&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$type = match($color) {
    &#39;red&#39; =&amp;gt; &#39;danger&#39;,
    &#39;yellow&#39;, &#39;orange&#39; =&amp;gt; &#39;warning&#39;,
    &#39;green&#39; =&amp;gt; &#39;success&#39;,
    default =&amp;gt; &#39;Unknown&#39;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ£€æŸ¥å˜é‡æ˜¯å¦å£°æ˜&#34;&gt;æ£€æŸ¥å˜é‡æ˜¯å¦å£°æ˜&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;isset($color[&#39;red&#39;]);  # true
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;å¾ªç¯å’Œè¿­ä»£&#34;&gt;å¾ªç¯å’Œè¿­ä»£&lt;/h1&gt;
&lt;h2 id=&#34;for-å¾ªç¯&#34;&gt;for å¾ªç¯&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;for ($i = 0; $i &amp;lt; 20; $i++) {
    echo &amp;quot;i value = &amp;quot; . i;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;while-å¾ªç¯&#34;&gt;while å¾ªç¯&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$number = 1;
while ($number &amp;lt; 10) {
    echo &#39;value : &#39; . $number ;
    $number += 1;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;do-while&#34;&gt;do while&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$number = 1;
do {
    echo &#39;value : &#39; . $number ;
    $number += 1;
} while ($number &amp;lt; 10);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;foreach-å¸¦æœ‰-break-continue-çš„ç¤ºä¾‹&#34;&gt;foreach å¸¦æœ‰ break / continue çš„ç¤ºä¾‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$values = [&#39;one&#39;, &#39;two&#39;, &#39;three&#39;];
foreach ($values as $value) {
    if ($value === &#39;two&#39;) {
        break; // é€€å‡ºå¾ªç¯
    } elseif ($value === &#39;three&#39;) {
        continue; // ä¸‹ä¸€ä¸ªå¾ªç¯è¿­ä»£
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ•°ç»„-2&#34;&gt;æ•°ç»„&lt;/h1&gt;
&lt;h2 id=&#34;æ•°ç»„å£°æ˜å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹&#34;&gt;æ•°ç»„å£°æ˜å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$example = [&#39;Mike&#39;, 50.2, true, [&#39;10&#39;, &#39;20&#39;];
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°ç»„å£°æ˜&#34;&gt;æ•°ç»„å£°æ˜&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$names = [&#39;Mike&#39;, &#39;Peter&#39;, &#39;Shawn&#39;, &#39;John&#39;];
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç›´æ¥è®¿é—®ç‰¹å®šå…ƒç´ &#34;&gt;ç›´æ¥è®¿é—®ç‰¹å®šå…ƒç´ &lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$name[1]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¦‚ä½•è®¿é—®æ•°ç»„ä¸­çš„æ•°ç»„å…ƒç´ &#34;&gt;å¦‚ä½•è®¿é—®æ•°ç»„ä¸­çš„æ•°ç»„å…ƒç´ &lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$example[3][1]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å°†å…ƒç´ æ·»åŠ åˆ°æ•°ç»„&#34;&gt;å°†å…ƒç´ æ·»åŠ åˆ°æ•°ç»„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$names[] = &#39;Micheal&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°ç»„åˆå¹¶&#34;&gt;æ•°ç»„åˆå¹¶&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$array3 = array_merge($array1, $array2);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦æ¥è¿›è¡Œæ•°ç»„åˆå¹¶&#34;&gt;ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦æ¥è¿›è¡Œæ•°ç»„åˆå¹¶&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$names = [&#39;Mike&#39;, &#39;Peter&#39;, &#39;Paul&#39;];
$people = [&#39;John&#39;, ...$names]; // [&#39;John&#39;, &#39;Mike&#39;, &#39;Peter&#39;, &#39;Paul&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ é™¤æ•°ç»„å…ƒç´ &#34;&gt;åˆ é™¤æ•°ç»„å…ƒç´ &lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;unset($names[&#39;Peter&#39;]);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°ç»„è½¬å­—ç¬¦ä¸²&#34;&gt;æ•°ç»„è½¬å­—ç¬¦ä¸²&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo implode(&#39;, &#39;, $names); // è¾“å‡º Mike, Shawn, John, Micheal
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å­—ç¬¦ä¸²è½¬æ•°ç»„&#34;&gt;å­—ç¬¦ä¸²è½¬æ•°ç»„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo explode(&#39;,&#39;, $text); // [&#39;Mike&#39;, &#39;Shawn&#39;, &#39;John&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;éå†æ•°ç»„å…ƒç´ &#34;&gt;éå†æ•°ç»„å…ƒç´ &lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;foreach($names as $name) { 
   echo &#39;Hello &#39; . $name;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°&#34;&gt;æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo count($names);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å…³è”æ•°ç»„å£°æ˜-key-value&#34;&gt;å…³è”æ•°ç»„å£°æ˜ (key =&amp;gt; value):&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$person = [&#39;age&#39; =&amp;gt; 45, &#39;genre&#39; =&amp;gt; &#39;men&#39;];
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ·»åŠ åˆ°æœ«å°¾-æ•°ç»„&#34;&gt;æ·»åŠ åˆ°æœ«å°¾. æ•°ç»„:&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$person[&#39;name&#39;] = &#39;Mike&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¾ªç¯æ•°ç»„-key-value&#34;&gt;å¾ªç¯æ•°ç»„ key =&amp;gt; value:&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;foreach($names as $key =&amp;gt; $value) { 
   echo $key . &#39; : &#39; . $value
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸä¸ªç‰¹å®šé”®&#34;&gt;æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸä¸ªç‰¹å®šé”®&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo array_key_exists(&#39;age&#39;, $person);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è¿”å›é”®&#34;&gt;è¿”å›é”®&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo array_keys($person); // [&#39;age&#39;, &#39;genre&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è¿”å›å€¼&#34;&gt;è¿”å›å€¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;echo array_values($person) // [45, &#39;men&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°ç»„è¿‡æ»¤å™¨-è¿”å›è¿‡æ»¤åçš„æ•°ç»„&#34;&gt;æ•°ç»„è¿‡æ»¤å™¨ (è¿”å›è¿‡æ»¤åçš„æ•°ç»„)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$filteredPeople = array_filter($people, function ($person) {
    return $names-&amp;gt;active;
})
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°ç»„æ˜ å°„-è¿”å›å˜æ¢åçš„æ•°ç»„&#34;&gt;æ•°ç»„æ˜ å°„ (è¿”å›å˜æ¢åçš„æ•°ç»„)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$onlyNames = array_map(function($person) {
    return [&#39;name&#39; =&amp;gt; $person-&amp;gt;name];
}, $people)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æœç´¢å…³è”æ•°ç»„&#34;&gt;æœç´¢å…³è”æ•°ç»„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$items = [
        [&#39;id&#39; =&amp;gt; &#39;100&#39;, &#39;name&#39; =&amp;gt; &#39;product 1&#39;],
        [&#39;id&#39; =&amp;gt; &#39;200&#39;, &#39;name&#39; =&amp;gt; &#39;product 2&#39;],
        [&#39;id&#39; =&amp;gt; &#39;300&#39;, &#39;name&#39; =&amp;gt; &#39;product 3&#39;],
        [&#39;id&#39; =&amp;gt; &#39;400&#39;, &#39;name&#39; =&amp;gt; &#39;product 4&#39;],
    ];
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åœ¨-name-åˆ—ä¸­æœç´¢æ‰€æœ‰å€¼&#34;&gt;åœ¨ &#39;name&#39; åˆ—ä¸­æœç´¢æ‰€æœ‰å€¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$found_key = array_search(&#39;product 3&#39;, array_column($items, &#39;name&#39;));
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;å‡½æ•°&#34;&gt;å‡½æ•°&lt;/h1&gt;
&lt;h2 id=&#34;å‡½æ•°å£°æ˜&#34;&gt;å‡½æ•°å£°æ˜&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;function name($firstName, $lastName = &#39;defaultvalue&#39;) {
    return &amp;quot;$firstName $lastName&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å‡½æ•°è°ƒç”¨&#34;&gt;å‡½æ•°è°ƒç”¨&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;name(&#39;Mike&#39;, &#39;Taylor&#39;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¸¦å‘½åå‚æ•°çš„å‡½æ•°è°ƒç”¨-php-8&#34;&gt;å¸¦å‘½åå‚æ•°çš„å‡½æ•°è°ƒç”¨ (PHP 8)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;name(firstName: &#39;Mike&#39;, lastName: &#39;Taylor&#39;); // æ’åºèƒ½å¤Ÿæ”¹å˜
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å‡½æ•°å¯å˜æ•°é‡å‚æ•°&#34;&gt;å‡½æ•°å¯å˜æ•°é‡å‚æ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;function name(...$params) {
    return $params[0] . â€œ â€œ . params[1];
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é—­åŒ…å‡½æ•°&#34;&gt;é—­åŒ…å‡½æ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;Route::get(&#39;/&#39;, function () {
     return view(&#39;welcome&#39;);
});
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç®­å¤´å‡½æ•°&#34;&gt;ç®­å¤´å‡½æ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;Route::get(&#39;/&#39;, fn () =&amp;gt; view(&#39;welcome&#39;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹&#34;&gt;å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;function display(string $first, string $last) : string {
    return &amp;quot;$first $last&amp;quot;;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç±»å‹æˆ–ç©ºå€¼&#34;&gt;ç±»å‹æˆ–ç©ºå€¼&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;function display(?string $name) {
   
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ–‡ä»¶&#34;&gt;æ–‡ä»¶&lt;/h1&gt;
&lt;h2 id=&#34;è·å–å½“å‰ç›®å½•&#34;&gt;è·å–å½“å‰ç›®å½•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$current_dir = __DIR__;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨&#34;&gt;æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;if (file_exists(&#39;/posts/first.txt&#39;)) {
 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è¯»å–æ–‡ä»¶å†…å®¹åˆ°ä¸€ä¸ªå˜é‡ä¸­&#34;&gt;è¯»å–æ–‡ä»¶å†…å®¹åˆ°ä¸€ä¸ªå˜é‡ä¸­&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$post = file_get_contents($file);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ–‡ä»¶è¯»å–&#34;&gt;æ–‡ä»¶è¯»å–&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$file = fopen(&amp;quot;test.txt&amp;quot;, &amp;quot;r&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è¾“å‡ºè¡Œ-ç›´åˆ°-eof-ç»“æŸ&#34;&gt;è¾“å‡ºè¡Œ, ç›´åˆ° EOF ç»“æŸ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;while(! feof($file)) {
  $line = fgets($file);
  echo $line. &amp;quot;&amp;lt;br&amp;gt;&amp;quot;;
}
fclose($file);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ–‡ä»¶å†™å…¥&#34;&gt;æ–‡ä»¶å†™å…¥&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$file = fopen(&#39;export.csv&#39;, &#39;a&#39;);
$array = [&#39;name&#39; =&amp;gt; &#39;Mike&#39;, &#39;age&#39; =&amp;gt; 45];
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å°†é”®åå†™ä¸º-csv-æ ‡é¢˜&#34;&gt;å°†é”®åå†™ä¸º CSV æ ‡é¢˜&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;fputcsv($file, array_keys($array[0]));
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å†™å…¥è¡Œ-æ ¼å¼ä¸º-csv&#34;&gt;å†™å…¥è¡Œ (æ ¼å¼ä¸º csv)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;foreach ($array as $row) {
    fputcsv($file, $row); 
}
fclose($file);
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;errors&#34;&gt;Errors&lt;/h1&gt;
&lt;h2 id=&#34;æŠ›å‡ºé”™è¯¯&#34;&gt;æŠ›å‡ºé”™è¯¯&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;if (someCondition) {
    throw new Exception(&#39;Data format error&#39;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•è·é”™è¯¯&#34;&gt;æ•è·é”™è¯¯&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;try {
  $db-&amp;gt;checkData($data);
} catch (Exception $e) {
    echo $e-&amp;gt;getMessage();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;// å¦‚æœtry catchéƒ½æœ‰returnï¼ŒæŒ‰ç…§æ­£å¸¸æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œfinallyçš„é€»è¾‘ï¼Œå†è¿”å›å¯¹åº”çš„try æˆ–è€…catché‡Œæ‰§è¡Œreturn
// å¦‚æœtry catch finallyéƒ½æœ‰returnï¼Œæ‰§è¡Œå®Œfinallyçš„é€»è¾‘åï¼Œä¼šè°ƒç”¨finallyçš„return
try {
  $db-&amp;gt;checkData($data);
} catch (Exception $e) {
    echo $e-&amp;gt;getMessage();
} finally {

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;oop&#34;&gt;OOP&lt;/h1&gt;
&lt;h2 id=&#34;ç±»å£°æ˜&#34;&gt;ç±»å£°æ˜&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class Person 
{
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¯¹è±¡å®ä¾‹&#34;&gt;å¯¹è±¡å®ä¾‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;$person = new Person
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç±»å±æ€§å’Œæ„é€ æ–¹æ³•&#34;&gt;ç±»å±æ€§å’Œæ„é€ æ–¹æ³•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class Person 
{
   protected $firstName;
   protected $lastName;
   public function __construct($firstName, $lastName) {
        $this-&amp;gt;firstName = $firstName;
        $this-&amp;gt;lastName = $lastName
   }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ„é€ å™¨å±æ€§æå‡php-8&#34;&gt;æ„é€ å™¨å±æ€§æå‡ï¼ˆPHP 8ï¼‰&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class Person 
{
    public function __construct(protected $firstName, protected $lastName) 
    {

    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è·å–å’Œè®¾ç½®&#34;&gt;è·å–å’Œè®¾ç½®&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class Person
{
    private $name;

    public function setName($name){
        if(!is_string($name)){
            throw new Exception(&#39;$name must be a string!&#39;);
        }
        $this-&amp;gt;name = $name;
    }

    public function getName(){
        return $this-&amp;gt;name;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é™æ€æ„é€ æ–¹æ³•&#34;&gt;é™æ€æ„é€ æ–¹æ³•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;public static function create(...$params) {
    return new self($params)
}
$person = Person::create(â€˜Mikeâ€™, â€˜Taylorâ€™);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é™æ€æ–¹æ³•&#34;&gt;é™æ€æ–¹æ³•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class greeting {
  public static function welcome() {
    echo &amp;quot;Hello World!&amp;quot;;
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è°ƒç”¨é™æ€æ–¹æ³•&#34;&gt;è°ƒç”¨é™æ€æ–¹æ³•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;greeting::welcome();
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é™æ€æ–¹æ³•è°ƒç”¨&#34;&gt;é™æ€æ–¹æ³•è°ƒç”¨&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class greeting {
  public static function welcome() {
    echo &amp;quot;Hello World!&amp;quot;;
  }

  public function __construct() {
    static::welcome();
  }
}
new greeting();
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é™æ€å¸¸é‡&#34;&gt;é™æ€å¸¸é‡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class Connection
{
  const MAX_USER = 100;
}
echo Connection::MAX_USER # 100
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç±»ç»§æ‰¿&#34;&gt;ç±»ç»§æ‰¿&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class Customer extends Person
{
    public function name()
    {
        parent::name();
        echo &#39;Override method&#39;;  
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;self-å…³é”®å­—å¼•ç”¨å½“å‰ç±»ä¸ä¼šåƒé™æ€é‚£æ ·é€šè¿‡ç»§æ‰¿åæœŸç»‘å®šä¿®æ”¹&#34;&gt;self å…³é”®å­—å¼•ç”¨å½“å‰ç±»ï¼ˆä¸ä¼šåƒé™æ€é‚£æ ·é€šè¿‡ç»§æ‰¿åæœŸç»‘å®šä¿®æ”¹ï¼‰&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;self::welcome();
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ¥å£&#34;&gt;æ¥å£&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;interface Animal {
  public function makeSound();
}

class Cat implements Animal {
  public function makeSound() {
    echo &amp;quot;Meow&amp;quot;;
  }
}
$animal = new Cat();
$animal-&amp;gt;makeSound();
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;trait-mix-in&#34;&gt;Trait (mix-in)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;trait HelloWorld {
    public function sayHello() {
        echo &#39;Hello World!&#39;;
    }
}
class Greetings {
    use HelloWorld;
}
$object = new Greetings();
$object-&amp;gt;sayHello();
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;https://learnku.com/php/t/62217&lt;/p&gt;
&lt;/blockquote&gt;
">PHP é€ŸæŸ¥è¡¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/go-cao-zuo-mysql/"" data-c="
          &lt;h2 id=&#34;ä¸‹è½½ä¾èµ–&#34;&gt;ä¸‹è½½ä¾èµ–&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;go get -u github.com/go-sql-driver/mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;è¿æ¥&#34;&gt;è¿æ¥&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;package main

import (
	&amp;quot;database/sql&amp;quot;
	&amp;quot;fmt&amp;quot;

	_ &amp;quot;github.com/go-sql-driver/mysql&amp;quot;
)

var db *sql.DB

func initDB() (err error) {
	// ç”¨æˆ·å:å¯†ç @tcp(ip:ç«¯å£)/æ•°æ®åº“å
	dsn := &amp;quot;root:123456@tcp(127.0.0.1:3306)/go_test&amp;quot;
	// Open ä¸ä¼šæ ¡éªŒè´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
	db, err = sql.Open(&amp;quot;mysql&amp;quot;, dsn)
	if err != nil {
		return
	}
	// å°è¯•ä¸æ•°æ®åº“å»ºç«‹è¿æ¥ï¼ˆæ ¡éªŒdsnæ˜¯å¦æ­£ç¡®ï¼‰
	err = db.Ping()
	if err != nil {
		return
    }
	return nil
}

func main()  {
	err:= initDB()
	if err!= nil {
		fmt.Println(err)
		return
	}
	fmt.Println(&amp;quot;è¿æ¥æˆåŠŸï¼&amp;quot;)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;sql.DB&lt;/code&gt; æ˜¯è¡¨ç¤ºè¿æ¥çš„æ•°æ®åº“å¯¹è±¡ï¼ˆç»“æ„ä½“å®ä¾‹ï¼‰ï¼Œå®ƒä¿å­˜äº†è¿æ¥æ•°æ®åº“ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯ã€‚å®ƒå†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªå…·æœ‰é›¶åˆ°å¤šä¸ªåº•å±‚è¿æ¥çš„è¿æ¥æ± ï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°è¢«å¤šä¸ª goroutine åŒæ—¶ä½¿ç”¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;curd&#34;&gt;CURD&lt;/h2&gt;
&lt;h3 id=&#34;æ’å…¥&#34;&gt;æ’å…¥&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func insertRow()  {
	sqlStr := &amp;quot;insert into user (name, age) values (?, ?)&amp;quot;
	result, err := db.Exec(sqlStr, &amp;quot;å°æ™“&amp;quot;, 11)
	if err != nil {
		fmt.Println(err)
		return
	}
	id, err := result.LastInsertId()
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(id)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æŸ¥è¯¢&#34;&gt;æŸ¥è¯¢&lt;/h3&gt;
&lt;h4 id=&#34;å•è¡ŒæŸ¥è¯¢&#34;&gt;å•è¡ŒæŸ¥è¯¢&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func queryRow()  {
	sqlStr := &amp;quot;select id, name, age from user where id = ?&amp;quot;
    var u user
    // ç¡®ä¿ QueryRow ä¹‹åè°ƒç”¨ Scan æ–¹æ³•ï¼Œå¦åˆ™æŒæœ‰çš„æ•°æ®åº“é“¾æ¥ä¸ä¼šè¢«é‡Šæ”¾
	err := db.QueryRow(sqlStr, 1).Scan(&amp;amp;u.id, &amp;amp;u.name, &amp;amp;u.age)
	if err != nil {
		fmt.Println(&amp;quot;é”™è¯¯ï¼š&amp;quot;, err)
		return
	}
	fmt.Println(u)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;å¤šè¡ŒæŸ¥è¯¢&#34;&gt;å¤šè¡ŒæŸ¥è¯¢&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func queryRows()  {
	sqlStr := &amp;quot;select id, name, age from user where id &amp;gt;= ?&amp;quot;
	rows, err := db.Query(sqlStr, 1)
	if err != nil {
		fmt.Println(err)
	}
	// å…³é—­ rows é‡Šæ”¾æŒæœ‰çš„æ•°æ®åº“é“¾æ¥
	defer rows.Close()

	// å¾ªç¯è¯»å–ç»“æœé›†ä¸­çš„æ•°æ®
	for rows.Next() {
		var u user
		err := rows.Scan(&amp;amp;u.id, &amp;amp;u.name, &amp;amp;u.age)
		if err != nil {
			fmt.Println(&amp;quot;é”™è¯¯ï¼š&amp;quot;, err)
			return
		}
		fmt.Println(u)
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ›´æ–°&#34;&gt;æ›´æ–°&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func updateRow()  {
	sqlStr := &amp;quot;update user set age = ? where id &amp;gt; ?&amp;quot;
	result, err := db.Exec(sqlStr, 12, 2)
	if err != nil {
		fmt.Println(err)
		return
	}
	n, err := result.RowsAffected() // æ“ä½œå—å½±å“çš„è¡Œæ•°
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(n)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åˆ é™¤æ•°æ®&#34;&gt;åˆ é™¤æ•°æ®&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func deleteRow()  {
	sqlStr := &amp;quot;delete from user where id = ?&amp;quot;
	result, err := db.Exec(sqlStr, 4)
	if err != nil {
		fmt.Println(err)
		return
	}
	n, err := result.RowsAffected()
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(n)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é¢„å¤„ç†&#34;&gt;é¢„å¤„ç†&lt;/h2&gt;
&lt;p&gt;é˜²æ­¢ &lt;code&gt;SQL æ³¨å…¥&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;æŸ¥è¯¢-2&#34;&gt;æŸ¥è¯¢&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func prepareQuery()  {
	sqlStr := &amp;quot;select id, name, age from user where id &amp;gt;= ?&amp;quot;
	stmt, err := db.Prepare(sqlStr)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer stmt.Close()
	rows, err := stmt.Query(1)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer rows.Close()
	for rows.Next() {
		var u user
		err := rows.Scan(&amp;amp;u.id, &amp;amp;u.name, &amp;amp;u.age)
		if err != nil {
			fmt.Println(err)
			return
		}
		fmt.Println(u)
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ’å…¥æ›´æ–°åˆ é™¤ç±»ä¼¼&#34;&gt;æ’å…¥ï¼Œæ›´æ–°ï¼Œåˆ é™¤ç±»ä¼¼&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func prepareInsert() {
	sqlStr := &amp;quot;insert into user(name, age) values (?, ?)&amp;quot;
	stmt, err := db.Prepare(sqlStr)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer stmt.Close()
	_, err = stmt.Exec(&amp;quot;å°çˆ±&amp;quot;, 5)
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(&amp;quot;success&amp;quot;)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;äº‹åŠ¡&#34;&gt;äº‹åŠ¡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func transactionDemo()  {
	tx, err := db.Begin() // å¼€å¯äº‹åŠ¡
	if err != nil {
		if tx != nil {
			tx.Rollback() // å›æ»š
		}
		fmt.Println(err)
		return
	}
	sqlStr1 := &amp;quot;update user set age = 18 where id = ?&amp;quot;
	result1, err := tx.Exec(sqlStr1, 2)
	if err != nil {
		tx.Rollback()
		fmt.Println(err)
		return
	}
	n1, err := result1.RowsAffected()
	if err != nil {
		tx.Rollback()
		fmt.Println(err)
		return
	}
	sqlStr2 := &amp;quot;update user set age = 18 where id = ?&amp;quot;
	result2, err := tx.Exec(sqlStr2, 1)
	if err != nil {
		tx.Rollback()
		fmt.Println(err)
		return
	}
	n2, err := result2.RowsAffected()
	if err != nil {
		tx.Rollback()
		fmt.Println(err)
		return
	}
	fmt.Println(n1, n2)
	if 1 == n1 &amp;amp;&amp;amp; 1 == n2 {
		tx.Commit() // æäº¤
	} else {
		tx.Rollback()
	}
}
&lt;/code&gt;&lt;/pre&gt;
">Go æ“ä½œMySQL</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/php-sui-ji-zi-fu-chuan/"" data-c="
          &lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;function getRandChar($length = 6)
{
    $charStr = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz&#39;;

    $str = &#39;&#39;;
    $max = strlen($charStr);
    for ($i = 0; $i &amp;lt; $length; $i++) {
        $str .= $charStr[rand(0, $max - 1)];
    }

    return $str;
}

var_dump(getRandChar(5));
&lt;/code&gt;&lt;/pre&gt;
">PHP éšæœºå­—ç¬¦ä¸²</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/php-wu-xian-ji-fen-lei/"" data-c="
          &lt;h1 id=&#34;é€’å½’&#34;&gt;é€’å½’&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

$array = [
    [&#39;id&#39; =&amp;gt; 1, &#39;parent_id&#39; =&amp;gt; 0, &#39;name&#39; =&amp;gt; &#39;æ²³åŒ—çœ&#39;],
    [&#39;id&#39; =&amp;gt; 2, &#39;parent_id&#39; =&amp;gt; 0, &#39;name&#39; =&amp;gt; &#39;åŒ—äº¬å¸‚&#39;],
    [&#39;id&#39; =&amp;gt; 3, &#39;parent_id&#39; =&amp;gt; 1, &#39;name&#39; =&amp;gt; &#39;é‚¯éƒ¸å¸‚&#39;],
    [&#39;id&#39; =&amp;gt; 4, &#39;parent_id&#39; =&amp;gt; 2, &#39;name&#39; =&amp;gt; &#39;æœé˜³åŒº&#39;],
    [&#39;id&#39; =&amp;gt; 5, &#39;parent_id&#39; =&amp;gt; 2, &#39;name&#39; =&amp;gt; &#39;é€šå·åŒº&#39;],
    [&#39;id&#39; =&amp;gt; 6, &#39;parent_id&#39; =&amp;gt; 4, &#39;name&#39; =&amp;gt; &#39;æœ›äº¬&#39;],
    [&#39;id&#39; =&amp;gt; 7, &#39;parent_id&#39; =&amp;gt; 4, &#39;name&#39; =&amp;gt; &#39;é…’ä»™æ¡¥&#39;],
    [&#39;id&#39; =&amp;gt; 8, &#39;parent_id&#39; =&amp;gt; 3, &#39;name&#39; =&amp;gt; &#39;æ°¸å¹´åŒº&#39;],
    [&#39;id&#39; =&amp;gt; 9, &#39;parent_id&#39; =&amp;gt; 1, &#39;name&#39; =&amp;gt; &#39;æ­¦å®‰å¸‚&#39;],
];

function getTree($array, $parent_id = 0, $level = 0)
{
    static $list = [];
    foreach ($array as $key =&amp;gt; $value) {
        if ($value[&#39;parent_id&#39;] == $parent_id) {
            $value[&#39;level&#39;] = $level;
            $list[] = $value;
            unset($array[$key]);
            getTree($array, $value[&#39;id&#39;], $level + 1);
        }
    }
    return $list;
}

$list = getTree($array);

foreach ($list as $value) {
    echo str_repeat(&#39;--&#39;, $value[&#39;level&#39;]) . $value[&#39;name&#39;] . PHP_EOL;
}
/**
æ²³åŒ—çœ
--é‚¯éƒ¸å¸‚
----æ°¸å¹´åŒº
--æ­¦å®‰å¸‚
åŒ—äº¬å¸‚
--æœé˜³åŒº
----æœ›äº¬
----é…’ä»™æ¡¥
--é€šå·åŒº
 **/
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;å¼•ç”¨&#34;&gt;å¼•ç”¨&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

$array = [
    1 =&amp;gt; [&#39;id&#39; =&amp;gt; 1, &#39;parent_id&#39; =&amp;gt; 0, &#39;name&#39; =&amp;gt; &#39;æ²³åŒ—çœ&#39;],
    2 =&amp;gt; [&#39;id&#39; =&amp;gt; 2, &#39;parent_id&#39; =&amp;gt; 0, &#39;name&#39; =&amp;gt; &#39;åŒ—äº¬å¸‚&#39;],
    3 =&amp;gt; [&#39;id&#39; =&amp;gt; 3, &#39;parent_id&#39; =&amp;gt; 1, &#39;name&#39; =&amp;gt; &#39;é‚¯éƒ¸å¸‚&#39;],
    4 =&amp;gt; [&#39;id&#39; =&amp;gt; 4, &#39;parent_id&#39; =&amp;gt; 2, &#39;name&#39; =&amp;gt; &#39;æœé˜³åŒº&#39;],
    5 =&amp;gt; [&#39;id&#39; =&amp;gt; 5, &#39;parent_id&#39; =&amp;gt; 2, &#39;name&#39; =&amp;gt; &#39;é€šå·åŒº&#39;],
    6 =&amp;gt; [&#39;id&#39; =&amp;gt; 6, &#39;parent_id&#39; =&amp;gt; 4, &#39;name&#39; =&amp;gt; &#39;æœ›äº¬&#39;],
    7 =&amp;gt; [&#39;id&#39; =&amp;gt; 7, &#39;parent_id&#39; =&amp;gt; 4, &#39;name&#39; =&amp;gt; &#39;é…’ä»™æ¡¥&#39;],
    8 =&amp;gt; [&#39;id&#39; =&amp;gt; 8, &#39;parent_id&#39; =&amp;gt; 3, &#39;name&#39; =&amp;gt; &#39;æ°¸å¹´åŒº&#39;],
    9 =&amp;gt; [&#39;id&#39; =&amp;gt; 9, &#39;parent_id&#39; =&amp;gt; 1, &#39;name&#39; =&amp;gt; &#39;æ­¦å®‰å¸‚&#39;],
];

function getTree($list)
{
    $tree = [];
    foreach ($list as &amp;amp;$item) {
        $parent_id = $item[&#39;parent_id&#39;];

        if (isset($list[$parent_id]) &amp;amp;&amp;amp; !empty($list[$parent_id])) {
            $list[$parent_id][&#39;list&#39;][] = &amp;amp;$item;
        } else {
            $tree[] = &amp;amp;$item;
        }
    }
    unset($item);

    return $tree;
}

$list = getTree($array);
print_r($list);
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;laravel-orm-æ¨¡å‹&#34;&gt;Laravel ORM æ¨¡å‹&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;å­—æ®µåç§°&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;ç±»å‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è‡ªå¢é•¿ ID&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;unsigned big int&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;name&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç±»ç›®åç§°&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;varchar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;parent_id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;çˆ¶ç±»ç›® ID&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;unsigned big int, null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;is_directory&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ˜¯å¦æ‹¥æœ‰å­ç±»ç›®&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;tinyint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;level&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å½“å‰ç±»ç›®å±‚çº§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;unsigned int&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;path&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è¯¥ç±»ç›®æ‰€æœ‰çˆ¶ç±»ç›® id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;varchar&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
namespace App\Services;

use App\Models\Category;

class CategoryService
{
    // è¿™æ˜¯ä¸€ä¸ªé€’å½’æ–¹æ³•
    // $parentId å‚æ•°ä»£è¡¨è¦è·å–å­ç±»ç›®çš„çˆ¶ç±»ç›® IDï¼Œnull ä»£è¡¨è·å–æ‰€æœ‰æ ¹ç±»ç›®
    // $allCategories å‚æ•°ä»£è¡¨æ•°æ®åº“ä¸­æ‰€æœ‰çš„ç±»ç›®ï¼Œå¦‚æœæ˜¯ null ä»£è¡¨éœ€è¦ä»æ•°æ®åº“ä¸­æŸ¥è¯¢
    public function getCategoryTree($parentId = null, $allCategories = null)
    {
        if (is_null($allCategories)) {
            // ä»æ•°æ®åº“ä¸­ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰ç±»ç›®
            $allCategories = Category::all();
        }

        return $allCategories
            // ä»æ‰€æœ‰ç±»ç›®ä¸­æŒ‘é€‰å‡ºçˆ¶ç±»ç›® ID ä¸º $parentId çš„ç±»ç›®
            -&amp;gt;where(&#39;parent_id&#39;, $parentId)
            // éå†è¿™äº›ç±»ç›®ï¼Œå¹¶ç”¨è¿”å›å€¼æ„å»ºä¸€ä¸ªæ–°çš„é›†åˆ
            -&amp;gt;map(function (Category $category) use ($allCategories) {
                $data = [&#39;id&#39; =&amp;gt; $category-&amp;gt;id, &#39;name&#39; =&amp;gt; $category-&amp;gt;name];
                // å¦‚æœå½“å‰ç±»ç›®ä¸æ˜¯çˆ¶ç±»ç›®ï¼Œåˆ™ç›´æ¥è¿”å›
                if (!$category-&amp;gt;is_directory) {
                    return $data;
                }
                // å¦åˆ™é€’å½’è°ƒç”¨æœ¬æ–¹æ³•ï¼Œå°†è¿”å›å€¼æ”¾å…¥ children å­—æ®µä¸­
                $data[&#39;children&#39;] = $this-&amp;gt;getCategoryTree($category-&amp;gt;id, $allCategories);

                return $data;
            });
    }
}

// è°ƒç”¨
app(App\Services\CategoryService::class)-&amp;gt;getCategoryTree()
&lt;/code&gt;&lt;/pre&gt;
">PHP æ— é™æåˆ†ç±»</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/selenium-cong-ru-men-dao-fang-qi/"" data-c="
          &lt;h1 id=&#34;å®‰è£…æµè§ˆå™¨é©±åŠ¨&#34;&gt;å®‰è£…æµè§ˆå™¨é©±åŠ¨&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://chromedriver.storage.googleapis.com/index.html&#34;&gt;Chrome æµè§ˆå™¨é©±åŠ¨&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://github.com/mozilla/geckodriver/releases&#34;&gt;Firefox æµè§ˆå™¨é©±åŠ¨&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;http://selenium-release.storage.googleapis.com/index.html&#34;&gt;IE æµè§ˆå™¨é©±åŠ¨&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/&#34;&gt;Edge æµè§ˆå™¨é©±åŠ¨&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://phantomjs.org/&#34;&gt;PhantomJS æµè§ˆå™¨é©±åŠ¨&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://github.com/operasoftware/operachromiumdriver/releases&#34;&gt;Opera æµè§ˆå™¨é©±åŠ¨&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æµ‹è¯•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver

# Chromeæµè§ˆå™¨
driver = webdriver.Chrome()
driver.get(&#39;https://www.baidu.com/&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;å®šä½é¡µé¢å…ƒç´ &#34;&gt;å®šä½é¡µé¢å…ƒç´ &lt;/h1&gt;
&lt;h2 id=&#34;id-å®šä½&#34;&gt;id å®šä½&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;input id=&amp;quot;toolbar-search-input&amp;quot; autocomplete=&amp;quot;off&amp;quot; type=&amp;quot;text&amp;quot; value=&amp;quot;&amp;quot; placeholder=&amp;quot;C++éš¾åœ¨å“ªé‡Œï¼Ÿ&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.find_element_by_id(&#39;toolbar-search-input&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;name-å®šä½&#34;&gt;name å®šä½&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;meta name=&amp;quot;keywords&amp;quot; content=&amp;quot;CSDNåšå®¢,CSDNå­¦é™¢,CSDNè®ºå›,CSDNç›´æ’­&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.find_element_by_name(&amp;quot;keywords&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;class-å®šä½&#34;&gt;class å®šä½&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;div class=&amp;quot;toolbar-search-container&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.find_element_by_class_name(&amp;quot;toolbar-search-container&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;tag-å®šä½&#34;&gt;tag å®šä½&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;div class=&amp;quot;toolbar-search-container&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.find_element_by_tag_name(&amp;quot;div&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;xpath-å®šä½&#34;&gt;xpath å®šä½&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;html&amp;gt;
  &amp;lt;head&amp;gt;...&amp;lt;head/&amp;gt;
  &amp;lt;body&amp;gt;
    &amp;lt;div id=&amp;quot;csdn-toolbar&amp;quot;&amp;gt;
      &amp;lt;div class=&amp;quot;toolbar-inside&amp;quot;&amp;gt;
        &amp;lt;div class=&amp;quot;toolbar-container&amp;quot;&amp;gt;
          &amp;lt;div class=&amp;quot;toolbar-container-left&amp;quot;&amp;gt;...&amp;lt;/div&amp;gt;
          &amp;lt;div class=&amp;quot;toolbar-container-middle&amp;quot;&amp;gt;
            &amp;lt;div class=&amp;quot;toolbar-search onlySearch&amp;quot;&amp;gt;
			&amp;lt;div class=&amp;quot;toolbar-search-container&amp;quot;&amp;gt;
				&amp;lt;input id=&amp;quot;toolbar-search-input&amp;quot; autocomplete=&amp;quot;off&amp;quot; type=&amp;quot;text&amp;quot; value=&amp;quot;&amp;quot; placeholder=&amp;quot;C++éš¾åœ¨å“ªé‡Œï¼Ÿ&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# ç»å¯¹è·¯å¾„ï¼ˆå±‚çº§å…³ç³»ï¼‰å®šä½
driver.find_element_by_xpath(
	&amp;quot;/html/body/div/div/div/div[2]/div/div/input[1]&amp;quot;)

# åˆ©ç”¨å…ƒç´ å±æ€§å®šä½
driver.find_element_by_xpath(
	&amp;quot;//*[@id=&#39;toolbar-search-input&#39;]&amp;quot;))

# å±‚çº§+å…ƒç´ å±æ€§å®šä½
driver.find_element_by_xpath(
	&amp;quot;//div[@id=&#39;csdn-toolbar&#39;]/div/div/div[2]/div/div/input[1]&amp;quot;)

# é€»è¾‘è¿ç®—ç¬¦å®šä½
driver.find_element_by_xpath(
	&amp;quot;//*[@id=&#39;toolbar-search-input&#39; and @autocomplete=&#39;off&#39;]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;css-å®šä½&#34;&gt;css å®šä½&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;ä¾‹å­&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;.class&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;.toolbar-search-container&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é€‰æ‹© class = &#39;toolbar-search-container&#39; çš„æ‰€æœ‰å…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;#id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;#toolbar-search-input&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é€‰æ‹© id = &#39;toolbar-search-input&#39; çš„å…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;*&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;*&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é€‰æ‹©æ‰€æœ‰å…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;element&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;input&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é€‰æ‹©æ‰€æœ‰ &amp;lt;input&amp;gt; å…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;element&amp;gt;element&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;div&amp;gt;input&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é€‰æ‹©çˆ¶å…ƒç´ ä¸º &amp;lt;div&amp;gt; çš„æ‰€æœ‰ &amp;lt;input&amp;gt; å…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;element+element&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;div+input&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é€‰æ‹©åŒä¸€çº§ä¸­åœ¨ &amp;lt;div&amp;gt; ä¹‹åçš„æ‰€æœ‰ &amp;lt;input&amp;gt; å…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;[attribute=value]&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;type=&#39;text&#39;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é€‰æ‹© type = &#39;text&#39; çš„æ‰€æœ‰å…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.find_element_by_css_selector(&#39;#toolbar-search-input&#39;)
driver.find_element_by_css_selector(&#39;html&amp;gt;body&amp;gt;div&amp;gt;div&amp;gt;div&amp;gt;div&amp;gt;div&amp;gt;div&amp;gt;input&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;link-å®šä½&#34;&gt;link å®šä½&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;link&lt;/code&gt; ä¸“é—¨ç”¨æ¥å®šä½æ–‡æœ¬é“¾æ¥ï¼Œå‡å¦‚è¦å®šä½ä¸‹é¢è¿™ä¸€æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;div class=&amp;quot;practice-box&amp;quot; data-v-04f46969=&amp;quot;&amp;quot;&amp;gt;åŠ å…¥ï¼æ¯æ—¥ä¸€ç»ƒ&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.find_element_by_link_text(&amp;quot;åŠ å…¥ï¼æ¯æ—¥ä¸€ç»ƒ&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;partial_link-å®šä½&#34;&gt;partial_link å®šä½&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;partial_link&lt;/code&gt; ç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œéƒ¨åˆ†é“¾æ¥â€ï¼Œå¯¹äºæœ‰äº›æ–‡æœ¬å¾ˆé•¿ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åªæŒ‡å®šéƒ¨åˆ†æ–‡æœ¬å³å¯å®šä½ï¼ŒåŒæ ·ä½¿ç”¨åˆšæ‰çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;div class=&amp;quot;practice-box&amp;quot; data-v-04f46969=&amp;quot;&amp;quot;&amp;gt;åŠ å…¥ï¼æ¯æ—¥ä¸€ç»ƒ&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.find_element_by_partial_link_text(&amp;quot;åŠ å…¥&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æµè§ˆå™¨æ§åˆ¶&#34;&gt;æµè§ˆå™¨æ§åˆ¶&lt;/h1&gt;
&lt;h2 id=&#34;ä¿®æ”¹æµè§ˆå™¨çª—å£å¤§å°&#34;&gt;ä¿®æ”¹æµè§ˆå™¨çª—å£å¤§å°&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;webdriver&lt;/code&gt; æä¾› &lt;code&gt;set_window_size()&lt;/code&gt; æ–¹æ³•æ¥ä¿®æ”¹æµè§ˆå™¨çª—å£çš„å¤§å°ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver

# Chromeæµè§ˆå™¨
driver = webdriver.Chrome()
driver.get(&#39;https://www.csdn.net/&#39;)
# è®¾ç½®æµè§ˆå™¨æµè§ˆå™¨çš„å®½é«˜ä¸ºï¼š600x800
driver.set_window_size(600, 800)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;maximize_window()&lt;/code&gt; æ–¹æ³•å¯ä»¥å®ç°æµè§ˆå™¨å…¨å±æ˜¾ç¤º&lt;br&gt;
from selenium import webdriver&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# Chromeæµè§ˆå™¨
driver = webdriver.Chrome()
driver.get(&#39;https://www.csdn.net/&#39;)
# è®¾ç½®æµè§ˆå™¨æµè§ˆå™¨çš„å®½é«˜ä¸ºå…¨å±
driver.maximize_window()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æµè§ˆå™¨å‰è¿›åé€€&#34;&gt;æµè§ˆå™¨å‰è¿›&amp;amp;åé€€&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;webdriver&lt;/code&gt; æä¾› &lt;code&gt;back&lt;/code&gt; å’Œ &lt;code&gt;forward&lt;/code&gt; æ–¹æ³•æ¥å®ç°é¡µé¢çš„åé€€ä¸å‰è¿›&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from time import sleep

driver = webdriver.Chrome()

# è®¿é—®CSDNé¦–é¡µ
driver.get(&#39;https://www.csdn.net/&#39;)
sleep(2)
#è®¿é—®CSDNä¸ªäººä¸»é¡µ
driver.get(&#39;https://blog.csdn.net/qq_43965708&#39;)
sleep(2)
#è¿”å›ï¼ˆåé€€ï¼‰åˆ°CSDNé¦–é¡µ
driver.back()
sleep(2)
#å‰è¿›åˆ°ä¸ªäººä¸»é¡µ
driver.forward()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€&#34;&gt;æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€&lt;/h2&gt;
&lt;p&gt;å¦‚æœæƒ³çš„è¯ä¹Ÿå¯ä»¥åœ¨æ–°çš„æ ‡ç­¾é¡µä¸­æ‰“å¼€æ–°çš„é“¾æ¥ï¼Œä½†éœ€è¦æ›´æ”¹ä¸€ä¸‹ä»£ç ï¼Œæ‰§è¡Œ js è¯­å¥æ¥æ‰“å¼€æ–°çš„æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# åœ¨åŸé¡µé¢æ‰“å¼€
driver.get(&#39;https://blog.csdn.net/qq_43965708&#39;)

# æ–°æ ‡ç­¾ä¸­æ‰“å¼€
js = &amp;quot;window.open(&#39;https://blog.csdn.net/qq_43965708&#39;)&amp;quot;
driver.execute_script(js)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æµè§ˆå™¨åˆ·æ–°&#34;&gt;æµè§ˆå™¨åˆ·æ–°&lt;/h2&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ &lt;code&gt;refresh()&lt;/code&gt; æ¥åˆ·æ–°å½“å‰é¡µé¢ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# åˆ·æ–°é¡µé¢
driver.refresh()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æµè§ˆå™¨çª—å£åˆ‡æ¢&#34;&gt;æµè§ˆå™¨çª—å£åˆ‡æ¢&lt;/h2&gt;
&lt;p&gt;åœ¨å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½éœ€è¦ç”¨åˆ°çª—å£åˆ‡æ¢ï¼Œæ¯”å¦‚ï¼šå½“æˆ‘ä»¬ç‚¹å‡»æ³¨å†ŒæŒ‰é’®æ—¶ï¼Œå®ƒä¸€èˆ¬ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µï¼Œä½†å®é™…ä¸Šä»£ç å¹¶æ²¡æœ‰åˆ‡æ¢åˆ°æœ€æ–°é¡µé¢ä¸­ï¼Œè¿™æ—¶ä½ å¦‚æœè¦å®šä½æ³¨å†Œé¡µé¢çš„æ ‡ç­¾å°±ä¼šå‘ç°å®šä½ä¸åˆ°ï¼Œè¿™æ—¶å°±éœ€è¦å°†å®é™…çª—å£åˆ‡æ¢åˆ°æœ€æ–°æ‰“å¼€çš„é‚£ä¸ªçª—å£ã€‚æˆ‘ä»¬å…ˆè·å–å½“å‰å„ä¸ªçª—å£çš„å¥æŸ„ï¼Œè¿™äº›ä¿¡æ¯çš„ä¿å­˜é¡ºåºæ˜¯æŒ‰ç…§æ—¶é—´æ¥çš„ï¼Œæœ€æ–°æ‰“å¼€çš„çª—å£æ”¾åœ¨æ•°ç»„çš„æœ«å°¾ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å®šä½åˆ°æœ€æ–°æ‰“å¼€çš„é‚£ä¸ªçª—å£äº†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# è·å–æ‰“å¼€çš„å¤šä¸ªçª—å£å¥æŸ„
windows = driver.window_handles
# åˆ‡æ¢åˆ°å½“å‰æœ€æ–°æ‰“å¼€çš„çª—å£
driver.switch_to.window(windows[-1])
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¸¸è§æ“ä½œ&#34;&gt;å¸¸è§æ“ä½œ&lt;/h2&gt;
&lt;p&gt;webdriverä¸­çš„å¸¸è§æ“ä½œæœ‰ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;send_keys()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ¨¡æ‹Ÿè¾“å…¥æŒ‡å®šå†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;clear()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ¸…é™¤æ–‡æœ¬å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;is_displayed()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦å¯è§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;get_attribute()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è·å–æ ‡ç­¾å±æ€§å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;size&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è¿”å›å…ƒç´ çš„å°ºå¯¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;text&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è¿”å›å…ƒç´ æ–‡æœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from time import sleep

driver = webdriver.Chrome()

driver.get(&#39;https://www.csdn.net/&#39;)
sleep(2)
# å®šä½æœç´¢è¾“å…¥æ¡†
text_label = driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;toolbar-search-input&amp;quot;]&#39;)

# åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ Dreamä¸¶Killer
text_label.send_keys(&#39;Dreamä¸¶Killer&#39;)

sleep(2)
# æ¸…é™¤æœç´¢æ¡†ä¸­çš„å†…å®¹
text_label.clear()

# è¾“å‡ºæœç´¢æ¡†å…ƒç´ æ˜¯å¦å¯è§
print(text_label.is_displayed())
# è¾“å‡ºplaceholderçš„å€¼
print(text_label.get_attribute(&#39;placeholder&#39;))

# å®šä½æœç´¢æŒ‰é’®
button = driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;toolbar-search-button&amp;quot;]/span&#39;)
# è¾“å‡ºæŒ‰é’®çš„å¤§å°
print(button.size)
# è¾“å‡ºæŒ‰é’®ä¸Šçš„æ–‡æœ¬
print(button.text)

&#39;&#39;&#39;è¾“å‡ºå†…å®¹
True
pythoné¢è¯•100é—®
{&#39;height&#39;: 32, &#39;width&#39;: 28}
æœç´¢
&#39;&#39;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;é¼ æ ‡æ§åˆ¶&#34;&gt;é¼ æ ‡æ§åˆ¶&lt;/h1&gt;
&lt;p&gt;åœ¨webdriver ä¸­ï¼Œé¼ æ ‡æ“ä½œéƒ½å°è£…åœ¨ActionChainsç±»ä¸­ï¼Œå¸¸è§æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;click()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å•å‡»å·¦é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;context_click()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å•å‡»å³é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;double_click()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åŒå‡»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;drag_and_drop()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ‹–åŠ¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;move_to_element()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é¼ æ ‡æ‚¬åœ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;perform()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ‰§è¡Œæ‰€æœ‰ActionChainsä¸­å­˜å‚¨çš„åŠ¨ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;å•å‡»å·¦é”®&#34;&gt;å•å‡»å·¦é”®&lt;/h2&gt;
&lt;p&gt;æ¨¡æ‹Ÿå®Œæˆå•å‡»é¼ æ ‡å·¦é”®çš„æ“ä½œï¼Œä¸€èˆ¬ç‚¹å‡»è¿›å…¥å­é¡µé¢ç­‰ä¼šç”¨åˆ°ï¼Œå·¦é”®ä¸éœ€è¦ç”¨åˆ° &lt;code&gt;ActionChains&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# å®šä½æœç´¢æŒ‰é’®
button = driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;toolbar-search-button&amp;quot;]/span&#39;)
# æ‰§è¡Œå•å‡»æ“ä½œ
button.click()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å•å‡»å³é”®&#34;&gt;å•å‡»å³é”®&lt;/h2&gt;
&lt;p&gt;é¼ æ ‡å³å‡»çš„æ“ä½œä¸å·¦å‡»æœ‰å¾ˆå¤§ä¸åŒï¼Œéœ€è¦ä½¿ç”¨ &lt;code&gt;ActionChains&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium.webdriver.common.action_chains import ActionChains

# å®šä½æœç´¢æŒ‰é’®
button = driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;toolbar-search-button&amp;quot;]/span&#39;)
# å³é”®æœç´¢æŒ‰é’®
ActionChains(driver).context_click(button).perform()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åŒå‡»&#34;&gt;åŒå‡»&lt;/h2&gt;
&lt;p&gt;æ¨¡æ‹Ÿé¼ æ ‡åŒå‡»æ“ä½œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# å®šä½æœç´¢æŒ‰é’®
button = driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;toolbar-search-button&amp;quot;]/span&#39;)
# æ‰§è¡ŒåŒå‡»åŠ¨ä½œ
ActionChains(driver).double_click(button).perform()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ‹–åŠ¨&#34;&gt;æ‹–åŠ¨&lt;/h2&gt;
&lt;p&gt;æ¨¡æ‹Ÿé¼ æ ‡æ‹–åŠ¨æ“ä½œï¼Œè¯¥æ“ä½œæœ‰ä¸¤ä¸ªå¿…è¦å‚æ•°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;source&lt;/strong&gt;ï¼šé¼ æ ‡æ‹–åŠ¨çš„å…ƒç´ &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;target&lt;/strong&gt;ï¼šé¼ æ ‡æ‹–è‡³å¹¶é‡Šæ”¾çš„ç›®æ ‡å…ƒç´ &lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# å®šä½è¦æ‹–åŠ¨çš„å…ƒç´ 
source = driver.find_element_by_xpath(&#39;xxx&#39;)
# å®šä½ç›®æ ‡å…ƒç´ 
target = driver.find_element_by_xpath(&#39;xxx&#39;)
# æ‰§è¡Œæ‹–åŠ¨åŠ¨ä½œ
ActionChains(driver).drag_and_drop(source, target).perform()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é¼ æ ‡æ‚¬åœ&#34;&gt;é¼ æ ‡æ‚¬åœ&lt;/h2&gt;
&lt;p&gt;æ¨¡æ‹Ÿæ‚¬åœçš„ä½œç”¨ä¸€èˆ¬æ˜¯ä¸ºäº†æ˜¾ç¤ºéšè—çš„ä¸‹æ‹‰æ¡†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# å®šä½æ”¶è—æ 
collect  = driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;csdn-toolbar&amp;quot;]/div/div/div[3]/div/div[3]/a&#39;)

# æ‚¬åœè‡³æ”¶è—æ ‡ç­¾å¤„
ActionChains(driver).move_to_element(collect).perform()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;é”®ç›˜æ§åˆ¶&#34;&gt;é”®ç›˜æ§åˆ¶&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;webdriver&lt;/code&gt; ä¸­ &lt;code&gt;Keys&lt;/code&gt; ç±»å‡ ä¹æä¾›äº†é”®ç›˜ä¸Šçš„æ‰€æœ‰æŒ‰é”®æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;send_keys + Keys&lt;/code&gt; å®ç°è¾“å‡ºé”®ç›˜ä¸Šçš„ç»„åˆæŒ‰é”®å¦‚ â€œ&lt;strong&gt;Ctrl + C&lt;/strong&gt;â€ã€â€œ&lt;strong&gt;Ctrl + V&lt;/strong&gt;â€ ç­‰ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium.webdriver.common.keys import Keys

# å®šä½è¾“å…¥æ¡†å¹¶è¾“å…¥æ–‡æœ¬
driver.find_element_by_id(&#39;xxx&#39;).send_keys(&#39;Dreamä¸¶killer&#39;)

# æ¨¡æ‹Ÿå›è½¦é”®è¿›è¡Œè·³è½¬ï¼ˆè¾“å…¥å†…å®¹åï¼‰ 
driver.find_element_by_id(&#39;xxx&#39;).send_keys(Keys.ENTER)

# ä½¿ç”¨ Backspace æ¥åˆ é™¤ä¸€ä¸ªå­—ç¬¦
driver.find_element_by_id(&#39;xxx&#39;).send_keys(Keys.BACK_SPACE)

# Ctrl + A å…¨é€‰è¾“å…¥æ¡†ä¸­å†…å®¹
driver.find_element_by_id(&#39;xxx&#39;).send_keys(Keys.CONTROL, &#39;a&#39;)

# Ctrl + C å¤åˆ¶è¾“å…¥æ¡†ä¸­å†…å®¹
driver.find_element_by_id(&#39;xxx&#39;).send_keys(Keys.CONTROL, &#39;c&#39;)

# Ctrl + V ç²˜è´´è¾“å…¥æ¡†ä¸­å†…å®¹
driver.find_element_by_id(&#39;xxx&#39;).send_keys(Keys.CONTROL, &#39;v&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä»–å¸¸è§é”®ç›˜æ“ä½œï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æ“ä½œ&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.F1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;F1é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.SPACE&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç©ºæ ¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.TAB&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tabé”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.ESCAPE&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ESCé”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.ALT&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Alté”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.SHIFT&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Shifté”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.ARROW_DOWN&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‘ä¸‹ç®­å¤´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.ARROW_LEFT&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‘å·¦ç®­å¤´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.ARROW_RIGHT&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‘å³ç®­å¤´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Keys.ARROW_UP&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‘ä¸Šç®­å¤´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;è®¾ç½®å…ƒç´ ç­‰å¾…&#34;&gt;è®¾ç½®å…ƒç´ ç­‰å¾…&lt;/h1&gt;
&lt;p&gt;å¾ˆå¤šé¡µé¢éƒ½ä½¿ç”¨ &lt;code&gt;ajax&lt;/code&gt; æŠ€æœ¯ï¼Œé¡µé¢çš„å…ƒç´ ä¸æ˜¯åŒæ—¶è¢«åŠ è½½å‡ºæ¥çš„ï¼Œä¸ºäº†é˜²æ­¢å®šä½è¿™äº›å°šåœ¨åŠ è½½çš„å…ƒç´ æŠ¥é”™ï¼Œå¯ä»¥è®¾ç½®å…ƒç´ ç­‰æ¥å¢åŠ è„šæœ¬çš„ç¨³å®šæ€§ã€‚&lt;code&gt;webdriver&lt;/code&gt; ä¸­çš„ç­‰å¾…åˆ†ä¸º &lt;strong&gt;æ˜¾å¼ç­‰å¾…&lt;/strong&gt; å’Œ &lt;strong&gt;éšå¼ç­‰å¾…&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ˜¾å¼ç­‰å¾…&#34;&gt;æ˜¾å¼ç­‰å¾…&lt;/h2&gt;
&lt;p&gt;æ˜¾å¼ç­‰å¾…ï¼šè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œæ¯ä¸ªä¸€æ®µæ—¶é—´å°±å»æ£€æµ‹ä¸€æ¬¡è¯¥å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æ‰§è¡Œåç»­å†…å®¹ï¼Œå¦‚æœè¶…è¿‡æœ€å¤§æ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´ï¼‰åˆ™æŠ›å‡ºè¶…æ—¶å¼‚å¸¸ï¼ˆ&lt;code&gt;TimeoutException&lt;/code&gt;ï¼‰ã€‚æ˜¾ç¤ºç­‰å¾…éœ€è¦ä½¿ç”¨ &lt;code&gt;WebDriverWait&lt;/code&gt;ï¼ŒåŒæ—¶é…åˆ &lt;code&gt;until&lt;/code&gt; æˆ– &lt;code&gt;not until&lt;/code&gt; ã€‚ä¸‹é¢è¯¦ç»†è®²è§£ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;driver&lt;/code&gt;ï¼šæµè§ˆå™¨é©±åŠ¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;timeout&lt;/code&gt;ï¼šè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’&lt;/li&gt;
&lt;li&gt;&lt;code&gt;poll_frequency&lt;/code&gt;ï¼šæ¯æ¬¡æ£€æµ‹çš„é—´éš”æ—¶é—´ï¼Œé»˜è®¤ä¸º0.5ç§’&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ignored_exceptions&lt;/code&gt;ï¼šæŒ‡å®šå¿½ç•¥çš„å¼‚å¸¸ï¼Œå¦‚æœåœ¨è°ƒç”¨ &lt;code&gt;until&lt;/code&gt; æˆ– &lt;code&gt;until_not&lt;/code&gt; çš„è¿‡ç¨‹ä¸­æŠ›å‡ºæŒ‡å®šå¿½ç•¥çš„å¼‚å¸¸ï¼Œåˆ™ä¸ä¸­æ–­ä»£ç ï¼Œé»˜è®¤å¿½ç•¥çš„åªæœ‰ &lt;code&gt;NoSuchElementException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;until(method, message=&#39; &#39;) until_not(method, message=&#39; &#39;)&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;method&lt;/code&gt;ï¼šæŒ‡å®šé¢„æœŸæ¡ä»¶çš„åˆ¤æ–­æ–¹æ³•ï¼Œåœ¨ç­‰å¾…æœŸé—´ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œç›´åˆ°å…ƒç´ å‡ºç°ã€‚&lt;code&gt;until_not&lt;/code&gt; æ­£å¥½ç›¸åï¼Œå½“å…ƒç´ æ¶ˆå¤±æˆ–æŒ‡å®šæ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­ä»£ç &lt;/li&gt;
&lt;li&gt;&lt;code&gt;message&lt;/code&gt;: å¦‚æœè¶…æ—¶ï¼ŒæŠ›å‡º &lt;code&gt;TimeoutException&lt;/code&gt;ï¼Œå¹¶æ˜¾ç¤º &lt;code&gt;message&lt;/code&gt; ä¸­çš„å†…å®¹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;method&lt;/code&gt; ä¸­çš„é¢„æœŸæ¡ä»¶åˆ¤æ–­æ–¹æ³•æ˜¯ç”± &lt;code&gt;expected_conditions&lt;/code&gt; æä¾›ï¼Œä¸‹é¢åˆ—ä¸¾å¸¸ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;title_is(&#39;ç™¾åº¦ä¸€ä¸‹&#39;)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å½“å‰é¡µé¢çš„ title æ˜¯å¦ç­‰äºé¢„æœŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;title_contains(&#39;ç™¾åº¦&#39;)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å½“å‰é¡µé¢çš„ title æ˜¯å¦åŒ…å«é¢„æœŸå­—ç¬¦ä¸²&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;presence_of_element_located(locator)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;presence_of_element_located(locator)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;visibility_of_element_located(locator)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å…ƒç´ æ˜¯å¦å¯è§ï¼Œå¯è§ä»£è¡¨å…ƒç´ ééšè—ï¼Œå¹¶ä¸”å…ƒç´ çš„å®½å’Œé«˜éƒ½ä¸ç­‰äº0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;visibility_of(element)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è·Ÿä¸Šä¸€ä¸ªæ–¹æ³•ä½œç”¨ç›¸åŒï¼Œä½†ä¼ å…¥å‚æ•°ä¸º element&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;text_to_be_present_in_element(locator , &#39;ç™¾åº¦&#39;)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å…ƒç´ ä¸­çš„ text æ˜¯å¦åŒ…å«äº†é¢„æœŸçš„å­—ç¬¦ä¸²&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;text_to_be_present_in_element_value(locator , &#39;æŸå€¼&#39;)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å…ƒç´ ä¸­çš„ value å±æ€§æ˜¯å¦åŒ…å«äº†é¢„æœŸçš„å­—ç¬¦ä¸²&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;frame_to_be_available_and_switch_to_it(locator)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­è¯¥ frame æ˜¯å¦å¯ä»¥ switch è¿›å»ï¼ŒTrue åˆ™ switch è¿›å»ï¼Œåä¹‹ False&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;invisibility_of_element_located(locator)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å…ƒç´ ä¸­æ˜¯å¦ä¸å­˜åœ¨äº dom æ ‘æˆ–ä¸å¯è§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;element_to_be_clickable(locator)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å…ƒç´ ä¸­æ˜¯å¦å¯è§å¹¶ä¸”æ˜¯å¯ç‚¹å‡»çš„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;staleness_of(element)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç­‰å¾…å…ƒç´ ä» dom æ ‘ä¸­ç§»é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;element_to_be_selected(element)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å…ƒç´ æ˜¯å¦è¢«é€‰ä¸­,ä¸€èˆ¬ç”¨åœ¨ä¸‹æ‹‰åˆ—è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;element_selection_state_to_be(element, True)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­å…ƒç´ çš„é€‰ä¸­çŠ¶æ€æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå‚æ•° elementï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º True/False&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;element_located_selection_state_to_be(locator, True)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è·Ÿä¸Šä¸€ä¸ªæ–¹æ³•ä½œç”¨ç›¸åŒï¼Œä½†ä¼ å…¥å‚æ•°ä¸º locator&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;alert_is_present()&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ¤æ–­é¡µé¢ä¸Šæ˜¯å¦å­˜åœ¨ alert&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;h3 id=&#34;æ™®é€šå®šä½&#34;&gt;æ™®é€šå®šä½&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium.webdriver.common.by import By
from selenium import webdriver

driver = webdriver.Chrome()
locator = (By.ID, &#39;kw&#39;)
element = driver.find_element_by_id(&#39;kw&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ˜¾ç¤ºå®šä½&#34;&gt;æ˜¾ç¤ºå®šä½&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By

driver = webdriver.Chrome()
element = WebDriverWait(driver, 5, 0.5).until(
 Â  Â  Â  Â  Â  Â EC.presence_of_element_located((By.ID, &#39;kw&#39;)),
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message=&#39;è¶…æ—¶å•¦!&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;éšå¼ç­‰å¾…&#34;&gt;éšå¼ç­‰å¾…&lt;/h2&gt;
&lt;p&gt;éšå¼ç­‰å¾…ä¹Ÿæ˜¯æŒ‡å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…å‡ºè¿™ä¸ªæ—¶é—´æŒ‡å®šå…ƒç´ è¿˜æ²¡æœ‰è¢«åŠ è½½å‡ºæ¥ï¼Œå°±ä¼šæŠ›å‡º &lt;code&gt;NoSuchElementException&lt;/code&gt; å¼‚å¸¸ã€‚ é™¤äº†æŠ›å‡ºçš„å¼‚å¸¸ä¸åŒå¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼Œéšå¼ç­‰å¾…æ˜¯å…¨å±€æ€§çš„ï¼Œå³è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå…ƒç´ å¯ä»¥å®šä½åˆ°ï¼Œå®ƒä¸ä¼šå½±å“ä»£ç è¿è¡Œï¼Œä½†å¦‚æœå®šä½ä¸åˆ°ï¼Œåˆ™å®ƒä¼šä»¥è½®è¯¢çš„æ–¹å¼ä¸æ–­åœ°è®¿é—®å…ƒç´ ç›´åˆ°å…ƒç´ è¢«æ‰¾åˆ°ï¼Œè‹¥è¶…è¿‡æŒ‡å®šæ—¶é—´ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;implicitly_wait()&lt;/code&gt; æ¥å®ç°éšå¼ç­‰å¾…ï¼Œä½¿ç”¨éš¾åº¦ç›¸å¯¹äºæ˜¾å¼ç­‰å¾…è¦ç®€å•å¾ˆå¤šã€‚ ç¤ºä¾‹ï¼šæ‰“å¼€ä¸ªäººä¸»é¡µï¼Œè®¾ç½®ä¸€ä¸ªéšå¼ç­‰å¾…æ—¶é—´ 5sï¼Œé€šè¿‡ &lt;code&gt;id&lt;/code&gt; å®šä½ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ ï¼Œæœ€åæ‰“å° æŠ›å‡ºçš„å¼‚å¸¸ ä¸ è¿è¡Œæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from time import time

driver = webdriver.Chrome()
driver.get(&#39;https://blog.csdn.net/qq_43965708&#39;)

start = time()
driver.implicitly_wait(5)
try:
 Â  Â driver.find_element_by_id(&#39;kw&#39;)
except Exception as e:
 Â  Â print(e)
 Â  Â print(f&#39;è€—æ—¶ï¼š{time()-start}&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»£ç è¿è¡Œåˆ° driver.find_element_by_id(&#39;kw&#39;) è¿™å¥ä¹‹åè§¦å‘éšå¼ç­‰å¾…ï¼Œåœ¨è½®è¯¢æ£€æŸ¥ 5s åä»ç„¶æ²¡æœ‰å®šä½åˆ°å…ƒç´ ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å¼ºåˆ¶ç­‰å¾…&#34;&gt;å¼ºåˆ¶ç­‰å¾…&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;time.sleep()&lt;/code&gt; å¼ºåˆ¶ç­‰å¾…ï¼Œè®¾ç½®å›ºå®šçš„ä¼‘çœ æ—¶é—´ï¼Œå¯¹äºä»£ç çš„è¿è¡Œæ•ˆç‡ä¼šæœ‰å½±å“ã€‚ä»¥ä¸Šé¢çš„ä¾‹å­ä½œä¸ºå‚ç…§ï¼Œå°† éšå¼ç­‰å¾… æ”¹ä¸º å¼ºåˆ¶ç­‰å¾…ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from time import time, sleep

driver = webdriver.Chrome()
driver.get(&#39;https://blog.csdn.net/qq_43965708&#39;)

start = time()
sleep(5)
try:
 Â  Â driver.find_element_by_id(&#39;kw&#39;)
except Exception as e:
 Â  Â print(e)
 Â  Â print(f&#39;è€—æ—¶ï¼š{time()-start}&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯¹äºå®šä½ä¸åˆ°å…ƒç´ çš„æ—¶å€™ï¼Œä»è€—æ—¶æ–¹é¢éšå¼ç­‰å¾…å’Œå¼ºåˆ¶ç­‰å¾…æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚ä½†å¦‚æœå…ƒç´ ç»è¿‡ 2s åè¢«åŠ è½½å‡ºæ¥ï¼Œè¿™æ—¶éšå¼ç­‰å¾…å°±ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œä½† sleepè¿˜è¦ç»§ç»­ç­‰å¾… 3sã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;å®šä½ä¸€ç»„å…ƒç´ &#34;&gt;å®šä½ä¸€ç»„å…ƒç´ &lt;/h1&gt;
&lt;p&gt;ä¸Šç¯‡è®²è¿°äº†å®šä½ä¸€ä¸ªå…ƒç´ çš„ 8 ç§æ–¹æ³•ï¼Œå®šä½ä¸€ç»„å…ƒç´ ä½¿ç”¨çš„æ–¹æ³•åªéœ€è¦å°† &lt;code&gt;element&lt;/code&gt; æ”¹ä¸º &lt;code&gt;elements&lt;/code&gt; å³å¯ï¼Œå®ƒçš„ä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯ä¸ºäº†æ‰¹é‡æ“ä½œå…ƒç´ ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_id()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_name()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_class_name()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_tag_name()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_xpath()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_css_selector()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_link_text()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find_elements_by_partial_link_text()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver

# è®¾ç½®æ— å¤´æµè§ˆå™¨
option = webdriver.ChromeOptions()
option.add_argument(&#39;--headless&#39;)

driver = webdriver.Chrome(options=option)
driver.get(&#39;https://blog.csdn.net/&#39;)

p_list = driver.find_elements_by_xpath(&amp;quot;//p[@class=&#39;name&#39;]&amp;quot;)
name = [p.text for p in p_list]
print(name)
&#39;&#39;&#39;
[&#39;èŠ±ç”Ÿ&#39;, &#39;ç¼–ç¨‹&#39;, &#39;å“&#39;]
&#39;&#39;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;åˆ‡æ¢æ“ä½œ&#34;&gt;åˆ‡æ¢æ“ä½œ&lt;/h1&gt;
&lt;h2 id=&#34;çª—å£åˆ‡æ¢&#34;&gt;çª—å£åˆ‡æ¢&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;code&gt;selenium&lt;/code&gt; æ“ä½œé¡µé¢çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå› ä¸ºç‚¹å‡»æŸä¸ªé“¾æ¥è€Œè·³è½¬åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ï¼ˆæ‰“å¼€äº†ä¸€ä¸ªæ–°æ ‡ç­¾é¡µï¼‰ï¼Œè¿™æ—¶å€™ &lt;code&gt;selenium&lt;/code&gt; å®é™…è¿˜æ˜¯å¤„äºä¸Šä¸€ä¸ªé¡µé¢çš„ï¼Œéœ€è¦æˆ‘ä»¬è¿›è¡Œåˆ‡æ¢æ‰èƒ½å¤Ÿå®šä½æœ€æ–°é¡µé¢ä¸Šçš„å…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;çª—å£åˆ‡æ¢éœ€è¦ä½¿ç”¨ &lt;code&gt;switch_to.windows()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver

handles = []
driver = webdriver.Chrome()
driver.get(&#39;https://blog.csdn.net/&#39;)
# è®¾ç½®éšå¼ç­‰å¾…
driver.implicitly_wait(3)
# è·å–å½“å‰çª—å£çš„å¥æŸ„
handles.append(driver.current_window_handle)
# ç‚¹å‡» pythonï¼Œè¿›å…¥åˆ†ç±»é¡µé¢
driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;mainContent&amp;quot;]/aside/div[1]/div&#39;).click()
# è·å–å½“å‰çª—å£çš„å¥æŸ„
handles.append(driver.current_window_handle)

print(handles)
# è·å–å½“å‰æ‰€æœ‰çª—å£çš„å¥æŸ„
print(driver.window_handles)
&#39;&#39;&#39;
[&#39;CDwindow-D032106A36A4D596E67B6A8D9CC7DE6B&#39;, &#39;CDwindow-D032106A36A4D596E67B6A8D9CC7DE6B&#39;]
[&#39;CDwindow-D032106A36A4D596E67B6A8D9CC7DE6B&#39;, &#39;CDwindow-DC9A05D1F67FE0AF0CEC441EB9FBD316&#39;]
&#39;&#39;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ—è¡¨ &lt;code&gt;handle&lt;/code&gt; æ˜¯ç›¸åŒçš„ï¼Œè¯´æ˜ &lt;code&gt;selenium&lt;/code&gt; å®é™…æ“ä½œçš„è¿˜æ˜¯ CSDNé¦–é¡µ ï¼Œå¹¶æœªåˆ‡æ¢åˆ°æ–°é¡µé¢ã€‚ ä¸‹é¢ä½¿ç”¨ &lt;code&gt;switch_to.windows()&lt;/code&gt; è¿›è¡Œåˆ‡æ¢ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver

handles = []
driver = webdriver.Chrome()
driver.get(&#39;https://blog.csdn.net/&#39;)
# è®¾ç½®éšå¼ç­‰å¾…
driver.implicitly_wait(3)
# è·å–å½“å‰çª—å£çš„å¥æŸ„
handles.append(driver.current_window_handle)
# ç‚¹å‡» pythonï¼Œè¿›å…¥åˆ†ç±»é¡µé¢
driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;mainContent&amp;quot;]/aside/div[1]/div&#39;).click()
# åˆ‡æ¢çª—å£
driver.switch_to.window(driver.window_handles[-1])
# è·å–å½“å‰çª—å£çš„å¥æŸ„
handles.append(driver.current_window_handle)

print(handles)
print(driver.window_handles)
&#39;&#39;&#39;
[&#39;CDwindow-9329E73908B77E0AA52FE5EEB1AA3147&#39;, &#39;CDwindow-327C23C8937C00202FF541E843C37101&#39;]
[&#39;CDwindow-9329E73908B77E0AA52FE5EEB1AA3147&#39;, &#39;CDwindow-327C23C8937C00202FF541E843C37101&#39;]
&#39;&#39;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢ä»£ç åœ¨ç‚¹å‡»è·³è½¬åï¼Œä½¿ç”¨ &lt;code&gt;switch_to&lt;/code&gt; åˆ‡æ¢çª—å£ï¼Œ&lt;code&gt;window_handles&lt;/code&gt; è¿”å›çš„ &lt;code&gt;handle&lt;/code&gt; åˆ—è¡¨æ˜¯æŒ‰ç…§é¡µé¢å‡ºç°æ—¶é—´è¿›è¡Œæ’åºçš„ï¼Œæœ€æ–°æ‰“å¼€çš„é¡µé¢è‚¯å®šæ˜¯æœ€åä¸€ä¸ªã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é‚£å¦‚æœæ‰“å¼€çš„çª—å£æœ‰å¤šä¸ªï¼Œå¦‚ä½•è·³è½¬åˆ°ä¹‹å‰æ‰“å¼€çš„çª—å£ï¼Œå¦‚æœç¡®å®æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œé‚£ä¹ˆæ‰“å¼€çª—å£æ˜¯å°±éœ€è¦è®°å½•æ¯ä¸€ä¸ªçª—å£çš„ &lt;code&gt;key&lt;/code&gt;(åˆ«å) ä¸ &lt;code&gt;value&lt;/code&gt;(&lt;code&gt;handle&lt;/code&gt;)ï¼Œä¿å­˜åˆ°å­—å…¸ä¸­ï¼Œåç»­æ ¹æ® &lt;code&gt;key&lt;/code&gt; æ¥å– &lt;code&gt;handle&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è¡¨å•åˆ‡æ¢&#34;&gt;è¡¨å•åˆ‡æ¢&lt;/h2&gt;
&lt;p&gt;å¾ˆå¤šé¡µé¢ä¹Ÿä¼šç”¨å¸¦ &lt;code&gt;frame/iframe&lt;/code&gt; è¡¨å•åµŒå¥—ï¼Œå¯¹äºè¿™ç§å†…åµŒçš„é¡µé¢ &lt;code&gt;selenium&lt;/code&gt; æ˜¯æ— æ³•ç›´æ¥å®šä½çš„ï¼Œéœ€è¦ä½¿ç”¨ &lt;code&gt;switch_to.frame()&lt;/code&gt; æ–¹æ³•å°†å½“å‰æ“ä½œçš„å¯¹è±¡åˆ‡æ¢æˆ &lt;code&gt;frame/iframe&lt;/code&gt; å†…åµŒçš„é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;switch_to.frame()&lt;/code&gt; é»˜è®¤å¯ä»¥ç”¨çš„ &lt;code&gt;id&lt;/code&gt; æˆ– &lt;code&gt;name&lt;/code&gt; å±æ€§ç›´æ¥å®šä½ï¼Œä½†å¦‚æœ &lt;code&gt;iframe&lt;/code&gt; æ²¡æœ‰ &lt;code&gt;id&lt;/code&gt; æˆ– &lt;code&gt;name&lt;/code&gt; ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ &lt;code&gt;xpath&lt;/code&gt; è¿›è¡Œå®šä½ã€‚&lt;/p&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;

&amp;lt;head&amp;gt;
 Â  Â &amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
 Â  Â &amp;lt;meta http-equiv=&amp;quot;X-UA-Compatible&amp;quot; content=&amp;quot;IE=edge&amp;quot;&amp;gt;
 Â  Â &amp;lt;meta name=&amp;quot;viewport&amp;quot; content=&amp;quot;width=device-width, initial-scale=1.0&amp;quot;&amp;gt;
 Â  Â &amp;lt;title&amp;gt;Document&amp;lt;/title&amp;gt;
 Â  Â &amp;lt;style&amp;gt;
 Â  Â  Â  Â div p {
 Â  Â  Â  Â  Â  Â color: #red;
 Â  Â  Â  Â  Â  Â animation: change 2s infinite;
 Â  Â  Â   }
 Â  Â  Â  Â @keyframes change {
 Â  Â  Â  Â  Â  Â from {
 Â  Â  Â  Â  Â  Â  Â  Â color: red;
 Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â to {
 Â  Â  Â  Â  Â  Â  Â  Â color: blue;
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
 Â  Â &amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;

&amp;lt;body&amp;gt;
 Â  Â &amp;lt;div&amp;gt;
        &amp;lt;p&amp;gt;ç®€å•çš„æ —å­&amp;lt;/p&amp;gt;
 Â  Â &amp;lt;/div&amp;gt;
 Â  Â &amp;lt;iframe src=&amp;quot;https://blog.csdn.net/qq_43965708&amp;quot; width=&amp;quot;400&amp;quot; height=&amp;quot;200&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;
&amp;lt;!-- Â  Â  &amp;lt;iframe id=&amp;quot;CSDN_info&amp;quot; name=&amp;quot;lizi&amp;quot; src=&amp;quot;https://blog.csdn.net/qq_43965708&amp;quot; width=&amp;quot;400&amp;quot; height=&amp;quot;200&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt; --&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1635753252992.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from pathlib import Path


driver = webdriver.Chrome()
# è¯»å–æœ¬åœ°htmlæ–‡ä»¶
driver.get(&#39;file:///&#39; + str(Path(Path.cwd(), &#39;iframeæµ‹è¯•.html&#39;)))

# 1.é€šè¿‡idå®šä½
driver.switch_to.frame(&#39;CSDN_info&#39;)
# 2.é€šè¿‡nameå®šä½
# driver.switch_to.frame(&#39;lizi&#39;)
# 3.é€šè¿‡xpathå®šä½
# iframe_label = driver.find_element_by_xpath(&#39;/html/body/iframe&#39;)
# driver.switch_to.frame(iframe_label)

driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;csdn-toolbar&amp;quot;]/div/div/div[1]/div/a/img&#39;).click()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;å¼¹çª—å¤„ç†&#34;&gt;å¼¹çª—å¤„ç†&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;JavaScript&lt;/code&gt; æœ‰ä¸‰ç§å¼¹çª— &lt;code&gt;alert&lt;/code&gt;ï¼ˆç¡®è®¤ï¼‰ã€&lt;code&gt;confirm&lt;/code&gt;ï¼ˆç¡®è®¤ã€å–æ¶ˆï¼‰ã€&lt;code&gt;prompt&lt;/code&gt;ï¼ˆæ–‡æœ¬æ¡†ã€ç¡®è®¤ã€å–æ¶ˆï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¤„ç†æ–¹å¼ï¼šå…ˆå®šä½ï¼ˆswitch_to.alertè‡ªåŠ¨è·å–å½“å‰å¼¹çª—ï¼‰ï¼Œå†ä½¿ç”¨ textã€acceptã€dismissã€send_keys ç­‰æ–¹æ³•è¿›è¡Œæ“ä½œ&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;text&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è·å–å¼¹çª—ä¸­çš„æ–‡å­—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;accept&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ¥å—ï¼ˆç¡®è®¤ï¼‰å¼¹çª—å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;dismiss&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è§£é™¤ï¼ˆå–æ¶ˆï¼‰å¼¹çª—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;send_keys&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‘é€æ–‡æœ¬è‡³è­¦å‘Šæ¡†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;
â€‹
&amp;lt;head&amp;gt;
&amp;lt;/head&amp;gt;
â€‹
&amp;lt;body&amp;gt;
 Â  Â &amp;lt;button id=&amp;quot;alert&amp;quot;&amp;gt;alert&amp;lt;/button&amp;gt;
 Â  Â &amp;lt;button id=&amp;quot;confirm&amp;quot;&amp;gt;confirm&amp;lt;/button&amp;gt;
 Â  Â &amp;lt;button id=&amp;quot;prompt&amp;quot;&amp;gt;prompt&amp;lt;/button&amp;gt;
â€‹
 Â  Â &amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
 Â  Â  Â  Â const dom1 = document.getElementById(&amp;quot;alert&amp;quot;)
 Â  Â  Â  Â dom1.addEventListener(&#39;click&#39;, function(){
 Â  Â  Â  Â  Â  alert(&amp;quot;alert hello&amp;quot;)
 Â  Â  Â   })
â€‹
 Â  Â  Â  Â  Â  Â  Â  Â const dom2 = document.getElementById(&amp;quot;confirm&amp;quot;)
 Â  Â  Â  Â dom2.addEventListener(&#39;click&#39;, function(){
 Â  Â  Â  Â  Â  Â confirm(&amp;quot;confirm hello&amp;quot;)
 Â  Â  Â   })
â€‹
 Â  Â  Â  Â  Â  Â  Â  Â const dom3 = document.getElementById(&amp;quot;prompt&amp;quot;)
 Â  Â  Â  Â dom3.addEventListener(&#39;click&#39;, function(){
 Â  Â  Â  Â  Â  Â prompt(&amp;quot;prompt hello&amp;quot;)
 Â  Â  Â   })
 Â  Â &amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æµ‹è¯•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from pathlib import Path
from time import sleep
â€‹
â€‹
driver = webdriver.Firefox()
driver.get(&#39;file:///&#39; + str(Path(Path.cwd(), &#39;å¼¹çª—.html&#39;)))
â€‹
sleep(2)
â€‹
# ç‚¹å‡»alertæŒ‰é’®
driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;alert&amp;quot;]&#39;).click()
sleep(1)
alert = driver.switch_to.alert
# æ‰“å°alertå¼¹çª—çš„æ–‡æœ¬
print(alert.text)
# ç¡®è®¤
alert.accept()
â€‹
sleep(2)
â€‹
# ç‚¹å‡»confirmæŒ‰é’®
driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;confirm&amp;quot;]&#39;).click()
sleep(1)
confirm = driver.switch_to.alert
print(confirm.text)
# å–æ¶ˆ
confirm.dismiss()
â€‹
sleep(2)
â€‹
# ç‚¹å‡»confirmæŒ‰é’®
driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;prompt&amp;quot;]&#39;).click()
sleep(1)
prompt = driver.switch_to.alert
print(prompt.text)
# å‘promptçš„è¾“å…¥æ¡†ä¸­ä¼ å…¥æ–‡æœ¬
prompt.send_keys(&amp;quot;Dreamä¸¶Killer&amp;quot;)
sleep(2)
prompt.accept()
â€‹
&#39;&#39;&#39;è¾“å‡º
alert hello
confirm hello
prompt hello
&#39;&#39;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ä¸Šä¼ -ä¸‹è½½æ–‡ä»¶&#34;&gt;ä¸Šä¼  &amp;amp; ä¸‹è½½æ–‡ä»¶&lt;/h1&gt;
&lt;h2 id=&#34;ä¸Šä¼ æ–‡ä»¶&#34;&gt;ä¸Šä¼ æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;å¸¸è§çš„ web é¡µé¢çš„ä¸Šä¼ ï¼Œä¸€èˆ¬ä½¿ç”¨ &lt;code&gt;input&lt;/code&gt; æ ‡ç­¾æˆ–æ˜¯æ’ä»¶ï¼ˆ&lt;code&gt;JavaScript&lt;/code&gt;ã€&lt;code&gt;Ajax&lt;/code&gt;ï¼‰ï¼Œå¯¹äº &lt;code&gt;input&lt;/code&gt; æ ‡ç­¾çš„ä¸Šä¼ ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code&gt;send_keys(è·¯å¾„)&lt;/code&gt; æ¥è¿›è¡Œä¸Šä¼ ã€‚ å…ˆå†™ä¸€ä¸ªæµ‹è¯•ç”¨çš„é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;
â€‹
&amp;lt;head&amp;gt;
 Â  Â &amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
 Â  Â &amp;lt;meta http-equiv=&amp;quot;X-UA-Compatible&amp;quot; content=&amp;quot;IE=edge&amp;quot;&amp;gt;
 Â  Â &amp;lt;meta name=&amp;quot;viewport&amp;quot; content=&amp;quot;width=device-width, initial-scale=1.0&amp;quot;&amp;gt;
 Â  Â &amp;lt;title&amp;gt;Document&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
â€‹
&amp;lt;body&amp;gt;
 Â  Â &amp;lt;input type=&amp;quot;file&amp;quot; name=&amp;quot;&amp;quot;&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢é€šè¿‡ &lt;code&gt;xpath&lt;/code&gt; å®šä½ &lt;code&gt;input&lt;/code&gt; æ ‡ç­¾ï¼Œç„¶åä½¿ç”¨ &lt;code&gt;send_keys(str(file_path)&lt;/code&gt; ä¸Šä¼ æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from pathlib import Path
from time import sleep
â€‹
â€‹
driver = webdriver.Chrome()
file_path = Path(Path.cwd(), &#39;ä¸Šä¼ ä¸‹è½½.html&#39;)
driver.get(&#39;file:///&#39; + str(file_path))
â€‹
driver.find_element_by_xpath(&#39;//*[@name=&amp;quot;upload&amp;quot;]&#39;).send_keys(str(file_path))
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ä¸‹è½½æ–‡ä»¶&#34;&gt;ä¸‹è½½æ–‡ä»¶&lt;/h2&gt;
&lt;h3 id=&#34;chromeæµè§ˆå™¨&#34;&gt;Chromeæµè§ˆå™¨&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Chrome&lt;/code&gt; æµè§ˆå™¨è¦æƒ³å®ç°æ–‡ä»¶ä¸‹è½½ï¼Œéœ€è¦é€šè¿‡ &lt;code&gt;add_experimental_option&lt;/code&gt; æ·»åŠ  &lt;code&gt;prefs&lt;/code&gt; å‚æ•°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;download.default_directory&lt;/code&gt;ï¼šè®¾ç½®ä¸‹è½½è·¯å¾„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;profile.default_content_settings.popups&lt;/code&gt;ï¼š0 ç¦æ­¢å¼¹å‡ºçª—å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver 
â€‹
prefs = {&#39;profile.default_content_settings.popups&#39;: 0,
 Â  Â  Â  Â  &#39;download.default_directory&#39;: str(Path.cwd())}
option = webdriver.ChromeOptions() 
option.add_experimental_option(&#39;prefs&#39;, prefs)
driver = webdriver.Chrome(options=option)
driver.get(&amp;quot;https://pic.sogou.com/d?query=%E7%83%9F%E8%8A%B1&amp;amp;did=4&amp;amp;category_from=copyright&amp;quot;)
driver.find_element_by_xpath(&#39;/html/body/div/div/div/div[2]/div[1]/div[2]/div[1]/div[2]/a&#39;).click()
â€‹
driver.switch_to.window(driver.window_handles[-1])
driver.find_element_by_xpath(&#39;./html&#39;).send_keys(&#39;thisisunsafe&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»£ç æœ€åä¸¤å¥çŒœæµ‹æœ‰ç†è§£ä»€ä¹ˆæ„æ€çš„å—~ï¼Œå“ˆå“ˆï¼Œå®é™…ä½œç”¨æ˜¯å½“ä½ å¼¹å‡ºåƒä¸‹é¢çš„é¡µé¢ â€œæ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†è¿æ¥â€ æ—¶ï¼Œå¯ä»¥ç›´æ¥é”®ç›˜è¾“å…¥ â€œthisisunsafeâ€ ç›´æ¥è®¿é—®é“¾æ¥ã€‚é‚£ä¹ˆè¿™ä¸ªé”®ç›˜è¾“å…¥å­—ç¬¦ä¸²çš„æ“ä½œå°±æ˜¯ä¹‹é—´è®²åˆ°çš„ send_keysï¼Œä½†ç”±äºè¯¥æ ‡ç­¾é¡µæ˜¯æ–°æ‰“å¼€çš„ï¼Œæ‰€ä»¥è¦é€šè¿‡ switch_to.window() å°†çª—å£åˆ‡æ¢åˆ°æœ€æ–°çš„æ ‡ç­¾é¡µã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;firefoxæµè§ˆå™¨&#34;&gt;Firefoxæµè§ˆå™¨&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Firefox&lt;/code&gt; æµè§ˆå™¨è¦æƒ³å®ç°æ–‡ä»¶ä¸‹è½½ï¼Œéœ€è¦é€šè¿‡ &lt;code&gt;set_preference&lt;/code&gt; è®¾ç½® &lt;code&gt;FirefoxProfile()&lt;/code&gt; çš„ä¸€äº›å±æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;browser.download.foladerList&lt;/code&gt;ï¼š0 ä»£è¡¨æŒ‰æµè§ˆå™¨é»˜è®¤ä¸‹è½½è·¯å¾„ï¼›2 ä¿å­˜åˆ°æŒ‡å®šçš„ç›®å½•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;browser.download.dir&lt;/code&gt;ï¼šæŒ‡å®šä¸‹è½½ç›®å½•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;browser.download.manager.showWhenStarting&lt;/code&gt;ï¼šæ˜¯å¦æ˜¾ç¤ºå¼€å§‹ï¼Œ&lt;code&gt;boolean&lt;/code&gt; ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;browser.helperApps.neverAsk.saveToDisk&lt;/code&gt;ï¼šå¯¹æŒ‡å®šæ–‡ä»¶ç±»å‹ä¸å†å¼¹å‡ºæ¡†è¿›è¡Œè¯¢é—®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP Content-typeå¯¹ç…§è¡¨&lt;/strong&gt;: &lt;a href=&#34;https://www.runoob.com/http/http-content-type.html&#34;&gt;https://www.runoob.com/http/http-content-type.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cookiesæ“ä½œ&#34;&gt;cookiesæ“ä½œ&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;cookies&lt;/code&gt; æ˜¯è¯†åˆ«ç”¨æˆ·ç™»å½•ä¸å¦çš„å…³é”®ï¼Œçˆ¬è™«ä¸­å¸¸å¸¸ä½¿ç”¨ &lt;code&gt;selenium&lt;/code&gt; + &lt;code&gt;requests&lt;/code&gt; å®ç° &lt;code&gt;cookie&lt;/code&gt; æŒä¹…åŒ–ï¼Œå³å…ˆç”¨ &lt;code&gt;selenium&lt;/code&gt; æ¨¡æ‹Ÿç™»é™†è·å– &lt;code&gt;cookie&lt;/code&gt; ï¼Œå†é€šè¿‡ &lt;code&gt;requests&lt;/code&gt; æºå¸¦ &lt;code&gt;cookie&lt;/code&gt; è¿›è¡Œè¯·æ±‚ã€‚&lt;br&gt;
&lt;code&gt;webdriver&lt;/code&gt; æä¾› &lt;code&gt;cookies&lt;/code&gt; çš„å‡ ç§æ“ä½œï¼šè¯»å–ã€æ·»åŠ åˆ é™¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;get_cookies&lt;/code&gt;ï¼šä»¥å­—å…¸çš„å½¢å¼è¿”å›å½“å‰ä¼šè¯ä¸­å¯è§çš„ &lt;code&gt;cookie&lt;/code&gt; ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;get_cookie(name)&lt;/code&gt;ï¼šè¿”å› &lt;code&gt;cookie&lt;/code&gt; å­—å…¸ä¸­ &lt;code&gt;key == name&lt;/code&gt; çš„ &lt;code&gt;cookie&lt;/code&gt; ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;add_cookie(cookie_dict)&lt;/code&gt;ï¼šå°† &lt;code&gt;cookie&lt;/code&gt; æ·»åŠ åˆ°å½“å‰ä¼šè¯ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delete_cookie(name)&lt;/code&gt;ï¼šåˆ é™¤æŒ‡å®šåç§°çš„å•ä¸ª &lt;code&gt;cookie&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delete_all_cookies()&lt;/code&gt;ï¼šåˆ é™¤ä¼šè¯èŒƒå›´å†…çš„æ‰€æœ‰ &lt;code&gt;cookie&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver 
â€‹
driver = webdriver.Chrome()
driver.get(&amp;quot;https://blog.csdn.net/&amp;quot;)
â€‹
# è¾“å‡ºæ‰€æœ‰cookieä¿¡æ¯
print(driver.get_cookies())
â€‹
cookie_dict = {
 Â  Â &#39;domain&#39;: &#39;.csdn.net&#39;,
 Â  Â  &#39;expiry&#39;: 1664765502,
 Â  Â  &#39;httpOnly&#39;: False,
 Â  Â  &#39;name&#39;: &#39;test&#39;,
 Â  Â  &#39;path&#39;: &#39;/&#39;,
 Â  Â  &#39;secure&#39;: True,
 Â  Â  &#39;value&#39;: &#39;null&#39;}
â€‹
# æ·»åŠ cookie
driver.add_cookie(cookie_dict)
# æ˜¾ç¤º name = &#39;test&#39; çš„cookieä¿¡æ¯
print(driver.get_cookie(&#39;test&#39;))
# åˆ é™¤ name = &#39;test&#39; çš„cookieä¿¡æ¯
driver.delete_cookie(&#39;test&#39;)
# åˆ é™¤å½“å‰ä¼šè¯ä¸­çš„æ‰€æœ‰cookie
driver.delete_all_cookies()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;è°ƒç”¨javascript&#34;&gt;è°ƒç”¨JavaScript&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;webdriver&lt;/code&gt; å¯¹äºæ»šåŠ¨æ¡çš„å¤„ç†éœ€è¦ç”¨åˆ° &lt;code&gt;JavaScript&lt;/code&gt;ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‘ &lt;code&gt;textarea&lt;/code&gt; æ–‡æœ¬æ¡†ä¸­è¾“å…¥æ–‡æœ¬ï¼ˆ&lt;code&gt;webdriver&lt;/code&gt; åªèƒ½å®šä½ï¼Œä¸èƒ½è¾“å…¥æ–‡æœ¬ï¼‰ï¼Œ&lt;code&gt;webdriver&lt;/code&gt; ä¸­ä½¿ç”¨ &lt;code&gt;execute_script&lt;/code&gt; æ–¹æ³•å®ç° &lt;code&gt;JavaScript&lt;/code&gt; çš„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ»‘åŠ¨æ»šåŠ¨æ¡&#34;&gt;æ»‘åŠ¨æ»šåŠ¨æ¡&lt;/h2&gt;
&lt;h3 id=&#34;é€šè¿‡-x-y-åæ ‡æ»‘åŠ¨&#34;&gt;é€šè¿‡ x ,y åæ ‡æ»‘åŠ¨&lt;/h3&gt;
&lt;p&gt;å¯¹äºè¿™ç§é€šè¿‡åæ ‡æ»‘åŠ¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åšè¡¨çš„èµ·å§‹ä½ç½®åœ¨é¡µé¢å·¦ä¸Šè§’ï¼ˆ0,0)ã€‚&lt;br&gt;
ğŸŒ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver 
from time import sleep
â€‹
driver = webdriver.Chrome()
driver.get(&amp;quot;https://blog.csdn.net/&amp;quot;)
sleep(1)
â€‹
js = &amp;quot;window.scrollTo(0,500);&amp;quot;
driver.execute_script(js)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é€šè¿‡å‚ç…§æ ‡ç­¾æ»‘åŠ¨&#34;&gt;é€šè¿‡å‚ç…§æ ‡ç­¾æ»‘åŠ¨&lt;/h3&gt;
&lt;p&gt;è¿™ç§æ–¹å¼éœ€è¦å…ˆæ‰¾ä¸€ä¸ªå‚ç…§æ ‡ç­¾ï¼Œç„¶åå°†æ»šåŠ¨æ¡æ»‘åŠ¨è‡³è¯¥æ ‡ç­¾çš„ä½ç½®ã€‚ä¸‹é¢è¿˜æ˜¯ç”¨ CSDN é¦–é¡µåšç¤ºä¾‹ï¼Œæˆ‘ä»¬ç”¨å¾ªç¯æ¥å®ç°é‡å¤æ»‘åŠ¨ã€‚è¯¥ &lt;code&gt;li&lt;/code&gt; æ ‡ç­¾å®é™…æ˜¯ä¸€ç§&lt;strong&gt;æ‡’åŠ è½½&lt;/strong&gt;ï¼Œå½“ç”¨æˆ·æ»‘åŠ¨è‡³æœ€åæ ‡ç­¾æ—¶ï¼Œæ‰ä¼šåŠ è½½åé¢çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-pyhton&#34;&gt;from selenium import webdriver 
from time import sleep
â€‹
driver = webdriver.Chrome()
driver.get(&amp;quot;https://blog.csdn.net/&amp;quot;)
sleep(1)
driver.implicitly_wait(3)
â€‹
for i in range(31, 102, 10):
 Â  Â sleep(1)
 Â  Â target = driver.find_element_by_xpath(f&#39;//*[@id=&amp;quot;feedlist_id&amp;quot;]/li[{i}]&#39;)
 Â  Â driver.execute_script(&amp;quot;arguments[0].scrollIntoView();&amp;quot;, target)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;å…¶ä»–æ“ä½œ&#34;&gt;å…¶ä»–æ“ä½œ&lt;/h1&gt;
&lt;h2 id=&#34;å…³é—­æ‰€æœ‰é¡µé¢&#34;&gt;å…³é—­æ‰€æœ‰é¡µé¢&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;quit()&lt;/code&gt; æ–¹æ³•å¯ä»¥å…³é—­æ‰€æœ‰çª—å£å¹¶é€€å‡ºé©±åŠ¨ç¨‹åºã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;driver.quit()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å…³é—­å½“å‰é¡µé¢&#34;&gt;å…³é—­å½“å‰é¡µé¢&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;close()&lt;/code&gt; æ–¹æ³•å¯ä»¥å…³é—­å½“å‰é¡µé¢ï¼Œä½¿ç”¨æ—¶è¦æ³¨æ„ â€œå½“å‰é¡µé¢â€ è¿™å››ä¸ªå­—ï¼Œå½“ä½ å…³é—­æ–°æ‰“å¼€çš„é¡µé¢æ—¶ï¼Œéœ€è¦åˆ‡æ¢çª—å£æ‰èƒ½æ“ä½œæ–°çª—å£å¹¶å°†å®ƒå…³é—­ã€‚ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™é‡Œä¸åˆ‡æ¢çª—å£ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿå…³é—­æ–°æ‰“å¼€çš„é¡µé¢ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from selenium import webdriver
from time import sleep
â€‹
driver = webdriver.Chrome()
driver.get(&#39;https://blog.csdn.net/&#39;)
driver.implicitly_wait(3)
â€‹
# ç‚¹å‡»è¿›å…¥æ–°é¡µé¢
driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;mainContent&amp;quot;]/aside/div[1]/div&#39;).click()
# åˆ‡æ¢çª—å£
# driver.switch_to.window(driver.window_handles[-1])
â€‹
sleep(3)
driver.close()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸åˆ‡æ¢çª—å£æ—¶ï¼Œ&lt;code&gt;driver&lt;/code&gt; å¯¹è±¡è¿˜æ˜¯æ“ä½œæœ€å¼€å§‹çš„é¡µé¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹å½“å‰é¡µé¢è¿›è¡Œæˆªå›¾&#34;&gt;å¯¹å½“å‰é¡µé¢è¿›è¡Œæˆªå›¾&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;webdriver&lt;/code&gt; ä¸­ä½¿ç”¨ &lt;code&gt;get_screenshot_as_file()&lt;/code&gt; å¯¹ â€œå½“å‰é¡µé¢â€ è¿›è¡Œæˆªå›¾ï¼Œè¿™é‡Œå’Œä¸Šé¢çš„ &lt;code&gt;close()&lt;/code&gt; æ–¹æ³•ä¸€æ ·ï¼Œå¯¹äºæ–°çª—å£çš„æ“ä½œï¼Œä¸€å®šè¦åˆ‡æ¢çª—å£ï¼Œä¸ç„¶æˆªçš„è¿˜æ˜¯åŸé¡µé¢çš„å›¾ã€‚å¯¹é¡µé¢æˆªå›¾è¿™ä¸€åŠŸèƒ½ï¼Œä¸»è¦ç”¨åœ¨æˆ‘ä»¬æµ‹è¯•æ—¶è®°å½•æŠ¥é”™é¡µé¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°† &lt;code&gt;try except&lt;/code&gt; ç»“åˆ &lt;code&gt;get_screenshot_as_file()&lt;/code&gt; ä¸€èµ·ä½¿ç”¨æ¥å®ç°è¿™ä¸€æ•ˆæœã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;try:
 Â  Â driver.find_element_by_xpath(&#39;//*[@id=&amp;quot;mainContent&amp;quot;]/aside/div[1]/div&#39;).click()
except:
 Â  Â driver.get_screenshot_as_file(r&#39;C:\Users\pc\Desktop\screenshot.png&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;https://juejin.cn/post/7022925905395875847&lt;/p&gt;
&lt;/blockquote&gt;
">Selenium ä»å…¥é—¨åˆ°æ”¾å¼ƒ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/shi-yong-safari-liu-lan-qi-dao-chu-excel-wen-jian-hou-zhui-hui-jia-yi-ge-html/"" data-c="
          &lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1635389216714.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;è§£å†³åŠæ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;header(&amp;quot;Pragma: public&amp;quot;);  
header(&amp;quot;Expires: 0&amp;quot;);  
header(&amp;quot;Cache-Control:must-revalidate, post-check=0, pre-check=0&amp;quot;);  
header(&amp;quot;Content-Type:application/force-download&amp;quot;);  
header(&amp;quot;Content-Type:application/vnd.ms-excel&amp;quot;);  
header(&amp;quot;Content-Type:application/octet-stream&amp;quot;);  
header(&amp;quot;Content-Type:application/download&amp;quot;);;  
header(&#39;Content-Disposition:attachment;filename=&amp;quot;&#39;.$filename.&#39;.xls&amp;quot;&#39;);
header(&amp;quot;Content-Transfer-Encoding:binary&amp;quot;);
$objWriter-&amp;gt;save(&#39;php://output&#39;);
exit;
&lt;/code&gt;&lt;/pre&gt;
">ä½¿ç”¨ safari æµè§ˆå™¨å¯¼å‡º Excel æ–‡ä»¶åç¼€ä¼šåŠ ä¸€ä¸ª .html</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/php-dong-tai-yu-yan-jing-tai-hua/"" data-c="
          &lt;p&gt;æ–°å»ºæ–‡ä»¶ &lt;code&gt;demo.php&lt;/code&gt;&lt;br&gt;
æ­£å¸¸è¾“å‡º&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;p&amp;gt;åœ¨ demo.php æ–‡ä»¶ä¸‹è¾“å‡º html æ–‡æœ¬&amp;lt;/p&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¼€å¯è¾“å‡ºæ§åˆ¶ç¼“å†² &lt;code&gt;ob_start&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
    ob_start(); // æ‰“å¼€è¾“å‡ºæ§åˆ¶ç¼“å†²
?&amp;gt;
&amp;lt;p&amp;gt;åœ¨ demo.php æ–‡ä»¶ä¸‹è¾“å‡º html æ–‡æœ¬&amp;lt;/p&amp;gt;
&amp;lt;?php
    $content = ob_get_contents(); // è¿”å›è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹
    ob_end_flush(); // å†²åˆ·å‡ºï¼ˆé€å‡ºï¼‰è¾“å‡ºç¼“å†²åŒºå†…å®¹å¹¶å…³é—­ç¼“å†²
    var_dump($content);
&lt;/code&gt;&lt;/pre&gt;
&lt;!--more--&gt;
&lt;p&gt;æŠŠç¼“å­˜å†™å…¥æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
    $cache_name = md5(__FILE__) . &#39;.html&#39;;

    ob_start(); // æ‰“å¼€è¾“å‡ºæ§åˆ¶ç¼“å†²
?&amp;gt;
&amp;lt;p&amp;gt;åœ¨ demo.php æ–‡ä»¶ä¸‹è¾“å‡º html æ–‡æœ¬&amp;lt;/p&amp;gt;
&amp;lt;?php
    $content = ob_get_contents(); // è¿”å›è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹
    ob_end_flush(); // å†²åˆ·å‡ºï¼ˆé€å‡ºï¼‰è¾“å‡ºç¼“å†²åŒºå†…å®¹å¹¶å…³é—­ç¼“å†²

    $handle = fopen($cache_name, &#39;w&#39;);
    fwrite($handle, $content);
    fclose($handle);
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;var_dump($cache_name);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œåç”Ÿæˆä¸´æ—¶æ–‡ä»¶ &lt;code&gt;xxxx.html&lt;/code&gt; ç¼“å­˜&lt;/p&gt;
&lt;p&gt;å…³é”®ç¼“å­˜åˆ¤æ–­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
    $cache_name = md5(__FILE__) . &#39;.html&#39;;
    $cache_lifetime = 3600;
    // filectime() å‡½æ•°è¿”å›æŒ‡å®šæ–‡ä»¶çš„ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´
    if (file_exists($cache_name)
        &amp;amp;&amp;amp; filectime(__FILE__) &amp;lt;= filectime($cache_name)
        &amp;amp;&amp;amp; filectime($cache_name) + $cache_lifetime &amp;gt; time()) {
        // ç¼“å­˜æ–‡ä»¶å­˜åœ¨
        // å½“å‰æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹ï¼ˆæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´å°äºç¼“å­˜æ–‡ä»¶çš„ä¿®æ”¹é—®ï¼‰
        // ç¼“å­˜æ–‡ä»¶æ˜¯å¦å·²ç»è¿‡æœŸ
        include $cache_name;
        exit;
    }

    ob_start(); // æ‰“å¼€è¾“å‡ºæ§åˆ¶ç¼“å†²
?&amp;gt;
&amp;lt;p&amp;gt;åœ¨ demo.php æ–‡ä»¶ä¸‹è¾“å‡º html æ–‡æœ¬&amp;lt;/p&amp;gt;
&amp;lt;?php
    $content = ob_get_contents(); // è¿”å›è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹
    ob_end_flush(); // å†²åˆ·å‡ºï¼ˆé€å‡ºï¼‰è¾“å‡ºç¼“å†²åŒºå†…å®¹å¹¶å…³é—­ç¼“å†²

    $handle = fopen($cache_name, &#39;w&#39;);
    fwrite($handle, $content);
    fclose($handle);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ ¹æ®ä¸åŒçš„ç”¨æˆ· &lt;code&gt;id&lt;/code&gt; åšä¸åŒçš„ç¼“å­˜&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
    $id = intval($_GET[&#39;id&#39;]);
    if (empty($id)) {
        $id = &#39;&#39;;
    }

    $cache_name = md5(__FILE__) . &#39;-&#39; . $id .&#39;.html&#39;;
    $cache_lifetime = 3600;
    // filectime() å‡½æ•°è¿”å›æŒ‡å®šæ–‡ä»¶çš„ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´
    if (file_exists($cache_name)
        &amp;amp;&amp;amp; filectime(__FILE__) &amp;lt;= filectime($cache_name)
        &amp;amp;&amp;amp; filectime($cache_name) + $cache_lifetime &amp;gt; time()) {
        // ç¼“å­˜æ–‡ä»¶å­˜åœ¨
        // å½“å‰æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹ï¼ˆæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´å°äºç¼“å­˜æ–‡ä»¶çš„ä¿®æ”¹é—®ï¼‰
        // ç¼“å­˜æ–‡ä»¶æ˜¯å¦å·²ç»è¿‡æœŸ
        include $cache_name;
        exit;
    }

    ob_start(); // æ‰“å¼€è¾“å‡ºæ§åˆ¶ç¼“å†²
?&amp;gt;
&amp;lt;p&amp;gt;åœ¨ demo.php æ–‡ä»¶ä¸‹è¾“å‡º html æ–‡æœ¬. &amp;lt;?php echo $id?&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;?php
    $content = ob_get_contents(); // è¿”å›è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹
    ob_end_flush(); // å†²åˆ·å‡ºï¼ˆé€å‡ºï¼‰è¾“å‡ºç¼“å†²åŒºå†…å®¹å¹¶å…³é—­ç¼“å†²

    $handle = fopen($cache_name, &#39;w&#39;);
    fwrite($handle, $content);
    fclose($handle);
&lt;/code&gt;&lt;/pre&gt;
">PHP åŠ¨æ€è¯­è¨€é™æ€åŒ–</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/api-fang-cuan-gai-he-fang-chong-fang/"" data-c="
          &lt;h1 id=&#34;é˜²ç¯¡æ”¹&#34;&gt;é˜²ç¯¡æ”¹&lt;/h1&gt;
&lt;p&gt;ç­¾åæ ¡éªŒ&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;é˜²é‡é˜²&#34;&gt;é˜²é‡é˜²&lt;/h1&gt;
&lt;h2 id=&#34;timestampnonce&#34;&gt;timestamp+nonce&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¸¸ç”¨çš„é˜²æ­¢é‡æ”¾çš„æœºåˆ¶æ˜¯ä½¿ç”¨ timestamp å’Œ nonce æ¥åšçš„é‡æ”¾æœºåˆ¶ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;timestamp ç”¨æ¥è¡¨ç¤ºè¯·æ±‚çš„å½“å‰æ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´æˆ³å½“ç„¶è¦å’ŒæœåŠ¡å™¨æ—¶é—´æˆ³è¿›è¡Œæ ¡æ­£è¿‡çš„ã€‚æˆ‘ä»¬é¢„æœŸæ­£å¸¸è¯·æ±‚å¸¦çš„ timestamp å‚æ•°ä¼šæ˜¯ä¸åŒçš„ï¼ˆé¢„æœŸæ˜¯æ­£å¸¸çš„äººæ¯ç§’è‡³å¤šåªä¼šåšä¸€ä¸ªæ“ä½œï¼‰ã€‚æ¯ä¸ªè¯·æ±‚å¸¦çš„æ—¶é—´æˆ³ä¸èƒ½å’Œå½“å‰æ—¶é—´è¶…è¿‡ä¸€å®šè§„å®šçš„æ—¶é—´ã€‚æ¯”å¦‚ 60sã€‚è¿™æ ·ï¼Œè¿™ä¸ªè¯·æ±‚å³ä½¿è¢«æˆªå–äº†ï¼Œä½ ä¹Ÿåªèƒ½åœ¨ 60s å†…è¿›è¡Œé‡æ”¾æ”»å‡»ã€‚è¿‡æœŸå¤±æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™æ ·ä¹Ÿæ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜æœ‰ç»™æ”»å‡»è€… 60s çš„æ—¶é—´ã€‚æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ä¸€ä¸ª nonceï¼Œéšæœºæ•°ã€‚&lt;/p&gt;
&lt;p&gt;nonce æ˜¯ç”±å®¢æˆ·ç«¯æ ¹æ®è¶³å¤Ÿéšæœºçš„æƒ…å†µç”Ÿæˆçš„ï¼Œæ¯”å¦‚ md5 (timestamp+rand (0, 1000)); å®ƒå°±æœ‰ä¸€ä¸ªè¦æ±‚ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨çŸ­æ—¶é—´å†…ï¼ˆæ¯”å¦‚ 60sï¼‰è¿ç»­ç”Ÿæˆä¸¤ä¸ªç›¸åŒ nonce çš„æƒ…å†µå‡ ä¹ä¸º 0ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç«¯&#34;&gt;æœåŠ¡ç«¯&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç«¯ç¬¬ä¸€æ¬¡åœ¨æ¥æ”¶åˆ°è¿™ä¸ª nonce çš„æ—¶å€™åšä¸‹é¢è¡Œä¸ºï¼š&lt;br&gt;
1 å» redis ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ key ä¸º nonce:{nonce} çš„ string&lt;br&gt;
2 å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºè¿™ä¸ª keyï¼ŒæŠŠè¿™ä¸ª key å¤±æ•ˆçš„æ—¶é—´å’ŒéªŒè¯ timestamp å¤±æ•ˆçš„æ—¶é—´ä¸€è‡´ï¼Œæ¯”å¦‚æ˜¯ 60sã€‚&lt;br&gt;
3 å¦‚æœæœ‰ï¼Œè¯´æ˜è¿™ä¸ª key åœ¨ 60s å†…å·²ç»è¢«ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±å¯ä»¥åˆ¤æ–­ä¸ºé‡æ”¾è¯·æ±‚ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;https://www.jianshu.com/p/de9295087560&lt;br&gt;
https://learnku.com/articles/4196/talk-about-the-anti-replay-mechanism-of-api&lt;/p&gt;
&lt;/blockquote&gt;
">API é˜²ç¯¡æ”¹å’Œé˜²é‡æ”¾</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/php-curl/"" data-c="
          &lt;h1 id=&#34;curl&#34;&gt;cURL&lt;/h1&gt;
&lt;h2 id=&#34;get&#34;&gt;GET&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;/**
 * @param string $url è¯·æ±‚ url
 * @param int $httpCode çŠ¶æ€ç 
 * @return mixed
 */
function curl_get($url, &amp;amp;$httpCode = 404)
{
    // åˆå§‹åŒ–ä¸€ä¸ªcurlä¼šè¯
    $ch = curl_init();

    // éœ€è¦è·å–çš„urlåœ°å€
    curl_setopt($ch, CURLOPT_URL, $url);
    // å¯ç”¨ è¿”å›åŸç”Ÿçš„(raw)è¾“å‡º
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

    //ä¸åšè¯ä¹¦æ ¡éªŒ,éƒ¨ç½²åœ¨linuxç¯å¢ƒä¸‹è¯·æ”¹ä¸ºtrue
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    // åœ¨å‘èµ·è¿æ¥å‰ç­‰å¾…çš„æ—¶é—´ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™æ— é™ç­‰å¾…
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);

    // 	æ‰§è¡Œä¸€ä¸ªcurlä¼šè¯
    $fileContents = curl_exec($ch);
    // è·å–ä¸€ä¸ªcurlè¿æ¥èµ„æºå¥æŸ„çš„ä¿¡æ¯
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);

    // å…³é—­ä¸€ä¸ªcurlä¼šè¯
    curl_close($ch);
    return $fileContents;
}

$statusCode = 0;
var_dump(curl_get(&#39;http://www.baidu.com/&#39;, $statusCode));
var_dump($statusCode);
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;post&#34;&gt;POST&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;/**
 * @param string $url è¯·æ±‚ url
 * @param array $params å‚æ•°
 * @return mixed
 */
function curl_post(string $url, array $params = [])
{
    // åˆå§‹åŒ–ä¸€ä¸ªcurlä¼šè¯
    $ch = curl_init();

    // éœ€è¦è·å–çš„urlåœ°å€
    curl_setopt($ch, CURLOPT_URL, $url);
    // å¯ç”¨æ—¶ä¼šå°†å¤´æ–‡ä»¶çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æµè¾“å‡º
    curl_setopt($ch, CURLOPT_HEADER, 0);
    // å¯ç”¨ è¿”å›åŸç”Ÿçš„(raw)è¾“å‡º
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    //ä¸åšè¯ä¹¦æ ¡éªŒ,éƒ¨ç½²åœ¨linuxç¯å¢ƒä¸‹è¯·æ”¹ä¸ºtrue
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    // åœ¨å‘èµ·è¿æ¥å‰ç­‰å¾…çš„æ—¶é—´ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™æ— é™ç­‰å¾…
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);
    // å¯ç”¨æ—¶ä¼šå‘é€ä¸€ä¸ªå¸¸è§„çš„POSTè¯·æ±‚ï¼Œç±»å‹ä¸ºï¼šapplication/x-www-form-urlencodedï¼Œå°±åƒè¡¨å•æäº¤çš„ä¸€æ ·
    curl_setopt($ch, CURLOPT_POST, 1);
    // å…¨éƒ¨æ•°æ®ä½¿ç”¨HTTPåè®®ä¸­çš„&amp;quot;POST&amp;quot;æ“ä½œæ¥å‘é€ã€‚è¦å‘é€æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶åå‰é¢åŠ ä¸Š@å‰ç¼€å¹¶ä½¿ç”¨å®Œæ•´è·¯å¾„ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥é€šè¿‡urlencodedåçš„å­—ç¬¦ä¸²ç±»ä¼¼&#39;para1=val1&amp;amp;para2=val2&amp;amp;...&#39;æˆ–ä½¿ç”¨ä¸€ä¸ªä»¥å­—æ®µåä¸ºé”®å€¼ï¼Œå­—æ®µæ•°æ®ä¸ºå€¼çš„æ•°ç»„ã€‚å¦‚æœvalueæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒContent-Typeå¤´å°†ä¼šè¢«è®¾ç½®æˆmultipart/form-data
    // ä¼ é€’ä¸€ä¸ªæ•°ç»„åˆ°CURLOPT_POSTFIELDSï¼ŒcURLä¼šæŠŠæ•°æ®ç¼–ç æˆ multipart/form-dataï¼Œè€Œç„¶ä¼ é€’ä¸€ä¸ªURL-encodedå­—ç¬¦ä¸²æ—¶ï¼Œæ•°æ®ä¼šè¢«ç¼–ç æˆ application/x-www-form-urlencoded
    curl_setopt($ch, CURLOPT_POSTFIELDS, $params);

    /*
    // æˆ–è€…ä¼ é€’ä¸€ä¸ª json ç±»å‹ $params è¦ json_encode() è½¬ä¹‰
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        &#39;Content-Type: application/json&#39; // ä¸€ä¸ªç”¨æ¥è®¾ç½®HTTPå¤´å­—æ®µçš„æ•°ç»„
    ]);
    */
    // 	æ‰§è¡Œä¸€ä¸ªcurlä¼šè¯
    $contents = curl_exec($ch);
    // å…³é—­ä¸€ä¸ªcurlä¼šè¯
    curl_close($ch);
    return $contents;
}

$url = &#39;xxxxx&#39;; // æäº¤çš„ url
$data = array(&#39;name&#39; =&amp;gt; &#39;Foo&#39;, &#39;file&#39; =&amp;gt; &#39;@/home/user/test.png&#39;);
var_dump(curl_post($url, $data));
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;raw&#34;&gt;Raw&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;/**
 * @param string $url è¯·æ±‚ url
 * @param string $data å‚æ•°
 * @return mixed
 */
function curl_post_raw(string $url, string $data)
{
    // åˆå§‹åŒ–ä¸€ä¸ªcurlä¼šè¯
    $ch = curl_init();

    // éœ€è¦è·å–çš„urlåœ°å€
    curl_setopt($ch, CURLOPT_URL, $url);
    // å¯ç”¨æ—¶ä¼šå°†å¤´æ–‡ä»¶çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æµè¾“å‡º
    curl_setopt($ch, CURLOPT_HEADER, 0);
    // å¯ç”¨ è¿”å›åŸç”Ÿçš„(raw)è¾“å‡º
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    //ä¸åšè¯ä¹¦æ ¡éªŒ,éƒ¨ç½²åœ¨linuxç¯å¢ƒä¸‹è¯·æ”¹ä¸ºtrue
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    // åœ¨å‘èµ·è¿æ¥å‰ç­‰å¾…çš„æ—¶é—´ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™æ— é™ç­‰å¾…
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);
    // å¯ç”¨æ—¶ä¼šå‘é€ä¸€ä¸ªå¸¸è§„çš„POSTè¯·æ±‚ï¼Œç±»å‹ä¸ºï¼šapplication/x-www-form-urlencodedï¼Œå°±åƒè¡¨å•æäº¤çš„ä¸€æ ·
    curl_setopt($ch, CURLOPT_POST, 1);

    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
    // // ä¸€ä¸ªç”¨æ¥è®¾ç½®HTTPå¤´å­—æ®µçš„æ•°ç»„
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        &#39;Content-Type: text&#39;
    ]);
    // 	æ‰§è¡Œä¸€ä¸ªcurlä¼šè¯
    $contents = curl_exec($ch);
    // å…³é—­ä¸€ä¸ªcurlä¼šè¯
    curl_close($ch);
    return $contents;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµ&#34;&gt;å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;file_get_contents(&amp;quot;php://input&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
">PHP cURL</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/si-suo/"" data-c="
          &lt;h1 id=&#34;ä»€ä¹ˆæ˜¯æ­»é”&#34;&gt;ä»€ä¹ˆæ˜¯æ­»é”&lt;/h1&gt;
&lt;p&gt;å¤šçº¿ç¨‹ä»¥åŠå¤šè¿›ç¨‹æ”¹å–„äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å¹¶æé«˜äº†ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œç„¶è€Œå¹¶å‘æ‰§è¡Œä¹Ÿå¸¦æ¥äº†æ–°çš„é—®é¢˜ ä¸€ä¸€ &lt;strong&gt;æ­»é”&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§åƒµå±€ï¼ˆDeadly-Embrace) ) ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œè¿™äº›è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰éƒ½å°†æ— æ³•å‘å‰æ¨è¿›ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;æ€ä¹ˆç†è§£æ­»é”å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å…ˆçœ‹ç”Ÿæ´»ä¸­çš„ä¸€ä¸ªå®ä¾‹ï¼Œ2ä¸ªäººä¸€èµ·åƒé¥­ä½†æ˜¯åªæœ‰ä¸€åŒç­·å­ï¼Œ2äººè½®æµåƒï¼ˆå½“æ¯ä¸ªäººåŒæ—¶æ‹¥æœ‰2åªç­·å­æ‰èƒ½åƒï¼Œç”²åƒå®Œï¼Œå·²åœ¨åƒï¼‰ã€‚&lt;br&gt;
æŸä¸€ä¸ªæ—¶å€™ï¼Œç”²æ‹¿äº†å·¦ç­·å­ï¼Œå·²æ‹¿äº†å³ç­·å­ï¼Œ2ä¸ªäººéƒ½åŒæ—¶å ç”¨ä¸€ä¸ªèµ„æºï¼Œç­‰å¾…å¦ä¸€ä¸ªèµ„æºï¼Œè¿™ä¸ªæ—¶å€™ç”²åœ¨ç­‰å¾…ä¹™åƒå®Œå¹¶é‡Šæ”¾å®ƒå æœ‰çš„ç­·å­ï¼ŒåŒç†ï¼Œä¹™ä¹Ÿåœ¨ç­‰å¾…ç”²åƒå®Œå¹¶é‡Šæ”¾å®ƒå æœ‰çš„ç­·å­ï¼Œè¿™æ ·å°±é™·å…¥äº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œè°ä¹Ÿæ— æ³•ç»§ç»­åƒé¥­ã€‚&lt;/p&gt;
&lt;p&gt;è®¡ç®—æœºä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¦‚è®¡ç®—æœºç³»ç»Ÿä¸­åªæœ‰ä¸€å°æ‰“å°æœºå’Œä¸€å°è¾“å…¥è®¾å¤‡ï¼Œè¿›ç¨‹P1æ­£å ç”¨è¾“å…¥è®¾å¤‡ï¼ŒåŒæ—¶åˆæå‡ºä½¿ç”¨æ‰“å°æœºçš„è¯·æ±‚ï¼Œä½†æ­¤æ—¶æ‰“å°æœºæ­£è¢«è¿›ç¨‹P2 æ‰€å ç”¨ï¼Œè€ŒP2åœ¨æœªé‡Šæ”¾æ‰“å°æœºä¹‹å‰ï¼Œåˆæå‡ºè¯·æ±‚ä½¿ç”¨æ­£è¢«P1å ç”¨ç€çš„è¾“å…¥è®¾å¤‡ã€‚&lt;br&gt;
è¿™æ ·ä¸¤ä¸ªè¿›ç¨‹ç›¸äº’æ— ä¼‘æ­¢åœ°ç­‰å¾…ä¸‹å»ï¼Œå‡æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶ä¸¤ä¸ªè¿›ç¨‹é™·å…¥æ­»é”çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºæ­»é”çš„ä¸€äº›ç»“è®ºï¼š&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;å‚ä¸æ­»é”çš„è¿›ç¨‹æ•°è‡³å°‘ä¸ºä¸¤ä¸ª&lt;/li&gt;
    &lt;li&gt;å‚ä¸æ­»é”çš„æ‰€æœ‰è¿›ç¨‹å‡ç­‰å¾…èµ„æº&lt;/li&gt;
    &lt;li&gt;å‚ä¸æ­»é”çš„è¿›ç¨‹è‡³å°‘æœ‰ä¸¤ä¸ªå·²ç»å æœ‰èµ„æº&lt;/li&gt;
    &lt;li&gt;æ­»é”è¿›ç¨‹æ˜¯ç³»ç»Ÿä¸­å½“å‰è¿›ç¨‹é›†åˆçš„ä¸€ä¸ªå­é›†&lt;/li&gt;
    &lt;li&gt;æ­»é”ä¼šæµªè´¹å¤§é‡ç³»ç»Ÿèµ„æºï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿå´©æºƒ&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;æ­»é”ä¸é¥¥é¥¿&#34;&gt;æ­»é”ä¸é¥¥é¥¿&lt;/h1&gt;
&lt;p&gt;é¥¥é¥¿ï¼ˆStarvationï¼‰æŒ‡ä¸€ä¸ªè¿›ç¨‹ä¸€ç›´å¾—ä¸åˆ°èµ„æºã€‚&lt;br&gt;
æ­»é”å’Œé¥¥é¥¿éƒ½æ˜¯ç”±äºè¿›ç¨‹ç«äº‰èµ„æºè€Œå¼•èµ·çš„ã€‚é¥¥é¥¿ä¸€èˆ¬ä¸å æœ‰èµ„æºï¼Œæ­»é”è¿›ç¨‹ä¸€å®šå æœ‰èµ„æºã€‚&lt;/p&gt;
&lt;h1 id=&#34;mysql-æ­»é”è§£å†³æ–¹æ¡ˆ&#34;&gt;MySQL æ­»é”è§£å†³æ–¹æ¡ˆ&lt;/h1&gt;
&lt;p&gt;å¦‚æœæ˜¯ä¸¤ä¸ªäº‹åŠ¡å‡ºç°ç›¸äº’ä¾èµ–ï¼Œæ¯”å¦‚äº‹åŠ¡ A éœ€è¦ç­‰å¾…äº‹åŠ¡ B é‡Šæ”¾è¡Œé”æ‰èƒ½ç»§ç»­å¾€ä¸‹æ“ä½œï¼ŒåŒæ—¶äº‹åŠ¡ B éœ€è¦ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾è¡Œé”æ‰èƒ½ç»§ç»­å¾€ä¸‹æ“ä½œï¼Œå°±å¯èƒ½å‡ºç°æ­»é”ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å½¢&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;SQL è¯­å¥æ‰§è¡Œåºåˆ—&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;äº‹åŠ¡ A&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;äº‹åŠ¡ B&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;BEGIN;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;UPDATE walltes SET balance = balance + 2000 WHERE id = 1;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;BEGIN;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;UPDATE walltes SET balance = balance + 2000 WHERE id = 2;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;UPDATE walltes SET balance = balance + 2000 WHERE id = 2;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;UPDATE walltes SET balance = balance + 2000 WHERE id = 1;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;äº‹åŠ¡ B åœ¨ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾ &lt;code&gt;id=1&lt;/code&gt; çš„è¡Œé”ï¼Œäº‹åŠ¡ A åœ¨ç­‰å¾…äº‹åŠ¡ B é‡Šæ”¾ &lt;code&gt;id=2&lt;/code&gt; çš„è¡Œé”ï¼Œè€Œæˆ‘ä»¬çŸ¥é“æ ¹æ®ä¸¤é˜¶æ®µé”åè®®ï¼Œè¡Œé”éœ€è¦åœ¨äº‹åŠ¡æäº¤åæ‰èƒ½é‡Šæ”¾ï¼Œå› æ­¤è¿™ä¸¤ä¸ªäº‹åŠ¡é™·å…¥ç›¸äº’ä¾èµ–çš„æ­»å¾ªç¯ï¼Œè¿›è€Œå‡ºç°æ­»é”ã€‚&lt;/p&gt;
&lt;p&gt;å‡ºç°æ­»é”åï¼Œé€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®è¶…æ—¶æ—¶é—´ï¼šMySQL æä¾›äº†ä¸€ä¸ª &lt;code&gt;innodb_lock_wait_timeout&lt;/code&gt; é…ç½®é¡¹ï¼ˆé»˜è®¤æ˜¯ 50sï¼Œè¿™ä¹Ÿå¤ªé•¿äº†ï¼‰ç”¨äºè®¾ç½®æ­»é”ç­‰å¾…çš„è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œæ­»é”ä¸­ç¬¬ä¸€ä¸ªè¢«é”ä½çš„çº¿ç¨‹ä¼šè‡ªåŠ¨é€€å‡ºï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†&lt;/li&gt;
&lt;li&gt;å‘èµ·æ­»é”æ£€æµ‹ï¼šMySQL æä¾›äº†ä¸€ä¸ª &lt;code&gt;innodb_deadlock_detect&lt;/code&gt; é…ç½®é¡¹ç”¨äºè®¾ç½®æ˜¯å¦å¼€å¯æ­»é”æ£€æµ‹ï¼ˆé»˜è®¤å€¼æ˜¯ ONï¼Œè¡¨ç¤ºå¼€å¯ï¼‰ï¼Œå¼€å§‹æ­»é”æ£€æµ‹åï¼Œç³»ç»Ÿå¦‚æœå‘ç°å­˜åœ¨æ­»é”ï¼Œä¼šå›æ»šé™·å…¥æ­»é”çš„æŸä¸ªäº‹åŠ¡ï¼Œä»è€Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­æ‰§è¡Œä¸‹å»&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ç”±äºé»˜è®¤è¶…æ—¶æ—¶é—´å¤ªé•¿äº†ï¼Œè€Œå…·ä½“é…ç½®æˆå¤šå°‘åˆé€‚åˆå¾ˆéš¾æ‹¿æï¼ˆæ¯”å¦‚å­˜åœ¨æ…¢æŸ¥è¯¢ï¼‰ï¼Œæ‰€ä»¥é€šå¸¸é€‰æ‹©ç¬¬äºŒç§æ–¹å¼å¤„ç†æ­»é”ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;https://zhuanlan.zhihu.com/p/308300980&lt;/p&gt;
&lt;/blockquote&gt;
">æ­»é”</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/php-sheng-cheng-sui-ji-tou-xiang/"" data-c="
          &lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

if (!function_exists(&#39;make_avatar&#39;)) {
    function make_avatar($email)
    {
        $md5_email = md5($email);
        return &amp;quot;https://api.multiavatar.com/{$md5_email}.png&amp;quot;;
    }
}

$src  = make_avatar(&#39;111111@qq.com&#39;);
var_dump($src);
&lt;/code&gt;&lt;/pre&gt;
">PHPç”Ÿæˆéšæœºå¤´åƒ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/er-cha-shu-de-bian-li-ji-dai-ma-shi-xian/"" data-c="
          &lt;h1 id=&#34;éå†&#34;&gt;éå†&lt;/h1&gt;
&lt;h2 id=&#34;å‰åºéå†&#34;&gt;å‰åºéå†&lt;/h2&gt;
&lt;p&gt;å¦‚æœäºŒå‰æ ‘ä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºï¼Œå¦åˆ™ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆéå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1633568114149.jpeg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸­åºéå†&#34;&gt;ä¸­åºéå†&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ˜¯ç©ºæ ‘ï¼Œè¿”å›ç©ºï¼Œå¦åˆ™ä»å·¦å­æ ‘æœ€å·¦ä¾§çš„èŠ‚ç‚¹å¼€å§‹ï¼Œç„¶åä»å·¦åˆ°å³ä¾æ¬¡éå†å·¦å­æ ‘ï¼ŒçœŸæ­£çš„æ ¹èŠ‚ç‚¹ï¼Œæœ€åæ˜¯å³å­æ ‘ï¼ˆä¾ç„¶æ˜¯ä»æœ€å·¦ä¾§èŠ‚ç‚¹å¼€å§‹ä»å·¦åˆ°å³çš„é¡ºåºéå†ï¼‰&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1633568152256.jpeg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ååºéå†&#34;&gt;ååºéå†&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ˜¯ç©ºæ ‘ï¼Œè¿”å›ç©ºï¼Œå¦åˆ™è¿˜æ˜¯ä»å·¦å­æ ‘æœ€å·¦ä¾§çš„èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆéå†å®Œå¶å­èŠ‚ç‚¹ï¼Œå†éå†çˆ¶èŠ‚ç‚¹ï¼Œéå†å®Œå·¦å­æ ‘åï¼Œç›´æ¥ä»å³å­æ ‘æœ€å·¦ä¾§èŠ‚ç‚¹å¼€å§‹ï¼ŒæŒ‰ç…§å’Œå·¦å­æ ‘åŒæ ·çš„é¡ºåºéå†å®Œå³å­æ ‘ï¼Œæœ€åè®¿é—®æ ¹èŠ‚ç‚¹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1633568168107.jpeg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;ä¸åŒçš„éå†æ–¹å¼ä»ä¸åŒç»´åº¦å°†äºŒå‰æ ‘è¿™ç§éçº¿æ€§çš„ç»“æ„å˜æˆäº†æŸç§æ„ä¹‰ä¸Šçš„çº¿æ€§åºåˆ—ï¼Œä»è€Œæ–¹ä¾¿è®¡ç®—æœºæ“ä½œã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä»£ç &#34;&gt;ä»£ç &lt;/h1&gt;
&lt;p&gt;äºŒå‰æ ‘çš„éå†å…¶å®å°±æ˜¯ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯¹åº”ç®—æ³•ä¹Ÿé‡‡ç”¨é€’å½’æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»¥äºŒå‰é“¾è¡¨çš„æ–¹å¼æ¥å­˜å‚¨æ•°ç»„ï¼Œå¯¹åº”çš„å‰åºã€ä¸­åºã€ååºå®ç°ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

// äºŒå‰é“¾è¡¨èŠ‚ç‚¹
class Node
{
    public $data;
    public $left = null;
    public $right = null;

    public function __construct($data)
    {
        $this-&amp;gt;data = $data;
    }
}

/**
 * å‰åºéå†
 * å¦‚æœäºŒå‰æ ‘ä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºï¼Œå¦åˆ™ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆéå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘
 * @param Node $tree
 */
function preOrderTraverse($tree)
{
    if ($tree === null) {
        return;
    }
    printf(&amp;quot;%s\n&amp;quot;, $tree-&amp;gt;data);
    preOrderTraverse($tree-&amp;gt;left);
    preOrderTraverse($tree-&amp;gt;right);
}

/**
 * ä¸­åºéå†
 * å¦‚æœäºŒå‰æ ‘ä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºï¼Œå¦åˆ™ä»å·¦å­æ ‘æœ€å·¦ä¾§çš„èŠ‚ç‚¹å¼€å§‹ï¼Œç„¶åä»å·¦åˆ°å³ä¾æ¬¡éå†å·¦å­æ ‘ï¼ŒçœŸæ­£çš„æ ¹èŠ‚ç‚¹ï¼Œæœ€åæ˜¯å³å­æ ‘ï¼ˆä¾ç„¶æ˜¯ä»æœ€å·¦ä¾§èŠ‚ç‚¹å¼€å§‹ä»å·¦åˆ°å³çš„é¡ºåºéå†ï¼‰
 * @param Node $tree
 */
function midOrderTraverse($tree)
{
    if ($tree === null) {
        return;
    }
    midOrderTraverse($tree-&amp;gt;left);
    printf(&amp;quot;%s\n&amp;quot;, $tree-&amp;gt;data);
    midOrderTraverse($tree-&amp;gt;right);
}

/**
 * ååºéå†
 * å¦‚æœäºŒå‰æ ‘ä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºï¼Œå¦åˆ™ä»å·¦å­æ ‘æœ€å·¦ä¾§çš„èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆéå†å®Œå¶å­èŠ‚ç‚¹ï¼Œå†éå†çˆ¶èŠ‚ç‚¹ï¼Œéå†å®Œå·¦å­æ ‘åï¼Œç›´æ¥ä»å³å­æ ‘æœ€å·¦ä¾§èŠ‚ç‚¹å¼€å§‹ï¼ŒæŒ‰ç…§å’Œå·¦å­æ ‘åŒæ ·çš„é¡ºåºéå†å®Œå³å­æ ‘ï¼Œæœ€åè®¿é—®æ ¹èŠ‚ç‚¹
 * @param Node $tree
 */
function postOrderTraverse($tree)
{
    if ($tree === null) {
        return;
    }
    postOrderTraverse($tree-&amp;gt;left);
    postOrderTraverse($tree-&amp;gt;right);
    printf(&amp;quot;%s\n&amp;quot;, $tree-&amp;gt;data);
}

// èŠ‚ç‚¹æ ‘
$node1 = new Node(&#39;A&#39;);
$node2 = new Node(&#39;B&#39;);
$node3 = new Node(&#39;C&#39;);
$node1-&amp;gt;left = $node2;
$node1-&amp;gt;right = $node3;
// å‰åºéå†
preOrderTraverse($node1);
print(&amp;quot;========\n&amp;quot;);
// ä¸­åºéå†
midOrderTraverse($node1);
print(&amp;quot;========\n&amp;quot;);
// ååºéå†
postOrderTraverse($node1);
&lt;/code&gt;&lt;/pre&gt;
">äºŒå‰æ ‘çš„éå†åŠä»£ç å®ç°</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/laravel-da-jian-zi-ji-de-websocket-fu-wu-qi/"" data-c="
          &lt;h4 id=&#34;å‡†å¤‡&#34;&gt;å‡†å¤‡&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;laravel new weakcc
cd weakcc/
valet link weakcc
composer require laravel/ui
php artisan ui vue --auth
npm install &amp;amp;&amp;amp; npm run dev
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;p&gt;æ›´æ–°.env&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;APP_NAME=weakcc
APP_URL=http://weakcc.test/
DB_DATABASE=weakcc
DB_USERNAME=root
DB_PASSWORD=123456

BROADCAST_DRIVER=pusher

// å› ä¸ºè‡ªå·±æ­å»ºçš„éšæ„æ·»åŠ ï¼Œå”¯ä¸€æ³¨æ„çš„å°±æ˜¯ APP_KEY å‰åç«¯è¦ä¿æŒä¸€è‡´ 
PUSHER_APP_ID=123456789
PUSHER_APP_KEY=123
PUSHER_APP_SECRET=123456
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ•°æ®è¿ç§»&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;php artisan migrate
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœéœ€è¦ä½¿ç”¨ &lt;code&gt;PrivateChannel&lt;/code&gt; æˆ– &lt;code&gt;PresenceChannel&lt;/code&gt; ï¼Œéœ€è¦è§£é™¤ &lt;code&gt;config/app.php&lt;/code&gt; ä¸‹ &lt;code&gt;App\Providers\BroadcastServiceProvider::class&lt;/code&gt; æ³¨é‡Š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®‰è£…æ‰©å±•&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;composer require beyondcode/laravel-websockets
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åŠ è½½é…ç½®&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;php artisan vendor:publish --provider=&amp;quot;BeyondCode\LaravelWebSockets\WebSocketsServiceProvider&amp;quot; --tag=&amp;quot;migrations&amp;quot;
php artisan migrate
php artisan vendor:publish --provider=&amp;quot;BeyondCode\LaravelWebSockets\WebSocketsServiceProvider&amp;quot; --tag=&amp;quot;config&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è°ƒè¯•ä»ªè¡¨æ¿ï¼Œæµè§ˆå™¨æ‰“å¼€ &lt;code&gt;http://weakcc.test/laravel-websockets&lt;/code&gt;&lt;br&gt;
æ›´æ–° &lt;code&gt;config/broadcasting.php&lt;/code&gt; ä¸‹ &lt;code&gt;pusher&lt;/code&gt; é…ç½®&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&#39;options&#39; =&amp;gt; [
    &#39;cluster&#39; =&amp;gt; env(&#39;PUSHER_APP_CLUSTER&#39;),
    &#39;host&#39; =&amp;gt; &#39;127.0.0.1&#39;,
    &#39;port&#39; =&amp;gt; 6001,
    &#39;scheme&#39; =&amp;gt; &#39;http&#39;
],
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è§£é™¤ &lt;code&gt;resources/js/bootstrap.js&lt;/code&gt; æ³¨é‡Šå¹¶æ›´æ–°å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import Echo from &#39;laravel-echo&#39;;

window.Pusher = require(&#39;pusher-js&#39;);

window.Echo = new Echo({
    broadcaster: &#39;pusher&#39;,
    key: &#39;123&#39;, // è¦è·Ÿåå°ä¿æŒä¸€è‡´
    wsHost: window.location.hostname,
    wsPort: 6001,
    disableStats: true,
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®‰è£…å‰ç«¯ä¾èµ–åŒ…&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;npm install --save laravel-echo pusher-js
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡ŒæœåŠ¡&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;php artisan websockets:serve
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;.env é‡Œçš„ APP_URL ä¸€å®šè¦ä¿®æ”¹ï¼Œä¸ç„¶å¯»å€ä¼šå‡ºç°é—®é¢˜&lt;/p&gt;
&lt;/blockquote&gt;
">Laravel æ­å»ºè‡ªå·±çš„ WebSocket æœåŠ¡å™¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/laravel-kua-zhan-deng-lu/"" data-c="
          &lt;h4 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h4&gt;
&lt;p&gt;ä¸¤ä¸ªé¡¹ç›®è¦å…±ç”¨ä¸€å¥—éªŒè¯ä½“ç³»ï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆåšå®Œä¸»ç«™ï¼Œå…±ç”¨çš„ç”¨æˆ·ç³»ç»Ÿå°±æ˜¯ä¸»ç«™çš„ç”¨æˆ·ç³»ç»Ÿ&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h4 id=&#34;å‡†å¤‡&#34;&gt;å‡†å¤‡&lt;/h4&gt;
&lt;p&gt;åˆ›å»ºä¸»ç«™é¡¹ç›®&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;laravel new weakcc
cd weakcc/
valet link weakcc
composer require laravel/ui
php artisan ui vue --auth
npm install &amp;amp;&amp;amp; npm run dev
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ›´æ–°.env&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;APP_NAME=weakcc
APP_URL=http://weakcc.test/
DB_DATABASE=weakcc
DB_USERNAME=root
DB_PASSWORD=123456
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ•°æ®è¿ç§»&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;php artisan migrate
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ›å»ºå­ç«™é¡¹ç›®&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;laravel new weakcc2
cd weakcc2/
valet link zoo.weakcc
composer require laravel/ui
php artisan ui vue --auth
npm install &amp;amp;&amp;amp; npm run dev
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ›´æ–°.env&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;APP_NAME=weakcc2
APP_URL=http://zoo.weakcc.test/
DB_DATABASE=weakcc2
DB_USERNAME=root
DB_PASSWORD=123456
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ•°æ®è¿ç§»&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;php artisan migrate
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h4&gt;
&lt;p&gt;å­ç«™éœ€è¦æ–°å»ºä¸€ä¸ªèƒ½å¤Ÿå…³è”åˆ°ä¸»ç«™çš„æ•°æ®åº“è¿æ¥ï¼Œæ‰“å¼€å­ç«™çš„é¡¹ç›®é…ç½®æ–‡ä»¶ &lt;code&gt;database.php&lt;/code&gt; å¤åˆ¶ä¸€é &lt;code&gt;mysql&lt;/code&gt; ä¿¡æ¯å¹¶é‡åä¸º &lt;code&gt;cc_mysql&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// æœ¬åœ°æµ‹è¯•ï¼Œå…¶ä»–è®°å½•ä¸€æ ·ï¼Œåªæ˜¯æ›´æ–°æ•°æ®åº“ï¼Œå…¶ä»–ç¯å¢ƒï¼Œè¯·è‡ªè¡Œæ›´æ–°
&#39;cc_mysql&#39; =&amp;gt; [
    &#39;driver&#39; =&amp;gt; &#39;mysql&#39;,
    &#39;url&#39; =&amp;gt; env(&#39;DATABASE_URL&#39;),
    &#39;host&#39; =&amp;gt; env(&#39;DB_HOST&#39;, &#39;127.0.0.1&#39;),
    &#39;port&#39; =&amp;gt; env(&#39;DB_PORT&#39;, &#39;3306&#39;),
    &#39;database&#39; =&amp;gt; &#39;weakcc&#39;, // ä¸»é¡¹ç›®çš„æ•°æ®åº“
    &#39;username&#39; =&amp;gt; env(&#39;DB_USERNAME&#39;, &#39;forge&#39;),
    &#39;password&#39; =&amp;gt; env(&#39;DB_PASSWORD&#39;, &#39;&#39;),
    &#39;unix_socket&#39; =&amp;gt; env(&#39;DB_SOCKET&#39;, &#39;&#39;),
    &#39;charset&#39; =&amp;gt; &#39;utf8mb4&#39;,
    &#39;collation&#39; =&amp;gt; &#39;utf8mb4_unicode_ci&#39;,
    &#39;prefix&#39; =&amp;gt; &#39;&#39;,
    &#39;prefix_indexes&#39; =&amp;gt; true,
    &#39;strict&#39; =&amp;gt; true,
    &#39;engine&#39; =&amp;gt; null,
    &#39;options&#39; =&amp;gt; extension_loaded(&#39;pdo_mysql&#39;) ? array_filter([
        PDO::MYSQL_ATTR_SSL_CA =&amp;gt; env(&#39;MYSQL_ATTR_SSL_CA&#39;),
    ]) : [],
],
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å­ç«™æ›´æ–° &lt;code&gt;User&lt;/code&gt; æ¨¡å‹æ•°æ®åº“è¿æ¥ä¸ºæ–°è®¾ç½®çš„ &lt;code&gt;cc_mysql&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// ä¸»ç«™å¯¹åº”çš„ç”¨æˆ·è¡¨
protected $table = &#39;users&#39;;
// è¿™æ ·çš„è¯ç”¨æˆ·éªŒè¯å°†å»ä¸»é¡¹ç›®çš„ç”¨æˆ·é€»è¾‘
protected $connection = &#39;cc_mysql&#39;; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸»é¡¹ç›®å’Œå­é¡¹ç›®åŒæ—¶æ›´æ–° &lt;code&gt;.env&lt;/code&gt; åŒæ—¶æ‰§è¡Œ &lt;code&gt;session&lt;/code&gt; è¡¨ç”Ÿæˆ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// æ­¤å¤„ä½¿ç”¨æ•°æ®åº“é©±åŠ¨ï¼ˆè·¨ç«™ç™»å½•å¯ä»¥ä½¿ç”¨ redis å’Œ database é©±åŠ¨ï¼‰
SESSION_DRIVER=database
// æ‰§è¡Œ session è¡¨æ ¼ç”Ÿæˆ
php artisan session:table
php artisan migrate
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…³é”®æ­¥éª¤ï¼Œæ˜¯ä¸¤ä¸ªç½‘ç«™èƒ½å¤Ÿä½¿ç”¨ç›¸åŒçš„åŸŸ&lt;/p&gt;
&lt;p&gt;ä¸»é¡¹ç›®æ›´æ–° &lt;code&gt;.env&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SESSION_DOMAIN=.weakcc.test
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å­é¡¹ç›®æ›´æ–° &lt;code&gt;.env&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SESSION_DOMAIN=.weakcc.test
// å­é¡¹ç›®çš„ session è¿æ¥ä¿¡æ¯å¿…é¡»ä¸ºå­ç«™ç”¨æ¥è¿æ¥ä¸»ç«™çš„é‚£ä¸ª mysql ä¿¡æ¯
SESSION_CONNECTION=cc_mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ€åä¸€æ­¥ï¼Œä¸¤ä¸ªé¡¹ç›®çš„çš„ &lt;code&gt;APP_KEY&lt;/code&gt; å¿…é¡»ç›¸åŒï¼Œå¯ä»¥å¤åˆ¶ä¸»ç«™çš„ &lt;code&gt;APP_KEY&lt;/code&gt; åˆ°å­ç«™ï¼Œæ›´æ–° &lt;code&gt;.env&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// ä¸ºä¸»ç«™çš„ APP_KEY
APP_KEY=base64:mkmoK3/Y84EkxihfiqZZM9ooHoD2GHRbaMNH79CrD0Q=
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¥½äº†ï¼Œç°åœ¨å¯ä»¥åœ¨ä¸»ç«™æ³¨å†Œç”¨æˆ·ç™»å½•ï¼Œåœ¨å­ç«™è®¿é—®äº†&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é¡µé¢æ˜¾ç¤º &lt;code&gt;419&lt;/code&gt; éœ€è¦æ¸…é™¤ä¸‹æµè§ˆå™¨ç¼“å­˜çš„ &lt;code&gt;cookie&lt;/code&gt; ä¿¡æ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;!-- more --&gt;
&lt;!-- more --&gt;
&lt;!-- more --&gt;
">Laravel è·¨ç«™ç™»å½•</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/laravel-dan-ren-deng-lu/"" data-c="
          &lt;h4 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h4&gt;
&lt;p&gt;ä¸€ä¸ªè´¦æˆ·åªèƒ½åœ¨ä¸€ä¸ªåœ°æ–¹ç™»å½•ï¼ˆç”¨æˆ·ç™»å½•ç½‘ç«™ä¼šåˆ›å»ºä¸€ä¸ª &lt;code&gt;session&lt;/code&gt; ä¿¡æ¯ï¼Œå®ç°å•äººç™»å½•çš„åŸç†å°±æ˜¯æŠŠä»¥å‰å·²ç»ç”Ÿæˆçš„ &lt;code&gt;session&lt;/code&gt; ä¿¡æ¯å¼ƒç”¨æ‰ï¼Œè¦ä¹ˆåˆ é™¤ä¹‹å‰çš„ &lt;code&gt;session&lt;/code&gt; ä¿¡æ¯ï¼Œè¦ä¹ˆä¿®æ”¹ä¹‹å‰çš„ &lt;code&gt;session&lt;/code&gt; ä¿¡æ¯ï¼Œä½¿æµè§ˆå™¨æäº¤ &lt;code&gt;cookie&lt;/code&gt; ä¿¡æ¯åŒ¹é… &lt;code&gt;session&lt;/code&gt; æ‰¾ä¸åˆ°å°±å¯ä»¥äº†ï¼‰&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h4 id=&#34;å‡†å¤‡&#34;&gt;å‡†å¤‡&lt;/h4&gt;
&lt;p&gt;åˆ›å»ºä¸»ç«™é¡¹ç›®&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;laravel new weakcc
cd weakcc/
valet link weakcc
composer require laravel/ui
php artisan ui vue --auth
npm install &amp;amp;&amp;amp; npm run dev
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ›´æ–°.env&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;APP_NAME=weakcc
APP_URL=http://weakcc.test/
DB_DATABASE=weakcc
DB_USERNAME=root
DB_PASSWORD=123456
SESSION_DRIVER=database
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ•°æ®è¿ç§»&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;php artisan migrate
php artisan session:table
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;session&lt;/code&gt; ä»¥ &lt;code&gt;database&lt;/code&gt; ä¸ºæ•°æ®åº“é©±åŠ¨ä¸ºä¾‹&lt;br&gt;
è¦†å†™ &lt;code&gt;App\Http\Controllers\Auth\LoginController&lt;/code&gt; æ–‡ä»¶ä¸‹çš„ &lt;code&gt;authenticated&lt;/code&gt; æ–¹æ³•ï¼ˆå½“ç™»å½•æ—¶ï¼Œsession ä¿¡æ¯è¿˜æ²¡æœ‰ç”Ÿæˆï¼Œå°±æ˜¯åœ¨è¿™é‡ŒæŠŠå·²ç»æœ‰çš„ &lt;code&gt;session&lt;/code&gt; ä¿®æ”¹ä¸‹ï¼‰&lt;/p&gt;
&lt;p&gt;æ–¹æ³•1ï¼š&lt;/p&gt;
&lt;p&gt;ç®€å•ç²—æš´æ³•ï¼Œæœ‰ç™»å½•å°±åˆ é™¤å·²æœ‰çš„ &lt;code&gt;session&lt;/code&gt; ä¿¡æ¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;protected function authenticated(Request $request, $user)
{
    DB::table(&#39;sessions&#39;)-&amp;gt;where(&#39;user_id&#39;, $user-&amp;gt;id)-&amp;gt;delete();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ–¹æ³•2ï¼š&lt;/p&gt;
&lt;p&gt;ä¿ç•™ç”¨æˆ·ç™»å½• &lt;code&gt;session&lt;/code&gt; å†å²ä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­åšä¿¡æ¯æ’æŸ¥ï¼Œä¿®æ”¹å·²æœ‰çš„ &lt;code&gt;session&lt;/code&gt; ä¿¡æ¯ï¼Œå˜ä¸ºæ— æ•ˆçš„ &lt;code&gt;session&lt;/code&gt; ä¿¡æ¯ï¼Œç¡®è®¤ä¸æ˜¯æ¶æ„çš„ç™»å½•ä¿¡æ¯ï¼Œè¿™æ—¶å°±å¯ä»¥å¯¹æ— æ•ˆçš„ä¿¡æ¯è¿›è¡Œåˆ é™¤&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// &#39;OUTMAN-&#39; å¯ä»¥è‡ªå·±éšæ„è®¾ç½®
protected function authenticated(Request $request, $user)
{
    DB::table(&#39;sessions&#39;)-&amp;gt;where(&#39;user_id&#39;, $user-&amp;gt;id)-&amp;gt;orderBy(&#39;last_activity&#39;)-&amp;gt;each(function ($session) {
        DB::table(&#39;sessions&#39;)-&amp;gt;where(&#39;id&#39;, $session-&amp;gt;id)-&amp;gt;update([&#39;id&#39; =&amp;gt; &#39;OUTMAN-&#39; . $session-&amp;gt;id]);
    });
}
&lt;/code&gt;&lt;/pre&gt;
">Laravel å•äººç™»å½•</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/laravel-chao-shi-deng-lu/"" data-c="
          &lt;p&gt;è®¾ç½® &lt;code&gt;.env&lt;/code&gt; é»˜è®¤ä¸º120åˆ†é’Ÿ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SESSION_LIFETIME=120
&lt;/code&gt;&lt;/pre&gt;
">Laravel è¶…æ—¶ç™»å½•</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/ssh-mian-mi-deng-lu/"" data-c="
          &lt;h2 id=&#34;è®¾ç½®å…å¯†ç™»å½•&#34;&gt;è®¾ç½®å…å¯†ç™»å½•&lt;/h2&gt;
&lt;h3 id=&#34;ç”Ÿæˆç§é’¥å…¬é’¥æ–‡ä»¶&#34;&gt;ç”Ÿæˆç§é’¥å…¬é’¥æ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ çš„æœ¬åœ°ä¸»æœºä¸åŒ…å« &lt;code&gt;~/.ssh/id_rsa&lt;/code&gt; æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ssh-keygen -t rsa
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¯æ¬¡æ‰§è¡Œä¸Šè¿°å‘½ä»¤åäº§ç”Ÿçš„ç§é’¥æ–‡ä»¶éƒ½ä¸åŒï¼Œå¦‚æœ &lt;code&gt;~/.ssh/id_rsa&lt;/code&gt; æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¼šæç¤ºæ˜¯å¦è¦†ç›–ï¼Œé€‰æ‹© &lt;code&gt;n&lt;/code&gt; ä¸è¦†ç›–ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¼šç”Ÿæˆè¯¥æ–‡ä»¶ï¼ˆæç¤ºéœ€è¦è¾“å…¥çš„åœ°æ–¹éƒ½å¯ä»¥ç•™ç©ºï¼‰&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;è¿è¡Œè¯¥å‘½ä»¤ä¼šç”Ÿæˆ &lt;code&gt;~/.ssh/id_rsa&lt;/code&gt; å’Œ &lt;code&gt;~/.ssh/id_rsa.pub&lt;/code&gt; ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«å­˜å‚¨ç§é’¥å’Œå…¬é’¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ &lt;code&gt;scp&lt;/code&gt; å‘½ä»¤å°†å…¬é’¥æ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ &lt;code&gt;.ssh&lt;/code&gt; ç›®å½•ä¸‹ï¼ˆå¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¯¥ç›®å½•ï¼Œå…ˆåˆ›å»ºè¿™ä¸ªç›®å½•ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;scp ~/.ssh/id_rsa.pub root@47.98.218.227:~/.ssh/
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç™»å½•è¿œç¨‹æœåŠ¡å™¨&#34;&gt;ç™»å½•è¿œç¨‹æœåŠ¡å™¨&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;ssh -p 22 root@47.98.218.227
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å°†å…¬é’¥æ·»åŠ åˆ°æˆæƒ-key&#34;&gt;å°†å…¬é’¥æ·»åŠ åˆ°æˆæƒ KEY&lt;/h3&gt;
&lt;p&gt;ç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤å°†å…¬é’¥æ–‡ä»¶å†…å®¹è¿½åŠ åˆ° &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt; æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cat ~/.ssh/id_rsa.pub &amp;gt;&amp;gt; ~/.ssh/authorized_keys
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰ &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt; è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤å°† &lt;code&gt;~/.ssh/id_rsa.pub&lt;/code&gt; æ–‡ä»¶æ‹·è´è¿‡æ¥&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cp id_rsa.pub authorized_keys
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h2&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥é€šè¿‡ &lt;code&gt;ssh -p 22 root@47.98.218.227&lt;/code&gt; æ˜¯å¦æˆåŠŸå…å¯†ç™»å½•äº†ï¼Œå¦‚æœå¤±è´¥ï¼Œç™»å½•è¿œç¨‹æœåŠ¡å™¨è¾“å…¥&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ«åç™»å½•ssh-config-é…ç½®&#34;&gt;åˆ«åç™»å½•ï¼ˆSSH config é…ç½®ï¼‰&lt;/h2&gt;
&lt;p&gt;config æ”¾åœ¨ &lt;code&gt;~/.ssh/config&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Host            åˆ«å
HostName        ä¸»æœºå
Port            ç«¯å£ï¼ˆé»˜è®¤22ï¼‰
User            ç”¨æˆ·å
IdentityFile    å¯†é’¥æ–‡ä»¶çš„è·¯å¾„

host &amp;quot;weakcc&amp;quot;
    HostName        47.98.218.227
    Port            22
    User            root
    IdentityFile    ~/.ssh/id_rsa.pub
    IdentitiesOnly  yes
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;MAC&lt;/code&gt; ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;1) cd ~/.ssh/
2) touch config
3) vim config
    host weakcc
        HostName    47.98.218.227
        Port            22
        User            root
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ssh-å…å¯†ç ç™»å½•-ssh-key&#34;&gt;SSH å…å¯†ç ç™»å½• ssh key&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;ssh-keygen -t rsa
cd ~/.ssh
ls -al
ssh-copy-id -i  ~/.ssh/id_rsa.pub root@47.98.218.227
ssh weakcc
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å¯èƒ½å­˜åœ¨é—®é¢˜&#34;&gt;å¯èƒ½å­˜åœ¨é—®é¢˜&lt;/h3&gt;
&lt;h4 id=&#34;1-warning-remote-host-identification-has-changed&#34;&gt;1. WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!&lt;/h4&gt;
&lt;p&gt;è§£å†³åŠæ³•&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;vim ~/.ssh/known_hosts
åˆ é™¤å¯¹åº” ip çš„ ssh-rsa
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;2-æŒ‰ç…§æ“ä½œå…å¯†ç™»å½•å¤±è´¥&#34;&gt;2. æŒ‰ç…§æ“ä½œå…å¯†ç™»å½•å¤±è´¥&lt;/h4&gt;
&lt;p&gt;è§£å†³åŠæ³•&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;æŸ¥çœ‹æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®
.ssh éœ€è¦ chmod 700 ~/.ssh
authorized_keys éœ€è¦ chmod 600 ~/.ssh/authorized_keys
&lt;/code&gt;&lt;/pre&gt;
">SSH å…å¯†ç™»å½•</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/yi-lai-zhu-ru-kong-zhi-fan-zhuan-fan-she-ge-ge-gai-nian-de-li-jie-he-shi-yong/"" data-c="
          &lt;p&gt;ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç”¨æˆ·ç™»å½•éœ€è¦æä¾›è®°å½•æ—¥å¿—çš„åŠŸèƒ½ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨æ–‡ä»¶æˆ–è€…æ•°æ®åº“ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç æ¥æ¼”ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

// å®šä¹‰å†™æ—¥å¿—çš„æ¥å£è§„èŒƒ
interface Log
{
    public function write();
}

// æ–‡ä»¶è®°å½•æ—¥å¿—
class FileLog implements Log
{
    public function write()
    {
        echo &#39;file log write...&#39;;
    }
}

// æ•°æ®åº“è®°å½•æ—¥å¿—
class DatabaseLog implements Log
{
    public function write()
    {
        echo &#39;database log write...&#39;;
    }
}

// ç¨‹åºæ“ä½œç±»
class User
{
    protected $fileLog;

    public function __construct()
    {
        $this-&amp;gt;fileLog = new FileLog();
    }

    public function login()
    {
        echo &#39;login success...&#39;;
        echo PHP_EOL;
        $this-&amp;gt;fileLog-&amp;gt;write();
    }
}

$user = new User();
$user-&amp;gt;login();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‡è®¾ç°åœ¨æƒ³ç”¨æ•°æ®åº“è®°å½•æ—¥å¿—çš„è¯ï¼Œæˆ‘ä»¬å°±å¾—ä¿®æ”¹ User ç±»ï¼Œè¿™ä»½ä»£ç æ²¡è¾¾åˆ°è§£è€¦åˆï¼Œä¹Ÿä¸ç¬¦åˆç¼–ç¨‹å¼€æ”¾å°é—­åŸåˆ™ï¼Œé‚£å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠæ—¥å¿—å¤„ç†ç±»é€šè¿‡æ„é€ å‡½æ•°æ–¹å¼ä¼ é€’è¿›å»ã€‚ä¸‹é¢æˆ‘ä»¬è¯•ç€ä¿®æ”¹ User ç±»çš„ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class User
{
    protected $log;

    public function __construct(Log $log)
    {
        $this-&amp;gt;log = $log;
    }

    public function login()
    {
        echo &#39;login success...&#39;;
        echo PHP_EOL;
        $this-&amp;gt;log-&amp;gt;write();
    }
}

$user = new User(new DatabaseLog());
$user-&amp;gt;login();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·æƒ³ç”¨ä»»ä½•æ–¹å¼è®°å½•æ“ä½œæ—¥å¿—éƒ½ä¸éœ€è¦å»ä¿®æ”¹ User ç±»äº†ï¼Œåªéœ€è¦é€šè¿‡æ„é€ å‡½æ•°å‚æ•°ä¼ é€’å°±å¯ä»¥å®ç°ï¼Œå…¶å®è¿™å°±æ˜¯ &lt;code&gt;æ§åˆ¶åè½¬&lt;/code&gt;ã€‚ä¸éœ€è¦è‡ªå·±å†…å®¹ä¿®æ”¹ï¼Œæ”¹æˆç”±å¤–éƒ¨ä¼ é€’ã€‚è¿™ç§ç”±å¤–éƒ¨è´Ÿè´£å…¶ä¾èµ–éœ€æ±‚çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç§°å…¶ä¸º &lt;code&gt;æ§åˆ¶åè½¬ï¼ˆIoCï¼‰&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åå°„çš„æ¦‚å¿µå…¶å®å¯ä»¥ç†è§£æˆæ ¹æ®ç±»åè¿”å›è¯¥ç±»çš„ä»»ä½•ä¿¡æ¯ï¼Œæ¯”å¦‚è¯¥ç±»æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œå‚æ•°ï¼Œå˜é‡ç­‰ç­‰ã€‚æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸‹åå°„è¦ç”¨åˆ°çš„ apiã€‚æ‹¿ User ä¸¾ä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;// è·å–Userçš„reflectionClasså¯¹è±¡
$reflector = new ReflectionClass(User::class);

// æ‹¿åˆ°Userçš„æ„é€ å‡½æ•°
$constructor = $reflector-&amp;gt;getConstructor();

// æ‹¿åˆ°Userçš„æ„é€ å‡½æ•°çš„æ‰€æœ‰ä¾èµ–å‚æ•°
$dependencies = $constructor-&amp;gt;getParameters();


// åˆ›å»ºuserå¯¹è±¡
$user = $reflector-&amp;gt;newInstance();

// åˆ›å»ºuserå¯¹è±¡ï¼Œéœ€è¦ä¼ é€’å‚æ•°çš„
$user = $reflector-&amp;gt;newInstanceArgs($dependencies = []);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª make æ–¹æ³•ï¼Œä¼ å…¥ Userï¼Œåˆ©ç”¨åå°„æœºåˆ¶æ‹¿åˆ° User çš„æ„é€ å‡½æ•°ï¼Œè¿›è€Œå¾—åˆ°æ„é€ å‡½æ•°çš„å‚æ•°å¯¹è±¡ã€‚ç”¨é€’å½’çš„æ–¹å¼åˆ›å»ºå‚æ•°ä¾èµ–ã€‚æœ€åè°ƒç”¨ newInstanceArgs æ–¹æ³•ç”Ÿæˆ User å®ä¾‹ã€‚ å¯èƒ½æœ‰äº›åŒå­¦è¿˜ä¸æ˜¯å¾ˆç†è§£ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç å»ç®€å•æ¨¡æ‹Ÿä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;function make($concrete){
    // æˆ–è€…Userçš„åå°„ç±»
    $reflector = new ReflectionClass($concrete);
    // Useræ„é€ å‡½æ•°
    $constructor = $reflector-&amp;gt;getConstructor();
    // Useræ„é€ å‡½æ•°å‚æ•°
    $dependencies = $constructor-&amp;gt;getParameters();
    // æœ€åç”ŸæˆUser    
    return $reflector-&amp;gt;newInstanceArgs($dependencies);
}

$user = make(&#39;User&#39;);
$user-&amp;gt;login();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‚£ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥å‘¢ï¼Ÿï¼Œå…¶å®ä¸Šé¢çš„ä¾‹å­ä¹Ÿç®—æ˜¯ä¾èµ–æ³¨å…¥ï¼Œä¸æ˜¯ç”±è‡ªå·±å†…éƒ¨ new å¯¹è±¡æˆ–è€…å®ä¾‹ï¼Œé€šè¿‡æ„é€ å‡½æ•°ï¼Œæˆ–è€…æ–¹æ³•ä¼ å…¥çš„éƒ½å±äº &lt;code&gt;ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;// æ³¨æ„æˆ‘ä»¬è¿™é‡Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹Userçš„æ„é€ å‡½æ•°ï¼Œå¦‚æœä¸å»ä¿®æ”¹ã€‚åå°„æ˜¯ä¸èƒ½åŠ¨æ€åˆ›å»ºæ¥å£çš„ï¼Œé‚£å¦‚æœéè¦ç”¨æ¥å£è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿä¸‹ä¸€èŠ‚æˆ‘ä»¬è®²Iocå®¹å™¨çš„æ—¶å€™ä¼šå»è§£å†³ã€‚

class User 
{
    protected $log;

    public function __construct(FileLog $log)
    {
        $this-&amp;gt;log = $log;   
    }

    public function login()
    {
        // ç™»å½•æˆåŠŸï¼Œè®°å½•ç™»å½•æ—¥å¿—
        echo &#39;login success...&#39;;
        $this-&amp;gt;log-&amp;gt;write();
    }

}

function make($concrete){

    $reflector = new ReflectionClass($concrete);
    $constructor = $reflector-&amp;gt;getConstructor();
    // ä¸ºä»€ä¹ˆè¿™æ ·å†™çš„? ä¸»è¦æ˜¯é€’å½’ã€‚æ¯”å¦‚åˆ›å»ºFileLogä¸éœ€è¦ä¼ å…¥å‚æ•°ã€‚
    if(is_null($constructor)) {
        return $reflector-&amp;gt;newInstance();
    }else {
        // æ„é€ å‡½æ•°ä¾èµ–çš„å‚æ•°
        $dependencies = $constructor-&amp;gt;getParameters();
        // æ ¹æ®å‚æ•°è¿”å›å®ä¾‹ï¼Œå¦‚FileLog
        $instances = getDependencies($dependencies);
        return $reflector-&amp;gt;newInstanceArgs($instances);
    }

}

function getDependencies($paramters) {
    $dependencies = [];
    foreach ($paramters as $paramter) {
        $dependencies[] = make($paramter-&amp;gt;getClass()-&amp;gt;name);
    }
&lt;/code&gt;&lt;/pre&gt;
">ä¾èµ–æ³¨å…¥,æ§åˆ¶åè½¬,åå°„å„ä¸ªæ¦‚å¿µçš„ç†è§£å’Œä½¿ç”¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/ngrok-shi-xian-nei-wang-chuan-tou-jiao-cheng/"" data-c="
          &lt;p&gt;https://ngrok.com/&lt;/p&gt;
&lt;h1 id=&#34;ngrok-authtoken-ä½ çš„-token&#34;&gt;ngrok authtoken {ä½ çš„ Token}&lt;/h1&gt;
&lt;p&gt;Ngrok æ³¨å†Œå®Œæˆä¹‹åä¼šè¿›å…¥è¿™ä¸ªé¡µé¢ï¼š&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1630894686441.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¤åˆ¶è¿™ä¸ªæ¡†é‡Œçš„å‘½ä»¤&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;ngrok authtoken {ä½ çš„ Token}
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;å¯åŠ¨-ngrok-å®¢æˆ·ç«¯&#34;&gt;å¯åŠ¨ Ngrok å®¢æˆ·ç«¯&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;ngrok http -host-header=zbcrm.com -region us 80
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;http ä»£è¡¨æˆ‘ä»¬è¦æ˜ å°„çš„æ˜¯ HTTP åè®®ï¼›-host-header= ä»£è¡¨æœ¬åœ°ç«™ç‚¹çš„åŸŸåï¼Œå¦‚æœä½ ç”¨çš„ä¸æ˜¯ shop.test è¯·æ›´æ¢æˆå¯¹åº”çš„åŸŸåï¼›-region us ä»£è¡¨æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯ç¾å›½çš„å…¬å…±èŠ‚ç‚¹ï¼›80 ä»£è¡¨æ˜ å°„åˆ°æœ¬åœ°çš„ 80 ç«¯å£ã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1630894831743.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;code&gt;Forwarding&lt;/code&gt; ä»£è¡¨ Ngrok åˆ†é…ç»™ä½ çš„åŸŸåï¼Œ&lt;b&gt;å¯¹äºå…è´¹è´¦å·æ¥è¯´ï¼Œæ¯æ¬¡å¯åŠ¨ Ngrok ï¼Œéƒ½ä¼šé‡æ–°åˆ†é…ä¸€ä¸ªéšæœºçš„åŸŸåï¼Œæ— æ³•å›ºå®šã€‚&lt;/b&gt;&lt;br&gt;
&lt;code&gt;Web Interface&lt;/code&gt; æ˜¯ Ngrok å†…ç½®çš„ä¸€ä¸ªç®¡ç†é¢æ¿ï¼Œå®ƒå¯ä»¥å±•ç¤ºæ‰€æœ‰é€šè¿‡ Ngrok è¿›æ¥çš„è¯·æ±‚ä¿¡æ¯ä»¥åŠè¿”å›çš„æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬è®¿é—®ä¸€ä¸‹ http://127.0.0.1:4040/ çœ‹çœ‹ï¼š&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1630894964212.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å›½é™…å¸¦å®½ä¸ç¨³å®šçš„æ—¶å€™æœ‰å¯èƒ½å‡ºç°è¿æ¥è¶…æ—¶ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è¯•è¯•æŠŠå¯åŠ¨ Ngrok å‘½ä»¤ä¸­çš„ us æ”¹æˆ au æ¾³å¤§åˆ©äºšæˆ–è€… eu æ¬§æ´²&lt;/p&gt;
&lt;/blockquote&gt;
">Ngrok å®ç°å†…ç½‘ç©¿é€æ•™ç¨‹</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/shi-xian-da-shu-ju-liang-wen-jian-de-yi-bu-dao-chu/"" data-c="
          &lt;ol&gt;
    &lt;li&gt;ç‚¹å‡»å¯¼å‡ºåï¼Œå°†ç­›é€‰æ¡ä»¶æ¨è¿›é˜Ÿåˆ—ã€‚ï¼ˆåŒ…æ‹¬æ€»æ¡æ•°ï¼‰ï¼ˆæç¤ºæ­£åœ¨å¤„ç†ï¼‰&lt;/li&gt;
    &lt;li&gt;æ¶ˆè´¹é˜Ÿåˆ—ä»»åŠ¡ï¼Œå¹¶åˆ†é¡µè·å–åˆ—è¡¨æ•°æ®ã€‚ç”Ÿæˆæ–‡ä»¶ã€‚ï¼ˆæç¤ºæ­£åœ¨å¤„ç†ï¼‰&lt;/li&gt;
    &lt;li&gt;å°†ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸Šä¼ æŸåœ°ï¼Œå¹¶æä¾›ä¸‹è½½é“¾æ¥ï¼ˆæç¤ºå¤„ç†å®Œæˆï¼Œè¶…é“¾æ¥ä¸‹è½½ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
">å®ç°å¤§æ•°æ®é‡æ–‡ä»¶çš„å¼‚æ­¥å¯¼å‡º</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/ru-he-fang-zhi-chao-mai/"" data-c="
          &lt;h1 id=&#34;æ‚²è§‚é”&#34;&gt;æ‚²è§‚é”&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;æ‚²è§‚å¹¶å‘æ§åˆ¶&lt;/code&gt;ï¼ˆåˆåâ€œ&lt;b&gt;æ‚²è§‚é”&lt;/b&gt;â€ï¼‰æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥é˜»æ­¢ä¸€ä¸ªäº‹åŠ¡ä»¥å½±å“å…¶ä»–ç”¨æˆ·çš„æ–¹å¼æ¥ä¿®æ”¹æ•°æ®ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œçš„æ“ä½œè¯»æŸè¡Œæ•°æ®åº”ç”¨äº†é”ï¼Œé‚£åªç”¨å½“è¿™ä¸ªäº‹åŠ¡æŠŠé”é‡Šæ”¾ï¼Œå…¶ä»–äº‹åŠ¡æ‰èƒ½å¤Ÿæ‰§è¡Œä¸è¯¥é”å†²çªçš„æ“ä½œã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;æ‚²è§‚é”ä¸»è¦ç”¨äºæ•°æ®äº‰ç”¨æ¿€çƒˆçš„ç¯å¢ƒï¼Œä»¥åŠå‘ç”Ÿå¹¶å‘å†²çªæ—¶é”ä¿æŠ¤æ•°æ®çš„æˆæœ¬è¦ä½äºå›æ»šäº‹åŠ¡çš„æˆæœ¬çš„ç¯å¢ƒä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œæ‚²è§‚é”ä¸»è¦ç”¨äºä¿æŠ¤æ•°æ®çš„å®Œæ•´æ€§ã€‚å½“å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼ŒæŸä¸ªäº‹åŠ¡å¯¹æ•°æ®åº”ç”¨äº†é”ï¼Œåˆ™å…¶ä»–äº‹åŠ¡åªèƒ½ç­‰è¯¥äº‹åŠ¡æ‰§è¡Œå®Œäº†ï¼Œæ‰èƒ½è¿›è¡Œå¯¹è¯¥æ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;update goods set num = num - 1 where id = 1001 and num &amp;gt; 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‡è®¾ç°åœ¨å•†å“åªå‰©ä¸‹ä¸€ä»¶äº†ï¼Œæ­¤æ˜¯æ•°æ®åº“ä¸­ &lt;b&gt;num = 1&lt;/b&gt;ï¼›&lt;br&gt;
ä½†æœ‰ 100 ä¸ªçº¿ç¨‹åŒæ—¶è¯»å–åˆ°äº†è¿™ä¸ª &lt;b&gt;num = 1&lt;/b&gt;ï¼Œæ‰€ä»¥ 100 ä¸ªçº¿ç¨‹éƒ½å¼€å§‹å‡åº“å­˜äº†ã€‚&lt;br&gt;
ä½†ä½ æœ€ç»ˆä¼šå‘è§‰ï¼Œ &lt;b&gt;å…¶å®åªæœ‰ä¸€ä¸ªçº¿ç¨‹å‡åº“å­˜æˆåŠŸï¼Œå…¶ä»– 99 ä¸ªçº¿ç¨‹å…¨éƒ¨å¤±è´¥&lt;/b&gt;ã€‚&lt;br&gt;
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code&gt;FOR UPDATE&lt;/code&gt; ç”Ÿæ•ˆéœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶æ‰ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;æ•°æ®åº“çš„å¼•æ“ä¸º innoDB&lt;/li&gt;
    &lt;li&gt;æ“ä½œä½äºäº‹åŠ¡å—ä¸­ï¼ˆBEGIN/COMMITï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‚²è§‚é”é‡‡ç”¨çš„æ˜¯ã€Œå…ˆè·å–é”å†è®¿é—®ã€çš„ç­–ç•¥ï¼Œæ¥ä¿éšœæ•°æ®çš„å®‰å…¨ã€‚ä½†æ˜¯åŠ é”ç­–ç•¥ï¼Œä¾èµ–æ•°æ®åº“å®ç°ï¼Œä¼šå¢åŠ æ•°æ®åº“çš„è´Ÿæ‹…ï¼Œä¸”ä¼šå¢åŠ æ­»é”å‘ç”Ÿçš„å‡ ç‡ã€‚æ­¤å¤–ï¼Œå¯¹äºä¸ä¼šå‘ç”Ÿå˜åŒ–çš„åªè¯»æ•°æ®ï¼ŒåŠ é”åªä¼šå¢åŠ é¢å¤–ä¸å¿…è¦çš„è´Ÿæ‹…ã€‚åœ¨å®é™…çš„å®è·µä¸­ï¼Œå¯¹äºå¹¶å‘å¾ˆé«˜çš„åœºæ™¯å¹¶ä¸ä¼šä½¿ç”¨æ‚²è§‚é”ï¼Œå› ä¸ºå½“ä¸€ä¸ªäº‹åŠ¡é”ä½äº†æ•°æ®ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡éƒ½ä¼šå‘ç”Ÿé˜»å¡ï¼Œä¼šå¯¼è‡´å¤§é‡çš„äº‹åŠ¡å‘ç”Ÿç§¯å‹æ‹–å®æ•´ä¸ªç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¹è§‚é”&#34;&gt;ä¹è§‚é”&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;select version from goods where id = 1001;

update goods set num = num - 1, version = version + 1 where id = 1001 and num &amp;gt; 0 and version = @version(ä¸Šé¢æŸ¥åˆ°çš„version);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ç§æ–¹å¼é‡‡ç”¨äº†&lt;b&gt;ç‰ˆæœ¬å·&lt;/b&gt;çš„æ–¹å¼ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ &lt;b&gt;CAS&lt;/b&gt; çš„åŸç†ã€‚&lt;br&gt;
å‡è®¾æ­¤æ—¶ version = 100, num = 1;  ç°åœ¨æœ‰ 100 ä¸ªçº¿ç¨‹è¿›å…¥åˆ°äº†è¿™é‡Œï¼ŒåŒæ—¶ä»–ä»¬ select å‡ºæ¥ç‰ˆæœ¬å·éƒ½æ˜¯ version = 100ã€‚&lt;br&gt;
ç„¶åç›´æ¥ update çš„æ—¶å€™ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå…ˆ update äº†ï¼ŒåŒæ—¶æ›´æ–°äº†ç‰ˆæœ¬å·ã€‚&lt;br&gt;
é‚£ä¹ˆå…¶ä»– 99 ä¸ªåœ¨æ›´æ–°çš„æ—¶å€™ï¼Œä¼šå‘è§‰ version å¹¶ä¸ç­‰äºä¸Šæ¬¡ select çš„ versionï¼Œå°±è¯´æ˜ version è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†ï¼Œå°±æ”¾å¼ƒè¿™æ¬¡çš„ updateã€‚&lt;/p&gt;
&lt;h1 id=&#34;redis-æ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;Redis æ¶ˆæ¯é˜Ÿåˆ—&lt;/h1&gt;
&lt;p&gt;åœ¨ç§’æ€çš„æƒ…å†µä¸‹ï¼Œé«˜é¢‘ç‡çš„å»è¯»å†™æ•°æ®åº“ï¼Œä¼šä¸¥é‡é€ æˆæ€§èƒ½é—®é¢˜ã€‚&lt;br&gt;
æ‰€ä»¥å¿…é¡»å€ŸåŠ©å…¶ä»–æœåŠ¡ï¼Œå¯ä»¥åˆ©ç”¨ redis çš„å•çº¿ç¨‹é¢„å‡åº“å­˜ã€‚&lt;br&gt;
æ¯”å¦‚å•†å“æœ‰ 100 ä»¶ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥åœ¨ redis ä¸­å…ˆå­˜å‚¨ä¸€ä¸ª &lt;code&gt;k, v&lt;/code&gt;ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼šæ¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹è¿›æ¥ï¼Œkey å€¼å°±å‡ 1ï¼Œç­‰å‡åˆ° 0 çš„æ—¶å€™ï¼Œå…¨éƒ¨æ‹’ç»å‰©ä¸‹çš„è¯·æ±‚ã€‚&lt;br&gt;
é‚£ä¹ˆä¹Ÿå°±æ˜¯åªæœ‰ 100 ä¸ªçº¿ç¨‹ä¼šè¿›å…¥åˆ°åç»­æ“ä½œã€‚æ‰€ä»¥ä¸€å®šä¸ä¼šå‡ºç°è¶…å–çš„ç°è±¡ã€‚&lt;/p&gt;
&lt;h1 id=&#34;redis-åˆ†å¸ƒå¼é”&#34;&gt;Redis åˆ†å¸ƒå¼é”&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
/**
 * å®ç°Redisåˆ†å¸ƒé”
 */
 
$key        = &#39;test&#39;;       //è¦æ›´æ–°ä¿¡æ¯çš„ç¼“å­˜KEY
$lockKey    = &#39;lock:&#39;.$key; //è®¾ç½®é”KEY
$lockExpire = 10;           //è®¾ç½®é”çš„æœ‰æ•ˆæœŸä¸º10ç§’
 
//è·å–ç¼“å­˜ä¿¡æ¯
$result = $redis-&amp;gt;get($key);
//åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®
if(empty($result))
{
    $status = TRUE;
    while ($status)
    {
        //è®¾ç½®é”å€¼ä¸ºå½“å‰æ—¶é—´æˆ³ + æœ‰æ•ˆæœŸ
        $lockValue = time() + $lockExpire;
        /**
         * åˆ›å»ºé”
         * è¯•å›¾ä»¥$lockKeyä¸ºkeyåˆ›å»ºä¸€ä¸ªç¼“å­˜,valueå€¼ä¸ºå½“å‰æ—¶é—´æˆ³
         * ç”±äºsetnx()å‡½æ•°åªæœ‰åœ¨ä¸å­˜åœ¨å½“å‰keyçš„ç¼“å­˜æ—¶æ‰ä¼šåˆ›å»ºæˆåŠŸ
         * æ‰€ä»¥ï¼Œç”¨æ­¤å‡½æ•°å°±å¯ä»¥åˆ¤æ–­å½“å‰æ‰§è¡Œçš„æ“ä½œæ˜¯å¦å·²ç»æœ‰å…¶ä»–è¿›ç¨‹åœ¨æ‰§è¡Œäº†
         * @var [type]
         */
        $lock = $redis-&amp;gt;setnx($lockKey, $lockValue);
        /**
         * æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ªå³å¯è¿›è¡Œæ“ä½œ
         * 1ã€ä¸Šé¢ä¸€æ­¥åˆ›å»ºé”æˆåŠŸ;
         * 2ã€   1ï¼‰åˆ¤æ–­é”çš„å€¼ï¼ˆæ—¶é—´æˆ³ï¼‰æ˜¯å¦å°äºå½“å‰æ—¶é—´    $redis-&amp;gt;get()
         *      2ï¼‰åŒæ—¶ç»™é”è®¾ç½®æ–°å€¼æˆåŠŸ    $redis-&amp;gt;getset()
         */
        if(!empty($lock) || ($redis-&amp;gt;get($lockKey) &amp;lt; time() &amp;amp;&amp;amp; $redis-&amp;gt;getSet($lockKey, $lockValue) &amp;lt; time() ))
        {
            //ç»™é”è®¾ç½®ç”Ÿå­˜æ—¶é—´
            $redis-&amp;gt;expire($lockKey, $lockExpire);
            //******************************
            //æ­¤å¤„æ‰§è¡Œæ’å…¥ã€æ›´æ–°ç¼“å­˜æ“ä½œ...
            //******************************
 
            //ä»¥ä¸Šç¨‹åºèµ°å®Œåˆ é™¤é”
            //æ£€æµ‹é”æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸé”æ²¡å¿…è¦åˆ é™¤
            if($redis-&amp;gt;ttl($lockKey))
                $redis-&amp;gt;del($lockKey);
            $status = FALSE;
        }else{
            /**
             * å¦‚æœå­˜åœ¨æœ‰æ•ˆé”è¿™é‡Œåšç›¸åº”å¤„ç†
             *      ç­‰å¾…å½“å‰æ“ä½œå®Œæˆå†æ‰§è¡Œæ­¤æ¬¡è¯·æ±‚
             *      ç›´æ¥è¿”å›
             */
            sleep(2);//ç­‰å¾…2ç§’åå†å°è¯•æ‰§è¡Œæ“ä½œ
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
">å¦‚ä½•é˜²æ­¢è¶…å–</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/redis-huan-cun-ji-chuan-huan-cun-chuan-tou-huan-cun-xue-beng/"" data-c="
          &lt;h1 id=&#34;ç¼“å­˜å¤„ç†æµç¨‹&#34;&gt;ç¼“å­˜å¤„ç†æµç¨‹&lt;/h1&gt;
&lt;p&gt;å‰å°è¯·æ±‚ï¼Œåå°å…ˆä»ç¼“å­˜ä¸­å–æ•°æ®ï¼Œå–åˆ°ç›´æ¥è¿”å›ç»“æœï¼Œå–ä¸åˆ°æ—¶ä»æ•°æ®åº“ä¸­å–ï¼Œæ•°æ®åº“å–åˆ°æ›´æ–°åˆ°ç¼“å­˜ï¼Œå¹¶è¿”å›ç»“æœï¼Œæ•°æ®åº“ä¹Ÿæ²¡å–åˆ°ï¼Œé‚£ç›´æ¥è¿”å›ç»“æœã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1625190068679.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;ç¼“å­˜ç©¿é€&#34;&gt;ç¼“å­˜ç©¿é€&lt;/h1&gt;
&lt;h2 id=&#34;å®šä¹‰&#34;&gt;å®šä¹‰&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;ç¼“å­˜ç©¿é€&lt;/code&gt;æ˜¯æŒ‡ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®ï¼Œè€Œç”¨æˆ·ä¸æ–­å‘èµ·è¯·æ±‚ï¼Œé€ æˆäº†ç±»ä¼¼æ”»å‡»è¡Œä¸ºã€‚å¦‚å‘èµ· id ä¸º-1çš„æ•°æ®æˆ– id ç‰¹åˆ«å¤§ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™æ˜¯ç”¨æˆ·å¯èƒ½å°±æ˜¯æ”»å‡»è€…ï¼Œæ”»å‡»ä¼šå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆ&#34;&gt;æ–¹æ¡ˆ&lt;/h2&gt;
&lt;ol&gt;
    &lt;li&gt;æ¥å£å±‚å¢åŠ æ ¡éªŒï¼Œå¦‚ç”¨æˆ·é‰´æƒæ ¡éªŒï¼ŒidåšåŸºç¡€æ ¡éªŒï¼Œid&lt;0çš„ç›´æ¥æ‹¦æˆª&lt;/li&gt;
    &lt;li&gt;ç¼“å­˜ç©ºå€¼ï¼Œä¸ä¼šæŸ¥æ•°æ®åº“ã€‚ä»ç¼“å­˜å–ä¸åˆ°çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¹Ÿå–ä¸åˆ°ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥å°† key-value å¯¹å†™ä¸º key-nullï¼Œç¼“å­˜æœ‰æ•ˆæ—¶é—´å¯ä»¥è®¾ç½®çŸ­ç‚¹ï¼Œå¦‚30sï¼ˆè®¾ç½®æ—¶é—´å¤ªé•¿ä¼šå¯¼è‡´æ­£å¸¸æƒ…å†µä¹Ÿæ²¡åŠæ³•ä½¿ç”¨ï¼‰ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»ç”¨æˆ·åå¤ç”¨åŒä¸€ä¸ª id æš´åŠ›æ”»å‡»&lt;/li&gt;
    &lt;li&gt;é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ï¼ŒæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmap æ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹ DB çš„æŸ¥è¯¢å‹åŠ›&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ï¼šå½“ä¸€ä¸ªå…ƒç´ è¢«åŠ å…¥é›†åˆæ—¶ï¼Œé€šè¿‡ K ä¸ªæ•£åˆ—å‡½æ•°å°†è¿™ä¸ªå…ƒç´ æ˜ å°„æˆä¸€ä¸ªä½æ•°ç»„ä¸­çš„ K ä¸ªç‚¹ï¼ŒæŠŠå®ƒä»¬ç½®ä¸º 1ã€‚æŸ¥è¯¢æ—¶ï¼Œå°†å…ƒç´ é€šè¿‡æ•£åˆ—å‡½æ•°æ˜ å°„ä¹‹åä¼šå¾—åˆ° k ä¸ªç‚¹ï¼Œå¦‚æœè¿™äº›ç‚¹æœ‰ä»»ä½•ä¸€ä¸ª 0ï¼Œåˆ™è¢«æ£€å…ƒç´ ä¸€å®šä¸åœ¨ï¼Œç›´æ¥è¿”å›ï¼›å¦‚æœéƒ½æ˜¯ 1ï¼Œåˆ™æŸ¥è¯¢å…ƒç´ å¾ˆå¯èƒ½å­˜åœ¨ï¼Œå°±ä¼šå»æŸ¥è¯¢ Redis å’Œæ•°æ®åº“ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;ç¼“å­˜å‡»ç©¿&#34;&gt;ç¼“å­˜å‡»ç©¿&lt;/h1&gt;
&lt;h2 id=&#34;å®šä¹‰-2&#34;&gt;å®šä¹‰&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;ç¼“å­˜å‡»ç©¿&lt;/code&gt;æ˜¯æŒ‡ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰æ•°æ®ï¼ˆä¸€èˆ¬æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸï¼‰ï¼Œå¤§æ‰¹é‡çš„è¯·æ±‚åœ¨è®¿é—®åŒä¸€ä¸ª keyï¼Œè¿™ä¸ª key å¤±æ•ˆçš„ç¬é—´ï¼Œè¯·æ±‚æ‰“åˆ°äº†æ•°æ®åº“ï¼Œè¿™æ—¶ç”±äºå¹¶å‘ç”¨æˆ·ç‰¹åˆ«å¤šï¼ŒåŒæ—¶è¯»ç¼“å­˜æ²¡è¯»åˆ°æ•°æ®ï¼ŒåˆåŒæ—¶åˆå»æ•°æ®åº“å»å–æ•°æ®ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›ç¬é—´å¢å¤§ï¼Œé€ æˆè¿‡å¤§å‹åŠ›&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆ-2&#34;&gt;æ–¹æ¡ˆ&lt;/h2&gt;
&lt;ol&gt;
    &lt;li&gt;è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ&lt;/li&gt;
    &lt;li&gt;åŠ åˆ†å¸ƒå¼é”&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;åˆ†å¸ƒå¼é”ï¼Œå…ˆä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰æ•°æ®è·å–é”ï¼Œé”æˆåŠŸï¼Œå»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œæ›´æ–°ç¼“å­˜ï¼Œç„¶åé‡Šæ”¾é”ã€‚&lt;br&gt;
æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰ï¼Œå…¶ä»–å¹¶è¡Œè¿›å…¥çš„çº¿ç¨‹ä¼šç­‰å¾…100msï¼ˆæ—¶é—´ä¸æ˜“è®¾ç½®å¤ªé•¿ï¼‰ï¼Œå†é‡æ–°å»è¯»å–ç¼“å­˜æ•°æ®ï¼Œè¿™æ ·å°±é˜²æ­¢éƒ½å»æ•°æ®åº“é‡å¤å–æ•°æ®&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;b&gt;ç¼“å­˜å‡»ç©¿æ˜¯æŸ¥è¯¢ç¼“å­˜ä¸­å¤±æ•ˆçš„ keyï¼Œè€Œç¼“å­˜ç©¿é€æ˜¯æŸ¥è¯¢ä¸å­˜åœ¨çš„ key&lt;/b&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;public String get(String key) {
    String value = redis.get(key);
    if (value == null) { 
        //ç¼“å­˜å€¼è¿‡æœŸ
        String unique_key = systemId + &amp;quot;:&amp;quot; + key;
        //è®¾ç½®30sçš„è¶…æ—¶
        if (redis.set(unique_key, 1, &#39;NX&#39;, &#39;PX&#39;, 30000) == 1) {  //è®¾ç½®æˆåŠŸ
            value = db.get(key);
            redis.set(key, value, expire_secs);
            redis.del(unique_key);
        } else {  
            //å…¶ä»–çº¿ç¨‹å·²ç»åˆ°æ•°æ®åº“å–å€¼å¹¶å›å†™åˆ°ç¼“å­˜äº†ï¼Œå¯ä»¥é‡è¯•è·å–ç¼“å­˜å€¼
            sleep(50);
            get(key);  //é‡è¯•
        }
    } else {
        return value;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ç¼“å­˜é›ªå´©&#34;&gt;ç¼“å­˜é›ªå´©&lt;/h1&gt;
&lt;h2 id=&#34;å®šä¹‰-3&#34;&gt;å®šä¹‰&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;ç¼“å­˜é›ªå´©&lt;/code&gt;æ˜¯æŒ‡ç¼“å­˜ä¸­æ•°æ®å¤§æ‰¹é‡çš„åˆ°æœŸï¼Œè€ŒæŸ¥è¯¢æ•°æ®é‡å·¨å¤§ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³å®•æœºã€‚å¤§æ‰¹é‡çš„è¯·æ±‚åœ¨è®¿é—®å¤§æ‰¹é‡çš„ keyï¼Œè¿™äº› key åŒæ—¶å¤±æ•ˆï¼Œæ‰€æœ‰è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“æ— æ³•å“åº”&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆ-3&#34;&gt;æ–¹æ¡ˆ&lt;/h2&gt;
&lt;ol&gt;
    &lt;li&gt;ç¼“å­˜æ•°æ®çš„æ—¶é—´è®¾ç½®éšæœºï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¤§é‡æ•°æ®è¿‡æœŸç°è±¡å‘ç”Ÿ&lt;/li&gt;
    &lt;li&gt;å¦‚æœç¼“å­˜æ•°æ®åº“æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå°†çƒ­ç‚¹æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒçš„ç¼“å­˜æ•°æ®åº“ä¸­&lt;/li&gt;
    &lt;li&gt;è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;https://zhuanlan.zhihu.com/p/359118610&lt;/p&gt;
&lt;/blockquote&gt;
">Redis ç¼“å­˜å‡»ç©¿ ç¼“å­˜ç©¿é€ ç¼“å­˜é›ªå´©</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/lian-jie-chi/"" data-c="
          &lt;h1 id=&#34;ä»€ä¹ˆæ˜¯è¿æ¥æ± &#34;&gt;ä»€ä¹ˆæ˜¯è¿æ¥æ± &lt;/h1&gt;
&lt;p&gt;åœ¨å®é™…åº”ç”¨å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰å¾ˆå¤šè®¿é—®ä¸‹æ¸¸çš„éœ€æ±‚ï¼ˆä¸‹æ¸¸åŒ…æ‹¬ä½†ä¸é™äº&lt;b&gt;æœåŠ¡&lt;/b&gt;/&lt;b&gt;æ•°æ®åº“&lt;/b&gt;/&lt;b&gt;ç¼“å­˜&lt;/b&gt;ï¼‰ï¼Œåœ¨å¹¶å‘é‡å¾ˆä½çš„æ—¶å€™ï¼Œé€šå¸¸ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä½†å½“æœåŠ¡å™¨å•æœº&lt;b&gt;QPS&lt;/b&gt;ï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰è¾¾åˆ°å‡ ç™¾ï¼Œå‡ åƒï¼Œç”šè‡³ä¸Šä¸‡çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸€æ¬¡è®¿é—®éƒ½æ˜¯å¿…é¡»ç»å†å»ºç«‹è¿æ¥=ã€‹æ”¶å‘è¯·æ±‚=ã€‹å…³é—­è¿æ¥=ã€‹é‡Šæ”¾èµ„æºç­‰æ­¥éª¤ï¼Œç³»ç»Ÿçš„æ€§èƒ½å¿…ç„¶æ€¥å‰§ä¸‹é™ï¼Œä¸¥é‡å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢ç®€åŒ–ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;ä¸ä¸‹æ¸¸å»ºç«‹ä¸€ä¸ªè¿æ¥&lt;/li&gt;
    &lt;li&gt;é€šè¿‡è¿™ä¸ªè¿æ¥ï¼Œæ”¶å‘è¯·æ±‚&lt;/li&gt;
    &lt;li&gt;äº¤äº’ç»“æŸï¼Œå…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;blockquote&gt;
&lt;p&gt;QPSæ˜¯æ¯ç§’æŸ¥è¯¢ç‡ ,æ˜¯ä¸€å°æœåŠ¡å™¨æ¯ç§’èƒ½å¤Ÿç›¸åº”çš„æŸ¥è¯¢æ¬¡æ•°ï¼Œæ˜¯å¯¹ä¸€ä¸ªç‰¹å®šçš„æŸ¥è¯¢æœåŠ¡å™¨åœ¨è§„å®šæ—¶é—´å†…æ‰€å¤„ç†æµé‡å¤šå°‘çš„è¡¡é‡æ ‡å‡†, å³æ¯ç§’çš„å“åº”è¯·æ±‚æ•°ï¼Œä¹Ÿå³æ˜¯æœ€å¤§ååèƒ½åŠ›&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»¥ PHP è¿æ¥ MySQL ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
$host = &#39;127.0.0.1&#39;;
$username = &#39;root&#39;;
$password = &#39;123456&#39;;
$dbname = &#39;demo&#39;;
// æ‰“å¼€ä¸€ä¸ªåˆ° MySQL æœåŠ¡å™¨çš„æ–°çš„è¿æ¥
$link = @mysqli_connect($host, $username, $password, $dbname); 
if ($link) {
    // SQL è¯­å¥
    $sql = &#39;select version()&#39;; 
    // æ‰§è¡Œ SQL è¯­å¥ï¼Œå¹¶è¿”å›ç»“æœ
    $result = mysqli_query($link, $sql); 
    // ä»ç»“æœé›†ä¸­è·å–æ‰€æœ‰æ•°æ®
    $data = mysqli_fetch_all($result); 
    print_r($data);
    // å…³é—­è¿æ¥
    mysqli_close($link);
} else {
    echo &#39;æ•°æ®åº“è¿æ¥å¤±è´¥ï¼&#39;;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± &#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± &lt;/h1&gt;
&lt;p&gt;å½“æœåŠ¡å•æœº QPS è¾¾åˆ°å‡ ç™¾ã€å‡ åƒçš„æ—¶å€™ï¼Œ&lt;b&gt;å»ºç«‹è¿æ¥&lt;/b&gt;å’Œ&lt;b&gt;é”€æ¯è¿æ¥&lt;/b&gt;å°±ä¼šæˆä¸ºç“¶é¢ˆï¼Œæ­¤æ—¶è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿ&lt;br&gt;
å¾ˆç®€å•ï¼ŒæœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œ&lt;b&gt;å…ˆå»ºç«‹å¥½è‹¥å¹²è¿æ¥&lt;/b&gt;å½¢æˆä¸€ä¸ª&lt;code&gt;æ± å­&lt;/code&gt;ï¼Œå½“æœ‰è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œä»å»ºç«‹å¥½çš„&lt;code&gt;æ± å­&lt;/code&gt;ä¸­å–å‡ºä¸€ä¸ªè¿æ¥ï¼Œæ‰§è¡Œä¸‹æ¸¸æ“ä½œï¼Œæ‰§è¡Œå®Œæ¯•å†æ”¾å›åˆ°&lt;code&gt;æ± å­&lt;/code&gt;ä¸­ï¼Œä»¥æ­¤æå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®šä¹‰&#34;&gt;å®šä¹‰ï¼š&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;è¿æ¥æ± &lt;/code&gt;ï¼šåˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªè¿æ¥çš„ç¼“å†²æ± çš„æŠ€æœ¯ï¼Œè¿™äº›è¿æ¥å‡†å¤‡å¥½è¢«ä»»ä½•éœ€è¦å®ƒä»¬çš„çº¿ç¨‹ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œæœºåˆ¶&#34;&gt;è¿è¡Œæœºåˆ¶ï¼š&lt;/h2&gt;
&lt;ol&gt;
    &lt;li&gt;&lt;b&gt;init&lt;/b&gt; ç¨‹åºåˆå§‹åŒ–æ—¶åˆ›å»ºè¿æ¥æ± ï¼šåˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºï¼Œåœ¨æœåŠ¡å¯åŠ¨çš„æ—¶å€™åªè°ƒç”¨ä¸€æ¬¡&lt;/li&gt;
    &lt;li&gt;&lt;b&gt;get&lt;/b&gt; ä½¿ç”¨æ—¶å‘è¿æ¥æ± ç”³è¯·å¯ç”¨è¿æ¥ï¼šæ¯æ¬¡è¯·æ±‚é€šè¿‡è¿æ¥æ± çš„æ¥å£æ‹¿å–æ•°æ®&lt;/li&gt;
    &lt;li&gt;&lt;b&gt;push&lt;/b&gt; ä½¿ç”¨å®Œæ¯•ï¼Œå°†è¿æ¥è¿”è¿˜ç»™è¿æ¥æ± ï¼šè®¿é—®ç»“æŸï¼Œå¹¶ä¸æ˜¯å…³é—­è¿™ä¸ªè¿æ¥ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¿æ¥æ”¾å›åˆ°è¿æ¥æ± ä¸­&lt;/li&gt;
    &lt;li&gt;ç¨‹åºé€€å‡ºæ—¶ï¼Œæ–­å¼€æ‰€æœ‰è¿æ¥ï¼Œå¹¶é‡Šæ”¾èµ„æº&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¼ªä»£ç &#34;&gt;ä¼ªä»£ç &lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

class Pool
{
    public static function getIn()
    {
        // å•ä¾‹æ¨¡å¼
    }

    public function init()
    {
        // pool å‡†å¤‡å¥½å°±å¡«å……æŒ‡å®šçš„èµ„æº æ¯”å¦‚10ä¸ªè¿æ¥
        $this-&amp;gt;pool = $array;
    }

    public function get()
    {
        return array_pop($this-&amp;gt;pool);
    }

    public function push($obj)
    {
        $this-&amp;gt;pool[] = $obj;
    }
}

// å®ä¾‹åŒ–æ± å­
$dbPool = Pool::getIn();

// è·å–è¿æ¥
$db = $db-&amp;gt;get();

// æ‰§è¡Œè¯­å¥
$res = $db-&amp;gt;query(&#39;SQL è¯­å¥&#39;);

// å½’è¿˜è¿æ¥
$dbPool-&amp;gt;push($db);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ•°æ®åº“è¿æ¥æ± &#34;&gt;æ•°æ®åº“è¿æ¥æ± &lt;/h2&gt;
&lt;h3 id=&#34;å®šä¹‰-2&#34;&gt;å®šä¹‰&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;æ•°æ®åº“è¿æ¥æ± &lt;/code&gt;ï¼šç¨‹åºå¯åŠ¨æ—¶å»ºç«‹è¶³å¤Ÿçš„æ•°æ®åº“è¿æ¥ï¼Œå¹¶å°†è¿™äº›è¿æ¥ç»„æˆä¸€ä¸ªè¿æ¥æ± ï¼Œç”±ç¨‹åºåŠ¨æ€åœ°å¯¹æ± ä¸­çš„è¿æ¥ç”³è¯·ï¼Œä½¿ç”¨ï¼Œé‡Šæ”¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼˜ç‚¹&#34;&gt;ä¼˜ç‚¹&lt;/h3&gt;
&lt;p&gt;å‡å°‘ &lt;code&gt;I/O&lt;/code&gt; æ“ä½œï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡&lt;br&gt;
å¦‚æœåœ¨çŸ­æ—¶é—´å†…è¿›è¡Œä¸€ä¸‡æ¬¡mysqlçš„è¿æ¥ï¼Œå°±éœ€è¦åœ¨è¿™ä¸ªå¾€è¿”è¿‡ç¨‹å¾ªç¯ï¼Œåœ¨è·¯ä¸Šæµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€æ€§èƒ½æ¶ˆè€—ã€‚&lt;br&gt;
å¦‚æœæˆ‘ä»¬å…ˆæŠŠè¿æ¥è¿æ¥å¥½ï¼Œå¹¶ä¸”æ”¾åœ¨è¿æ¥æ± ä¸­ï¼Œç¨‹åºä¸­éœ€è¦ä½¿ç”¨å°±ä»æ± ä¸­è·å–ï¼Œæ‰§è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;å‡å°‘è¿æ¥åˆ›å»ºæ—¶é—´ã€‚è¿æ¥æ± ä¸­çš„è¿æ¥æ˜¯å·²å‡†å¤‡å¥½çš„ã€å¯é‡å¤ä½¿ç”¨çš„ï¼Œè·å–åå¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå› æ­¤å‡å°‘äº†è¿æ¥åˆ›å»ºçš„æ¬¡æ•°å’Œæ—¶é—´&lt;/li&gt;
    &lt;li&gt;ç®€åŒ–çš„ç¼–ç¨‹æ¨¡å¼ã€‚å½“ä½¿ç”¨è¿æ¥æ± æ—¶ï¼Œæ¯ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹èƒ½å¤Ÿåƒåˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ JDBC è¿æ¥ä¸€æ ·æ“ä½œï¼Œå…è®¸ç”¨æˆ·ç›´æ¥ä½¿ç”¨ JDBC ç¼–ç¨‹æŠ€æœ¯&lt;/li&gt;
    &lt;li&gt;æ§åˆ¶èµ„æºçš„ä½¿ç”¨ã€‚å¦‚æœä¸ä½¿ç”¨è¿æ¥æ± ï¼Œæ¯æ¬¡è®¿é—®æ•°æ®åº“éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œè¿™æ ·ç³»ç»Ÿçš„ç¨³å®šæ€§å—ç³»ç»Ÿè¿æ¥éœ€æ±‚å½±å“å¾ˆå¤§ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿèµ„æºæµªè´¹å’Œé«˜è´Ÿè½½å¼‚å¸¸ã€‚è¿æ¥æ± èƒ½å¤Ÿä½¿æ€§èƒ½æœ€å¤§åŒ–ï¼Œå°†èµ„æºåˆ©ç”¨æ§åˆ¶åœ¨ä¸€å®šçš„æ°´å¹³ä¹‹ä¸‹ã€‚è¿æ¥æ± èƒ½æ§åˆ¶æ± ä¸­çš„è¿æ¥æ•°é‡ï¼Œå¢å¼ºäº†ç³»ç»Ÿåœ¨å¤§é‡ç”¨æˆ·åº”ç”¨æ—¶çš„ç¨³å®šæ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Javaæ•°æ®åº“è¿æ¥ï¼Œï¼ˆJava Database Connectivityï¼Œç®€ç§°JDBCï¼‰æ˜¯Javaè¯­è¨€ä¸­ç”¨æ¥è§„èŒƒå®¢æˆ·ç«¯ç¨‹åºå¦‚ä½•æ¥è®¿é—®æ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œæä¾›äº†è¯¸å¦‚æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®åº“ä¸­æ•°æ®çš„æ–¹æ³•ã€‚JDBCä¹Ÿæ˜¯Sun Microsystemsçš„å•†æ ‡ã€‚æˆ‘ä»¬é€šå¸¸è¯´çš„JDBCæ˜¯é¢å‘å…³ç³»å‹æ•°æ®åº“çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ•°é‡å¦‚ä½•è®¾ç½®&#34;&gt;æ•°é‡å¦‚ä½•è®¾ç½®&lt;/h3&gt;
&lt;p&gt;è¿æ¥æ•°é‡éœ€è¦æ ¹æ®å¹¶å‘æ•°ï¼Œä»¥åŠæ•°æ®åº“çš„å¤„ç†æƒ…å†µæ¥å†³å®šçš„ï¼Œå¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œæ¯”å¦‚ä½ çš„æ•°æ®åº“æœ€å¤§åªèƒ½å¤„ç†500ä¸ªè¿æ¥ï¼Œé‚£ä½ è®¾ç½®700ä¸ªï¼Œæ•°æ®åº“ç…§æ ·å¤„ç†ä¸è¿‡æ¥ï¼Œè®¾ç½®è¿‡å¤šå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„,åè€Œå¯èƒ½ä¼šè®©æ•°æ®åº“å®•æœºã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿æ¥æ± æ•°é‡ï¼Œä¹Ÿå°±æ˜¯æ€»æ•°ï¼Œéœ€è¦æ ¹æ®è¿›ç¨‹æ¥çœ‹ï¼Œæ¯ä¸ªè¿›ç¨‹ * è¿æ¥æ± é…ç½®æ•°é‡ = æ€»æ•°é‡ å¦‚ swoole ä¸­ worker è¿›ç¨‹ä¸º8ï¼Œé‚£ä½ è®¾ç½®20ä¸ªï¼Œåˆ™æ€»æ•°å°±æ˜¯ 8 * 20 = 160&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿æ¥æ± ä¸­åˆ°åº•åº”è¯¥æ”¾ç½®å¤šå°‘è¿æ¥ï¼Œæ‰èƒ½ä½¿ç³»ç»Ÿçš„æ€§èƒ½æœ€ä½³ï¼Ÿç³»ç»Ÿå¯é‡‡å–è®¾ç½®æœ€å°è¿æ¥æ•°ï¼ˆminConnectionï¼‰å’Œæœ€å¤§è¿æ¥æ•°ï¼ˆmaxConnectionï¼‰ç­‰å‚æ•°æ¥æ§åˆ¶è¿æ¥æ± ä¸­çš„è¿æ¥ã€‚æ¯”æ–¹è¯´ï¼Œæœ€å°è¿æ¥æ•°æ˜¯ç³»ç»Ÿå¯åŠ¨æ—¶è¿æ¥æ± æ‰€åˆ›å»ºçš„è¿æ¥æ•°ã€‚å¦‚æœåˆ›å»ºè¿‡å¤šï¼Œåˆ™ç³»ç»Ÿå¯åŠ¨å°±æ…¢ï¼Œä½†åˆ›å»ºåç³»ç»Ÿçš„å“åº”é€Ÿåº¦ä¼šå¾ˆå¿«ï¼›å¦‚æœåˆ›å»ºè¿‡å°‘ï¼Œåˆ™ç³»ç»Ÿå¯åŠ¨çš„å¾ˆå¿«ï¼Œå“åº”èµ·æ¥å´æ…¢ã€‚è¿™æ ·ï¼Œå¯ä»¥åœ¨å¼€å‘æ—¶ï¼Œè®¾ç½®è¾ƒå°çš„æœ€å°è¿æ¥æ•°ï¼Œå¼€å‘èµ·æ¥ä¼šå¿«ï¼Œè€Œåœ¨ç³»ç»Ÿå®é™…ä½¿ç”¨æ—¶è®¾ç½®è¾ƒå¤§çš„ï¼Œå› ä¸ºè¿™æ ·å¯¹è®¿é—®å®¢æˆ·æ¥è¯´é€Ÿåº¦ä¼šå¿«äº›ã€‚æœ€å¤§è¿æ¥æ•°æ˜¯è¿æ¥æ± ä¸­å…è®¸è¿æ¥çš„æœ€å¤§æ•°ç›®ï¼Œå…·ä½“è®¾ç½®å¤šå°‘ï¼Œè¦çœ‹ç³»ç»Ÿçš„è®¿é—®é‡ï¼Œå¯é€šè¿‡è½¯ä»¶éœ€æ±‚ä¸Šå¾—åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•ç¡®ä¿è¿æ¥æ± ä¸­çš„æœ€å°è¿æ¥æ•°å‘¢ï¼Ÿæœ‰åŠ¨æ€å’Œé™æ€ä¸¤ç§ç­–ç•¥ã€‚åŠ¨æ€å³æ¯éš”ä¸€å®šæ—¶é—´å°±å¯¹è¿æ¥æ± è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå‘ç°è¿æ¥æ•°é‡å°äºæœ€å°è¿æ¥æ•°ï¼Œåˆ™è¡¥å……ç›¸åº”æ•°é‡çš„æ–°è¿æ¥ï¼Œä»¥ä¿è¯è¿æ¥æ± çš„æ­£å¸¸è¿è½¬ã€‚é™æ€æ˜¯å‘ç°ç©ºé—²è¿æ¥ä¸å¤Ÿæ—¶å†å»æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä½•è¦ä½¿ç”¨&#34;&gt;ä¸ºä½•è¦ä½¿ç”¨&lt;/h3&gt;
&lt;ul&gt;
    &lt;li&gt;å‡è®¾ç½‘ç«™ä¸€å¤©æœ‰å¾ˆå¤§çš„è®¿é—®é‡ï¼Œæ•°æ®åº“æœåŠ¡å™¨å°±éœ€è¦ä¸ºæ¯æ¬¡è¿æ¥åˆ›å»ºä¸€æ¬¡æ•°æ®åº“è¿æ¥ï¼Œæå¤§çš„æµªè´¹æ•°æ®åº“çš„èµ„æºï¼Œå¹¶ä¸”ææ˜“é€ æˆæ•°æ®åº“æœåŠ¡å™¨å†…å­˜æº¢å‡ºã€å®•æœº&lt;/li&gt;
    &lt;li&gt;æ•°æ®åº“è¿æ¥æ˜¯ä¸€ç§å…³é”®çš„æœ‰é™çš„æ˜‚è´µçš„èµ„æºï¼Œè¿™ä¸€ç‚¹åœ¨å¤šç”¨æˆ·çš„ç½‘é¡µåº”ç”¨ç¨‹åºä¸­ä½“ç°çš„å°¤ä¸ºçªå‡ºã€‚å¯¹æ•°æ®åº“è¿æ¥çš„ç®¡ç†èƒ½æ˜¾è‘—å½±å“åˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ä¼¸ç¼©æ€§å’Œå¥å£®æ€§ï¼Œå½±å“åˆ°ç¨‹åºçš„æ€§èƒ½æŒ‡æ ‡ã€‚æ•°æ®åº“è¿æ¥æ± æ­£å¼é’ˆå¯¹è¿™ä¸ªé—®é¢˜æå‡ºæ¥çš„ã€‚æ•°æ®åº“è¿æ¥æ± è´Ÿè´£åˆ†é…ï¼Œç®¡ç†å’Œé‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºé‡å¤ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸æ˜¯é‡æ–°å»ºç«‹ä¸€ä¸ª&lt;/li&gt;
    &lt;li&gt;æ•°æ®åº“è¿æ¥æ± åœ¨åˆå§‹åŒ–æ—¶å°†åˆ›å»ºä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥æ”¾åˆ°è¿æ¥æ± ä¸­ï¼Œè¿™äº›æ•°æ®åº“è¿æ¥çš„æ•°é‡æ˜¯ç”±æœ€å°æ•°æ®åº“è¿æ¥æ•°æ¥è®¾å®šçš„ã€‚æ— è®ºè¿™äº›æ•°æ®åº“è¿æ¥æ˜¯å¦è¢«ä½¿ç”¨ï¼Œè¿æ¥æ± éƒ½å°†ä¸€ç›´ä¿è¯è‡³å°‘æ‹¥æœ‰è¿™ä¹ˆå¤šçš„è¿æ¥æ•°é‡ã€‚è¿æ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿æ¥æ•°é‡é™å®šäº†è¿™ä¸ªè¿æ¥æ± èƒ½å æœ‰çš„æœ€å¤§è¿æ¥æ•°ï¼Œå½“åº”ç”¨ç¨‹åºå‘è¿æ¥æ± è¯·æ±‚çš„è¿æ¥æ•°è¶…è¿‡æœ€å¤§è¿æ¥æ•°é‡æ—¶ï¼Œè¿™äº›è¯·æ±‚å°†è¢«åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¹¶å‘é—®é¢˜&#34;&gt;å¹¶å‘é—®é¢˜&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä½¿è¿æ¥ç®¡ç†æœåŠ¡å…·æœ‰æœ€å¤§çš„é€šç”¨æ€§ï¼Œå¿…é¡»è€ƒè™‘å¤šçº¿ç¨‹ç¯å¢ƒï¼Œå³å¹¶å‘é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜ç›¸å¯¹æ¯”è¾ƒå¥½è§£å†³ï¼Œå› ä¸ºå„ä¸ªè¯­è¨€è‡ªèº«æä¾›äº†å¯¹å¹¶å‘ç®¡ç†çš„æ”¯æŒåƒ java,c# ç­‰ç­‰ï¼Œä½¿ç”¨ synchronized (java) lock (C#) å…³é”®å­—å³å¯ç¡®ä¿çº¿ç¨‹æ˜¯åŒæ­¥çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;äº‹åŠ¡å¤„ç†&#34;&gt;äº‹åŠ¡å¤„ç†&lt;/h3&gt;
&lt;ul&gt;
    &lt;li&gt;DB è¿æ¥æ± å¿…é¡»è¦ç¡®ä¿æŸä¸€æ—¶é—´å†…ä¸€ä¸ª conn åªèƒ½åˆ†é…ç»™ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸åŒ conn çš„äº‹åŠ¡æ˜¯ç›¸äº’ç‹¬ç«‹çš„&lt;/li&gt;
    &lt;li&gt;äº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œæ­¤æ—¶è¦æ±‚å¯¹æ•°æ®åº“çš„æ“ä½œç¬¦åˆ â€œALL-ALL-NOTHINGâ€ åŸåˆ™ï¼Œå³å¯¹äºä¸€ç»„ SQL è¯­å¥è¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš&lt;/li&gt;
    &lt;li&gt;æˆ‘ä»¬çŸ¥é“å½“ï¼’ä¸ªçº¿ç¨‹å…±ç”¨ä¸€ä¸ªè¿æ¥ Connection å¯¹è±¡ï¼Œè€Œä¸”å„è‡ªéƒ½æœ‰è‡ªå·±çš„äº‹åŠ¡è¦å¤„ç†æ—¶å€™ï¼Œå¯¹äºè¿æ¥æ± æ˜¯ä¸€ä¸ªå¾ˆå¤´ç–¼çš„é—®é¢˜ï¼Œå› ä¸ºå³ä½¿ Connection ç±»æä¾›äº†ç›¸åº”çš„äº‹åŠ¡æ”¯æŒï¼Œå¯æ˜¯æˆ‘ä»¬ä»ç„¶ä¸èƒ½ç¡®å®šé‚£ä¸ªæ•°æ®åº“æ“ä½œæ˜¯å¯¹åº”é‚£ä¸ªäº‹åŠ¡çš„ï¼Œè¿™æ˜¯ç”±äºæˆ‘ä»¬æœ‰ï¼’ä¸ªçº¿ç¨‹éƒ½åœ¨è¿›è¡Œäº‹åŠ¡æ“ä½œè€Œå¼•èµ·çš„ã€‚ä¸ºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¯ä¸€ä¸ªäº‹åŠ¡ç‹¬å ä¸€ä¸ªè¿æ¥æ¥å®ç°ï¼Œè™½ç„¶è¿™ç§æ–¹æ³•æœ‰ç‚¹æµªè´¹è¿æ¥æ± èµ„æºä½†æ˜¯å¯ä»¥å¤§å¤§é™ä½äº‹åŠ¡ç®¡ç†çš„å¤æ‚æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å·¥ä½œåŸç†&#34;&gt;å·¥ä½œåŸç†&lt;/h3&gt;
&lt;p&gt;è¿æ¥æ± çš„å·¥ä½œåŸç†ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«ä¸ºè¿æ¥æ± çš„å»ºç«‹ã€è¿æ¥æ± ä¸­è¿æ¥çš„ä½¿ç”¨ç®¡ç†ã€è¿æ¥æ± çš„å…³é—­ã€‚&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;ç¬¬ä¸€ã€è¿æ¥æ± çš„å»ºç«‹ã€‚ä¸€èˆ¬åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼Œè¿æ¥æ± ä¼šæ ¹æ®ç³»ç»Ÿé…ç½®å»ºç«‹ï¼Œå¹¶åœ¨æ± ä¸­åˆ›å»ºäº†å‡ ä¸ªè¿æ¥å¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨æ—¶èƒ½ä»è¿æ¥æ± ä¸­è·å–ã€‚è¿æ¥æ± ä¸­çš„è¿æ¥ä¸èƒ½éšæ„åˆ›å»ºå’Œå…³é—­ï¼Œè¿™æ ·é¿å…äº†è¿æ¥éšæ„å»ºç«‹å’Œå…³é—­é€ æˆçš„ç³»ç»Ÿå¼€é”€ã€‚Java ä¸­æä¾›äº†å¾ˆå¤šå®¹å™¨ç±»å¯ä»¥æ–¹ä¾¿çš„æ„å»ºè¿æ¥æ± ï¼Œä¾‹å¦‚ Vectorã€Stack ç­‰&lt;/li&gt;
    &lt;li&gt;ç¬¬äºŒã€è¿æ¥æ± çš„ç®¡ç†ã€‚è¿æ¥æ± ç®¡ç†ç­–ç•¥æ˜¯è¿æ¥æ± æœºåˆ¶çš„æ ¸å¿ƒï¼Œè¿æ¥æ± å†…è¿æ¥çš„åˆ†é…å’Œé‡Šæ”¾å¯¹ç³»ç»Ÿçš„æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚å…¶ç®¡ç†ç­–ç•¥æ˜¯ï¼š
     &lt;ul&gt;
        &lt;li&gt;å½“å®¢æˆ·è¯·æ±‚æ•°æ®åº“è¿æ¥æ—¶ï¼Œé¦–å…ˆæŸ¥çœ‹è¿æ¥æ± ä¸­æ˜¯å¦æœ‰ç©ºé—²è¿æ¥ï¼Œå¦‚æœå­˜åœ¨ç©ºé—²è¿æ¥ï¼Œåˆ™å°†è¿æ¥åˆ†é…ç»™å®¢æˆ·ä½¿ç”¨ï¼›å¦‚æœæ²¡æœ‰ç©ºé—²è¿æ¥ï¼Œåˆ™æŸ¥çœ‹å½“å‰æ‰€å¼€çš„è¿æ¥æ•°æ˜¯å¦å·²ç»è¾¾åˆ°æœ€å¤§è¿æ¥æ•°ï¼Œå¦‚æœæ²¡è¾¾åˆ°å°±é‡æ–°åˆ›å»ºä¸€ä¸ªè¿æ¥ç»™è¯·æ±‚çš„å®¢æˆ·ï¼›å¦‚æœè¾¾åˆ°å°±æŒ‰è®¾å®šçš„æœ€å¤§ç­‰å¾…æ—¶é—´è¿›è¡Œç­‰å¾…ï¼Œå¦‚æœè¶…å‡ºæœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ç»™å®¢æˆ·&lt;/li&gt;
        &lt;li&gt;å½“å®¢æˆ·é‡Šæ”¾æ•°æ®åº“è¿æ¥æ—¶ï¼Œå…ˆåˆ¤æ–­è¯¥è¿æ¥çš„å¼•ç”¨æ¬¡æ•°æ˜¯å¦è¶…è¿‡äº†è§„å®šå€¼ï¼Œå¦‚æœè¶…è¿‡å°±ä»è¿æ¥æ± ä¸­åˆ é™¤è¯¥è¿æ¥ï¼Œå¦åˆ™ä¿ç•™ä¸ºå…¶ä»–å®¢æˆ·æœåŠ¡&lt;/li&gt;
        &lt;li&gt;è¯¥ç­–ç•¥ä¿è¯äº†æ•°æ®åº“è¿æ¥çš„æœ‰æ•ˆå¤ç”¨ï¼Œé¿å…é¢‘ç¹çš„å»ºç«‹ã€é‡Šæ”¾è¿æ¥æ‰€å¸¦æ¥çš„ç³»ç»Ÿèµ„æºå¼€é”€&lt;/li&gt;
    &lt;/ul&gt;
    &lt;/li&gt;
    &lt;li&gt;ç¬¬ä¸‰ã€è¿æ¥æ± çš„å…³é—­ã€‚å½“åº”ç”¨ç¨‹åºé€€å‡ºæ—¶ï¼Œå…³é—­è¿æ¥æ± ä¸­æ‰€æœ‰çš„è¿æ¥ï¼Œé‡Šæ”¾è¿æ¥æ± ç›¸å…³çš„èµ„æºï¼Œè¯¥è¿‡ç¨‹æ­£å¥½ä¸åˆ›å»ºç›¸å&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä½¿ç”¨-swoole-å®ç°ç®€å•çš„-redisè¿æ¥æ± &#34;&gt;ä½¿ç”¨ Swoole å®ç°ç®€å•çš„ Redisè¿æ¥æ± &lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php
use http\Exception\RuntimeException;
class Pool
{
    protected static $instance;

    public static function i() :self
    {
        return static::$instance ?? (static::$instance = new static);
    }

    protected $channel;

    public function __construct(int $size = 10)
    {
        $this-&amp;gt;channel = new Swoole\Coroutine\Channel($size);

        while ($size--) {
            // åç¨‹ Redis å®¢æˆ·ç«¯
            $redis = new Swoole\Coroutine\Redis;
            $res = $redis-&amp;gt;connect(&#39;127.0.0.1&#39;, 6379);
            if ($res) {
                // pull
                $this-&amp;gt;put($redis);
            } else {
                // æŠ›å…¥å¼‚å¸¸æˆ–è€…åšé”™è¯¯å¤„ç†æˆ–è€…é‡è¯•
                throw new RuntimeException($res-&amp;gt;errMsg, $res-&amp;gt;errCode);
            }
        }
    }

    // å…¥åˆ—
    public function put(Swoole\Coroutine\Redis $redis): void
    {
        $this-&amp;gt;channel-&amp;gt;push($redis);
    }

    // å‡ºåˆ—
    public function get($timeout = -1): ?Swoole\Coroutine\Redis
    {
        return $this-&amp;gt;channel-&amp;gt;pop($timeout) ?: null;
    }

    // å…³é—­
    public function close(): void
    {
        $this-&amp;gt;channel-&amp;gt;close();
    }
}

// ä½¿ç”¨äº† Co\run() æ¥åˆ›å»ºä¸€ä¸ªåç¨‹å®¹å™¨
Co\run(function() {
    $pool = Pool::i();
    $redis = $pool-&amp;gt;get();
//    $redis-&amp;gt;set(&#39;foo&#39;, &#39;å°ç†Š&#39;);
    $value = $redis-&amp;gt;get(&#39;foo&#39;);
    if ($value === false) {
        throw new RuntimeException($redis-&amp;gt;errMsg, $redis-&amp;gt;errCode);
    }
    echo $value;
    $pool-&amp;gt;put($redis);
});
&lt;/code&gt;&lt;/pre&gt;
">è¿æ¥æ± </a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/redis-shi-xian-xiao-xi-dui-lie/"" data-c="
          &lt;h2 id=&#34;æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»€ä¹ˆ&#34;&gt;æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»€ä¹ˆ&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/code&gt;ï¼šæŠŠè¦ä¼ è¾“çš„æ•°æ®æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚æ¶ˆæ¯æ˜¯ä¸¤ä¸ªæœåŠ¡ä¹‹é—´æ²Ÿé€šçš„åª’ä»‹ï¼Œé˜Ÿåˆ—å°±æ˜¯ä¸¤ä¸ªæœåŠ¡ä¹‹é—´è¿›è¡Œæ²Ÿé€šæ¶ˆæ¯çš„è½½ä½“æˆ–å®¹å™¨ã€‚ï¼ˆæŠŠæ•°æ®æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—å«åš&lt;b&gt;ç”Ÿäº§è€…&lt;/b&gt;ï¼Œä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢å–æ•°æ®å«åš&lt;b&gt;æ¶ˆè´¹è€…&lt;/b&gt;ï¼‰&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624000927881.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;ç”Ÿäº§è€…ï¼ˆproducerï¼‰ï¼šç”¨äºç»„è£…æ¶ˆæ¯ï¼Œå¹¶å°†ç»„è£…çš„æ¶ˆæ¯é€šè¿‡ lpushï¼ˆå·¦è¿›ï¼‰çš„æ–¹å¼å‹å…¥é˜Ÿåˆ—ï¼Œä¾›æ¶ˆè´¹è€…æ¶ˆè´¹æ­¤æ¶ˆæ¯&lt;/li&gt;
    &lt;li&gt;æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ï¼šç”¨äºå°†é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æŒ‰ç…§&lt;b&gt;å…ˆè¿›å…ˆå‡º&lt;/b&gt; rpopï¼ˆå³è¿›ï¼‰ çš„åŸåˆ™å¼¹å‡ºé˜Ÿåˆ—å®¹å™¨ä¸­&lt;/li&gt;
    &lt;li&gt;é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼šç”¨äºæ‰¿è½½æ¶ˆæ¯çš„è½½ä½“ï¼Œåœ¨é˜Ÿåˆ—é‡Œé¢ï¼Œè¢«ç”Ÿäº§è€…å‹å…¥çš„æ¶ˆæ¯æŒ‰ç…§ä¸€å®šé¡ºåºè¿›è¡Œå­˜æ”¾ï¼Œä¿è¯æœ‰åºæ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—&lt;/h2&gt;
&lt;p&gt;å¸¸ç”¨äºè§£å†³å¹¶å‘ç³»ç»Ÿä¸­èµ„æºçš„ä¸€è‡´æ€§é—®é¢˜ï¼ˆè¶…å–ï¼‰ï¼Œæå‡å³°å€¼çš„å¤„ç†èƒ½åŠ›ï¼ŒåŒæ—¶ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€å¯æ¢å¤æ€§ã€å¿…é€è¾¾æ€§ã€‚&lt;br&gt;
æ ¸å¿ƒä½œç”¨ï¼š&lt;code&gt;å¼‚æ­¥&lt;/code&gt;ï¼Œ&lt;code&gt;è§£è€¦&lt;/code&gt;ï¼Œ&lt;code&gt;å‰Šå³°&lt;/code&gt;ã€‚&lt;br&gt;
ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;å¼‚æ­¥å¤„ç†ï¼ˆçŸ­ä¿¡é€šçŸ¥ï¼Œç»ˆç«¯çŠ¶æ€æ¨é€ï¼ŒAPPæ¨é€ï¼Œç”¨æˆ·æ³¨å†Œï¼‰&lt;/li&gt;
    &lt;li&gt;æ•°æ®åŒæ­¥ï¼ˆä¸šåŠ¡æ•°æ®æ¨é€åŒæ­¥ï¼‰&lt;/li&gt;
    &lt;li&gt;é‡è¯•è¡¥å¿ï¼ˆè®°è´¦å¤±è´¥é‡è¯•ï¼‰&lt;/li&gt;
    &lt;li&gt;ç³»ç»Ÿè§£è€¦ï¼ˆé€šè®¯ä¸Šä¸‹è¡Œï¼Œç»ˆç«¯å¼‚å¸¸ç›‘æ§ï¼Œåˆ†å¸ƒå¼äº‹ä»¶ä¸­å¿ƒï¼Œè®¢å•ä»“å‚¨ç‰©æµï¼‰&lt;/li&gt;
    &lt;li&gt;æµé‡å‰Šå³°ï¼ˆç§’æ€åœºæ™¯ä¸‹çš„ä¸‹å•å¤„ç†ï¼‰&lt;/li&gt;
    &lt;li&gt;å‘å¸ƒè®¢é˜…ï¼ˆæœåŠ¡çŠ¶æ€çš„å˜åŒ–é€šçŸ¥ï¼Œåˆ†å¸ƒå¼äº‹ä»¶ä¸­å¿ƒï¼‰&lt;/li&gt;
    &lt;li&gt;é«˜å¹¶å‘ç¼“å†²ï¼ˆæ—¥å¿—æœåŠ¡ï¼Œç›‘æ§ä¸ŠæŠ¥ï¼‰&lt;/li&gt;
&lt;/ul&gt;
ç¼ºç‚¹ï¼š
&lt;ul&gt;
    &lt;li&gt;ç³»ç»Ÿå¯ç”¨æ€§é™ä½ï¼Œç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤š&lt;/li&gt;
    &lt;li&gt;ç³»ç»Ÿå¤æ‚åº¦æé«˜&lt;/li&gt;
    &lt;li&gt;ä¸€è‡´æ€§é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºäº-list-çš„-lpush-rpop-å®ç°çš„ç”Ÿäº§æ¶ˆè´¹æ¨¡å¼&#34;&gt;åŸºäº list çš„ lpush + rpop å®ç°çš„ç”Ÿäº§/æ¶ˆè´¹æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;ä½å»¶è¿Ÿï¼ˆæ¶ˆæ¯å‡ ä¹æ— å»¶è¿Ÿï¼‰&lt;/li&gt;
&lt;/ul&gt;
ç¼ºç‚¹ï¼š
&lt;ul&gt;
    &lt;li&gt;åšæ¶ˆè´¹è€…ç¡®è®¤ ACK éº»çƒ¦ï¼Œä¸èƒ½ä¿è¯æ¶ˆè´¹è€…æ¶ˆè´¹ä¿¡æ¯åæ˜¯å¦æˆåŠŸå¤„ç†çš„é—®é¢˜ï¼ˆå®•æœºæˆ–å¤„ç†å¼‚å¸¸ç­‰ï¼‰ï¼Œé€šå¸¸éœ€è¦ç»´æŠ¤ä¸€ä¸ª Pendingï¼ˆç­‰å¾…ï¼‰åˆ—è¡¨ï¼Œä¿è¯æ¶ˆæ¯å¤„ç†ç¡®è®¤&lt;/li&gt;
    &lt;li&gt;ä¸æ”¯æŒåˆ†ç»„æ¶ˆè´¹&lt;/li&gt;
    &lt;li&gt;ä¸èƒ½é‡å¤æ¶ˆè´¹ï¼Œä¸€æ—¦æ¶ˆè´¹å°±ä¼šåˆ é™¤&lt;/li&gt;
    &lt;li&gt;ä¸èƒ½åšå¹¿æ’­æ¨¡å¼ï¼Œå¦‚ pub/subï¼Œæ¶ˆæ¯å‘å¸ƒ/è®¢é˜…æ¨¡å‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºäº-pubsub-çš„å‘å¸ƒè®¢é˜…æ¨¡å¼&#34;&gt;åŸºäº pub/sub çš„å‘å¸ƒ/è®¢é˜…æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;æ­¤æ¨¡å¼å…è®¸ç”Ÿäº§è€…åªç”Ÿäº§ä¸€æ¬¡æ¶ˆæ¯ï¼Œç”±ä¸­é—´ä»¶è´Ÿè´£å°†æ¶ˆæ¯å¤åˆ¶åˆ°å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ç”±å¯¹åº”çš„æ¶ˆè´¹è€…ç»„æˆæ¶ˆè´¹ã€‚&lt;br&gt;
&lt;code&gt;pub/sub&lt;/code&gt; æ¨¡å¼ä¸é€‚åˆåšæ¶ˆæ¯å­˜å‚¨ï¼Œæ¶ˆæ¯ç§¯å‹ç±»çš„ä¸šåŠ¡ï¼Œè€Œæ˜¯æ“…é•¿å¤„ç†å¹¿æ’­ï¼Œå³æ—¶é€šè®¯ï¼Œå³æ—¶åé¦ˆçš„ä¸šåŠ¡ã€‚&lt;br&gt;
ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;å…¸å‹çš„å¹¿æ’­æ¨¡å¼ï¼Œä¸€ä¸ªæ¶ˆæ¯å¯ä»¥å‘å¸ƒåˆ°å¤šä¸ªæ¶ˆè´¹è€…&lt;/li&gt;
    &lt;li&gt;å¤šä¿¡é“è®¢é˜…ï¼Œæ¶ˆè´¹è€…å¯ä»¥åŒæ—¶è®¢é˜…å¤šä¸ªä¿¡é“ï¼Œä»è€Œæ¥æ”¶å¤šç±»æ¶ˆæ¯&lt;/li&gt;
    &lt;li&gt;æ¶ˆæ¯å³æ—¶å‘é€ï¼Œæ¶ˆæ¯ä¸ç”¨ç­‰å¾…æ¶ˆè´¹è€…è¯»å–ï¼Œæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æ¥æ”¶åˆ°ä¿¡é“å‘å¸ƒçš„æ¶ˆæ¯&lt;/li&gt;
&lt;/ul&gt;
ç¼ºç‚¹ï¼š
&lt;ul&gt;
    &lt;li&gt;æ¶ˆæ¯ä¸€æ—¦å‘å¸ƒï¼Œä¸èƒ½æ¥æ”¶ã€‚æ¢å¥è¯è¯´å°±æ˜¯å‘å¸ƒæ—¶è‹¥å®¢æˆ·ç«¯ä¸åœ¨çº¿ï¼Œåˆ™æ¶ˆæ¯ä¸¢å¤±ï¼Œä¸èƒ½å¯»å›&lt;/li&gt;
    &lt;li&gt;è‹¥æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‡ºç°æ¶ˆæ¯ç§¯å‹ï¼Œåˆ°ä¸€å®šç¨‹åº¦ï¼Œä¼šè¢«å¼ºåˆ¶æ–­å¼€ï¼Œå¯¼è‡´æ¶ˆæ¯æ„å¤–ä¸¢å¤±ã€‚é€šå¸¸å‘ç”Ÿåœ¨æ¶ˆæ¯çš„ç”Ÿäº§è¿œå¤§äºæ¶ˆè´¹é€Ÿåº¦æ—¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŸºäº &lt;code&gt;list&lt;/code&gt; å®ç°çš„ç”Ÿäº§ / æ¶ˆè´¹æ¨¡å¼é˜Ÿåˆ—ï¼Œåœ¨åº”ç”¨ä¸­ä½¿ç”¨åœºæ™¯æœ€ä¸ºå¹¿æ³›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;class Queue
    /**
     * å‡†å¤‡å¤„ç†æ¶ˆæ¯key
     */
    public static $todoKey = &#39;TO_SEND_MSG&#39;;

    /**
     * å¤„ç†ä¸­æ¶ˆæ¯key
     */
    public static $doingKey = &#39;SENDING_MSG&#39;;

    /**
     * æ— é™åˆ¶é˜»å¡
     */
    public static $timeout = 0;

    ...
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç”Ÿäº§è€…å®ç°&#34;&gt;ç”Ÿäº§è€…å®ç°&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt; /**
     * ç”Ÿäº§è€…
     */
    public function producer()
    {
        $userArr = [
          &#39;user1@mail.com&#39;,
          &#39;user2@mail.com&#39;,
          &#39;user3@mail.com&#39;,
          &#39;user4@mail.com&#39;,
          &#39;user5@mail.com&#39;,
        ];

        Redis::lpush(self::$todoKey, ...$userArr);
        dd(&#39;ç”Ÿäº§è€…ç”Ÿäº§ç»“æŸï¼&#39;);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å¦‚ä½•æ¶ˆè´¹&#34;&gt;å¦‚ä½•æ¶ˆè´¹&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æ¶ˆè´¹è§¦å‘æ–¹å¼&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;ç‰¹ç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ­»å¾ªç¯æ–¹å¼è¯»å–&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ˜“å®ç°ï¼Œæ•…éšœæ—¶æ— æ³•åŠæ—¶æ¢å¤ï¼ˆæ¯”è¾ƒé€‚åˆåšç§’æ€ï¼Œæ¯”è¾ƒé›†ä¸­ï¼Œè¿ç»´é›†ä¸­ç»´æŠ¤ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å®šæ—¶ä»»åŠ¡&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‹åŠ›å‡åˆ†ï¼Œæœ‰å¤„ç†ä¸Šé™ï¼›ï¼ˆéœ€è¦åˆç†è®¾ç½®æ—¶é—´é—´éš”ï¼Œä¸è¦ç­‰ä¸Šä¸€ä¸ªä»»åŠ¡æ²¡æœ‰å®Œæˆä¸‹ä¸€ä¸ªä»»åŠ¡åˆå¼€å§‹äº†ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å®ˆæŠ¤è¿›ç¨‹&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç±»ä¼¼äº php-fpm å’Œ php-cg, éœ€è¦ shell åŸºç¡€ï¼Œå®ç°æˆæœ¬è¾ƒé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;æ¶ˆè´¹è€…1&#34;&gt;æ¶ˆè´¹è€…1&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;    public function consumer1()
    {
        /**
         * å¾ªç¯æ‰§è¡Œæ¶ˆè´¹
         */
        while (true) {
            $msg = Redis::rpop(self::$todoKey);
            if ($msg) {
                // TODO å‘é€æ¶ˆæ¯ä¸šåŠ¡
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å­˜åœ¨çš„é—®é¢˜ï¼šå½“ &lt;code&gt;self::$todoKey&lt;/code&gt; ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹æœåŠ¡å°†ä¼šå¯†é›†çš„å‘ &lt;code&gt;redis&lt;/code&gt; æœåŠ¡é‡å¤æ‰§è¡Œ &lt;code&gt;rpop&lt;/code&gt; å‘½ä»¤ï¼Œé€ æˆèµ„æºçš„æµªè´¹ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½æœ‰ä¸¥é‡æŠ˜æŸï¼Œå¯ä»¥é€‚å½“ &lt;code&gt;sleep&lt;/code&gt; ä¸€æ®µæ—¶é—´&lt;/p&gt;
&lt;h3 id=&#34;æ¶ˆè´¹è€…2&#34;&gt;æ¶ˆè´¹è€…2&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;    public function consumer2()
    {
        /**
         * å¾ªç¯æ‰§è¡Œæ¶ˆè´¹
         */
        while (true) {
            $msg = Redis::rpop(self::$todoKey);
            if ($msg) {
                // TODO å‘é€æ¶ˆæ¯ä¸šåŠ¡
            } else {
                // ç­‰å¾…10s
                sleep(10);
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å­˜åœ¨çš„é—®é¢˜ï¼šå¦‚æœæœ‰æ¶ˆæ¯åœ¨å…¥é˜Ÿçš„æƒ…å†µä¸‹ï¼Œç¨‹åºè¿˜å¤„äºé˜»å¡çŠ¶æ€ &lt;code&gt;sleep&lt;/code&gt;ï¼Œç¨‹åºå°†ä¼šæ— æ³•åŠæ—¶å“åº”æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŠæ—¶æ€§ä¼šå¤§æ‰“æŠ˜æ‰£ï¼ˆæ’é™¤ä¸šåŠ¡å…è®¸å»¶è¿Ÿçš„æƒ…å†µï¼‰&lt;/p&gt;
&lt;h3 id=&#34;æ¶ˆè´¹è€…3&#34;&gt;æ¶ˆè´¹è€…3&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;    public function consumer3()
    {
        /**
         * å¾ªç¯æ‰§è¡Œæ¶ˆè´¹
         */
        while (true) {
            // timeout=0 æ— é™åˆ¶é˜»å¡å¼æ¶ˆè´¹
            // ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢
            $msg = Redis::brpop(self::$todoKey, self::$timeout);
            if ($msg) {
                // TODO å‘é€æ¶ˆæ¯ä¸šåŠ¡
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å­˜åœ¨çš„é—®é¢˜ï¼šå¦‚æœæ¶ˆè´¹æœåŠ¡ç«¯å‡ºç°å¼‚å¸¸ï¼Œç”±äºæœåŠ¡ç«¯æ²¡æœ‰è¿›è¡Œå¤‡ä»½ï¼Œé‚£ä¹ˆå°†ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±&lt;/p&gt;
&lt;h3 id=&#34;æ¶ˆè´¹è€…4&#34;&gt;æ¶ˆè´¹è€…4&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;public function consumer4()
    {
        while (true) {
            do {
                // å¾ªç¯é˜»é˜»å¡æ‰§è¡Œï¼Œæ¶ˆè´¹ç«¯å–åˆ°æ¶ˆæ¯çš„åŒæ—¶ï¼ŒåŸå­æ€§çš„æŠŠè¯¥æ¶ˆæ¯æ”¾å…¥ä¸€ä¸ªæ­£åœ¨å¤„ç†ä¸­çš„$doingKeyåˆ—è¡¨ï¼ˆè¿›è¡Œå¤‡ä»½ï¼‰
                // ä»åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå°†å¼¹å‡ºçš„å…ƒç´ æ’å…¥åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒï¼› å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢
                $msg = Redis::brpoplpush(self::$todoKey, self::$doingKey, self::$timeout);
                try {
                    // TODO å‘é€æ¶ˆæ¯ä¸šåŠ¡
                    // ä¸šåŠ¡æœªå‡ºç°å¼‚å¸¸ï¼Œå¤„ç†å®Œä¸šåŠ¡åï¼Œåˆ™ä»æ­£åœ¨å¤„ç†çš„listä¸­åˆ é™¤å½“å‰å¤„ç†çš„æ¶ˆæ¯,ç›´åˆ°å¤„ç†ä¸­ list æ¶ˆæ¯ä¸ºç©º
                    Redis::lrem(self::$doingKey, 1, $msg);
                } catch (\Exception $e) {
                    // TODO å¼‚å¸¸
                    /**
                     * ä¸šåŠ¡å‡ºç°å¼‚å¸¸ï¼Œå¤„ç†å¼‚å¸¸
                     * é€šå¸¸å¤„ç†å¼‚å¸¸æœ‰ä¸¤ç§æ–¹æ³•
                     * 1.å°†å¼‚å¸¸æ¶ˆæ¯é‡æ–°æ”¾åˆ°å¾…æ¶ˆè´¹$todoKeyçš„ list ä¸­
                     * 2.å•ç‹¬å¤„ç†å¼‚å¸¸æ¶ˆæ¯ï¼ˆå¦‚å‘é€é‚®ä»¶é€šçŸ¥ï¼Œäººå·¥å¤„ç†ï¼‰
                     * 3.å•ç‹¬èµ·ä¸€ä¸ªè„šæœ¬ç¨‹åºï¼Œå¤„ç†é•¿æ—¶é—´å­˜åœ¨äº$doingKey listä¸­çš„æ¶ˆæ¯
                     */
                }
            } while (Redis::llen(self::$todoKey) || Redis::llen(self::$doingKey));
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ°æ­¤æ—¶ï¼Œé˜Ÿåˆ—å·²ç»æ»¡è¶³äº†å®‰å…¨å’Œæ€§èƒ½ï¼ˆé«˜å¯ç”¨ï¼‰çš„éœ€æ±‚&lt;br&gt;
ä¸Šé¢ä»£ç ä¸­åˆ©ç”¨ &lt;code&gt;brpoplpush&lt;/code&gt; åœ¨æ¶ˆè´¹ç«¯å–åˆ°æ¶ˆæ¯çš„åŒæ—¶åŸå­æ€§çš„æŠŠè¯¥æ¶ˆæ¯æ”¾å…¥ä¸€ä¸ªæ­£åœ¨å¤„ç†ä¸­çš„ $doingKey åˆ—è¡¨ä¸­ï¼ˆè¿›è¡Œå¤‡ä»½ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;å¦‚æœå¤„ç†ä¸šåŠ¡æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆä¸šåŠ¡å¤„ç†å®Œæˆåä»æ­£åœ¨å¤„ç†ä¸­çš„ $doingKey åˆ—è¡¨ lrem åˆ é™¤å½“å‰å·²ç»å¤„ç† ok çš„æ¶ˆæ¯&lt;/li&gt;
    &lt;li&gt;å¦‚æœå¤„ç†ä¸šåŠ¡å‡ºç°å¼‚å¸¸ï¼Œæˆ‘ä»¬å·²ç»åœ¨å¤„ç†ä¸­çš„ $doingKey åˆ—è¡¨ä¸­å¤‡ä»½äº†å¼‚å¸¸æ¶ˆæ¯ï¼Œå¯¹äºå¼‚å¸¸çš„æ¶ˆæ¯ï¼Œæ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å®ç°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—&lt;/h2&gt;
&lt;p&gt;ç”Ÿäº§è€…æŠŠæ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä»¥åï¼Œå¹¶ä¸æœŸæœ›è¢«ç«‹å³æ¶ˆè´¹ï¼Œè€Œæ˜¯ç­‰å¾…æŒ‡å®šæ—¶é—´åæ‰å¯ä»¥è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œè¿™ç±»æ¶ˆæ¯é€šå¸¸è¢«ç§°ä¸º&lt;b&gt;å»¶è¿Ÿæ¶ˆæ¯&lt;/b&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ—¶å€™éœ€è¦&#34;&gt;ä»€ä¹ˆæ—¶å€™éœ€è¦&lt;/h3&gt;
&lt;p&gt;æ•°æ®é‡å¤§ï¼Œå¯¹å®æ—¶æ€§è¦æ±‚å¹¶ä¸é«˜&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯&#34;&gt;åœºæ™¯&lt;/h3&gt;
&lt;ul&gt;
    &lt;li&gt;æœ‰æ•ˆæœŸï¼šé™æ—¶æ´»åŠ¨ï¼Œæ‹¼å›¢&lt;/li&gt;
    &lt;li&gt;è¶…æ—¶å¤„ç†ï¼šå–æ¶ˆè¶…æ—¶æœªæ”¯ä»˜è®¢å•ï¼Œè¶…æ—¶è‡ªåŠ¨ç¡®è®¤æ”¶è´§&lt;/li&gt;
    &lt;li&gt;å»¶è¿Ÿå¤„ç†ï¼šæœºå™¨äººç‚¹èµ / è§‚çœ‹æ•° / è¯„è®º / å…³æ³¨ï¼Œç­‰å¾…ä¾èµ–æ¡ä»¶&lt;/li&gt;
    &lt;li&gt;é‡è¯•ï¼šç½‘ç»œå¼‚å¸¸é‡è¯•ï¼Œæ‰“è½¦æ´¾å•ï¼Œä¾èµ–æ¡ä»¶ä¸ºæ»¡è¶³é‡è¯•&lt;/li&gt;
    &lt;li&gt;å®šæ—¶ä»»åŠ¡ï¼šæ™ºèƒ½è®¾å¤‡å®šæ—¶å¯åŠ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åŸºäº-key-çš„è¿‡æœŸç›‘å¬&#34;&gt;åŸºäº key çš„è¿‡æœŸç›‘å¬&lt;/h3&gt;
&lt;p&gt;å®ç°åŸç†ï¼šåœ¨Redis2.8ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œå½“æˆ‘ä»¬å°†&amp;lt;key, value&amp;gt;å¯¹ä½¿ç”¨Redisç¼“å­˜èµ·æ¥å¹¶è®¾ç½®ç¼“å­˜å¤±æ•ˆæ—¶é—´çš„æ—¶å€™ï¼Œä¼šè§¦å‘Redisçš„é”®äº‹ä»¶é€šçŸ¥ï¼Œå®¢æˆ·ç«¯è®¢é˜…è¿™ä¸ªé€šçŸ¥äº‹ä»¶ï¼ŒæœåŠ¡ç«¯ä¼šå°†å¯¹åº”çš„é€šçŸ¥äº‹ä»¶å‘é€ç»™æ¯ä¸ªè®¢é˜…çš„å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯æ ¹æ®æ”¶åˆ°çš„é€šçŸ¥ï¼Œåšç›¸åº”çš„åç»­å¤„ç†(ä¾‹å¦‚ï¼šé”®è¿‡æœŸæ—¶é—´é€šçŸ¥å¯¹åº”çš„topicä¸º:â€œkeyevent@0:expiredâ€)&lt;/p&gt;
&lt;p&gt;åœ¨ redis.conf è®¾ç½®&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;notify-keyspace-events Ex
 
# xä»£è¡¨è¿‡æœŸ
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®ç°æ€è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œå¼€å¯å¯¹ä»»åŠ¡ key (å¦‚ï¼šæœªæ”¯ä»˜è®¢å•å•å·) çš„ watchï¼ˆç›‘è§†ï¼‰&lt;/li&gt;
    &lt;li&gt;ä¸€æ—¦ key è¿‡æœŸï¼ˆè®¢å•æœªæ”¯ä»˜è¶…æ—¶æ—¶é—´ï¼‰ï¼Œè§¦å‘ eventï¼ˆäº‹ä»¶ï¼‰ è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆå–æ¶ˆè®¢å•ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•å¤„ç†èµ·æ¥ç®€å•ï¼Œä½†æ˜¯åœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ¡ˆå¯¹æ€§èƒ½å½±å“è¾ƒå¤§&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;rediså®ä¾‹åŒ–ç±»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;//é‡åˆ°ç±»åˆ«é‡å¤çš„æŠ¥é”™ï¼Œæ‰€æœ‰å«Redis2
class Redis2   
{
    private $redis;
 
    public function __construct($host = &#39;127.0.0.1&#39;, $port = 6379)
    {
        $this-&amp;gt;redis = new Redis();
        $this-&amp;gt;redis-&amp;gt;connect($host, $port);
    }
 
    public function setex($key, $time, $val)
    {
        return $this-&amp;gt;redis-&amp;gt;setex($key, $time, $val);
    }
 
    public function set($key, $val)
    {
        return $this-&amp;gt;redis-&amp;gt;set($key, $val);
    }
 
    public function get($key)
    {
        return $this-&amp;gt;redis-&amp;gt;get($key);
    }
 
    public function expire($key = null, $time = 0)
    {
        return $this-&amp;gt;redis-&amp;gt;expire($key, $time);
    }
 
    public function psubscribe($patterns = array(), $callback)
    {
        $this-&amp;gt;redis-&amp;gt;psubscribe($patterns, $callback);
    }
 
    public function setOption()
    {
        $this-&amp;gt;redis-&amp;gt;setOption(\Redis::OPT_READ_TIMEOUT, -1);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿‡æœŸäº‹ä»¶çš„è®¢é˜…ï¼špsubscribe.php&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;require_once &#39;./Redis.class.php&#39;;
$redis = new \Redis2();
// è§£å†³Rediså®¢æˆ·ç«¯è®¢é˜…æ—¶å€™è¶…æ—¶æƒ…å†µ
$redis-&amp;gt;setOption();
$redis-&amp;gt;psubscribe(array(&#39;__keyevent@0__:expired&#39;), &#39;keyCallback&#39;);
// å›è°ƒå‡½æ•°,è¿™é‡Œå†™å¤„ç†é€»è¾‘
function keyCallback($redis, $pattern, $chan, $msg)
{
    echo &amp;quot;Pattern: $pattern\n&amp;quot;;
    echo &amp;quot;Channel: $chan\n&amp;quot;;
    echo &amp;quot;Payload: $msg\n\n&amp;quot;;
    //keyCallbackä¸ºè®¢é˜…äº‹ä»¶åçš„å›è°ƒå‡½æ•°ï¼Œè¿™é‡Œå†™ä¸šåŠ¡å¤„ç†é€»è¾‘ï¼Œ
    //æ¯”å¦‚å‰é¢æåˆ°çš„å•†å“ä¸æ”¯ä»˜è‡ªåŠ¨æ’¤å•ï¼Œè¿™é‡Œå°±å¯ä»¥æ ¹æ®è®¢å•id,æ¥å®ç°è‡ªåŠ¨æ’¤å• 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è®¾ç½®è¿‡æœŸäº‹ä»¶ï¼šindex.php&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;require_once &#39;./Redis.class.php&#39;;
$redis = new \Redis2();
$order_id = 123;
$redis-&amp;gt;setex(&#39;order_id&#39;,10,$order_id);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…ˆç”¨å‘½ä»¤è¡Œæ¨¡å¼æ‰§è¡Œ psubscribe.php&lt;br&gt;
åœ¨æµè§ˆå™¨è®¿é—® index.php&lt;/p&gt;
&lt;h3 id=&#34;åŸºäº-zset-é›†åˆ&#34;&gt;åŸºäº zset é›†åˆ&lt;/h3&gt;
&lt;p&gt;å®ç°æ€è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;åˆ©ç”¨ zadd å‘é›†åˆä¸­æ’å…¥å…ƒç´ ï¼Œä»¥å…ƒç´ ï¼ˆè®¢å•ï¼‰çš„æ—¶é—´æˆ³ï¼ˆè¶…æ—¶æ—¶é—´ï¼‰ä½œä¸º score&lt;/li&gt;
    &lt;li&gt;åˆ©ç”¨ zrangebyscore ä»¥ã€0 - å½“å‰æ—¶é—´æˆ³ã€‘è¿›è¡Œè·å–éœ€è¦å¤„ç†çš„å…ƒç´ ï¼ˆå³ä¸ºè¶…æ—¶å¾…å¤„ç†è®¢å•&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;zrangebyscore è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåˆ†æ•°åŒºé—´çš„æˆå‘˜åˆ—è¡¨ã€‚æœ‰åºé›†æˆå‘˜æŒ‰åˆ†æ•°å€¼é€’å¢(ä»å°åˆ°å¤§)æ¬¡åºæ’åˆ—&lt;br&gt;
è¿™ç§æ–¹æ³•ç›¸è¾ƒäºä¸Šé¢æ–¹æ³•ï¼Œå®ç°è¾ƒä¸ºå¤æ‚ï¼Œä½†æ˜¯å¯¹æ€§èƒ½ä¿è¯è¾ƒå¥½ï¼Œå› æ­¤æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„å»¶è¿Ÿé˜Ÿåˆ—å®ç°æ–¹æ¡ˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;ç”Ÿæˆè€…&#34;&gt;ç”Ÿæˆè€…&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;    /**
     * ç”Ÿäº§
     */
    public function producer()
    {
        $orderMap = [
            &#39;orderNo.1&#39; =&amp;gt; time() + 10,//è®¢å•1éœ€è¦10sä¹‹åè¿›è¡Œæ¶ˆè´¹å¤„ç†
            &#39;orderNo.2&#39; =&amp;gt; time() + 100,//è®¢å•2éœ€è¦100sä¹‹åè¿›è¡Œæ¶ˆè´¹å¤„ç†
            &#39;orderNo.3&#39; =&amp;gt; time() + 1000,//è®¢å•3éœ€è¦1000sä¹‹åè¿›è¡Œæ¶ˆè´¹å¤„ç†
        ];
        Redis::connection()-&amp;gt;zadd(self::$delayKey, $orderMap);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ©ç”¨ &lt;code&gt;zadd&lt;/code&gt;ï¼Œä»¥å»¶è¿Ÿæ—¶é—´æˆ³ä½œä¸º &lt;code&gt;score&lt;/code&gt;ï¼Œå…ƒç´ å”¯ä¸€æ ‡å¿—ï¼ˆè®¢å•å·ä¸é‡å¤ï¼‰ä½œä¸º &lt;code&gt;value&lt;/code&gt;ï¼Œå‘éœ€è¦å¤„ç†çš„ &lt;code&gt;key&lt;/code&gt; ä¸­æ’å…¥å…ƒç´ &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºæ˜¯é›†åˆï¼Œå› æ­¤éœ€è¦ä¿è¯é›†åˆå…ƒç´ çš„å”¯ä¸€æ€§ï¼ˆscore å¯ä»¥ç›¸åŒï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;æ¶ˆè´¹è€…1-2&#34;&gt;æ¶ˆè´¹è€…1&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;    /**
     * æ¶ˆè´¹
     */
    public function consumer1()
    {
        /**
         * å¾ªç¯æ‰§è¡Œæ¶ˆè´¹
         */
        while (true) {
            $msg = Redis::connection()-&amp;gt;zrangebyscore(self::$delayKey, 0, time(), [&#39;limit&#39; =&amp;gt; [&#39;offset&#39; =&amp;gt; 0, &#39;count&#39; =&amp;gt; 1]]);
            if ($msg) {
                // åˆ é™¤å½“å‰å¤„ç†æ¶ˆæ¯
                if (Redis::connection()-&amp;gt;zrem(self::$delayKey, $msg)) {
                    // TODO ä¸šåŠ¡å¤„ç†å¹¶è¿”å›å¤„ç†ç»“æœ
                }
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;åˆ©ç”¨ zrangebyscore æŒ‰ç…§ score (æ­¤å¤„ä¸ºå…ƒç´ å¯¹åº”è¶…æ—¶æ—¶é—´æˆ³) è¿›è¡Œè·å–æ»¡è¶³æ¡ä»¶çš„é›†åˆå…ƒç´ ï¼ˆè¶…æ—¶å¾…å–æ¶ˆè®¢å•ï¼‰&lt;/li&gt;
&lt;li&gt;å½“æœ‰æ»¡è¶³çš„æ¡ä»¶çš„å…ƒç´ ï¼ˆè¶…æ—¶å¾…å–æ¶ˆè®¢å•ï¼‰, å…ˆåˆ é™¤è¯¥å…ƒç´ ï¼ˆä¿è¯ä¸è¢«å…¶ä»–è¿›ç¨‹å–åˆ°ï¼‰ï¼Œå†è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†&lt;/li&gt;
&lt;li&gt;æ­¤å¤„ä¸ºäº†è€ƒè™‘æ€§èƒ½ï¼Œå»ºè®®æ¯æ¬¡åªå¤„ç† 1ï¼ˆcount=1ï¼‰æ¡æ¶ˆæ¯æ•°æ®ï¼Œoffset=0&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å­˜åœ¨é—®é¢˜ï¼šå»¶è¿Ÿé˜Ÿåˆ—æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ä¸ºç©ºï¼ˆæˆ–è€…é›†åˆä¸ºç©ºï¼‰æ—¶å€™ï¼Œè¿›ç¨‹è¿˜ä¼šé¢‘ç¹ä¸æ–­å‘ redis æœåŠ¡è·å–æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œé€ æˆ redis æœåŠ¡èµ„æºå ç”¨å’Œæµªè´¹&lt;br&gt;
è§£å†³åŠæ³•ï¼šå¯ä»¥åœ¨æ²¡æœ‰å–åˆ°æ»¡è¶³æ¡ä»¶çš„æ—¶å€™è®©ç¨‹åºé˜»å¡ä¸€æ®µæ—¶é—´ unsleep(10000)&lt;/p&gt;
&lt;h4 id=&#34;æ¶ˆè´¹è€…2-2&#34;&gt;æ¶ˆè´¹è€…2&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;    /**
     * æ¶ˆè´¹
     */
    public function consumer2()
    {
        /**
         * å¾ªç¯æ‰§è¡Œæ¶ˆè´¹
         */
        while (true) {
            $msg = Redis::connection()-&amp;gt;zrangebyscore(self::$delayKey, 0, time(), [&#39;limit&#39; =&amp;gt; [&#39;offset&#39; =&amp;gt; 0, &#39;count&#39; =&amp;gt; 1]]);
            if ($msg) {
                // åˆ é™¤å½“å‰å¤„ç†æ¶ˆæ¯
                if (Redis::connection()-&amp;gt;zrem(self::$delayKey, $msg)) {
                    // TODO ä¸šåŠ¡å¤„ç†å¹¶è¿”å›å¤„ç†ç»“æœ
                }
            } else {
                /**
                 * é˜»å¡1s,å‡å°‘redisæœåŠ¡èµ„æºæµªè´¹
                 */
                unsleep(1000000);
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å­˜åœ¨é—®é¢˜ï¼šå•æœºéƒ¨ç½²åŸºæœ¬æ²¡æœ‰ä»»ä½•é—®é¢˜äº†ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œæœ‰å¯èƒ½å‡ºç° zrangebyscore å’Œ zrem éåŒä¸€ä¸ªå®¢æˆ·ç«¯çš„é—®é¢˜ï¼Œå³åŸå­æ€§é—®é¢˜&lt;br&gt;
è§£å†³åŠæ³•ï¼š&lt;code&gt;Lua&lt;/code&gt; è§£å†³åŠæ³•&lt;/p&gt;
&lt;h4 id=&#34;æ¶ˆè´¹è€…3-2&#34;&gt;æ¶ˆè´¹è€…3&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;
    /**
     * æ¶ˆè´¹
     * æ²¡æœ‰å¤‡ä»½æœºåˆ¶çš„luaè„šæœ¬
     */
    public function consumer3()
    {
        $luaScript = &amp;lt;&amp;lt;&amp;lt;EOF
local delayKey = KEYS[1]
local start = ARGV[1]
local endTime = ARGV[2]
local limitNum = ARGV[3]
local result = redis.call(&#39;zrangebyscore&#39;,delayKey,start,endTime,&#39;limit&#39;,0, limitNum)

if next(result) ~= nil  
then 
    local res = redis.call(&#39;zrem&#39;,delayKey,unpack(result))
    if res &amp;gt; 0
    then
        return result
    end 
else
    return {}
end
EOF;
        /**
         * å¾ªç¯æ‰§è¡Œæ¶ˆè´¹
         */
        while (true) {
            $startTime = 0;
            $endTime   = time();
            $limit     = 1;
            /**
             * ä¸ºäº†é˜²æ­¢å¹¶å‘ï¼Œä¿è¯åŸå­æ€§æ“ä½œ
             * åˆ©ç”¨luaè„šæœ¬è·å–æ»¡è¶³æ¡ä»¶çš„æ¶ˆæ¯ï¼Œå¹¶åˆ é™¤æ»¡è¶³æ¡ä»¶æ¶ˆæ¯
             * è¿”å›æ»¡è¶³æ¡ä»¶çš„æ¶ˆæ¯
             */
            $msg = Redis::connection()-&amp;gt;eval($luaScript, 1, self::$delayKey, $startTime, $endTime, $limit);
            if ($msg) {
                // TODO ä¸šåŠ¡å¤„ç†å¹¶è¿”å›å¤„ç†ç»“æœ
            } else {
                /**
                 * é˜»å¡1s,å‡å°‘redisæœåŠ¡èµ„æºæµªè´¹
                 */
                unsleep(100000);
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
">Redis å®ç°æ¶ˆæ¯é˜Ÿåˆ—</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/jupyter-ji-ben-shi-yong/"" data-c="
          &lt;h3 id=&#34;æœåŠ¡å¯åŠ¨ä¸åœæ­¢-cmd&#34;&gt;æœåŠ¡å¯åŠ¨ä¸åœæ­¢ï¼ˆ CMD ï¼‰&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;- å¯åŠ¨ jupyter notebook
- åœæ­¢ Control + C
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;h3 id=&#34;cell-ä¸¤ç§æ¨¡å¼&#34;&gt;cell ä¸¤ç§æ¨¡å¼&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;- code     : ç¼–å†™ä»£ç  ( y ä¿®æ”¹ä¸º code æ¨¡å¼ )
- markdown : ç¼–å†™ç¬”è®° ( m ä¿®æ”¹ä¸º markdown æ¨¡å¼ )
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ¨¡å¼åˆ‡æ¢&#34;&gt;æ¨¡å¼åˆ‡æ¢&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;- å½“å‰ cell ä¾§è¾¹ä¸ºè“è‰²æ—¶ï¼Œè¡¨ç¤ºæ­¤æ—¶ä¸ºå‘½ä»¤æ¨¡å¼ï¼ŒæŒ‰ Enter åˆ‡æ¢ä¸ºç¼–è¾‘æ¨¡å¼
- å½“å‰ cell ä¾§è¾¹ä¸ºç»¿è‰²æ—¶ï¼Œè¡¨ç¤ºæ­¤æ—¶ä¸ºç¼–è¾‘æ¨¡å¼ï¼ŒæŒ‰ Esc åˆ‡æ¢ä¸ºå‘½ä»¤æ¨¡å¼
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å¿«æ·é”®&#34;&gt;å¿«æ·é”®&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;- a åœ¨ä¸Šæ–¹æ–°å»º cell
- b åœ¨ä¸‹æ–¹æ–°å»º cell
- x åˆ é™¤
- y ä¿®æ”¹ä¸º code æ¨¡å¼
- m ä¿®æ”¹ä¸º markdown æ¨¡å¼
- shift + enter è¿è¡Œå½“å‰ cell å¹¶è·³è½¬åˆ°ä¸‹ä¸€ä¸ª cell
- command + enter è¿è¡Œå½“å‰ cell 
- tab è‡ªåŠ¨è¡¥å…¨
- shift + tab æ‰“å¼€å¸®åŠ©æ–‡æ¡£
- dd åˆ é™¤å½“å‰ cell
- z æ’¤é”€åˆ é™¤&lt;/code&gt;&lt;/pre&gt;
">jupyter åŸºæœ¬ä½¿ç”¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/mysql-80-bi-zhi-bi-hui/"" data-c="
          &lt;h1 id=&#34;å®‰è£…ä¸é…ç½®&#34;&gt;å®‰è£…ä¸é…ç½®&lt;/h1&gt;
&lt;p&gt;MySQL 8.0 ä¸‹è½½åœ°å€&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;ä¸‹è½½&#34;&gt;ä¸‹è½½&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è§£å‹&#34;&gt;è§£å‹&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;# å°†æ–‡ä»¶æ”¹ä¸ºtaræ ¼å¼
xz -d mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz
# è§£å‹taræ–‡ä»¶
tar xf mysql-8.0.15-linux-glibc2.12-x86_64.tar
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç§»åŠ¨&#34;&gt;ç§»åŠ¨&lt;/h2&gt;
&lt;p&gt;ç§»åŠ¨åˆ° &lt;code&gt;/usr/local/mysql&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mv mysql-8.0.15-linux-glibc2.12-x86_64 /usr/local/mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®‰å…¨ä¿éšœæ–°å»ºä¸€ä¸ªè´¦æˆ· &lt;code&gt;mysql&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# åå­—è‡ªå–ï¼Œé…ç½®æ–‡ä»¶åˆ«å¿˜è®°åŒæ­¥æ›´æ–°
adduser mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é…ç½®&#34;&gt;é…ç½®&lt;/h2&gt;
&lt;p&gt;æ›´æ–°é…ç½®æ–‡ä»¶ä¿¡æ¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;vim /etc/my.cnf
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é…ç½®å†…å®¹å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[client]
# è®¾ç½®3306ç«¯å£
port            = 3306
socket          = /usr/local/mysql/data/mysql.sock
[mysqld]
# Skip #
skip_name_resolve              = 1
skip_external_locking          = 1 
skip_symbolic_links     = 1
# GENERAL #
# ç”¨æˆ·
user = mysql
# åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“
default_storage_engine = InnoDB
# æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸ºUTF8
character-set-server = utf8
socket  = /usr/local/mysql/data/mysql.sock
pid_file = /usr/local/mysql/data/mysqld.pid
# è®¾ç½®mysqlçš„å®‰è£…ç›®å½•
basedir = /usr/local/mysql
port = 3306
bind-address = 0.0.0.0
explicit_defaults_for_timestamp = off
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES
#read_only=on
# MyISAM #
key_buffer_size                = 32M
#myisam_recover                 = FORCE,BACKUP

# undo log #
innodb_undo_directory = /usr/local/mysql/undo
innodb_undo_tablespaces = 8

# SAFETY #
max_allowed_packet             = 100M
#å…è®¸è¿æ¥å¤±è´¥çš„æ¬¡æ•°ã€‚é˜²æ­¢æœ‰äººä»è¯¥ä¸»æœºè¯•å›¾æ”»å‡»æ•°æ®åº“ç³»ç»Ÿ
max_connect_errors             = 1000000
sysdate_is_now                 = 1
#innodb = FORCE
#innodb_strict_mode = 1
secure-file-priv=&#39;/tmp&#39;
default_authentication_plugin=&#39;mysql_native_password&#39;
# Replice #
 server-id = 1001
 relay_log = mysqld-relay-bin
 gtid_mode = on
 enforce-gtid-consistency
 log-slave-updates = on
 master_info_repository =TABLE
 relay_log_info_repository =TABLE


# DATA STORAGE #
# è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•
 datadir = /usr/local/mysql/data/
 tmpdir = /tmp
 
# BINARY LOGGING #
 log_bin = /usr/local/mysql/sql_log/mysql-bin
 max_binlog_size = 1000M
 binlog_format = row
 binlog_expire_logs_seconds=86400
# sync_binlog = 1

 # CACHES AND LIMITS #
 tmp_table_size                 = 32M
 max_heap_table_size            = 32M
 # å…è®¸æœ€å¤§è¿æ¥æ•°
 max_connections                = 4000
 thread_cache_size              = 2048
 open_files_limit               = 65535
 table_definition_cache         = 4096
 table_open_cache               = 4096
 sort_buffer_size               = 2M
 read_buffer_size               = 2M
 read_rnd_buffer_size           = 2M
# thread_concurrency             = 24
 join_buffer_size = 1M
# table_cache = 32768
 thread_stack = 512k
 max_length_for_sort_data = 16k


 # INNODB #
 innodb_flush_method            = O_DIRECT
 innodb_log_buffer_size = 16M
 innodb_flush_log_at_trx_commit = 2
 innodb_file_per_table          = 1
 innodb_buffer_pool_size        = 256M
 #innodb_buffer_pool_instances = 8
 innodb_stats_on_metadata = off
 innodb_open_files = 8192
 innodb_read_io_threads = 16
 innodb_write_io_threads = 16
 innodb_io_capacity = 20000
 innodb_thread_concurrency = 0
 innodb_lock_wait_timeout = 60
 innodb_old_blocks_time=1000
 innodb_use_native_aio = 1
 innodb_purge_threads=1
 innodb_change_buffering=all
 innodb_log_file_size = 64M
 innodb_log_files_in_group = 2
 innodb_data_file_path  = ibdata1:256M:autoextend
 
 innodb_rollback_on_timeout=on
 # LOGGING #
 log_error                      = /usr/local/mysql/sql_log/mysql-error.log
 # log_queries_not_using_indexes  = 1
 # slow_query_log                 = 1
  slow_query_log_file            = /usr/local/mysql/sql_log/slowlog.log

 # TimeOut #
 #interactive_timeout = 30
 #wait_timeout        = 30
 #net_read_timeout = 60

[mysqldump]
quick
max_allowed_packet = 100M

[mysql]
no-auto-rehash
# Remove the next comment character if you are not familiar with SQL
#safe-updates

[myisamchk]
key_buffer_size = 256M
sort_buffer_size = 256M
read_buffer = 2M
write_buffer = 2M

[mysqlhotcopy]
interactive-timeout
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å»ºç«‹å„ç§æ–‡ä»¶å­˜å‚¨æ–‡ä»¶åŒæ—¶èµ‹äºˆ &lt;code&gt;mysql&lt;/code&gt; æƒé™&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /usr/local/mysql/

mkdir data undo sql_log

# èµ‹äºˆ mysql å±ä¸»
chown mysql:mysql data/ undo/ sql_log/
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é…ç½®ç¯å¢ƒ &lt;code&gt;/ect/profile&lt;/code&gt; å˜é‡æ–¹ä¾¿ &lt;code&gt;mysql&lt;/code&gt; å¯åŠ¨&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# æœ«å°¾æ·»åŠ 
export PATH=$PATH:/usr/local/mysql/bin
# æ›´æ–°é…ç½®source /etc/profile
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆå§‹åŒ–&#34;&gt;åˆå§‹åŒ–&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŠŠå¯åŠ¨ &lt;code&gt;mysql.sever&lt;/code&gt; ç§»åŠ¨åˆ° &lt;code&gt;/etc/init.d&lt;/code&gt; ä¸­&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cp support-files/mysql.server /etc/init.d/mysqld
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å¯åŠ¨&#34;&gt;å¯åŠ¨&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;/etc/init.d/mysqld start
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps -ef | grep mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç™»å½•&#34;&gt;ç™»å½•&lt;/h2&gt;
&lt;p&gt;ç™»å½• &lt;code&gt;mysql&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cat sql_log/mysql-error.log | grep password
# [Note] [MY-010454] [Server] A temporary password is generated for root@localhost:Py1Olku2-u8v
# Py1Olku2-u8v å°±ä¸ºåˆå§‹çš„ä¸´æ—¶å¯†ç # è¿æ¥ mysqlmysql -uroot -pPy1Olku2-u8v
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‡ç½®å¯†ç &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;alter user user() identified by &#39;123456&#39;;
# å¯†ç çº¿ä¸Šéœ€è¦å¤æ‚äº›ï¼Œè¿™æœ¬åœ°æµ‹è¯•
# é€€å‡ºï¼Œé‡æ–°ç™»å½•
mysql -uroot -p123456
# æˆåŠŸç™»å½•ï¼Œç»“æŸ
&lt;/code&gt;&lt;/pre&gt;
">MySQL 8.0 å®‰è£…ä¸é…ç½®</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/xiao-xi-dui-lie/"" data-c="
          &lt;p&gt;&lt;code&gt;æ¶ˆæ¯ï¼ˆMessageï¼‰&lt;/code&gt;ï¼šä¼ è¾“çš„æ•°æ®ã€‚&lt;br&gt;
&lt;code&gt;é˜Ÿåˆ—ï¼ˆQueueï¼‰&lt;/code&gt;ï¼šé˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ã€‚&lt;br&gt;
&lt;code&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/code&gt;æ˜¯æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºï¼š&lt;b&gt;æŠŠè¦ä¼ è¾“çš„æ•°æ®æ”¾åœ¨é˜Ÿåˆ—ä¸­&lt;/b&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œ&lt;b&gt;æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§å¼‚æ­¥çš„æœåŠ¡é—´é€šä¿¡æ–¹å¼ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é‡è¦çš„ç»„ä»¶ï¼Œä¸»è¦è§£å†³åº”ç”¨è€¦åˆï¼Œå¼‚æ­¥æ¶ˆæ¯ï¼Œæµé‡å‰Šé”‹ç­‰é—®é¢˜ï¼Œå®ç°é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œå¯ä¼¸ç¼©å’Œæœ€ç»ˆä¸€è‡´æ€§æ¶æ„&lt;/b&gt;ã€‚ä½¿ç”¨è¾ƒå¤šçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰&lt;code&gt;RocketMQ&lt;/code&gt;ã€&lt;code&gt;RabbitMQ&lt;/code&gt;ã€&lt;code&gt;Kafka&lt;/code&gt;ç­‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç”Ÿäº§è€…ï¼šæŠŠæ•°æ®æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—å«åšç”Ÿäº§è€…&lt;br&gt;
æ¶ˆè´¹è€…ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œè¾¹å–æ•°æ®å«åšæ¶ˆè´¹è€…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯&#34;&gt;ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯ï¼‰&lt;/h1&gt;
&lt;p&gt;å¸¸ç”¨åº”ç”¨åœºæ™¯ï¼šè§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°&lt;/p&gt;
&lt;h2 id=&#34;è§£è€¦&#34;&gt;è§£è€¦&lt;/h2&gt;
&lt;p&gt;åº”ç”¨è€¦åˆï¼š&lt;b&gt;å¤šåº”ç”¨é—´é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé¿å…è°ƒç”¨æ¥å£å¤±è´¥å¯¼è‡´æ•´ä¸ªè¿‡ç¨‹å¤±è´¥&lt;/b&gt;&lt;/p&gt;
&lt;p&gt;åœºæ™¯è¯´æ˜ï¼šç”¨æˆ·ä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿéœ€è¦é€šçŸ¥åº“å­˜ç³»ç»Ÿã€‚ä¼ ç»Ÿçš„åšæ³•æ˜¯ï¼Œè®¢å•ç³»ç»Ÿè°ƒç”¨åº“å­˜ç³»ç»Ÿçš„æ¥å£&lt;br&gt;
ä¼ ç»Ÿæ¨¡å¼çš„ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;å‡å¦‚åº“å­˜ç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œåˆ™è®¢å•å‡åº“å­˜å°†å¤±è´¥ï¼Œä»è€Œå¯¼è‡´è®¢å•å¤±è´¥&lt;/li&gt;
    &lt;li&gt;è®¢å•ç³»ç»Ÿä¸åº“å­˜ç³»ç»Ÿè€¦åˆ&lt;/li&gt;
&lt;/ol&gt;
å¦‚ä½•è§£å†³ä»¥ä¸Šé—®é¢˜å‘¢ï¼Ÿå¼•å…¥åº”ç”¨æ¶ˆæ¯é˜Ÿåˆ—åçš„æ–¹æ¡ˆ
&lt;ul&gt;
    &lt;li&gt;è®¢å•ç³»ç»Ÿï¼šç”¨æˆ·ä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿå®ŒæˆæŒä¹…åŒ–å¤„ç†ï¼Œå°†æ¶ˆæ¯å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿”å›ç”¨æˆ·è®¢å•ä¸‹å•æˆåŠŸ&lt;/li&gt;
    &lt;li&gt;åº“å­˜ç³»ç»Ÿï¼šè®¢é˜…ä¸‹å•çš„æ¶ˆæ¯ï¼Œé‡‡ç”¨æ‹‰/æ¨çš„æ–¹å¼ï¼Œè·å–ä¸‹å•ä¿¡æ¯ï¼Œåº“å­˜ç³»ç»Ÿæ ¹æ®ä¸‹å•ä¿¡æ¯ï¼Œè¿›è¡Œåº“å­˜æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å‡å¦‚ï¼šåœ¨ä¸‹å•æ—¶åº“å­˜ç³»ç»Ÿä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ä¹Ÿä¸å½±å“æ­£å¸¸ä¸‹å•ï¼Œå› ä¸ºä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—å°±ä¸å†å…³å¿ƒå…¶ä»–çš„åç»­æ“ä½œäº†ã€‚å®ç°è®¢å•ç³»ç»Ÿä¸åº“å­˜ç³»ç»Ÿçš„åº”ç”¨è§£è€¦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç³»ç»Ÿæœªè§£è€¦ï¼šä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹ï¼Œç”¨æˆ·åˆ›å»ºè®¢å•åï¼Œå¦‚æœè€¦åˆè°ƒç”¨åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªå­ç³»ç»Ÿå‡ºäº†æ•…éšœæˆ–è€…å› ä¸ºå‡çº§ç­‰åŸå› æš‚æ—¶ä¸å¯ç”¨ï¼Œéƒ½ä¼šé€ æˆä¸‹å•å¼‚å¸¸ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚ï¼ˆå›¾1-1ï¼‰&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿè§£è€¦ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦åˆï¼Œæ¯”å¦‚ç‰©æµç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½ä¿®å¤ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„æ•°æ®è¢«ç¼“å­˜åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œæ­£å¸¸å®Œæˆã€‚å½“ç‰©æµç³»ç»Ÿæ¢å¤åï¼Œè¡¥å……å¤„ç†è¢«ç¼“å­˜åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•æ•°æ®ï¼Œç»ˆç«¯ç³»ç»Ÿæ„ŸçŸ¥ä¸åˆ°ç‰©æµç³»ç»Ÿå‘ç”Ÿçš„æ•…éšœã€‚ï¼ˆå›¾1-2ï¼‰&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1615859297884.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å½“è®¢å•ç³»ç»Ÿä¸éœ€è¦ç‰©æµç³»ç»Ÿæ—¶ï¼Œä¸ç”¨æ¶ˆæ¯é˜Ÿåˆ—éœ€è¦æ¥å›ä¿®æ”¹è€¦åˆçš„ä»£ç ï¼Œç”¨ MQ ååªéœ€åœ¨ç‰©æµç³»ç»Ÿæ¶ˆè´¹è€…å¤„ä¸åœ¨æ¥æ”¶è®¢å•é˜Ÿåˆ—ä¿¡æ¯å³å¯ã€‚é™ä½äº†äººå·¥æˆæœ¬ï¼Œä»£ç ä¾¿äºç»´æŠ¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼‚æ­¥&#34;&gt;å¼‚æ­¥&lt;/h2&gt;
&lt;p&gt;å¼‚æ­¥å¤„ç†ï¼š&lt;b&gt;å¤šåº”ç”¨å¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œåº”ç”¨é—´å¹¶å‘å¤„ç†æ¶ˆæ¯ï¼Œç›¸æ¯”ä¸²è¡Œå¤„ç†ï¼Œå‡å°‘å¤„ç†æ—¶é—´&lt;/b&gt;&lt;/p&gt;
&lt;p&gt;åœºæ™¯è¯´æ˜ï¼šç”¨æˆ·æ³¨å†Œåï¼Œéœ€è¦å‘æ³¨å†Œé‚®ä»¶å’Œæ³¨å†ŒçŸ­ä¿¡ã€‚ä¼ ç»Ÿçš„åšæ³•æœ‰ä¸¤ç§ 1.ä¸²è¡Œçš„æ–¹å¼ï¼›2.å¹¶è¡Œæ–¹å¼&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;ä¸²è¡Œæ–¹å¼ï¼šå°†æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“æˆåŠŸåï¼Œå‘é€æ³¨å†Œé‚®ä»¶ï¼Œå†å‘é€æ³¨å†ŒçŸ­ä¿¡ã€‚ä»¥ä¸Šä¸‰ä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯&lt;/li&gt;
    &lt;li&gt;å¹¶è¡Œæ–¹å¼ï¼šå°†æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“æˆåŠŸåï¼Œå‘é€æ³¨å†Œé‚®ä»¶çš„åŒæ—¶ï¼Œå‘é€æ³¨å†ŒçŸ­ä¿¡ã€‚ä»¥ä¸Šä¸‰ä¸ªä»»åŠ¡å®Œæˆåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä¸ä¸²è¡Œçš„å·®åˆ«æ˜¯ï¼Œå¹¶è¡Œçš„æ–¹å¼å¯ä»¥æé«˜å¤„ç†çš„æ—¶é—´&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‡è®¾ä¸‰ä¸ªä¸šåŠ¡èŠ‚ç‚¹æ¯ä¸ªä½¿ç”¨ 50 æ¯«ç§’é’Ÿï¼Œä¸è€ƒè™‘ç½‘ç»œç­‰å…¶ä»–å¼€é”€ï¼Œåˆ™ä¸²è¡Œæ–¹å¼çš„æ—¶é—´æ˜¯150æ¯«ç§’ï¼Œå¹¶è¡Œçš„æ—¶é—´å¯èƒ½æ˜¯ 100 æ¯«ç§’&lt;br&gt;
å› ä¸º CPU åœ¨å•ä½æ—¶é—´å†…å¤„ç†çš„è¯·æ±‚æ•°æ˜¯ä¸€å®šçš„ï¼Œå‡è®¾ CPU 1 ç§’å†…ååé‡æ˜¯ 100 æ¬¡ã€‚åˆ™ä¸²è¡Œæ–¹å¼ 1 ç§’å†… CPU å¯å¤„ç†çš„è¯·æ±‚é‡æ˜¯ 7 æ¬¡ï¼ˆ1000/150ï¼‰ã€‚å¹¶è¡Œæ–¹å¼å¤„ç†çš„è¯·æ±‚é‡æ˜¯ 10 æ¬¡ï¼ˆ1000/100ï¼‰&lt;br&gt;
å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°†ä¸æ˜¯å¿…é¡»çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¼‚æ­¥å¤„ç†ã€‚æ”¹é€ åçš„æ¶æ„å¦‚ä¸‹&lt;br&gt;
æŒ‰ç…§ä»¥ä¸Šçº¦å®šï¼Œç”¨æˆ·çš„å“åº”æ—¶é—´ç›¸å½“äºæ˜¯æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯50æ¯«ç§’ã€‚æ³¨å†Œé‚®ä»¶ï¼Œå‘é€çŸ­ä¿¡å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç›´æ¥è¿”å›ï¼Œå› æ­¤å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„é€Ÿåº¦å¾ˆå¿«ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ï¼Œå› æ­¤ç”¨æˆ·çš„å“åº”æ—¶é—´å¯èƒ½æ˜¯ 50æ¯«ç§’ã€‚å› æ­¤æ¶æ„æ”¹å˜åï¼Œç³»ç»Ÿçš„ååé‡æé«˜åˆ°æ¯ç§’ 20 QPSã€‚æ¯”ä¸²è¡Œæé«˜äº† 3 å€ï¼Œæ¯”å¹¶è¡Œæé«˜äº†ä¸¤å€&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿæœªå¼‚æ­¥ï¼šA ç³»ç»Ÿæ¥æ”¶ä¸€ä¸ªè¯·æ±‚ï¼Œéœ€è¦åœ¨è‡ªå·±æœ¬åœ°å†™åº“ï¼Œè¿˜éœ€è¦åœ¨Bã€Cã€Dä¸‰ä¸ªç³»ç»Ÿå†™åº“ï¼Œè‡ªå·±æœ¬åœ°å†™åº“è¦ 3msï¼ŒBã€Cã€Dä¸‰ä¸ªç³»ç»Ÿå†™åº“åˆ†åˆ«è¦ 300msã€450msã€200msã€‚æœ€ç»ˆè¯·æ±‚æ€»å»¶è¿Ÿæ˜¯ 3 + 300 + 450 + 200 = 953msï¼Œæ¥è¿‘ 1sï¼Œç”¨æˆ·ä½“éªŒå¾ˆå·®ï¼Œä¸€èˆ¬çš„äº’è”ç½‘ä¼ä¸šï¼Œå¯¹äºç”¨æˆ·çš„ç›´æ¥æ“ä½œï¼Œå®¹å¿å¿…é¡»è¦ 200ms ä»¥å†…ï¼Œå¯¹ç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œç­‰å¾… 1sï¼Œè¿™ä¸ªå‡ ä¹æ˜¯æ— æ³•æ¥å—çš„ã€‚ï¼ˆå›¾1-1ï¼‰&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿå¼‚æ­¥ï¼šå¦‚æœä½¿ç”¨ MQï¼Œé‚£ä¹ˆ A ç³»ç»Ÿè¿ç»­å‘é€ 3 æ¡æ¶ˆæ¯åˆ° MQ é˜Ÿåˆ—ä¸­ï¼Œå‡è®¾è€—æ—¶ 5msï¼ŒA ç³»ç»Ÿä»æ¥å—ä¸€ä¸ªè¯·æ±‚åˆ°è¿”å›å“åº”ç»™ç”¨æˆ·ï¼Œæ€»æ—¶é•¿ä¸º 5 + 3 = 8msï¼Œå“åº”é€Ÿåº¦å¤§å¤§æå‡ï¼Œæ”¹å–„äº†ç”¨æˆ·çš„ä½“éªŒã€‚ï¼ˆå›¾1-2ï¼‰&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1615860664817.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‰Šå³°&#34;&gt;å‰Šå³°&lt;/h2&gt;
&lt;p&gt;é™æµå‰Šå³°ï¼š&lt;b&gt;å¹¿æ³›åº”ç”¨äºç§’æ€æˆ–æŠ¢è´­æ´»åŠ¨ä¸­ï¼Œé¿å…æµé‡è¿‡å¤§å¯¼è‡´åº”ç”¨ç³»ç»ŸæŒ‚æ‰çš„æƒ…å†µ&lt;/b&gt;&lt;/p&gt;
&lt;p&gt;åœºæ™¯è¯´æ˜ï¼šç§’æ€æ´»åŠ¨ï¼Œä¸€èˆ¬ä¼šå› ä¸ºæµé‡è¿‡å¤§ï¼Œå¯¼è‡´æµé‡æš´å¢ï¼Œåº”ç”¨æŒ‚æ‰ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬éœ€è¦åœ¨åº”ç”¨å‰ç«¯åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;å¯ä»¥æ§åˆ¶æ´»åŠ¨çš„äººæ•°&lt;/li&gt;
    &lt;li&gt;å¯ä»¥ç¼“è§£çŸ­æ—¶é—´å†…é«˜æµé‡å‹å®åº”ç”¨&lt;/li&gt;
&lt;/ul&gt;
ç”¨æˆ·çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶åï¼Œé¦–å…ˆå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚å‡å¦‚æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦è¶…è¿‡æœ€å¤§æ•°é‡ï¼Œåˆ™ç›´æ¥æŠ›å¼ƒç”¨æˆ·è¯·æ±‚æˆ–è·³è½¬åˆ°é”™è¯¯é¡µé¢ï¼›ç§’æ€ä¸šåŠ¡æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ä¿¡æ¯ï¼Œå†åšåç»­å¤„ç†
&lt;p&gt;åº”ç”¨ç³»ç»Ÿå¦‚æœé‡åˆ°ç³»ç»Ÿè¯·æ±‚æµé‡çš„ç¬é—´çŒ›å¢ï¼Œæœ‰å¯èƒ½ä¼šå°†ç³»ç»Ÿå‹å®ï¼ˆå›¾1-1ï¼‰ã€‚æœ‰äº†æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å°†å¤§é‡è¯·æ±‚ç¼“å­˜èµ·æ¥ï¼Œåˆ†æ•£åˆ°å¾ˆé•¿ä¸€æ®µæ—¶é—´å¤„ç†ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒï¼ˆå›¾1-2ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå¦‚æœç³»ç»Ÿè´Ÿè½½è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¼šé˜»æ­¢ç”¨æˆ·è¯·æ±‚ï¼Œè¿™ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œè€Œå¦‚æœä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å°†è¯·æ±‚ç¼“å­˜èµ·æ¥ï¼Œç­‰å¾…ç³»ç»Ÿå¤„ç†å®Œæ¯•åé€šçŸ¥ç”¨æˆ·ä¸‹å•å®Œæˆï¼Œè¿™æ ·ä¸‹å•ä½“éªŒä¹Ÿå¥½ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸šåŠ¡ç³»ç»Ÿæ­£å¸¸æ—¶æ®µçš„ QPS å¦‚æœæ˜¯ 1 Kï¼Œæµé‡æœ€é«˜å³°æ˜¯ 10 Kï¼Œä¸ºäº†åº”å¯¹æµé‡é«˜å³°é…ç½®é«˜æ€§èƒ½çš„æœåŠ¡å™¨æ˜¾ç„¶ä¸åˆ’ç®—ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯¹å³°å€¼æµé‡è¿›è¡Œå‰Šå³°ã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1615870854381.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ—¥å¿—å¤„ç†&#34;&gt;æ—¥å¿—å¤„ç†&lt;/h2&gt;
&lt;p&gt;æ—¥å¿—å¤„ç†æ˜¯æŒ‡å°†æ¶ˆæ¯é˜Ÿåˆ—ç”¨åœ¨æ—¥å¿—å¤„ç†ä¸­ï¼Œæ¯”å¦‚ &lt;code&gt;Kafka&lt;/code&gt; çš„åº”ç”¨ï¼Œè§£å†³å¤§é‡æ—¥å¿—ä¼ è¾“çš„é—®é¢˜ã€‚æ¶æ„ç®€åŒ–å¦‚ä¸‹&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;æ—¥å¿—é‡‡é›†å®¢æˆ·ç«¯ï¼Œè´Ÿè´£æ—¥å¿—æ•°æ®é‡‡é›†ï¼Œå®šæ—¶å†™å‡ºå†™å…¥ Kafka é˜Ÿåˆ—&lt;/li&gt;
    &lt;li&gt;Kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè´Ÿè´£æ—¥å¿—æ•°æ®çš„æ¥æ”¶ï¼Œå­˜å‚¨å’Œè½¬å‘&lt;/li&gt;
    &lt;li&gt;æ—¥å¿—å¤„ç†åº”ç”¨ï¼Œè®¢é˜…å¹¶æ¶ˆè´¹ Kafka é˜Ÿåˆ—ä¸­çš„æ—¥å¿—æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ¶ˆæ¯é€šè®¯&#34;&gt;æ¶ˆæ¯é€šè®¯&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯é€šè®¯æ˜¯æŒ‡æ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬éƒ½å†…ç½®äº†é«˜æ•ˆçš„é€šä¿¡æœºåˆ¶ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨åœ¨çº¯çš„æ¶ˆæ¯é€šè®¯ã€‚&lt;br&gt;
æ¯”å¦‚å®ç°ç‚¹å¯¹ç‚¹æ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…èŠå¤©å®¤ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ç‚¹å¯¹ç‚¹é€šè®¯ï¼šï¼ˆç‚¹å¯¹ç‚¹ï¼‰&lt;br&gt;
å®¢æˆ·ç«¯Aï¼Œå®¢æˆ·ç«¯Bä½¿ç”¨åŒä¸€é˜Ÿåˆ—ï¼Œè¿›è¡Œé€šè®¯&lt;/p&gt;
&lt;p&gt;èŠå¤©å®¤é€šè®¯ï¼šï¼ˆå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰&lt;br&gt;
å®¢æˆ·ç«¯Aï¼Œå®¢æˆ·ç«¯B, ...ï¼Œå®¢æˆ·ç«¯è®¢é˜…åŒä¸€ä¸»é¢˜ï¼Œè¿›è¡Œæ¶ˆæ¯å‘å¸ƒå’Œæ¥æ”¶ã€‚å®ç°ç±»ä¼¼èŠå¤©å®¤æ•ˆæœ&lt;/p&gt;
&lt;h1 id=&#34;å„ç§æ¶ˆæ¯é˜Ÿåˆ—äº§å“çš„æ¯”è¾ƒ&#34;&gt;å„ç§æ¶ˆæ¯é˜Ÿåˆ—äº§å“çš„æ¯”è¾ƒ&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;RabbitMQ&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;RocketMQ&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Kafka&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å¼€å‘è¯­è¨€&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;erlang&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Java&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;scala&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å•æœºååé‡&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ä¸‡çº§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åä¸‡çº§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åä¸‡çº§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ—¶æ•ˆæ€§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;usçº§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;msçº§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;msçº§ä»¥å†…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å¯ç”¨æ€§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é«˜ï¼ˆä¸»ä»æ¶æ„ï¼‰&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;éå¸¸é«˜ï¼ˆåˆ†å¸ƒå¼æ¶æ„ï¼‰&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;éå¸¸é«˜ï¼ˆåˆ†å¸ƒå¼æ¶æ„ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åŠŸèƒ½ç‰¹æ€§&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åŸºäº erlangå¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½ç®¡ç†ç•Œé¢è¾ƒä¸°å¯Œ&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;MQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡ï¼Œæ‰©å±•æ€§ä½³&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åªæ”¯æŒä¸»è¦çš„MQåŠŸèƒ½ï¼Œåƒä¸€äº›æ¶ˆæ¯æŸ¥è¯¢ï¼Œæ¶ˆæ¯å›æº¯ç­‰åŠŸèƒ½æ²¡æœ‰æä¾›ï¼Œæ¯•ç«Ÿæ˜¯ä¸ºå¤§æ•°æ®å‡†å¤‡çš„ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸåº”ç”¨å¹¿&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;RabbitMQï¼Œå¼€å‘è¯­è¨€ erlang é˜»æ­¢äº†å¤§é‡å·¥ç¨‹å¸ˆå»æ·±å…¥ç ”ç©¶å’ŒæŒæ¡å®ƒï¼Œå¯¹å…¬å¸è€Œè¨€ï¼Œå‡ ä¹å¤„äºä¸å¯æ§çš„çŠ¶æ€ï¼Œä½†æ˜¯å®ƒæ˜¯å¼€æºçš„ï¼Œæ¯”è¾ƒç¨³å®šçš„æ”¯æŒï¼Œæ´»è·ƒåº¦ä¹Ÿå¾ˆé«˜ï¼Œå¦‚ä¸è€ƒè™‘äºŒæ¬¡å¼€å‘ï¼Œæ¨èä½¿ç”¨&lt;/p&gt;
&lt;p&gt;RocketMQï¼Œå¼€å‘è¯­è¨€ Javaï¼Œåœ¨é˜¿é‡Œå†…éƒ¨ç»å—è¿‡é«˜å¹¶å‘ä¸šåŠ¡çš„è€ƒéªŒï¼Œç¨³å®šæ€§å’Œæ€§èƒ½å‡ä¸é”™ï¼Œè€ƒè™‘åæœŸå¯èƒ½äºŒå¼€ï¼Œæ¨èä½¿ç”¨&lt;/p&gt;
&lt;p&gt;Kafkaï¼Œå¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼Œç”¨ Kafka æ˜¯ä¸šå†…æ ‡å‡†çš„ï¼Œç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œæ¨èä½¿ç”¨ã€‚å¤§æ•°æ®é¢†åŸŸæ—¥å¿—é‡‡é›†ç­‰ä¸šåŠ¡æ¨èä½¿ç”¨&lt;/p&gt;
&lt;h1 id=&#34;æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç‚¹å’Œç¼ºç‚¹&#34;&gt;æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç‚¹å’Œç¼ºç‚¹&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è§£è€¦&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç³»ç»Ÿå¯ç”¨æ€§é™ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å¼‚æ­¥&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç³»ç»Ÿå¤æ‚åº¦æé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‰Šå³°&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ä¸€è‡´æ€§é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;ç³»ç»Ÿå¯ç”¨æ€§é™ä½&lt;/code&gt;ï¼šç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ã€‚ä¸€æ—¦ MQ å®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚&lt;br&gt;
ï¼ˆå¦‚ä½•ä¿è¯ MQ çš„é«˜å¯ç”¨ï¼Ÿï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ç³»ç»Ÿå¤æ‚åº¦æé«˜&lt;/code&gt;ï¼šMQ çš„åŠ å…¥å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œä»¥å‰ç³»ç»Ÿé—´æ˜¯åŒæ­¥çš„è¿œç¨‹è°ƒç”¨ï¼Œç°åœ¨æ˜¯é€šè¿‡ MQ è¿›è¡Œä¸€æ­¥è°ƒç”¨ã€‚&lt;br&gt;
ï¼ˆæ¶ˆæ¯ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿé‡å¤æ¶ˆæ¯æ€ä¹ˆå¤„ç†ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ä¸€è‡´æ€§é—®é¢˜&lt;/code&gt;ï¼šA ç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡ MQ ç»™ Bã€Cã€D ä¸‰ä¸ªç³»ç»Ÿå‘æ¶ˆæ¯æ•°æ®ï¼Œå¦‚æœ B ç³»ç»Ÿã€C ç³»ç»Ÿå¤„ç†å®Œæˆï¼ŒD ç³»ç»Ÿå¤„ç†å¤±è´¥ã€‚&lt;br&gt;
ï¼ˆå¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§ï¼Ÿï¼‰&lt;/p&gt;
&lt;h1 id=&#34;å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨&#34;&gt;å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨&lt;/h1&gt;
&lt;p&gt;RabbitMQï¼šé•œåƒé›†ç¾¤&lt;br&gt;
RocketMQï¼šåŒä¸»åŒä»&lt;/p&gt;
&lt;h1 id=&#34;å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±&#34;&gt;å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±&lt;/h1&gt;
&lt;h2 id=&#34;æ¶ˆæ¯ä¸¢å¤±çš„åŸå› &#34;&gt;æ¶ˆæ¯ä¸¢å¤±çš„åŸå› &lt;/h2&gt;
&lt;p&gt;å‘é€æ–¹ï¼ŒMQï¼Œæ¶ˆè´¹æ–¹éƒ½æœ‰å¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±&lt;/p&gt;
&lt;h3 id=&#34;æƒ…å†µ1&#34;&gt;æƒ…å†µ1&lt;/h3&gt;
&lt;p&gt;æ¶ˆæ¯ç”Ÿäº§è€…æ²¡æœ‰æˆåŠŸå‘é€åˆ° MQ Broker&lt;/p&gt;
&lt;h3 id=&#34;æƒ…å†µ2&#34;&gt;æƒ…å†µ2&lt;/h3&gt;
&lt;p&gt;æ¶ˆæ¯å‘é€ç»™ MQ Broker åï¼ŒBroker å®•æœºå¯¼è‡´å†…å­˜ä¸­çš„æ¶ˆæ¯æ•°æ®ä¸¢å¤±&lt;/p&gt;
&lt;h3 id=&#34;æƒ…å†µ3&#34;&gt;æƒ…å†µ3&lt;/h3&gt;
&lt;p&gt;æ¶ˆè´¹è€…è·å–åˆ°æ¶ˆæ¯ï¼Œä½†æ¶ˆè´¹è€…è¿˜æ²¡æœ‰æ¥å¾—åŠå¤„ç†å®•æœºäº†ï¼Œä½†æ­¤æ—¶ MQ ä¸­æ¶ˆæ¯å·²ç»åˆ é™¤ï¼Œæ¶ˆè´¹è€…é‡å¯åä¸èƒ½å†æ¶ˆè´¹ä¹‹å‰çš„æ¶ˆæ¯&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624933872334.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±&#34;&gt;å¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±&lt;/h2&gt;
&lt;p&gt;å‘é€æ–¹å¯é å‘é€ï¼ŒMQ è¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ¶ˆè´¹æ–¹æ¶ˆè´¹å®Œæ¯•åè¿›è¡Œ ACK ç¡®è®¤ï¼ŒMQ æ”¶åˆ°æ¶ˆè´¹æ–¹çš„ ACK ç¡®è®¤ååœ¨åˆ é™¤æœ¬åœ°æ¶ˆæ¯&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;æ¶ˆæ¯å‘é€è€…å‘é€ç»™ MQ Broker åï¼ŒMQ Broker ç»™ç”Ÿäº§è€…ç¡®è®¤æ”¶åˆ°&lt;/li&gt;
    &lt;li&gt;MQ æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–&lt;/li&gt;
    &lt;li&gt;æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯å¤„ç†å®Œæ¯•åæ‰‹åŠ¨è¿›è¡Œ ACK ç¡®è®¤&lt;/li&gt;
    &lt;li&gt;MQ æ”¶åˆ°æ¶ˆè´¹è€… ACK ç¡®è®¤ååˆ é™¤æŒä¹…åŒ–çš„æ¶ˆæ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1624934257575.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§&#34;&gt;å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼ˆå¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§ï¼‰&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;æ¶ˆæ¯é‡å¤çš„æ ¹æœ¬åŸå› å°±æ˜¯ç½‘ç»œä¸å¯è¾¾
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å‘é€æ—¶æ¶ˆæ¯é‡å¤&#34;&gt;å‘é€æ—¶æ¶ˆæ¯é‡å¤&lt;/h2&gt;
&lt;p&gt;å½“ä¸€æ¡æ¶ˆæ¯å·²è¢«æˆåŠŸå‘é€åˆ°æœåŠ¡ç«¯ï¼Œæ­¤æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­ï¼Œå¯¼è‡´æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯åº”ç­”å¤±è´¥ã€‚å¦‚æœæ­¤æ—¶ç”Ÿäº§è€…æ„è¯†åˆ°æ¶ˆæ¯å‘é€å¤±è´¥å¹¶å°è¯•å†æ¬¡å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åç»­ä¼šæ”¶åˆ°ä¸¤å¤©å†…å®¹ç›¸åŒçš„æ¶ˆæ¯ã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624934825235.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ¶ˆè´¹æ—¶æ¶ˆæ¯é‡å¤&#34;&gt;æ¶ˆè´¹æ—¶æ¶ˆæ¯é‡å¤&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯æ¶ˆè´¹çš„åœºæ™¯ä¸‹ï¼Œæ¶ˆæ¯å·²æŠ•é€’åˆ°æ¶ˆè´¹è€…å¹¶å®Œæˆä¸šåŠ¡å¤„ç†ï¼Œå½“æ¶ˆè´¹æ–¹ç»™ MQ æœåŠ¡ç«¯åé¦ˆåº”ç­”çš„æ—¶å€™ç½‘ç»œé—ªæ–­ã€‚ä¸ºäº†ä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼ŒMQ æœåŠ¡ç«¯å°†åœ¨ç½‘ç»œæ¢å¤åå†æ¬¡å°è¯•æŠ•é€’ä¹‹å‰å·²è¢«æ¶ˆè´¹æ–¹å¤„ç†è¿‡çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…å°±ä¼šæ”¶åˆ°ä¸¤æ¡å†…å®¹ç›¸åŒçš„æ¶ˆæ¯ã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624935043623.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ¶ˆæ¯å¹‚ç­‰æ€§è§£å†³æ¶ˆæ¯é‡å¤é—®é¢˜&#34;&gt;æ¶ˆæ¯å¹‚ç­‰æ€§è§£å†³æ¶ˆæ¯é‡å¤é—®é¢˜&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯æºå¸¦å…¨å±€IDï¼Œæ¶ˆè´¹æ–¹æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶å…ˆæŸ¥åœ¨å¤„ç†ï¼Œæ ¹æ®å…¨å±€IDåšåˆ¤é‡æ“ä½œ&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯æ—¶æºå¸¦ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ¶ˆæ¯id&lt;/li&gt;
    &lt;li&gt;æ¶ˆè´¹è€…è·å–æ¶ˆè´¹åå…ˆæ ¹æ®idåœ¨ redis/db ä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨æ¶ˆè´¹è®°å½•&lt;/li&gt;
    &lt;li&gt;å¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡å°±æ­£å¸¸æ¶ˆè´¹ï¼Œæ¶ˆè´¹å®Œæ¯•åå†™å…¥ redis/db&lt;/li&gt;
    &lt;li&gt;å¦‚æœæ¶ˆæ¯æ¶ˆè´¹è¿‡å°±ç›´æ¥èˆå¼ƒ&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„é¡ºåºæ€§&#34;&gt;å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„é¡ºåºæ€§&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;æ¶ˆæ¯æœ‰åº&lt;/code&gt; æŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºè¿›è¡Œæ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šä¸€ç¬”è®¢å•äº§ç”Ÿäº†3æ¡æ¶ˆæ¯ï¼Œåˆ†åˆ«æ˜¯è®¢å•åˆ›å»ºï¼Œè®¢å•ä»˜æ¬¾ï¼Œè®¢å•å®Œæˆã€‚æ¶ˆè´¹æ—¶ï¼Œè¦æŒ‰ç…§é¡ºåºä¾æ¬¡æ¶ˆè´¹æ‰æœ‰æ„ä¹‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶å¤šç¬”è®¢å•ä¹‹é—´åˆæ˜¯å¯ä»¥å¹¶è¡Œæ¶ˆè´¹çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹æ–¹æŒ‰ç…§æ¶ˆæ¯å‘é€çš„é¡ºåºè¿›è¡Œæ¶ˆè´¹ï¼Œåˆ†ä¸ºå…¨å±€é¡ºåºæ¶ˆæ¯å’Œå±€éƒ¨é¡ºåºæ¶ˆæ¯ï¼Œå¸¸è§çš„æ˜¯å±€éƒ¨é¡ºåºæ¶ˆè´¹&lt;/p&gt;
&lt;p&gt;ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹ï¼š&lt;br&gt;
å…¨å±€é¡ºåºæ¶ˆè´¹ï¼Œç”Ÿäº§è€…ï¼šMQ Serverï¼šæ¶ˆè´¹è€… = 1 : 1 : 1&lt;br&gt;
å±€éƒ¨é¡ºåºæ¶ˆè´¹ï¼Œ1ï¼Œç”Ÿäº§è€…å°†åŒä¸€ç»„æ¶ˆæ¯å‘é€åˆ°å•ä¸ªé˜Ÿåˆ—ï¼›2ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œå¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼›3ï¼ŒQueue é€šè¿‡åˆ†æ®µé”ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„é¡ºåºæ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¨¡å‹1&#34;&gt;æ¨¡å‹1&lt;/h2&gt;
&lt;p&gt;M1ï¼ŒM2 æŒ‰ç…§å…ˆåé¡ºåºå‘é€åˆ°2å°Serverï¼Œè¢«2ä¸ªæ¶ˆè´¹è€…åˆ†åˆ«æ¶ˆè´¹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624937135467.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;å­˜åœ¨é—®é¢˜ï¼š1ï¼Œä¸èƒ½ä¿è¯æ¶ˆæ¯çš„é¡ºåºåˆ°è¾¾MQï¼›2ï¼Œä¸èƒ½ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¨¡å‹2&#34;&gt;æ¨¡å‹2&lt;/h2&gt;
&lt;p&gt;M1ï¼ŒM2 æŒ‰ç…§å…ˆåé¡ºåºå‘é€åˆ°1å°Serverï¼Œè¢«2ä¸ªæ¶ˆè´¹è€…åˆ†åˆ«æ¶ˆè´¹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624937236013.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;å­˜åœ¨é—®é¢˜ï¼š1ï¼Œå¯ä»¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºåˆ°è¾¾MQï¼›2ï¼Œæ¶ˆè´¹æ–¹å¦‚æœå‡ºç°ç½‘ç»œå»¶è¿Ÿé—®é¢˜ï¼Œä¸èƒ½ä¸¥æ ¼ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¨¡å‹3&#34;&gt;æ¨¡å‹3&lt;/h2&gt;
&lt;p&gt;ç”Ÿäº§è€…ï¼šMQ Serverï¼šæ¶ˆè´¹è€… ã€Š=ã€‹1 : 1 : 1&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624937379625.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä¿è¯æ¶ˆæ¯é¡ºåºåˆ°è¾¾MQï¼Œå¯ä»¥ä¿è¯æ¶ˆæ¯é¡ºåºæ¶ˆè´¹ã€‚&lt;br&gt;
å­˜åœ¨é—®é¢˜ï¼šå…¨å±€çš„é¡ºåºæ¶ˆè´¹ï¼Œä¸å¸¸è§ã€‚1ï¼Œååé‡ä¸‹é™ï¼›2ï¼Œå®¹é”™æ€§é™ä½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¨¡å‹4&#34;&gt;æ¨¡å‹4&lt;/h2&gt;
&lt;p&gt;å±€éƒ¨é¡ºåºæ¶ˆè´¹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1624937513605.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;1ï¼Œç”Ÿäº§è€…æ ¹æ®æ¶ˆæ¯IDå°†åŒä¸€ç»„æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ª &lt;code&gt;Queue&lt;/code&gt; ä¸­ï¼›&lt;br&gt;
2ï¼Œå¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶è·å– &lt;code&gt;Queue&lt;/code&gt; ä¸­çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼›&lt;br&gt;
3ï¼ŒMQ ä½¿ç”¨&lt;b&gt;åˆ†æ®µé”&lt;/b&gt;ä¿è¯å•ä¸ª &lt;code&gt;Queue&lt;/code&gt; ä¸­çš„æœ‰åºæ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åŸºäº-mq-çš„åˆ†å¸ƒå¼äº‹åŠ¡å®ç°&#34;&gt;åŸºäº MQ çš„åˆ†å¸ƒå¼äº‹åŠ¡å®ç°&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1624938219891.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æœ¬è´¨ä¸Šæ¥è¯´ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯ä¸ºäº†ä¿è¯ä¸åŒæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;ol&gt;
    &lt;li&gt;ç”¨æˆ·æäº¤è®¢å•&lt;/li&gt;
    &lt;li&gt;åº“å­˜æœåŠ¡æ“ä½œåº“å­˜DBï¼Œå‡åº“å­˜&lt;/li&gt;
    &lt;li&gt;è®¢å•æœåŠ¡æ“ä½œè®¢å•DBï¼Œç”Ÿæˆè®¢å•æ•°æ®&lt;/li&gt;
    &lt;li&gt;åº“å­˜æœåŠ¡å’Œè®¢å•æœåŠ¡è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥&lt;/li&gt;
&lt;/ol&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1624938407908.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">æ¶ˆæ¯é˜Ÿåˆ—</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/shi-yong-laradock-da-jian-ji-yu-docker-de-php-kai-fa-huan-jing/"" data-c="
          &lt;h1 id=&#34;é¦–å…ˆå°†-laradock-é¡¹ç›®ä»£ç å…‹éš†åˆ°æœ¬åœ°&#34;&gt;é¦–å…ˆå°† Laradock é¡¹ç›®ä»£ç å…‹éš†åˆ°æœ¬åœ°&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;git clone https://github.com/Laradock/laradock.git
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;è¿›å…¥-laradock-ç›®å½•å°†-env-example-é‡å‘½åä¸º-env&#34;&gt;è¿›å…¥ laradock ç›®å½•å°† env-example é‡å‘½åä¸º .env&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;cp env-example .env
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;p&gt;ç¼–è¾‘&lt;code&gt;.env&lt;/code&gt;æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# ç¼–è¾‘
APP_CODE_PATH_HOST=../ # é¡¹ç›®è·¯å¾„
CHANGE_SOURCE=true # åˆ‡æ¢æº
WORKSPACE_TIMEZONE=PRC # æ—¶åŒº
PHP_VERSION=7.3
MYSQL_VERSION=8.0
# æ–°å¢
DB_HOST=mysql
REDIS_HOST=redis
QUEUE_HOST=beanstalkd
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;è¿è¡Œå®¹å™¨&#34;&gt;è¿è¡Œå®¹å™¨&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker-compose up -d nginx mysql redis beanstalkd
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;åˆ›å»ºé¡¹ç›®&#34;&gt;åˆ›å»ºé¡¹ç›®&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;composer create-project --prefer-dist laravel/laravel test
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1615796925712.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;åš-nginx-é…ç½®&#34;&gt;åš nginx é…ç½®&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1615797075338.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1615797081492.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
é‡å¯ nginx&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker-compose up -d nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;é”™è¯¯&#34;&gt;é”™è¯¯&lt;/h1&gt;
&lt;p&gt;é—®é¢˜ï¼š&lt;br&gt;
ERROR: for nginx  Cannot start service nginx: Ports are not available: port is already allocated.&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1615794973501.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è§£å†³ï¼š&lt;br&gt;
æŒ‡å®š80ç«¯å£å·²ç»è¢«å ç”¨ï¼Œå…³é—­ç›¸åº”çš„æœåŠ¡å†é‡æ–°è¿è¡Œä¸Šè¿°å‘½ä»¤å³å¯&lt;/p&gt;
">ä½¿ç”¨ Laradock æ­å»ºåŸºäº Docker çš„ PHP å¼€å‘ç¯å¢ƒ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/docker-an-zhuang-bing-pei-zhi-redis/"" data-c="
          &lt;!-- more --&gt;
&lt;h1 id=&#34;é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„-docker-ç‰ˆæœ¬&#34;&gt;é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ docker ç‰ˆæœ¬&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://hub.docker.com/_/redis?tab=tags&amp;amp;page=1&amp;amp;ordering=last_updated&#34;&gt;https://hub.docker.com/_/redis?tab=tags&amp;amp;page=1&amp;amp;ordering=last_updated&lt;/a&gt;&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;ä½¿ç”¨-docker-å®‰è£…-redis&#34;&gt;ä½¿ç”¨ docker å®‰è£… redis&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sudo docker pull redis
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1615783536958.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;å‡†å¤‡-redis-çš„é…ç½®æ–‡ä»¶&#34;&gt;å‡†å¤‡ redis çš„é…ç½®æ–‡ä»¶&lt;/h1&gt;
&lt;p&gt;redis ä¸­æ–‡å®˜æ–¹ç½‘ç«™ï¼š&lt;a href=&#34;http://www.redis.cn/download.html&#34;&gt;http://www.redis.cn/download.html&lt;/a&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1615783307536.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è§£å‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1615783445135.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ä¿®æ”¹-redisconf-é…ç½®æ–‡ä»¶&#34;&gt;ä¿®æ”¹ redis.conf é…ç½®æ–‡ä»¶&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;bind 127.0.0.1 # æ³¨é‡Šæ‰ï¼Œä½¿ redis å¯ä»¥å¤–éƒ¨è®¿é—®&lt;/li&gt;
&lt;li&gt;daemonize no # ç”¨å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨&lt;/li&gt;
&lt;li&gt;requirepass ä½ çš„å¯†ç  # ç»™ redis è®¾ç½®å¯†ç &lt;/li&gt;
&lt;li&gt;appendonly yes # redis æŒä¹…åŒ–å¼€å¯&lt;/li&gt;
&lt;/ul&gt;
# åˆ›å»ºæœ¬åœ°ä¸ docker æ˜ å°„çš„ç›®å½•
```shell
sudo mkdir /data/redis
sudo mkdir /data/redis/data
```
&lt;p&gt;æŠŠé…ç½®æ–‡ä»¶&lt;code&gt;redis.conf&lt;/code&gt;æ‹·è´åˆ°åˆšæ‰åˆ›å»ºå¥½çš„&lt;code&gt;/data/redis&lt;/code&gt;ç›®å½•ä¸‹&lt;/p&gt;
&lt;h1 id=&#34;å¯åŠ¨-docker&#34;&gt;å¯åŠ¨ docker&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sudo docker run -p 6379:6379 --name redis -v /data/redis/redis.conf:/etc/redis/redis.conf  -v /data/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚æ•°è§£é‡Šï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;-p 6379:6379:æŠŠå®¹å™¨å†…çš„6379ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº6379ç«¯å£&lt;br&gt;
-v /data/redis/redis.conf:/etc/redis/redis.confï¼šæŠŠå®¿ä¸»æœºé…ç½®å¥½çš„ redis.conf æ”¾åˆ°å®¹å™¨å†…çš„è¿™ä¸ªä½ç½®ä¸­&lt;br&gt;
-v /data/redis/data:/dataï¼šæŠŠ redis æŒä¹…åŒ–çš„æ•°æ®åœ¨å®¿ä¸»æœºå†…æ˜¾ç¤ºï¼Œåšæ•°æ®å¤‡ä»½&lt;br&gt;
redis-server /etc/redis/redis.confï¼šè¿™ä¸ªæ˜¯å…³é”®é…ç½®ï¼Œè®© redis ä¸æ˜¯æ— é…ç½®å¯åŠ¨ï¼Œè€Œæ˜¯æŒ‰ç…§è¿™ä¸ª redis.conf çš„é…ç½®å¯åŠ¨&lt;br&gt;
-appendonly yesï¼šredis å¯åŠ¨åæ•°æ®æŒä¹…åŒ–&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ&#34;&gt;æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ&lt;/h1&gt;
&lt;p&gt;æ˜¯å¦å¯åŠ¨æˆåŠŸ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sudo docker ps
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ï¼ˆæ²¡æœ‰å¯åŠ¨æˆåŠŸä¹Ÿå¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹åŸå› ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo docker logs redis
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1615784431566.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;https://blog.csdn.net/qq_17623363/article/details/106418353&lt;/p&gt;
&lt;/blockquote&gt;
">Docker å®‰è£…å¹¶é…ç½® Redis</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/bei-guan-suo-he-le-guan-suo/"" data-c="
          &lt;h1 id=&#34;æ‚²è§‚é”&#34;&gt;æ‚²è§‚é”&lt;/h1&gt;
&lt;p&gt;åœ¨å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡Œï¼Œæ‚²è§‚å¹¶å‘æ§åˆ¶ï¼ˆåˆå&lt;code&gt;æ‚²è§‚é”&lt;/code&gt;ï¼ŒPessimistic Concurrency Controlï¼Œç¼©å†™&lt;code&gt;PCC&lt;/code&gt;ï¼‰æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆ&lt;b&gt;å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹&lt;/b&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;pre&gt;&lt;code class=&#34;language-mysql&#34;&gt;
//0.å¼€å§‹äº‹åŠ¡            
begin;/begin work;/start transaction; (ä¸‰è€…é€‰ä¸€å°±å¯ä»¥)              
//1.æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯               
select status from t_goods where id=1 for update;              
//2.æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•                
insert into t_orders (id,goods_id) values (null,1);              
//3.ä¿®æ”¹å•†å“ status ä¸º2               
update t_goods set status=2;              
//4.æäº¤äº‹åŠ¡             
commit;

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‚²è§‚å¹¶å‘æ§åˆ¶å®é™…ä¸Šæ˜¯&lt;code&gt;å…ˆå–é”å†è®¿é—®&lt;/code&gt;çš„ä¿å®ˆç­–ç•¥ï¼Œä¸ºæ•°æ®å¤„ç†çš„å®‰å…¨æä¾›äº†ä¿è¯ã€‚ä½†æ˜¯åœ¨æ•ˆç‡æ–¹é¢ï¼Œå¤„ç†åŠ é”çš„æœºåˆ¶ä¼šè®©æ•°æ®åº“äº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œè¿˜æœ‰å¢åŠ äº§ç”Ÿæ­»é”çš„æœºä¼šï¼›å¦å¤–ï¼Œåœ¨åªè¯»å‹äº‹åŠ¡å¤„ç†ä¸­ç”±äºä¸ä¼šäº§ç”Ÿå†²çªï¼Œä¹Ÿæ²¡å¿…è¦ä½¿ç”¨é”ï¼Œè¿™æ ·åšåªèƒ½å¢åŠ ç³»ç»Ÿè´Ÿè½½ï¼›è¿˜æœ‰ä¼šé™ä½äº†å¹¶è¡Œæ€§ï¼Œä¸€ä¸ªäº‹åŠ¡å¦‚æœé”å®šäº†æŸè¡Œæ•°æ®ï¼Œå…¶ä»–äº‹åŠ¡å°±å¿…é¡»ç­‰å¾…è¯¥äº‹åŠ¡å¤„ç†å®Œæ‰å¯ä»¥å¤„ç†é‚£è¡Œæ•°ã€‚&lt;br&gt;
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code&gt;FOR UPDATE&lt;/code&gt; ç”Ÿæ•ˆéœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶æ—¶æ‰ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;æ•°æ®åº“çš„å¼•æ“ä¸º innoDB&lt;/li&gt;
    &lt;li&gt;æ“ä½œä½äºäº‹åŠ¡å—ä¸­ï¼ˆBEGIN/COMMITï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¹è§‚é”&#34;&gt;ä¹è§‚é”&lt;/h1&gt;
&lt;p&gt;åœ¨å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé‡Œï¼Œä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆåˆå&lt;code&gt;ä¹è§‚é”&lt;/code&gt;ï¼ŒOptimistic Concurrency Controlï¼Œç¼©å†™&lt;code&gt;OCC&lt;/code&gt;ï¼‰æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¹è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶&lt;code&gt;version&lt;/code&gt;å’Œ CASï¼ˆCompare And Swap æ¯”è¾ƒä¸äº¤æ¢ï¼‰ç®—æ³•å®ç°ï¼ˆ&lt;b&gt;ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡&lt;/b&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç‰ˆæœ¬å·æ—¶ï¼Œå¯ä»¥åœ¨æ•°æ®åˆå§‹åŒ–æ—¶æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å¯¹æ•°æ®çš„æ›´æ–°æ“ä½œéƒ½å¯¹ç‰ˆæœ¬å·æ‰§è¡Œ+1æ“ä½œã€‚å¹¶åˆ¤æ–­å½“å‰ç‰ˆæœ¬å·æ˜¯ä¸æ˜¯è¯¥æ•°æ®çš„æœ€æ–°çš„ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-mysql&#34;&gt;
1.æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯
select (status,status,version) from t_goods where id=#{id}
2.æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•
3.ä¿®æ”¹å•†å“ status ä¸º2
update t_goods set status=2,version=version+1 where id=#{id} and version=#{version};

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹è§‚å¹¶å‘æ§åˆ¶ç›¸ä¿¡äº‹åŠ¡ä¹‹é—´çš„æ•°æ®ç«äº‰(data race)çš„æ¦‚ç‡æ˜¯æ¯”è¾ƒå°çš„ï¼Œå› æ­¤å°½å¯èƒ½ç›´æ¥åšä¸‹å»ï¼Œç›´åˆ°æäº¤çš„æ—¶å€™æ‰å»é”å®šï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿä»»ä½•é”å’Œæ­»é”ã€‚&lt;br&gt;
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¿ç”¨çš„ä¸æ˜¯ç‰ˆæœ¬å·è€Œæ˜¯å•†å“åº“å­˜ç­‰å…¶ä»–å­—æ®µå¯èƒ½ä¼šå‡ºç°&lt;code&gt;ABA&lt;/code&gt;é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªå˜é‡ V åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯ A å€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å› Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º CAS æ“ä½œçš„ &lt;code&gt;ABA&lt;/code&gt; é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;å“åº”é€Ÿåº¦ï¼šå¦‚æœéœ€è¦éå¸¸é«˜çš„å“åº”é€Ÿåº¦ï¼Œå»ºè®®é‡‡ç”¨ä¹è§‚é”æ–¹æ¡ˆï¼ŒæˆåŠŸå°±æ‰§è¡Œï¼Œä¸æˆåŠŸå°±å¤±è´¥ï¼Œä¸éœ€è¦ç­‰å¾…å…¶ä»–å¹¶å‘å»é‡Šæ”¾é”&lt;/li&gt;
    &lt;li&gt;å†²çªé¢‘ç‡ï¼šå¦‚æœå†²çªé¢‘ç‡éå¸¸é«˜ï¼Œå»ºè®®é‡‡ç”¨æ‚²è§‚é”ï¼Œä¿è¯æˆåŠŸç‡ï¼Œå¦‚æœå†²çªé¢‘ç‡å¤§ï¼Œä¹è§‚é”ä¼šéœ€è¦å¤šæ¬¡é‡è¯•æ‰èƒ½æˆåŠŸï¼Œä»£ä»·æ¯”è¾ƒå¤§&lt;/li&gt;
    &lt;li&gt;é‡è¯•ä»£ä»·ï¼šå¦‚æœé‡è¯•ä»£ä»·å¤§ï¼Œå»ºè®®é‡‡ç”¨æ‚²è§‚é”&lt;/li&gt;
&lt;/ul&gt;">æ‚²è§‚é”å’Œä¹è§‚é”</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/php-zai-cao-zuo-duan-dian-xu-chuan-shi-wen-jian-ru-he-fen-ge-he-bing/"" data-c="
          &lt;p&gt;php å®ç°æ–­ç‚¹ç»­ä¼ ï¼Œå°±éœ€è¦æŠŠå¤§æ–‡ä»¶åˆ†å‰²æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œç„¶åå•ä¸ªä¸Šä¼ ã€‚ä¼ å®Œååœ¨åˆå¹¶ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

/**
 * åˆ†éš”æ–‡ä»¶
 */
function file_split($filePath, $tmpDir = &amp;quot;tmp&amp;quot;, $fileSize = 1024)
{
    $fp = fopen($filePath, &#39;rb&#39;);
    $i = 0;
    $no = 1;
    while (!feof($fp)) {
        $file = fread($fp, $fileSize);
        $fileName = pathinfo($filePath, PATHINFO_FILENAME);
        $tmpFp = fopen(&#39;./&#39; . $tmpDir . &#39;/&#39; . $fileName . sprintf(&#39;%04d&#39;, $no) . &#39;.&#39; . $i . &#39;-&#39; . ($i + $fileSize) . &#39;.tmp&#39;, &#39;wb&#39;);
        fwrite($tmpFp, $file, $fileSize);
        fclose($tmpFp);
        $i += $fileSize + 1;
        $no++;
    }
    fclose($fp);
}

/**
 * åˆå¹¶æ–‡ä»¶
 */
function file_merge($tmpDir, $mergeFileName = &#39;merge.zip&#39;, $fileSize = 1024)
{
    $tmpFilePaths = glob($tmpDir . &#39;/*.tmp&#39;);
    @unlink($mergeFileName);
    $fp = fopen($mergeFileName, &#39;w+&#39;);
    foreach ($tmpFilePaths as $v) {
        $tmpFp = fopen($v, &#39;rb&#39;);
        $content = fread($tmpFp, $fileSize);
        fwrite($fp, $content, $fileSize);
        unset($content);
        unlink($v);
        fclose($tmpFp);
    }
    fclose($fp);
}

$dir = &#39;tmp&#39;;
// åˆ‡å‰²æ–‡ä»¶
file_split(&#39;./1.zip&#39;, $dir);
// åˆå¹¶æ–‡ä»¶
file_merge($dir);
&lt;/code&gt;&lt;/pre&gt;
">PHP åœ¨æ“ä½œæ–­ç‚¹ç»­ä¼ æ—¶æ–‡ä»¶å¦‚ä½•åˆ†å‰²åˆå¹¶</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/er-wei-shu-zu-gen-ju-mou-ge-zi-duan-pai-xu/"" data-c="
          &lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;array_multisort(array_column($array, &#39;key&#39;), SORT_DESC, $array);
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php

$arr = [
    [
        &#39;a&#39; =&amp;gt; &#39;1&#39;,
        &#39;b&#39; =&amp;gt; &#39;ä½ &#39;
    ],
    [
        &#39;a&#39; =&amp;gt; &#39;3&#39;,
        &#39;b&#39; =&amp;gt; &#39;æˆ‘&#39;
    ],
    [
        &#39;a&#39; =&amp;gt; &#39;2&#39;,
        &#39;b&#39; =&amp;gt; &#39;ä»–&#39;
    ],
];

array_multisort(array_column($arr, &#39;a&#39;), SORT_ASC, $arr);

print_r($arr);

//Array
//(
//    [0] =&amp;gt; Array
//    (
//            [a] =&amp;gt; 1
//            [b] =&amp;gt; ä½ 
//        )
//
//    [1] =&amp;gt; Array
//(
//            [a] =&amp;gt; 2
//            [b] =&amp;gt; ä»–
//        )
//
//    [2] =&amp;gt; Array
//(
//            [a] =&amp;gt; 3
//            [b] =&amp;gt; æˆ‘
//        )
//
//)
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
">äºŒç»´æ•°ç»„æ ¹æ®æŸä¸ªå­—æ®µæ’åº</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/sql-zhi-shi-zong-jie/"" data-c="
          &lt;h1 id=&#34;1-sql-é©±åŠ¨&#34;&gt;1. sql é©±åŠ¨&lt;/h1&gt;
&lt;p&gt;æ¨èé©±åŠ¨ï¼š&lt;br&gt;
* MySQL/MariaDB  â€”â€” &lt;a href=&#34;https://github.com/go-sql-driver/mysql/&#34;&gt;github.com/go-sql-driver/mysql/&lt;/a&gt;&lt;br&gt;
* Postgres SQL  â€”â€” &lt;a href=&#34;https://github.com/lib/pq&#34;&gt;github.com/lib/pq&lt;/a&gt;&lt;br&gt;
* SQLite3  â€”â€” &lt;a href=&#34;https://github.com/mattn/go-sqlite3&#34;&gt;github.com/go-sql-driver/mysql/&lt;/a&gt;&lt;br&gt;
* Oracle  â€”â€” &lt;a href=&#34;https://github.com/mattn/go-oci8&#34;&gt;github.com/go-sql-driver/mysql/&lt;/a&gt;&lt;br&gt;
* SQL Serve  â€”â€” &lt;a href=&#34;https://github.com/denisenkom/go-mssqldb&#34;&gt;github.com/go-sql-driver/mysql/&lt;/a&gt;&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;2-sqldb&#34;&gt;2. sql.DB&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;sql.DB&lt;/code&gt; ç»“æ„æ˜¯ &lt;code&gt;database/sql&lt;/code&gt; åŒ…å°è£…çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œå¯¹è±¡ï¼ŒåŒ…å«äº†æ“ä½œæ•°æ®åº“çš„åŸºæœ¬æ–¹æ³•ã€‚å¤§éƒ¨åˆ†æ—¶é—´æˆ‘ä»¬æ“ä½œæ•°æ®åº“éƒ½ä½¿ç”¨å®ƒã€‚&lt;br&gt;
å¯ä»¥æŠŠ &lt;code&gt;sql.DB&lt;/code&gt; å½“åšæ˜¯è¿æ¥æ± ï¼Œå®ƒå†…éƒ¨ä¼šè‡ªåŠ¨ç»´æŠ¤ SQL è¿æ¥çš„å…³é—­å’Œåˆ›å»ºã€‚&lt;/p&gt;
&lt;h1 id=&#34;3-è¿æ¥æ± è®¾ç½®&#34;&gt;3. è¿æ¥æ± è®¾ç½®&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// è®¾ç½®æœ€å¤§è¿æ¥æ•°
db.SetMaxOpenConns(100)

// è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°
db.SetMaxIdleConns(25)

// è®¾ç½®æ¯ä¸ªé“¾æ¥çš„è¿‡æœŸæ—¶é—´
db.SetConnMaxLifetime(5 * time.Minute)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;4-dsn&#34;&gt;4. DSN&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;DSN&lt;/code&gt; å…¨ç§°ä¸º &lt;code&gt;Data Source Name&lt;/code&gt;ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥æºï¼Œç”¨äºå®šä¹‰æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ï¼Œä¸åŒæ•°æ®åº“çš„ DSN æ ¼å¼ä¸åŒï¼ŒMySQL çš„ DSN æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// [ç”¨æˆ·å[:å¯†ç ]@][åè®®(æ•°æ®åº“æœåŠ¡å™¨åœ°å€)]]/æ•°æ®åº“åç§°?å‚æ•°åˆ—è¡¨
[username[:password]@][protocol[(address)]]/dbname[?param1=value1&amp;amp;...&amp;amp;paramN=valueN]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ mysql.Config æ¥åˆ›å»ºè¿æ¥ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// è®¾ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
config := mysql.Config{
    User:                 &amp;quot;homestead&amp;quot;,
    Passwd:               &amp;quot;secret&amp;quot;,
    Addr:                 &amp;quot;127.0.0.1:33060&amp;quot;,
    Net:                  &amp;quot;tcp&amp;quot;,
    DBName:               &amp;quot;goblog&amp;quot;,
    AllowNativePasswords: true,
}

fmt.Println(&amp;quot;conn: &amp;quot;, config.FormatDSN())
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;5-åˆå§‹åŒ–-sqldb&#34;&gt;5. åˆå§‹åŒ– sql.DB&lt;/h1&gt;
&lt;p&gt;ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;Open()&lt;/code&gt; æ–¹æ³•ä¾¿å¯åˆå§‹åŒ–å¹¶è¿”å›ä¸€ä¸ª &lt;code&gt;*sql.DB&lt;/code&gt; å®ä¾‹ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func Open(driverName, dataSourceName string) (*DB, error)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;Open()&lt;/code&gt; æ–¹æ³•åªè¦ä¼ å…¥é©±åŠ¨åç§°åŠå¯¹åº”çš„ DSN ä¾¿å¯ï¼Œä½¿ç”¨å¾ˆç®€å•ï¼Œä¹Ÿå¾ˆé€šç”¨ï¼Œå½“éœ€è¦è¿æ¥ä¸åŒæ•°æ®åº“æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹é©±åŠ¨åä¸ DSN å³å¯ã€‚é…åˆ mysql.Config ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;db, err = sql.Open(&amp;quot;mysql&amp;quot;, config.FormatDSN())
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;Open()&lt;/code&gt; æ—¶éœ€è¦çŸ¥é“çš„æ˜¯ â€”â€” æˆ‘ä»¬åªæ˜¯åšå¥½è¿æ¥çš„å‡†å¤‡ï¼Œå¹¶æœªçœŸæ˜¯è¿æ¥åˆ°æ•°æ®åº“ä¸Šã€‚å› æœªå‘ç”Ÿè¿æ¥ï¼Œæ‰€ä»¥å³ä½¿é…ç½®ä¿¡æ¯æœ‰è¯¯ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œä¼šæ­é… &lt;code&gt;Ping()&lt;/code&gt; è¿›è¡Œæµ‹è¯•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;err = db.Ping()
if err != nil {
    log.Fatal(err)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Ping()&lt;/code&gt; ä¼šä¸æ•°æ®åº“æœåŠ¡å™¨å‘ç”Ÿè¿æ¥ï¼Œå¦‚æœè¿æ¥ä¿¡æ¯æœ‰é”™è¯¯ï¼Œerr å°±ä¼šæœ‰å€¼ï¼Œå¦ä¸º nilã€‚&lt;br&gt;
DB çš„è¿çº¿éƒ½æ˜¯è¢«è®¾è®¡æ¥å½“ä½œé•¿è¿çº¿ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä¸è¯¥é¢‘ç¹çš„ Openã€Closeã€‚Open å–å¾—çš„ db å®ä¾‹ï¼Œè¦é‡å¤åˆ©ç”¨ï¼Œä¸åº”è¯¥å»é‡å¤ç”Ÿæˆã€‚&lt;/p&gt;
&lt;h1 id=&#34;5-prepare-å’Œ-stmt&#34;&gt;5. Prepare å’Œ Stmt&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;sql.DB.Prepare()&lt;/code&gt; æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª &lt;code&gt;sql.Stmt&lt;/code&gt; å¯¹è±¡ï¼Œä¸ Stmt ç›¸å…³çš„æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;stmt.Exec()
stmt.Query()
stmt.QueryRow()
stmt.Close()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åšå•ç‹¬çš„è¯­å¥æŸ¥è¯¢æ—¶ï¼Œè°¨è®°è°ƒç”¨ &lt;code&gt;defer stmt.Close()&lt;/code&gt; æ¥å…³é—­ SQL è¿æ¥ã€‚&lt;br&gt;
ä½¿ç”¨ Prepare è¯­å¥ä¼šå‘é€ä¸¤æ¬¡è¯·æ±‚åˆ°æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œç¬¬ä¸€æ¬¡æ˜¯è°ƒç”¨ Prepare() è¯­å¥æ—¶ï¼Œç¬¬äºŒæ¬¡æ˜¯è°ƒç”¨ä»¥ä¸Šæåˆ°çš„å››ä¸ª Stmt æ–¹æ³•æ—¶ï¼š&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1611198623133.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä½¿ç”¨ Prepare è¯­å¥ä¼šå‘é€ä¸¤æ¬¡è¯·æ±‚åˆ°æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œç¬¬ä¸€æ¬¡æ˜¯è°ƒç”¨ Prepare() è¯­å¥æ—¶ï¼Œç¬¬äºŒæ¬¡æ˜¯è°ƒç”¨ä»¥ä¸Šæåˆ°çš„å››ä¸ª Stmt æ–¹æ³•æ—¶ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (db *DB) Exec(query string, args ...interface{}) (Result, error)
func (db *DB) Query(query string, args ...interface{}) (*Rows, error)
func (db *DB) QueryRow(query string, args ...interface{}) *Row
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;6-exec&#34;&gt;6. Exec()&lt;/h1&gt;
&lt;p&gt;ä¸€èˆ¬å¢åŠ ã€åˆ é™¤ã€æ›´æ–°ï¼Œæˆ–è€…ä¿®æ”¹è¡¨ç»“æ„ï¼Œéƒ½ä½¿ç”¨ &lt;code&gt;sql.DB&lt;/code&gt; ä¸­çš„ &lt;code&gt;Exec()&lt;/code&gt; æ–¹æ³•æ¥å¤„ç†ã€‚&lt;br&gt;
è¯­æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (db *DB) Exec(query string, args ...interface{}) (Result, error)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å•å‚æ•°ä¸º&lt;b&gt;çº¯æ–‡æœ¬æ¨¡å¼&lt;/b&gt;ï¼Œä¸ä½¿ç”¨ Prepareï¼Œåªå‘é€ä¸€æ¡ SQL æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;db.Exec(&amp;quot;DELETE FROM articles WHERE id = &amp;quot; + strconv.FormatInt(a.ID, 10))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¤šå‚æ•°ä¸º &lt;b&gt;Prepare æ¨¡å¼&lt;/b&gt;ï¼Œåº•å±‚ä½¿ç”¨ Prepare è¯­å¥ï¼Œä¼šå‘é€ä¸¤æ¡ SQL æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;query := &amp;quot;UPDATE articles SET title = ?, body = ? WHERE id = ?&amp;quot;
rs, err := db.Exec(query, title, body, id)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬äºŒä¸ªåŠä»¥ä¸Šçš„å‚æ•°ä¸º SQL å ä½ç¬¦å¯¹åº”çš„æ•°æ®ã€‚&lt;br&gt;
&lt;code&gt;Exec()&lt;/code&gt; æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª &lt;code&gt;sql.Result&lt;/code&gt; ç±»å‹çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;7-sqlresult&#34;&gt;7. sql.Result&lt;/h1&gt;
&lt;p&gt;Result çš„å®šä¹‰å¦‚ä¸‹ï¼ŒåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;type Result interface {
    LastInsertId() (int64, error)
    RowsAffected() (int64, error)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;LastInsertId()&lt;/code&gt; æ–¹æ³•åªç”¨åœ¨ &lt;code&gt;INSERT&lt;/code&gt; è¯­å¥ä¸”æ•°æ®è¡¨æœ‰è‡ªå¢ ID æ—¶æ‰æœ‰è¿”å›è‡ªå¢ ID å€¼ï¼Œå¦åˆ™è¿”å› 0ã€‚&lt;br&gt;
&lt;code&gt;RowsAffected()&lt;/code&gt; è¡¨ç¤ºå½±å“çš„æ•°æ®è¡¨è¡Œæ•°ï¼Œæˆ‘ä»¬ä»¥æ­¤æ¥åˆ¤æ–­ &lt;code&gt;SQL&lt;/code&gt; è¯­å¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚&lt;br&gt;
SQL è¯­æ³•æ­£ç¡®çš„æƒ…å†µä¸‹ &lt;code&gt;RowsAffected()&lt;/code&gt; ä¸º 0 ï¼Œåˆ™è¡¨ç¤º SQL æ‰§è¡ŒæˆåŠŸäº†ï¼Œä½†æ˜¯æ•°æ®åº“é‡Œçš„æ•°æ®æ²¡æœ‰ä»»ä½•å˜æ›´ã€‚ä¾‹å¦‚è¯´æˆ‘ä»¬çš„æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰ ID ä¸º 6 çš„æ•°æ®ï¼Œè¿™æ—¶å€™æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;DELETE FROM articles WHERE id=6
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°±ä¼šå‡ºç° SQL æ‰§è¡ŒæˆåŠŸäº†ï¼Œä½†æ˜¯æ•°æ®æœªæ›´æ”¹çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h1 id=&#34;8-query&#34;&gt;8. Query()&lt;/h1&gt;
&lt;p&gt;ä¸€èˆ¬ä½¿ç”¨ &lt;code&gt;sql.DB&lt;/code&gt; ä¸­çš„ &lt;code&gt;Query()&lt;/code&gt; æ¥æŸ¥è¯¢å¾—åˆ°å¤šæ¡æ•°æ®ã€‚è¯­æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (db *DB) Query(query string, args ...interface{}) (*Rows, error)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚ä¸‹è·å–æ‰€æœ‰æ–‡ç« çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;rows, err := db.Query(&amp;quot;SELECT * from articles&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Query()&lt;/code&gt; æ–¹æ³•è¿”å›ä¸€ä¸ª &lt;code&gt;sql.Rows&lt;/code&gt; ç»“æ„ä½“ï¼Œä»£è¡¨ä¸€ä¸ªæŸ¥è¯¢ç»“æœé›†ã€‚&lt;br&gt;
ä½ å¯èƒ½å‘ç°äº†ï¼ŒQuery å’Œ Exec éƒ½å¯ä»¥æ‰§è¡Œ SQL è¯­å¥ï¼Œ&lt;b&gt;é‚£ä»–ä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/b&gt;&lt;br&gt;
Exec åªä¼šè¿”å›æœ€åæ’å…¥ ID å’Œå½±å“è¡Œæ•°ï¼Œè€Œ Query ä¼šè¿”å›æ•°æ®è¡¨é‡Œçš„å†…å®¹ï¼ˆç»“æœé›†ï¼‰ã€‚&lt;br&gt;
æˆ–è€…å¯ä»¥è¿™ä¹ˆè®°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Query ä¸­æ–‡è¯‘ä¸º &lt;b&gt;æŸ¥è¯¢&lt;/b&gt;ï¼Œè€Œ Exec è¯‘ä¸º &lt;b&gt;æ‰§è¡Œ&lt;/b&gt;ã€‚æƒ³æŸ¥è¯¢æ•°æ®ï¼Œä½¿ç”¨ Queryã€‚æƒ³æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ Execã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;9-sqlrows&#34;&gt;9. sql.Rows&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;sql.Rows&lt;/code&gt; æ‰€åŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (rs *Rows) Close() error                            //å…³é—­ç»“æœé›†
func (rs *Rows) ColumnTypes() ([]*ColumnType, error)    //è¿”å›æ•°æ®è¡¨çš„åˆ—ç±»å‹
func (rs *Rows) Columns() ([]string, error)             //è¿”å›æ•°æ®è¡¨åˆ—çš„åç§°
func (rs *Rows) Err() error                      // é”™è¯¯é›†
func (rs *Rows) Next() bool                      // æ¸¸æ ‡ï¼Œä¸‹ä¸€è¡Œ
func (rs *Rows) Scan(dest ...interface{}) error  // æ‰«æç»“æ„ä½“
func (rs *Rows) NextResultSet() bool            
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»“æœé›†åœ¨æ£€å‡ºå®Œ err ä»¥åï¼Œéå†æ•°æ®ä¹‹å‰ï¼Œåº”è°ƒç”¨ &lt;code&gt;defer rows.Close()&lt;/code&gt; æ¥å…³é—­ SQL è¿æ¥ã€‚&lt;br&gt;
ä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨ &lt;code&gt;rows.Next()&lt;/code&gt; æ¥éå†æ•°æ®ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;var articles []Article
//2. å¾ªç¯è¯»å–ç»“æœ
for rows.Next() {
    var article Article
    // 2.1 æ‰«ç æ¯ä¸€è¡Œçš„ç»“æœå¹¶èµ‹å€¼åˆ°ä¸€ä¸ª article å¯¹è±¡ä¸­
    err := rows.Scan(&amp;amp;article.ID, &amp;amp;article.Title, &amp;amp;article.Body)
    if err != nil {
        log.Fatal(err)
    }
    // 2.2 å°† article è¿½åŠ åˆ° articles çš„è¿™ä¸ªæ•°ç»„ä¸­
    articles = append(articles, article)
}
// 2.3 æ£€æµ‹å¾ªç¯æ—¶æ˜¯å¦å‘ç”Ÿé”™è¯¯
err = rows.Err()
if err != nil {
    log.Fatal(err)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¾ªç¯å®Œæ¯•éœ€æ£€æµ‹æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚&lt;br&gt;
&lt;code&gt;rows.Scan()&lt;/code&gt; å‚æ•°çš„é¡ºåºå¾ˆé‡è¦ï¼Œéœ€è¦å’ŒæŸ¥è¯¢çš„ç»“æœçš„ column å¯¹åº”ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;SELECT * from articles
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è€Œæˆ‘ä»¬çš„ articles çš„è¡¨ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;CREATE TABLE `articles` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `title` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  `body` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŸ¥è¯¢åˆ°çš„æ¯ä¸€è¡Œçš„ column é¡ºåºæ˜¯ id, title, bodyï¼Œå› æ­¤ rows.Scan ä¹Ÿéœ€è¦æŒ‰ç…§æ­¤é¡ºåºä¸ç„¶ä¼šé€ æˆæ•°æ®è¯»å–çš„é”™ä½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;10-queryrow&#34;&gt;10. QueryRow()&lt;/h1&gt;
&lt;p&gt;å¦‚æœæ˜¯è¯»å–ä¸€è¡Œæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ QueryRow()ï¼Œè¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (db *DB) QueryRow(query string, args ...interface{}) *Row
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿”å›çš„æ˜¯ä¸€ä¸ª &lt;code&gt;sql.Row&lt;/code&gt; å¯¹è±¡ï¼Œä¸å…¶ç›¸å…³çš„è°ƒç”¨æœ‰ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (r *Row) Scan(dest ...interface{}) error
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;sql.Row&lt;/code&gt; æ²¡æœ‰ &lt;code&gt;Close&lt;/code&gt; æ–¹æ³•ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ &lt;code&gt;Scan()&lt;/code&gt; æ—¶å°±ä¼šè‡ªåŠ¨å…³é—­ SQL è¿æ¥ã€‚æ‰€ä»¥ä¸ºäº†é˜²æ­¢å¿˜è®°å…³é—­è€Œæµªè´¹èµ„æºï¼Œä¸€èˆ¬éœ€è¦å…»æˆè¿ç€è°ƒç”¨ &lt;code&gt;Scan()&lt;/code&gt; ä¹ æƒ¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;article := Article{}
query := &amp;quot;SELECT * FROM articles WHERE id = ?&amp;quot;
err := db.QueryRow(query, id).Scan(&amp;amp;article.ID, &amp;amp;article.Title, &amp;amp;article.Body)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»¥ä¸Šæˆ‘ä»¬ä»æ•°æ®åº“ä¸­è¯»å–å¯¹åº” ID çš„ä¸€æ¡æ•°æ®ï¼Œå¹¶ç«‹åˆ»è°ƒç”¨ &lt;code&gt;Scan()&lt;/code&gt; è¯»å–æ•°æ®åˆ° article å˜é‡é‡Œã€‚&lt;br&gt;
å½“å‡ºç°è¯·æ±‚ç»“æœä¸æ­¢ä¸€æ¡æ•°æ®çš„æƒ…å†µï¼Œ&lt;code&gt;QueryRow()&lt;/code&gt; ä¼šåªä½¿ç”¨ç¬¬ä¸€æ¡æ•°æ®ã€‚&lt;/p&gt;
&lt;h1 id=&#34;11-context-ä¸Šä¸‹æ–‡&#34;&gt;11. Context ä¸Šä¸‹æ–‡&lt;/h1&gt;
&lt;p&gt;ä¸‰ä¸ªå¸¸ç”¨çš„ SQL è¯·æ±‚æ–¹æ³•éƒ½æœ‰å…¶æ”¯æŒä¸Šä¸‹æ–‡çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (db *DB) Exec(query string, args ...interface{}) (Result, error)
func (db *DB) ExecContext(ctx context.Context, query string, args ...interface{}) (Result, error)
func (db *DB) Query(query string, args ...interface{}) (*Rows, error)
func (db *DB) QueryContext(ctx context.Context, query string, args ...interface{}) (*Rows, error)
func (db *DB) QueryRow(query string, args ...interface{}) *Row
func (db *DB) QueryRowContext(ctx context.Context, query string, args ...interface{}) *Row
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ”¯æŒ Context ä¸Šä¸‹æ–‡çš„æ–¹æ³•ä¼ å‚æ ‡å‡†åº“ context é‡Œçš„ context.Context å¯¹è±¡å®ä¾‹ã€‚&lt;br&gt;
åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯é‡Œï¼Œæˆ‘ä»¬éœ€è¦ SQL è¯·æ±‚åœ¨æ‰§è¡Œè¿˜æœªå®Œæˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆä»–ä»¬ï¼ˆcancelï¼‰ï¼Œæˆ–è€…ä¸ºè¯·æ±‚è®¾ç½®æœ€é•¿æ‰§è¡Œæ—¶é—´ï¼ˆtimeoutï¼‰ï¼Œå°±ä¼šç”¨åˆ°è¿™äº›æ–¹æ³•ã€‚&lt;br&gt;
åœ¨è¿™é‡Œä½ åªéœ€è¦è®°ä½æœ‰è¿™äº›æ–¹æ³•å³å¯ï¼Œæ‰‹åŠ¨ç®¡ç†ä¸Šä¸‹æ–‡ SQL  è¯·æ±‚ä½¿ç”¨åœºæ™¯è¾ƒå°‘ï¼Œç¯‡å¹…è€ƒè™‘è¿™é‡Œä¸åšèµ˜è¿°ã€‚&lt;br&gt;
å¦å¤–éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œæ‰€æœ‰çš„è¯·æ±‚æ–¹æ³•åº•å±‚éƒ½æ˜¯ç”¨å…¶ä¸Šä¸‹æ–‡ç‰ˆæœ¬çš„æ–¹æ³•è°ƒç”¨ï¼Œä¸”ä¼ å…¥é»˜è®¤çš„ä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚ Exec() çš„æºç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (db *DB) Exec(query string, args ...interface{}) (Result, error) {
    return db.ExecContext(context.Background(), query, args...)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åº•å±‚è°ƒç”¨çš„æ˜¯ &lt;code&gt;ExecContext()&lt;/code&gt; æ–¹æ³•ã€‚&lt;code&gt;context.Background()&lt;/code&gt; æ˜¯é»˜è®¤çš„ä¸Šä¸‹æ–‡ï¼Œè¿™æ˜¯ä¸€ä¸ªç©ºçš„ &lt;code&gt;context&lt;/code&gt; ï¼Œæˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œå–æ¶ˆã€èµ‹å€¼ã€è®¾ç½® deadline ç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;h1 id=&#34;12-äº‹åŠ¡å¤„ç†-sqltx&#34;&gt;12. äº‹åŠ¡å¤„ç† sql.Tx&lt;/h1&gt;
&lt;p&gt;åœ¨å‰é¢è¯¾ç¨‹çš„ SQL æ“ä½œä¸­ï¼Œæˆ‘ä»¬éƒ½æ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œå½“å…¶ä¸­æŸä¸ªè¯­å¥æ‰§è¡Œé”™è¯¯ï¼Œåˆ™å‰é¢å·²ç»æ‰§è¡Œçš„ SQL è¯­å¥æ— æ³•å›æ»šã€‚&lt;br&gt;
å¯¹äºä¸€äº›è¦æ±‚æ¯”è¾ƒä¸¥æ ¼çš„ä¸šåŠ¡é€»è¾‘æ¥è¯´ï¼Œå¦‚ä»˜æ¬¾ã€è½¬è´¦ç­‰ï¼Œåº”è¯¥åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤å¤šæ¡ SQL è¯­å¥ï¼Œé¿å…å‘ç”Ÿæ‰§è¡Œå‡ºé”™æ— æ³•å›æ»šäº‹åŠ¡çš„æƒ…å†µã€‚&lt;br&gt;
ä½¿ç”¨ä»¥ä¸‹å¯ä»¥å¼€å¯äº‹åŠ¡ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (db *DB) Begin() (*Tx, error)
func (db *DB) BeginTx(ctx context.Context, opts *TxOptions) (*Tx, error)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Begin()&lt;/code&gt; å’Œ &lt;code&gt;BeginTxt()&lt;/code&gt; æ–¹æ³•è¿”å›ä¸€ä¸ª sql.Tx ç»“æ„ä½“ï¼Œä»–æ”¯æŒä»¥ä¸Šæˆ‘ä»¬æåˆ°è¿‡çš„å‡ ç§æŸ¥è¯¢æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (tx *Tx) Exec(query string, args ...interface{}) (Result, error)
func (tx *Tx) ExecContext(ctx context.Context, query string, args ...interface{}) (Result, error)
func (tx *Tx) Query(query string, args ...interface{}) (*Rows, error)
func (tx *Tx) QueryContext(ctx context.Context, query string, args ...interface{}) (*Rows, error)
func (tx *Tx) QueryRow(query string, args ...interface{}) *Row
func (tx *Tx) QueryRowContext(ctx context.Context, query string, args ...interface{}) *Row

// é¢„ç¼–è¯‘ Prepare
func (tx *Tx) Stmt(stmt *Stmt) *Stmt
func (tx *Tx) StmtContext(ctx context.Context, stmt *Stmt) *Stmt
func (tx *Tx) Prepare(query string) (*Stmt, error)
func (tx *Tx) PrepareContext(ctx context.Context, query string) (*Stmt, error)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨è¿™åŒä¸€ä¸ª &lt;code&gt;sql.Tx&lt;/code&gt; å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œå°±ä¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½¿ç”¨ &lt;code&gt;sql.Tx&lt;/code&gt; çš„æ“ä½œæ–¹å¼æ“ä½œæ•°æ®åï¼Œéœ€è¦ä½¿ç”¨ &lt;code&gt;sql.Tx&lt;/code&gt; çš„ &lt;code&gt;Commit()&lt;/code&gt; æ–¹æ³•æäº¤äº‹åŠ¡ï¼Œå¦‚æœå‡ºé”™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ &lt;code&gt;sql.Tx&lt;/code&gt; ä¸­çš„ &lt;code&gt;Rollback()&lt;/code&gt; æ–¹æ³•å›æ»šäº‹åŠ¡ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¸‹é¢æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (tx *Tx) Commit() error
func (tx *Tx) Rollback() error
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (s Service) DoSomething() (err error) {
    // 1. åˆ›å»ºäº‹åŠ¡
    tx, err := s.db.Begin()
    if err != nil {
        return
    }
    // 2. å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œå°±å›æ»šæ‰€æœ‰ SQL æ“ä½œï¼Œå¦åˆ™æäº¤
    //    defer ä¼šåœ¨å½“å‰æ–¹æ³•çš„æœ€åæ‰§è¡Œ
    defer func() {
        if err != nil {
            tx.Rollback()
            return err
        }
        err = tx.Commit()
    }()

    // 3. æ‰§è¡Œå„ç§è¯·æ±‚
    if _, err = tx.Exec(...); err != nil {
        return err
    }
    if _, err = tx.Exec(...); err != nil {
        return err
    }
    // ...
    return nil
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰ SQL æ“ä½œéƒ½å¿…é¡»ä½¿ç”¨ &lt;code&gt;tx&lt;/code&gt; æ¥æ“ä½œï¼Œæ‰èƒ½æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœä¸­é—´ä½¿ç”¨ &lt;code&gt;db.Exec()&lt;/code&gt; é‚£è¿™æ¡è¯­å¥æ˜¯æ— æ³•å›æ»šçš„ã€‚&lt;/p&gt;
">Go sql çŸ¥è¯†æ€»ç»“</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/you-ya-di-shi-xian-zai-python-tui-chu-shi-qiang-zhi-yun-xing-yi-duan-dai-ma/"" data-c="
          &lt;p&gt;å¦‚æœæœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œä½ è¦ç»™ä¸€ä¸ªé¡¹ç›®å¼€å‘æµ‹è¯•ç¨‹åºï¼Œç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™ï¼Œä¼šåˆ›å»ºåˆå§‹ç¯å¢ƒï¼Œæµ‹è¯•å®Œæˆä»¥åï¼Œä¼šæ¸…ç†ç¯å¢ƒã€‚&lt;br&gt;
ä½¿ç”¨ Python è‡ªå¸¦çš„ &lt;code&gt;atexit&lt;/code&gt; è¿™ä¸ªæ¨¡å—&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import atexit

@atexit.register
def clean():
    print(&amp;quot;æ¸…ç†ç¯å¢ƒç›¸å…³çš„ä»£ç &amp;quot;)

def test():
    print(&amp;quot;è¿™é‡Œå…ˆæ‰§è¡Œ&amp;quot;)
    example = {&#39;a&#39;: 1, &#39;b&#39;: 2}
    print(example[&#39;c&#39;])  # æ˜¾ç„¶è¿™é‡Œä¼šæŠ¥é”™

test()

# è¿™é‡Œå…ˆæ‰§è¡Œ
# Traceback (most recent call last):
# æ¸…ç†ç¯å¢ƒç›¸å…³çš„ä»£ç 
#   File &amp;quot;/Users/dupeng/m7/Python/Web/demo.py&amp;quot;, line 15, in &amp;lt;module&amp;gt;
#     test()
#   File &amp;quot;/Users/dupeng/m7/Python/Web/demo.py&amp;quot;, line 12, in test
#     print(example[&#39;c&#39;])  # æ˜¾ç„¶è¿™é‡Œä¼šæŠ¥é”™
# KeyError: &#39;c&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;p&gt;&lt;code&gt;atexit&lt;/code&gt; ä½¿ç”¨ä¸­æœ‰ä¸‹é¢å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ å¯ä»¥æ³¨å†Œå¤šä¸ªé€€å‡ºå‡½æ•°ï¼Œä»–ä»¬ä¼šæŒ‰ç…§æ³¨å†Œæ—¶é—´ä»æ™šåˆ°æ—©ä»¥æ­¤æ‰§è¡Œã€‚ä¾‹å¦‚
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import atexit

@atexit.register
def clean_1():
    ...

@atexit.register
def clean_2():
    ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¼šå…ˆè¿è¡Œ &lt;code&gt;clean_2()&lt;/code&gt; åè¿è¡Œ &lt;code&gt;clean_1()&lt;/code&gt;&lt;/li&gt;&lt;/p&gt;
&lt;li&gt;å¦‚æœ `clean()` å‡½æ•°æœ‰å‚æ•°ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¸ç”¨è£…é¥°å™¨ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨ `atexit.register(clean_1, å‚æ•°1, å‚æ•°2, å‚æ•°3=&#39;xxx&#39;)`&lt;/li&gt;
&lt;li&gt;å¦‚æœç¨‹åºæ˜¯è¢«ä½ æ²¡æœ‰å¤„ç†è¿‡çš„ç³»ç»Ÿä¿¡å·æ€æ­»çš„ï¼Œé‚£ä¹ˆæ³¨å†Œçš„å‡½æ•°æ— æ³•æ­£å¸¸æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœå‘ç”Ÿäº†ä¸¥é‡çš„Pythonå†…éƒ¨é”™è¯¯ï¼Œä½ æ³¨å†Œçš„å‡½æ•°æ— æ³•æ­£å¸¸æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æ‰‹åŠ¨è°ƒç”¨äº† `os._exit()`ï¼Œä½ æ³¨å†Œçš„å‡½æ•°æ— æ³•æ­£å¸¸æ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;https://mp.weixin.qq.com/s/Q65F49ZhFV02mqVPyxILHg&lt;/p&gt;
&lt;/blockquote&gt;
">ä¼˜é›…åœ°å®ç°åœ¨ Python é€€å‡ºæ—¶å¼ºåˆ¶è¿è¡Œä¸€æ®µä»£ç </a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/mysql-xie-sql-de-21-ge-hao-xi-guan-xue-xi-gong-zuo-xiao-lu-fan-bei/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;https://learnku.com/articles/51820&lt;/p&gt;
&lt;/blockquote&gt;
">MySQL å†™ sql çš„21ä¸ªå¥½ä¹ æƒ¯ï¼Œå­¦ä¹ å·¥ä½œæ•ˆç‡ç¿»å€</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/python-zheng-ze/"" data-c="
          &lt;p&gt;Python å†…ç½® &lt;code&gt;reæ¨¡å—&lt;/code&gt; å¤„ç†æ­£åˆ™è¡¨è¾¾å¼ï¼Œæä¾›äº†ä¸‹è¿°å‡½æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
    &lt;li&gt;&lt;b&gt;åŒ¹é…ï¼ˆæ‰¾ä¸€ä¸ªï¼‰&lt;/b&gt;ï¼šmatch() -&gt; ä»å¼€å¤´è¿›è¡ŒåŒ¹é…ã€search() -&gt; æ‰«ææ•´ä¸ªå­—ç¬¦ä¸²&lt;/li&gt;
    &lt;li&gt;&lt;b&gt;æ£€ç´¢ä¸æ›¿æ¢ï¼ˆæ‰¾å¤šä¸ªï¼‰&lt;/b&gt;ï¼šfindall() -&gt; æ‰«ææ•´ä¸ªå­—ç¬¦ä¸²æ‰€æœ‰èƒ½åŒ¹é…çš„ã€finditer() ã€split() -&gt; åˆ†å‰²&lt;/li&gt;
    &lt;li&gt;&lt;b&gt;ç¼–è¯‘ Pattern å¯¹è±¡&lt;/b&gt;ï¼šå¤šæ¬¡è°ƒç”¨ç›¸åŒæ­£åˆ™ï¼Œå°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆ Pattern å¯¹è±¡å¤ç”¨&lt;/li&gt;
    &lt;li&gt;&lt;b&gt;åˆ†ç»„&lt;/b&gt;ï¼šgroup() -&gt; è·å¾—åˆ†ç»„åŒ¹é…å†…å®¹ï¼Œå¦‚ group(1) è·å¾—ç¬¬ä¸€ä¸ªåŒ¹é…åˆ†ç»„&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;p&gt;ç„¶åè°ƒç”¨è¿™äº›å‡½æ•°å¯ä»¥ä¼ å…¥ä¸€ä¸ª &lt;code&gt;flags&lt;/code&gt; å‚æ•°ï¼ˆæ ‡å¿—ä½ä¿®é¥°ç¬¦ï¼‰ï¼Œæ¥æ§åˆ¶åŒ¹é…æ¨¡å¼ï¼Œå¯ä½¿ç”¨å¤šä¸ªï¼Œç”¨ &lt;code&gt;|&lt;/code&gt; è¿›è¡Œè¿æ¥&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1626401704192.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•ï¼šï¼ˆ&lt;b&gt;å­—ç¬¦ -&amp;gt; æ•°é‡ -&amp;gt; è¾¹ç•Œ -&amp;gt; åˆ†ç»„ -&amp;gt; æ–­è¨€ -&amp;gt; è´ªå©ªä¸éè´ªå©ª&lt;/b&gt;ï¼‰&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1626401856552.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1626401864250.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1626401867400.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1626401869852.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ–­è¨€å°±æ˜¯ï¼šç»™æŒ‡å®šä½ç½®åŠ ä¸€ä¸ª&lt;b&gt;é™å®šæ¡ä»¶&lt;/b&gt;ï¼Œè§„å®š&lt;b&gt;æ­¤ä½ç½®å‰/åçš„å­—ç¬¦éœ€æ»¡è¶³æ¡ä»¶æ‰ç®—åŒ¹é…æˆåŠŸ&lt;/b&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1626401988170.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ­£åˆ™åŒ¹é…é»˜è®¤æ˜¯&lt;b&gt;è´ªå©ªåŒ¹é…&lt;/b&gt;ï¼Œå°±æ˜¯åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1626402081453.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;éœ€è¦åŒ¹é…ç‰¹æ®Šå­—ç¬¦ä¸²æ—¶ï¼Œå¯åœ¨å‰é¢åŠ åæ–œæ è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚ &lt;code&gt;\\(&lt;/code&gt;ï¼Œæƒ³é¿å…å¤šæ¬¡è½¬ä¹‰é€ æˆçš„åæ–œæ å›°æ‰°ï¼Œå¯åœ¨æ­£åˆ™è¡¨è¾¾å¼å‰åŠ ä¸Š &lt;code&gt;r&lt;/code&gt; ä¿®é¥°ï¼Œå‘ŠçŸ¥ç¼–è¯‘å™¨å®ƒæ˜¯åŸå§‹å­—ç¬¦ä¸²ï¼Œä¸è¦è½¬ä¹‰åæ–œæ ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1603761872681.jpeg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">Python æ­£åˆ™</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/python-zhuang-shi-qi/"" data-c="
          &lt;p&gt;&lt;code&gt;è£…é¥°å™¨(Decorator)&lt;/code&gt;æœ¬è´¨ä¸Šå°±æ˜¯ä¸ªæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå‡½æ•°çš„é«˜é˜¶å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;b&gt;è£…é¥°å™¨çš„ä½œç”¨&lt;/b&gt;ï¼šå¯ä»¥åœ¨ä»£ç è¿è¡ŒæœŸé—´åŠ¨æ€å¢åŠ å‡½æ•°åŠŸèƒ½ï¼Œå³åŠ¨æ€æ‰©å±•å‡½æ•°åŠŸèƒ½çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h3 id=&#34;ç¬¬ä¸€æ­¥&#34;&gt;ç¬¬ä¸€æ­¥&lt;/h3&gt;
&lt;p&gt;å‡†å¤‡ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå¹¶çŸ¥é“å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª &lt;code&gt;_name_&lt;/code&gt; çš„å±æ€§ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def show(a, b):
    print(a, b)

show(1, 2)
print(show.__name__)

# 1 2
# show
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç¬¬äºŒæ­¥&#34;&gt;ç¬¬äºŒæ­¥&lt;/h3&gt;
&lt;p&gt;è£…é¥°å™¨ç®€å•è¯­æ³•çš„ä½¿ç”¨ä»¥åŠ &lt;code&gt;@&lt;/code&gt; è¯­æ³•çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def log(func):
    def wrapper(*args, **kwargs):
        print(&amp;quot;æˆ‘åœ¨showä¹‹å‰æ‰“å°&amp;quot;)
        func(*args, **kwargs)
        print(&amp;quot;æˆ‘åœ¨showä¹‹åæ‰“å°&amp;quot;)
    return wrapper

@log
def show(a, b):
    print(a, b)

show(1, 2)
print(show.__name__)

# æˆ‘åœ¨showä¹‹å‰æ‰“å°
# 1 2
# æˆ‘åœ¨showä¹‹åæ‰“å°
# wrapper
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‰©å±•äº† &lt;code&gt;show&lt;/code&gt; å‡½æ•°æœ¬èº«çš„åŠŸèƒ½ï¼Œè°ƒç”¨å‡½æ•°å¯¹è±¡ &lt;code&gt;__name__&lt;/code&gt; çš„å±æ€§å¾—åˆ°ä¸å†æ˜¯ &lt;code&gt;show&lt;/code&gt; è€Œæ˜¯ &lt;code&gt;wrapper&lt;/code&gt;ï¼Œæ˜¾ç¤ºæ˜¯ä¸åˆç†çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ç¬¬ä¸‰æ­¥&#34;&gt;ç¬¬ä¸‰æ­¥&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå®Œæ•´çš„ &lt;code&gt;decorator&lt;/code&gt; çš„å†™æ³•ï¼Œ&lt;code&gt;functools&lt;/code&gt; åº“çš„è°ƒç”¨ï¼Œ&lt;code&gt;@functools.wrap()&lt;/code&gt; çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import functools
def log(func):
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        print(&amp;quot;æˆ‘åœ¨showä¹‹å‰æ‰“å°&amp;quot;)
        func(*args, **kwargs)
        print(&amp;quot;æˆ‘åœ¨showä¹‹åæ‰“å°&amp;quot;)
    return wrapper

@log
def show(a, b):
    print(a, b)

show(1, 2)
print(show.__name__)

# æˆ‘åœ¨showä¹‹å‰æ‰“å°
# 1 2
# æˆ‘åœ¨showä¹‹åæ‰“å°
# show
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç¬¬å››æ­¥&#34;&gt;ç¬¬å››æ­¥&lt;/h3&gt;
&lt;p&gt;å­¦ä¼šå½“ä¸€ä¸ªè£…é¥°å™¨æœ¬èº«éœ€è¦ä¼ å…¥å‚æ•°æ—¶ï¼Œå¦‚ä½•å†™è£…é¥°å™¨ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import functools
def log(text):
    def decor(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            print(&amp;quot;æˆ‘åœ¨showä¹‹å‰æ‰“å°&amp;quot;)
            print(&amp;quot;====&amp;quot;, text, &amp;quot;====&amp;quot;)
            func(*args, **kwargs)
            print(&amp;quot;æˆ‘åœ¨showä¹‹åæ‰“å°&amp;quot;)
        return wrapper
    return decor

@log(&amp;quot;æˆ‘æ˜¯ä¼ å…¥çš„å‚æ•°&amp;quot;)
def show(a, b):
    print(a, b)

show(1, 2)
print(show.__name__)

# æˆ‘åœ¨showä¹‹å‰æ‰“å°
# ==== æˆ‘æ˜¯ä¼ å…¥çš„å‚æ•° ====
# 1 2
# æˆ‘åœ¨showä¹‹åæ‰“å°
# show
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç¬¬äº”æ­¥&#34;&gt;ç¬¬äº”æ­¥&lt;/h3&gt;
&lt;p&gt;ç±»è£…é¥°å™¨&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class A(object):
    def __init__(self, func):
        self.func = func

    def __call__(self, *args, **kwargs):
        print(&amp;quot;== before func ==&amp;quot;)
        return self.func(*args, **kwargs)


@A
def test_func(name):
    return &#39;hello &#39; + name


if __name__ == &#39;__main__&#39;:
    t = test_func(&amp;quot;å°å°&amp;quot;)
    print(t)

# == before func ==
# hello å°å°
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç¬¬å…­æ­¥&#34;&gt;ç¬¬å…­æ­¥&lt;/h3&gt;
&lt;p&gt;å¸¦å‚æ•°çš„ç±»è£…é¥°å™¨&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from functools import wraps


class A(object):
    def __init__(self, name):
        self.name = name

    def __call__(self, func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            print(&amp;quot;== before func ==&amp;quot;)
            print(self.name)
            return func(*args, **kwargs)

        return wrapper


@A(&amp;quot;å°æ˜&amp;quot;)
def test_func(name):
    return &#39;hello &#39; + name


if __name__ == &#39;__main__&#39;:
    t = test_func(&amp;quot;å°å°&amp;quot;)
    print(t)
    
# == before func ==
# å°æ˜
# hello å°å°
&lt;/code&gt;&lt;/pre&gt;
">Python è£…é¥°å™¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/python-lei-duo-ji-cheng/"" data-c="
          &lt;p&gt;Pythonçš„ç±»å¦‚æœç»§æ‰¿äº†å¤šä¸ªç±»ï¼Œé‚£ä¹ˆå…¶å¯»æ‰¾æ–¹æ³•çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šæ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆã€‚&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1603672655150.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ç±»æ˜¯ç»å…¸ç±»æ—¶ï¼Œå¤šç»§æ‰¿æƒ…å†µä¸‹ï¼Œä¼šæŒ‰ç…§æ·±åº¦ä¼˜å…ˆæ–¹å¼æŸ¥æ‰¾&lt;/li&gt;
&lt;li&gt;å½“ç±»æ˜¯æ–°å¼ç±»æ—¶ï¼Œå¤šç»§æ‰¿æƒ…å†µä¸‹ï¼Œä¼šæŒ‰ç…§å¹¿åº¦ä¼˜å…ˆæ–¹å¼æŸ¥æ‰¾&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;blockquote&gt;
&lt;p&gt;ç»å…¸ç±»å’Œæ–°å¼ç±»ï¼Œä»å­—é¢ä¸Šå¯ä»¥çœ‹å‡ºä¸€ä¸ªè€ä¸€ä¸ªæ–°ï¼Œæ–°çš„å¿…ç„¶åŒ…å«äº†è·Ÿå¤šçš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯ä¹‹åæ¨èçš„å†™æ³•ï¼Œä»å†™æ³•ä¸ŠåŒºåˆ†çš„è¯ï¼Œå¦‚æœ å½“å‰ç±»æˆ–è€…çˆ¶ç±»ç»§æ‰¿äº† &lt;code&gt;object&lt;/code&gt; ç±»ï¼Œé‚£ä¹ˆè¯¥ç±»ä¾¿æ˜¯æ–°å¼ç±»ï¼Œå¦åˆ™ä¾¿æ˜¯ç»å…¸ç±»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1603672935665.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;ç»å…¸ç±»å¤šç»§æ‰¿&#34;&gt;ç»å…¸ç±»å¤šç»§æ‰¿&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class D:

    def bar(self):
        print(&#39;D.bar&#39;)

class C(D):

    def bar(self):
        print(&#39;C.bar&#39;)

class B(D):

    def bar(self):
        print(&#39;B.bar&#39;)

class A(B, C):

    def bar(self):
        print(&#39;A.bar&#39;)

a = A()
# æ‰§è¡Œbaræ–¹æ³•æ—¶
# é¦–å…ˆå»Aç±»ä¸­æŸ¥æ‰¾ï¼Œ
# å¦‚æœAç±»ä¸­æ²¡æœ‰ï¼Œåˆ™ç»§ç»­å»Bç±»ä¸­æ‰¾ï¼Œ
# å¦‚æœBç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Dç±»ä¸­æ‰¾ï¼Œ
# å¦‚æœDç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Cç±»ä¸­æ‰¾ï¼Œ
# å¦‚æœè¿˜æ˜¯æœªæ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™
# æ‰€ä»¥ï¼ŒæŸ¥æ‰¾é¡ºåºï¼šA --&amp;gt; B --&amp;gt; D --&amp;gt; C
# åœ¨ä¸Šè¿°æŸ¥æ‰¾baræ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œåˆ™å¯»æ‰¾è¿‡ç¨‹ç«‹å³ä¸­æ–­ï¼Œä¾¿ä¸ä¼šå†ç»§ç»­æ‰¾äº†
a.bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ–°å¼ç±»å¤šç»§æ‰¿&#34;&gt;æ–°å¼ç±»å¤šç»§æ‰¿&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class D(object):

    def bar(self):
        print(&#39;D.bar&#39;)

class C(D):

    def bar(self):
        print(&#39;C.bar&#39;)

class B(D):

    def bar(self):
        print(&#39;B.bar&#39;)

class A(B, C):

    def bar(self):
        print(&#39;A.bar&#39;)

a = A()
# æ‰§è¡Œbaræ–¹æ³•æ—¶
# é¦–å…ˆå»Aç±»ä¸­æŸ¥æ‰¾ï¼Œ
# å¦‚æœAç±»ä¸­æ²¡æœ‰ï¼Œåˆ™ç»§ç»­å»Bç±»ä¸­æ‰¾ï¼Œ
# å¦‚æœBç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Cç±»ä¸­æ‰¾ï¼Œ
# å¦‚æœCç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Dç±»ä¸­æ‰¾ï¼Œ
# å¦‚æœè¿˜æ˜¯æœªæ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™
# æ‰€ä»¥ï¼ŒæŸ¥æ‰¾é¡ºåºï¼šA --&amp;gt; B --&amp;gt; C --&amp;gt; D
# åœ¨ä¸Šè¿°æŸ¥æ‰¾baræ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œåˆ™å¯»æ‰¾è¿‡ç¨‹ç«‹å³ä¸­æ–­ï¼Œä¾¿ä¸ä¼šå†ç»§ç»­æ‰¾äº†
a.bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»å…¸ç±»ï¼šé¦–å…ˆå»Aç±»ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœAç±»ä¸­æ²¡æœ‰ï¼Œåˆ™ç»§ç»­å»Bç±»ä¸­æ‰¾ï¼Œå¦‚æœBç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Dç±»ä¸­æ‰¾ï¼Œå¦‚æœDç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Cç±»ä¸­æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æœªæ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™&lt;/p&gt;
&lt;p&gt;æ–°å¼ç±»ï¼šé¦–å…ˆå»Aç±»ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœAç±»ä¸­æ²¡æœ‰ï¼Œåˆ™ç»§ç»­å»Bç±»ä¸­æ‰¾ï¼Œå¦‚æœBç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Cç±»ä¸­æ‰¾ï¼Œå¦‚æœCç±»ä¸­ä¹ˆæœ‰ï¼Œåˆ™ç»§ç»­å»Dç±»ä¸­æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æœªæ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨ä¸Šè¿°æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œåˆ™å¯»æ‰¾è¿‡ç¨‹ç«‹å³ä¸­æ–­ï¼Œä¾¿ä¸ä¼šå†ç»§ç»­æ‰¾äº†ã€‚&lt;/p&gt;
">Python ç±»å¤šç»§æ‰¿</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/gitlab-server-de-da-jian/"" data-c="
          &lt;p&gt;sudo yum install -y git vim gcc glibc-static telnet&lt;br&gt;
sudo yum install -y curl policycoreutils-python openssh-server&lt;br&gt;
sudo systemctl enable sshd&lt;br&gt;
sudo systemctl start sshd&lt;br&gt;
sudo yum install postfix&lt;br&gt;
sudo systemctl enable postfix&lt;br&gt;
sudo systemctl start postfix&lt;/p&gt;
&lt;p&gt;touch /etc/yum.repos.d/gitlab-ce.repo&lt;/p&gt;
&lt;p&gt;[gitlab-ce]&lt;br&gt;
name=Gitlab CE Repository&lt;br&gt;
baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever&lt;br&gt;
gpgcheck=0&lt;br&gt;
enabled=1&lt;br&gt;
gpgkey=https://packages.gitlab.com/gpg.key&lt;/p&gt;
">GitLab Server çš„æ­å»º</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/scrapy/"" data-c="
          &lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1599211588406.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;åˆ›å»ºé¡¹ç›®&#34;&gt;åˆ›å»ºé¡¹ç›®&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-python3&#34;&gt;scrapy startproject news_163
cd news_163/
scrapy genspider news news.163.com
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;è®¾ç½®é…ç½®&#34;&gt;è®¾ç½®é…ç½®&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# è®¾ç½®UA
USER_AGENT = &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36&#39;

# å…³é—­ROBOTxåè®®
ROBOTSTXT_OBEY = False

# æ˜¾ç¤ºæŒ‡å®šç±»å‹çš„é¡¹ç›®æ—¥å¿—
LOG_LEVEL = &#39;ERROR&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ‰§è¡Œé¡¹ç›®&#34;&gt;æ‰§è¡Œé¡¹ç›®&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-python3&#34;&gt;scrapy crawl news
&lt;/code&gt;&lt;/pre&gt;
">Scrapy</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/redis-ji-chu-zhi-ling/"" data-c="
          &lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598845148125.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;!-- more --&gt;
&lt;p&gt;Redis é»˜è®¤æœ‰&lt;code&gt;16&lt;/code&gt;ä¸ªæ•°æ®åº“(ç¼–å·ä¸º0~15)ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬&lt;code&gt;0&lt;/code&gt;ä¸ªï¼Œé€šè¿‡å‘½ä»¤&lt;code&gt;select&lt;/code&gt;ä»»æ„åˆ‡æ¢æ•°æ®åº“&lt;/p&gt;
&lt;h1 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h1&gt;
&lt;h2 id=&#34;å­—ç¬¦ä¸²-string&#34;&gt;å­—ç¬¦ä¸² String&lt;/h2&gt;
&lt;h3 id=&#34;å•å€¼ç¼“å­˜&#34;&gt;å•å€¼ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;å³ç®€å•é”®å€¼å¯¹æ•°æ®ç¼“å­˜ï¼›æœ‰ä¸€äº›æ•°æ®éœ€è¦å…±äº«ï¼Œæ¯”å¦‚åœ¨æ²¡æœ‰ç»Ÿä¸€æˆæƒä¸­å¿ƒçš„å¤šä¸ªç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡ç›¸åŒçš„ç®—æ³•å…±äº« token å­—ç¬¦ä¸²è¿›è¡Œå„ç³»ç»Ÿç»Ÿä¸€è®¤è¯&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;# å…¶ä¸­ä¸€ä¸ªç³»ç»Ÿç™»å½•ç”Ÿæˆ token
127.0.0.1:6379&amp;gt; set userId mytoken # å­˜å…¥ token
OK
127.0.0.1:6379&amp;gt; get userId # å…¶ä»–ç³»ç»Ÿå–å‡º token è¿›è¡ŒéªŒè¯
&amp;quot;mytoken&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å¯¹è±¡ç¼“å­˜&#34;&gt;å¯¹è±¡ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;æ¯”å¦‚ä¹‹å‰éƒ½å–œæ¬¢ç”¨ Session ä¿å­˜ç”¨æˆ·æ•°æ®ï¼Œç„¶ååœ¨æ¯ä¸ªç½‘é¡µä¸­è¿›è¡Œä½¿ç”¨ï¼Œä½†å¯¹äºåˆ†å¸ƒå¼æˆ–æ˜¯é›†ç¾¤ç³»ç»Ÿå°±éœ€è¦åš Session å…±äº«äº†ï¼Œä¸€èˆ¬ä¼šå°†ç”¨æˆ·ä¿¡æ¯è½¬ä¸º Json å­—ç¬¦ä¸²è¿›è¡Œç¼“å­˜&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;# ç™»å½•ä¹‹åè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå°†å…¶ç»„è£…æˆ Json å­—ç¬¦ä¸²
127.0.0.1:6379&amp;gt; set userData:userId &amp;quot;{&#39;username&#39;:&#39;Zoe&#39;, &#39;age&#39;:18}&amp;quot; # å°† Json å­—ç¬¦ä¸²ä¿å­˜
OK
127.0.0.1:6379&amp;gt; get userData:userId # æ ¹æ®ç”¨æˆ·ID è·å–æ•°æ®ï¼Œå¹¶è§£æ
&amp;quot;{&#39;username&#39;:&#39;Zoe&#39;, &#39;age&#39;:18}&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ–‡ç« é˜…è¯»æ•°æˆ–ç½‘é¡µæµè§ˆæ•°ç»Ÿè®¡&#34;&gt;æ–‡ç« é˜…è¯»æ•°æˆ–ç½‘é¡µæµè§ˆæ•°ç»Ÿè®¡&lt;/h3&gt;
&lt;p&gt;å­—ç¬¦ä¸²è¿˜å¯ä»¥å­˜å‚¨æ•°å­—æ ¼å¼çš„å€¼ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§å®ç°è®¡æ•°å™¨åŠŸèƒ½ï¼Œæ¯”å¦‚æµè§ˆæ•°ï¼Œè´­ä¹°æ•°ï¼Œç‚¹èµæ•°ç­‰ã€‚å¯ä»¥ä½¿ç”¨&lt;code&gt;INCR&lt;/code&gt;å‘½ä»¤æ¥åˆå§‹åŒ–å¯¹åº”çš„é”®å€¼&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;# ç½‘é¡µè®¿é—®é‡ç»Ÿè®¡
127.0.0.1:6379&amp;gt; incr viewCount
(integer) 1
127.0.0.1:6379&amp;gt; get viewCount
&amp;quot;1&amp;quot;
127.0.0.1:6379&amp;gt; incrby viewCount 5 # å¯ä»¥è‡ªå®šä¹‰æ­¥é•¿
(integer) 6
127.0.0.1:6379&amp;gt; get viewCount
&amp;quot;6&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åˆ†å¸ƒå¼é”&#34;&gt;åˆ†å¸ƒå¼é”&lt;/h3&gt;
&lt;p&gt;å•ä½“ç¨‹åºï¼Œå¤šçº¿ç¨‹é€šè¿‡çº¿ç¨‹é”æ¥æ§åˆ¶èµ„æºæŠ¢å ï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿå°±ç”¨çº¿ç¨‹é”å°±ä¸è¡Œäº†ï¼Œå€ŸåŠ©äº &lt;code&gt;setnx&lt;/code&gt; (set if not existsçš„ç¼©å†™)æ¥å®Œæˆï¼ŒåŠå¦‚æœæ²¡æœ‰å€¼å°±èƒ½æ–°å¢æˆåŠŸï¼Œå¦åˆ™å°±å¤±è´¥ï¼Œå’Œèµ„æºè¢«å å°±è¦ç­‰å¾…åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå½“ç„¶è¿˜å¾—è€ƒè™‘å¯¹åº”å€¼çš„è¿‡æœŸå’Œåˆ é™¤ï¼Œä¸ç„¶ä¸€ç›´å ç”¨ä¹Ÿä¸è¡Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;# ç§’æ€ éœ€è¦å¯¹äº§å“001è¿›è¡Œç§’æ€
127.0.0.1:6379&amp;gt; setnx product:001 true # å…ˆé”ä½ï¼Œç„¶åè¿›è¡Œä¸šåŠ¡å¤„ç†
(integer) 1
127.0.0.1:6379&amp;gt; setnx product:001 false # é”ä½è¿‡ç¨‹ä¸ä¼šè®©å…¶ä»–çº¿ç¨‹è¿›æ¥
(integer) 0
127.0.0.1:6379&amp;gt; del product:001 # é‡Šæ”¾æ‰é”ï¼Œå³åˆ é™¤
(integer) 1
127.0.0.1:6379&amp;gt; setnx product:001 true # å†è¿›æ¥å°±ä¼šæˆåŠŸï¼Œåˆè¢«é”ä½
(integer) 1
127.0.0.1:6379&amp;gt; expire product:001 10 # ä¸ç”¨æ‰‹åŠ¨é‡Šæ”¾çš„è¯ï¼Œå¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´
(integer) 1
127.0.0.1:6379&amp;gt; ttl product:001 # æŸ¥çœ‹è¿˜æœ‰å¤šä¹…è¿‡æœŸ
(integer) 8
127.0.0.1:6379&amp;gt; ttl product:001 # è¶…æ—¶
(integer) -2
127.0.0.1:6379&amp;gt; setnx product:001 true # å¯ä»¥é‡æ–°è®¾ç½®äº†
(integer) 1
127.0.0.1:6379&amp;gt; get product:001 # è·å–åˆ°å€¼
&amp;quot;true&amp;quot;
127.0.0.1:6379&amp;gt; set product:002 true ex 10 nx # ä¸ºäº†å‘½ä»¤çš„åŸå­æ€§æ“ä½œï¼Œå¯ä»¥åœ¨åŠ é”çš„åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´
OK
127.0.0.1:6379&amp;gt; get product:002 # è·å–åˆ°å€¼
&amp;quot;true&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ—è¡¨-list&#34;&gt;åˆ—è¡¨ List&lt;/h2&gt;
&lt;p&gt;å¯ä»¥åŸºäº Redis çš„åˆ—è¡¨å®ç°ç±»ä¼¼æ ˆå’Œé˜Ÿåˆ—çš„æ•°æ®ç»“æ„ï¼ŒåŸºäº Redis çš„æ¶ˆæ¯é˜Ÿåˆ—&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;127.0.0.1:6379&amp;gt; rpush skills &#39;PHP&#39;
(integer) 1
127.0.0.1:6379&amp;gt; rpush skills &#39;Java&#39;
(integer) 2
127.0.0.1:6379&amp;gt; rpush skills &#39;Go&#39;
(integer) 3
127.0.0.1:6379&amp;gt; lrange skills 0 -1
1) &amp;quot;PHP&amp;quot;
2) &amp;quot;Java&amp;quot;
3) &amp;quot;Go&amp;quot;
127.0.0.1:6379&amp;gt; lpop skills
&amp;quot;PHP&amp;quot;
127.0.0.1:6379&amp;gt; lpop skills
&amp;quot;Java&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸Šè¿°æ•°æ®æ·»åŠ å’Œè·å–ç¬¦åˆã€Œå…ˆå…¥å…ˆå‡ºã€è§„åˆ™ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæ ‡å‡†çš„é˜Ÿåˆ—ç»“æ„&lt;/p&gt;
&lt;h2 id=&#34;é›†åˆ-set&#34;&gt;é›†åˆ Set&lt;/h2&gt;
&lt;p&gt;Redis é›†åˆå…·å¤‡æ— åºæ€§ï¼Œæ‰€ä»¥å½“ä½ å‘é›†åˆæ·»åŠ å¤šä¸ªå…ƒç´ æ—¶ï¼Œè¿”å›çš„ç»“æœå’Œæ·»åŠ æ—¶çš„æ’åºå¹¶ä¸ä¸€è‡´ã€‚å½“ä¸šåŠ¡åœºæ™¯éœ€è¦å¯¹é›†åˆæ•°æ®åšå»é‡å¤„ç†è€Œåˆä¸éœ€è¦ç¡®ä¿æ•°æ®é¡ºåºæ—¶ï¼ŒRedis é›†åˆæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æŠ½å¥–é€»è¾‘&#34;&gt;æŠ½å¥–é€»è¾‘&lt;/h3&gt;
&lt;p&gt;æŠ½å¥–å°ä¼™ä¼´ä»¬ä¸é™Œç”Ÿäº†å§ï¼Œä¸ç®¡æ˜¯å…¬å¸å¹´ä¼šæŠ½å¥–ï¼Œè¿˜æ˜¯å…¬ä¼—å·å‚ä¸æŠ½å¥–ï¼Œåº”è¯¥å‡ ä¹ä¸ç”¨äº²æ‰‹æŠ“é˜„äº†å§ã€‚éƒ½æ˜¯é€šè¿‡ç¨‹åºï¼ŒæŠŠäººå‘˜éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œç„¶åéšæœºæŠ½å–ï¼ŒSet å¾ˆç¬¦åˆè¿™ç§åº”ç”¨åœºæ™¯&lt;/p&gt;
&lt;h3 id=&#34;æ–‡ç« ç‚¹èµ&#34;&gt;æ–‡ç« ç‚¹èµ&lt;/h3&gt;
&lt;p&gt;å‘è¡¨æ–‡ç« ä¹‹åï¼Œå¯ä»¥è¿›è¡Œç‚¹èµã€å–æ¶ˆç‚¹èµç­‰ç›¸å…³æ“ä½œ&lt;/p&gt;
&lt;h3 id=&#34;å…±åŒå¥½å‹ç»Ÿè®¡&#34;&gt;å…±åŒå¥½å‹ç»Ÿè®¡&lt;/h3&gt;
&lt;h2 id=&#34;æœ‰åºé›†åˆ-sortedset&#34;&gt;æœ‰åºé›†åˆ SortedSet&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯æ—¢è¦å»é‡ï¼Œåˆè¦ç¡®ä¿æ’åºï¼Œæœ‰åºé›†åˆå°±éå¸¸é€‚ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”¨äºæ’å&#34;&gt;ç”¨äºæ’å&lt;/h3&gt;
&lt;p&gt;æ¯”å¦‚è€ƒè¯•æˆç»©çš„æ’åï¼Œæ–°é—»çƒ­åº¦æ’è¡Œæ¦œï¼Œç›´æ’­æ‰“èµæ’åï¼Œçƒ­é—¨é˜…è¯»ã€çƒ­é—¨è®¨è®ºç­‰&lt;/p&gt;
&lt;h2 id=&#34;å“ˆå¸Œå­—å…¸-hash&#34;&gt;å“ˆå¸Œå­—å…¸ Hash&lt;/h2&gt;
&lt;h3 id=&#34;å¯¹è±¡ç¼“å­˜-2&#34;&gt;å¯¹è±¡ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;String ä¹Ÿèƒ½åšï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ Hash ?ï¼ŒString ä¸€èˆ¬ç”¨äºç®€å•å¯¹è±¡çš„ç¼“å­˜ï¼Œæ¯”å¦‚å­—æ®µä¸å¤šï¼Œè®°å½•ä¹Ÿä¸å¤šçš„æƒ…å†µï¼Œä¾¿äºåºåˆ—åŒ–è§£æã€‚å¹³æ—¶é¡¹ç›®ä¸­æœ‰é…ç½®ä¿¡æ¯æˆ–ä¸‹æ‹‰æ•°æ®ä¿¡æ¯ï¼Œä¼šç”¨äºå„ä¸ªé¡µé¢ï¼Œè¿™ç§å˜åŒ–é¢‘ç‡ä¸é«˜ï¼Œä½†éœ€é¢‘ç¹çš„è¯»å–çš„æ•°æ®ï¼Œå°†å…¶è¿›è¡Œç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®æ˜¯ä¸é”™çš„é€‰æ‹©&lt;/p&gt;
&lt;h3 id=&#34;å½“åšæ•°æ®åº“&#34;&gt;å½“åšæ•°æ®åº“&lt;/h3&gt;
&lt;h3 id=&#34;åšè´­ç‰©è½¦&#34;&gt;åšè´­ç‰©è½¦&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥ç”¨æˆ·IDä¸ºKey&lt;/li&gt;
&lt;li&gt;å•†å“IDä¸ºField&lt;/li&gt;
&lt;li&gt;å•†å“æ•°é‡ä¸ºValue&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;https://www.sohu.com/a/422681400_468635&lt;/p&gt;
&lt;/blockquote&gt;
">Redis åŸºç¡€æŒ‡ä»¤åŠé€‚ç”¨åœºæ™¯</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/bao-ta-da-jian-thinkphp/"" data-c="
          &lt;p&gt;è¦ä½¿ç”¨å®å¡”é¢æ¿é¦–å…ˆéœ€è¦å¼€å¯ç«¯å£:&lt;br&gt;
è…¾è®¯äº‘ï¼š&lt;a href=&#34;https://www.bt.cn/bbs/thread-1229-1-1.html&#34;&gt;https://www.bt.cn/bbs/thread-1229-1-1.html&lt;/a&gt;&lt;br&gt;
é˜¿é‡Œäº‘ï¼š&lt;a href=&#34;https://www.bt.cn/bbs/thread-2897-1-1.html&#34;&gt;https://www.bt.cn/bbs/thread-2897-1-1.html&lt;/a&gt;&lt;br&gt;
åä¸ºäº‘ï¼š&lt;a href=&#34;https://www.bt.cn/bbs/thread-3923-1-1.html&#34;&gt;https://www.bt.cn/bbs/thread-3923-1-1.html&lt;/a&gt;&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;å®‰è£…æ–¹æ³•&#34;&gt;å®‰è£…æ–¹æ³•&lt;/h1&gt;
&lt;p&gt;ç¤ºä¾‹æ˜¯ä½¿ç”¨ &lt;code&gt;CentOS7.4&lt;/code&gt;&lt;br&gt;
æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;yum install -y wget &amp;amp;&amp;amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;amp;&amp;amp; sh install.sh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598669843047.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä¸­é€”å¦‚æœè¯¢é—® &lt;code&gt;Do you want to install Bt-Panel to the /www directory now?(y/n)&lt;/code&gt;: è¾“å…¥ &lt;code&gt;y&lt;/code&gt; å›è½¦å³å¯ï¼›&lt;br&gt;
å‡ºç°ç±»ä¼¼ä¸‹é¢é¡µé¢å°±æ˜¯å®‰è£…å®Œæˆ&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598670082145.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç„¶åæµè§ˆå™¨æ‰“å¼€å¤–ç½‘é¢æ¿åœ°å€çš„é“¾æ¥&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598670218637.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¾“å…¥ &lt;code&gt;username&lt;/code&gt; å’Œ &lt;code&gt;password&lt;/code&gt; å¯¹åº”çš„å€¼å³å®Œæˆç™»å½•&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598670316511.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
é€‰æ‹©ç¯å¢ƒç±»å‹&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598670509110.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
é€‰æ‹©ç¼–è¯‘å®‰è£…ï¼Œä¸€é”®å®‰è£…å³å¯&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598670547784.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å–æ¯èŒ¶ loadIng... ä»»åŠ¡åˆ—è¡¨ä¸º 0 æ—¶è¡¨ç¤ºå®‰è£…æˆåŠŸ&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598671037291.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å®‰è£…éœ€è¦çš„ PHP æ‰©å±•ï¼ˆå¯ä»¥ä¸‹æ‹‰é€‰æ‹©ï¼‰&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598671326212.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å–æ¯èŒ¶ loadIng... ä»»åŠ¡åˆ—è¡¨ä¸º 0 æ—¶è¡¨ç¤ºå®‰è£…æˆåŠŸ&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598671459440.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å–æ¶ˆè¢«ç¦ç”¨çš„ &lt;code&gt;proc_open&lt;/code&gt; å‡½æ•°&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598671733927.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ–°å»ºä¸€ä¸ªç«™ç‚¹&lt;br&gt;
å¯ä»¥æŠŠåŸŸåè§£æåˆ°æœåŠ¡å™¨ IP&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598671957608.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598672008074.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¦‚æœæƒ³ IP ç›´æ¥è®¿é—®&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598673615513.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598673653330.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å®‰è£… &lt;code&gt;composer&lt;/code&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598688092769.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åˆ‡æ¢å›½å†…é•œåƒ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥ç½‘ç«™ç›®å½•&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598687672274.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åˆ é™¤é»˜è®¤æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;rm -rf index.html 404.html .htaccess
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®‰è£… &lt;code&gt;ThinkPHP5.1&lt;/code&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598688693276.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ›´æ”¹ç½‘ç«™è¿è¡Œç›®å½•&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598689879556.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å®šä¹‰ä¼ªé™æ€&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598691222921.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ‰€æœ‰è€…æ”¹ä¸º &lt;code&gt;www&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chown -R www:www * .*
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;èµ‹äºˆæƒé™&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chmod -R 755 *
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œ&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598689933583.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;é—®é¢˜å¤„ç†&#34;&gt;é—®é¢˜å¤„ç†&lt;/h1&gt;
&lt;h2 id=&#34;é—®é¢˜å®‰è£…çš„æ˜¯-php72-æ˜¾ç¤ºçš„-php54&#34;&gt;é—®é¢˜ï¼šå®‰è£…çš„æ˜¯ PHP7.2 æ˜¾ç¤ºçš„ PHP5.4&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598685559996.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åœ¨é€‰ä¸ª PHP ç‰ˆæœ¬ï¼Œæ¥å›åˆ‡ä¸‹å°±è¡Œäº†&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598685555408.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;é—®é¢˜putenv-has-been-disabled-for-security-reasons&#34;&gt;é—®é¢˜ï¼šputenv() has been disabled for security reasons&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598688465332.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åœ¨é…ç½®æ–‡ä»¶å»æ‰ &lt;code&gt;putenv&lt;/code&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598688493779.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;é—®é¢˜å®å¡”é¢æ¿ç½‘ç«™é˜²è·¨ç«™æ”»å‡»-open_basedir-æ— æ³•å…³é—­è§£å†³åŠæ³•&#34;&gt;é—®é¢˜ï¼šå®å¡”é¢æ¿ç½‘ç«™é˜²è·¨ç«™æ”»å‡» &lt;code&gt;open_basedir&lt;/code&gt; æ— æ³•å…³é—­è§£å†³åŠæ³•&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598691497862.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;é—®é¢˜fatal-error-require-failed-opening-required-wwwwwwroo&#34;&gt;é—®é¢˜ï¼šFatal error: require(): Failed opening required â€˜/www/wwwroo...&lt;/h2&gt;
&lt;p&gt;æŠŠç›®å½•ä¸‹çš„ &lt;code&gt;.user.ini&lt;/code&gt; åˆ æ‰ï¼ˆæŠŠé˜²è·¨ç«™æ”»å‡»å‹¾å»æ‰ï¼‰&lt;br&gt;
ç½‘ç«™æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ª &lt;code&gt;.user.ini&lt;/code&gt; çš„æ–‡ä»¶ï¼Œå°†å…¶åˆ æ‰å³å¯&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®˜ç½‘å®‰è£…æ–¹æ³•: &lt;a href=&#34;https://www.bt.cn/bbs/thread-19376-1-1.html&#34;&gt;https://www.bt.cn/bbs/thread-19376-1-1.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
">å®å¡”æ­å»º ThinkPHP</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/redis-gai-lan/"" data-c="
          &lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598489746128.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">Redis æ¦‚è§ˆ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/mysql-you-hua/"" data-c="
          &lt;h1 id=&#34;å®šä½æ…¢-sql&#34;&gt;å®šä½æ…¢ SQL&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ç§æ–¹æ³•æ˜¯æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—&lt;/li&gt;
&lt;li&gt;å¦ä¸€ç§æ–¹æ³•æ˜¯ show process æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„ SQL&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;ä½¿ç”¨ä¸äº†ç´¢å¼•çš„åœºæ™¯&#34;&gt;ä½¿ç”¨ä¸äº†ç´¢å¼•çš„åœºæ™¯&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åº”è¯¥é¿å…éšå¼è½¬æ¢&lt;/li&gt;
&lt;li&gt;likeæŸ¥è¯¢ä¸èƒ½ä»¥%å¼€å¤´&lt;/li&gt;
&lt;li&gt;èŒƒå›´æŸ¥è¯¢æ—¶ï¼ŒåŒ…å«çš„æ•°æ®æ¯”ä¾‹ä¸èƒ½å¤ªå¤§&lt;/li&gt;
&lt;li&gt;ä¸å»ºè®®å¯¹æ¡ä»¶å­—æ®µåšè¿ç®—åŠå‡½æ•°æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598350258439.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;åˆ†é¡µæŸ¥è¯¢&#34;&gt;åˆ†é¡µæŸ¥è¯¢&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®è‡ªå¢ä¸”è¿ç»­ä¸»é”®æ’åºçš„åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ ¹æ®éä¸»é”®å­—æ®µæ’åºçš„åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598350670568.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598350676387.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;å¸¸è§éœ€è¦æ·»åŠ ç´¢å¼•çš„åœºæ™¯&#34;&gt;å¸¸è§éœ€è¦æ·»åŠ ç´¢å¼•çš„åœºæ™¯&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®æ£€ç´¢æ—¶åœ¨æ¡ä»¶å­—æ®µæ·»åŠ ç´¢å¼•&lt;/li&gt;
&lt;li&gt;èšåˆå‡½æ•°å¯¹èšåˆå­—æ®µæ·»åŠ ç´¢å¼•&lt;/li&gt;
&lt;li&gt;å¯¹æ’åºå­—æ®µæ·»åŠ ç´¢å¼•&lt;/li&gt;
&lt;li&gt;ä¸ºäº†é˜²æ­¢å›è¡¨æ·»åŠ ç´¢å¼•&lt;/li&gt;
&lt;li&gt;å…³è”æŸ¥è¯¢åœ¨å…³è”å­—æ®µæ·»åŠ ç´¢å¼•&lt;/li&gt;
&lt;/ul&gt;">MySQL ä¼˜åŒ–</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://weakcc.github.io/post/mysql57-ban-ben-sql_modeonly_full_group_by-wen-ti-jie-jue-ban-fa/"" data-c="
          &lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598348346116.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;!-- more --&gt;
&lt;p&gt;å·² MAMP ä¸ºä¾‹ï¼š&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598348508212.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;http://weakcc.github.io/post-images/1598348628532.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åœ¨[mysqld]ä¸‹é¢æ·»åŠ è¿™æ®µ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://weakcc.github.io/post-images/1598348771324.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æœ€åé‡å¯ MAMP å°±å¯ä»¥äº†&lt;/p&gt;
">MySQL5.7 ç‰ˆæœ¬ sql_mode=only_full_group_by é—®é¢˜è§£å†³åŠæ³•</a>
      </div>
      
    </div>
    <div class="page">
      <div id="page_ul"></div>
    </div>
  </div>
</div>
<script>
  !function () {
    let searchMask = document.querySelector('#search_mask');
    let result = document.querySelector('#result');
    let items = document.querySelectorAll('.item');
    let searchBox = document.querySelector('#search');
    let statCount = document.querySelector('#stat_count');
    let statTimes = document.querySelector('#stat_times');
    let pageUl = document.querySelector('#page_ul');
    let close = document.querySelector('#close');
    
    close.addEventListener('click', function() {
      searchMask.style = 'display: none;'
    })

    let finds = [];
    let contents = [];
    let pageSize = 10;
    items.forEach(item => {
      let a = item.querySelector('a');
      contents.push({
        title: a.innerText,
        details: a.dataset.c,
        link: a.href
      })
      item.remove();
    })

    function insertStr(soure, start, count) {
      let newStr = soure.substr(start, count);
      return soure.slice(0, start) + '<em>' + newStr + '</em>' + soure.slice(start + count);
    }

    pageUl.addEventListener('click', function(event) {
      let target = event.target;
      if (target.__proto__ === HTMLSpanElement.prototype) {
        appendResults(parseInt(target.dataset.i));
      }
    })

    function appendResults(index) {
      let htmlResult = '';
      let start = index || 0;
      let end = Math.min(start + pageSize, finds.length);
      for (let i = start; i < end; i++) {
        const current = finds[i];
        let html = current.title;
        let sum = 0;
        let positions = current.positions;
        positions.forEach(position => {
          html = insertStr(html, position.start + sum, position.count);
          sum += 9;
        })
        htmlResult += `<div class="item"><a class="result-title" href="${current.link}">${html}</a></div>`;
      }
      result.innerHTML = htmlResult;
      pageUl.innerHTML = '';
      let count = finds.length / pageSize;
      let lis = '';
      if (start !== 0) {
        lis += `<span class="fa fa-angle-left" data-i='${start - 1}'></span>`;
      }
      for (let i = 0; i < count; i++) {
        lis += `<span class='${i === start?'current':''}' data-i='${i}'>${i+1}</span>`;     
      }
      if (start+1 < count) {
        lis += `<span class="fa fa-angle-right" data-i='${start+1}'></span>`;  
      }
      pageUl.innerHTML = lis;
    }

    function search(delay) {
      let timer = null
      return function () {
        clearTimeout(timer)
        timer = setTimeout(() => {
          let start = Date.now();
          let segments = searchBox.value.split(' ').filter(c => c != '');
          if (segments.length <= 0) {
            return;
          }
          finds = [];
          let htmlResult = '';
          contents.forEach(content => {
            let title = content.title;
            let positions = [];
            let find = false;
            segments.forEach((segment) => {
              if (content.title.includes(segment)) {
                find = true;
                positions.push({
                  start: content.title.indexOf(segment),
                  count: segment.length
                })
              } else if (content.details.includes(segment)) {
                find = true;
              }
            });
            if (find) {
              finds.push({
                title: content.title,
                link: content.link,
                positions
              });
            }
          })
          appendResults(0);
          statCount.textContent = finds.length;
          statTimes.textContent = Date.now() - start;
        }, delay)
      }
    }
    searchBox.addEventListener('input', search(200));
  }()
</script>

<input hidden id="copy" />
<script>
  !function () {
    let times = document.querySelectorAll('.publish-time');
    for (let i = 0; i < times.length; i++) {
      let date = times[i].dataset.t;
      let time = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
      if (time < 60) {
        str = time + 'ç§’ä¹‹å‰';
      } else if (time < 3600) {
        str = Math.floor(time / 60) + 'åˆ†é’Ÿä¹‹å‰';
      } else if (time >= 3600 && time < 86400) {
        str = Math.floor(time / 3600) + 'å°æ—¶ä¹‹å‰';
      } else if (time >= 86400 && time < 259200) {
        str = Math.floor(time / 86400) + 'å¤©ä¹‹å‰';
      } else {
        str = times[i].textContent;
      }
      times[i].textContent = str;
    }
  }();
</script>

<script>
  let language = '';
  if (language !== '') {
    let map = new Map();
    if (language === 'en') {
      map.set('search', 'Search');
      map.set('category', 'Categories');
      map.set('article', 'Articles');
      map.set('tag', 'Tags');
      map.set('top', 'Top');
      map.set('publish', 'published');
      map.set('minute', ' minutes');
      map.set('read-more', 'Read More');
      map.set('view', 'View');
      map.set('words', ' words');
      map.set('category-in', 'category in');
      map.set('preview', 'Meta');
      map.set('index', 'Toc');
      map.set('no-archives', "You haven't created yet");
      map.set('archives', " articles in total");
      map.set('cloud-tags', " tags in total");
      map.set('copyright', "Copyright: ");
      map.set('author', "Author: ");
      map.set('link', "Link: ");
      map.set('leave-message', "Leave a message");
      map.set('format', "Links Format");
      map.set('site-name', "Name: ");
      map.set('site-link', "Link: ");
      map.set('site-desc', "Desc: ");
      map.set('stat', " related results, taking ");
      map.set('stat-time', " ms");
      map.set('site-img', "Image: ");
    }

    if (map.size > 0) {
      let lanElems = document.querySelectorAll('.language');
      lanElems.forEach(elem => {
        let lan = elem.dataset.lan, text = map.get(lan);
        if (elem.__proto__ === HTMLInputElement.prototype) {
          elem.placeholder = text
        } else {
          if (elem.dataset.count) {
            text = elem.dataset.count + text;
          }
          elem.textContent = text;
        }
      })
    }
  }
  //æ‹¿æ¥ä¸»ä¹‰(çœŸé¦™)^_^ï¼ŒClipboard å®ç°æ‘˜è‡ªæ˜é‡‘ https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })

</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 200
  });
</script>


<script src="/media/js/mouse/peace.js"></script>




  <div class="snow-container"></div>
  <script src="/media/js/bg/snow.js"></script>

</html>